/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 
Edit by binhnt.tamviet@gmail.com
 Revision Details
 V-2.0 AFL - fully re written for clarity, Minor bugs removed
 V-2.1 support AND resistance line added
 V-2.2 Commentary for PlotOHLCsupport AND resistance line breaks Added.
 V-2.3 Revision detail- High Volume Lines added
 V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added
 V-2.5 Bar coloring option included - VSA based OR Trend Based
 V-3.0 Trend detection Method changed to "Random Walk"
 V-3.1 exploration AddedClosePos
 V-3.2 Bug in Exploration fixedupmajoroff
 V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. 
       Reduced unnecessary signals
       Low volume Test signals formula improved
       New signal discription for daily signals added like  "Move indicates Strength or weakness".
       Effort up or down failure also added
       Up and Down Arrows included to indicate change of sentiment.
 V-5.0 Removed some coding issues
       Added Two Bar reversals
       Added Strength Bar
       Added Dash Board for Buy and Sell Pressure
       Added Vwap 
       Added 3 pema and 200 ma plotting  options
       Adde additiona; options for plotting Candle sticks and other options for color
       Added Ribbons for Trend  
 V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)
       1. Hien thi Full thong tin ve Gia va Khoi luong
       2. Phan tich xu huong hien tai
       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)
       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200
       5. Them tu dong ve duong Ho tro, Khang cu gan nhat
       6. Them tuy chinh cac muc Ho tro, Khang cu
       7. Them tu dong ve Hop Darvas 
       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat
       9. Dashboard Bang do thi ap luc Cung Cau
       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)
       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot
       12. Them chi bao Volume
       13. Them chi bao Volume High Line
       14. Them chi bao Volume At Price
       15. Them chi bao  VWAP
       16. Bands
       17. Them tu dong ve duong Bollinger Bands
       18. Them tu dong ve dai bang Keltner Bands system 
       19. Them chi bao Center of Gravity - Trung tam trong luc
       20. He thong mua ban Con Rua - Turtle trading System
       21. Them chi bao Psar
       22. Them chi bao Zig zag
       23. Them chi bao  GAP
       24. Tin hieu Mua Ban luot song ngan han
       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) 
       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)
       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  
       28. Tin hieu mua ban theo ATR
       29. VAP Anna Coulling
      
  
       
       
//===================Version V.5.1 ======================
*/



//====================================================================================|
//                      Begin                                                         |
//====================================================================================|


SetChartOptions(0,chartShowArrows|chartShowDates);

GraphXSpace=Param("* - GraphXSpace - Zoom Chart",20,5,300,5);   //Chon che do Zoom





//|============================================================================================|
//|                         Thong tin Gia thi truong  
//|============================================================================================|   

//|Hien thi ten co phieu va gia dong cua|

_SECTION_BEGIN(" - Thong tin Gia thi truong");


YC       = TimeFrameGetPrice("C",inDaily,-1);
DD       = Prec(C-YC,2);
xx       = Prec((DD/YC)*100,2);

HorGia      = Param(" - Horizontal - Toa do Ngang",450,-900,1500,1);  // Vi tri ngang
VerGia      = Param(" - Vertical - Toa do Doc",1,1,1000,1);    // Vi tri doc

//Phong nen
GfxSetBkMode( colorWhite );
GfxSetTextColor( ParamColor(" - Fonts Color",colorCustom9));  // Hien thi mau chu

if (ParamToggle( "* - Hien thi Thong tin Gia",  "OFF|ON", 1 ))
{

//Hien chu
GfxSelectFont("Times New Roman", Param("Font Size",25,1,100,1), 700, italic = True, underline = False, True ); //chon Fonts
GfxTextOut( Name(), HorGia+700,  VerGia -10 );  //|Hien thi ten co phieu
GfxTextOut(""+C,    HorGia+950 , VerGia-10 ); //|Hien thi gia dong cua

//|Hien thi % thay doi gia
GfxSelectFont("Times New Roman", Param("Number Size",10,1,100,1), 700, italic =True, underline = False, True );
GfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", HorGia+950, VerGia+50); //|Hien thi thay doi gia dong cua
GfxTextOut("("+MarketID(1)+")", HorGia+700,  VerGia +50 ); 


}


if (ParamToggle( "* - Hien thi Thong tin Tai chinh",  "OFF|ON", 1 ))
{
//Thong tin tai chinh
Hor=Param("Horizontal Position",1800,-700,2500,1);  // Vi tri ngang
Ver=Param("Vertical Position",-55,-55,600,1);    // Vi tri doc
GfxSelectFont("Times New Roman",  Param("TC Font Size",10,1,100,1), 600, bold =True, underline = False, True );
GfxTextOut("CHI SO TAI CHINH:", Hor+10, Ver+55 );
GfxTextOut("EPS: " + Prec( GetFnData( "EPS" )*1000,0), Hor+10, Ver+85 );
GfxTextOut("P/E: " + Prec( (Close/GetFnData( "EPS" )),1), Hor+10, Ver+105 );
GfxTextOut("P/B: " + Prec(  Close / GetFnData( "BookValuePerShare" ),1), Hor+10, Ver+125 );
GfxTextOut("P/S: " + Prec( Close / GetFnData( "SalesPerShare" ),1), Hor+10, Ver+145 );
GfxTextOut("Sales/CP: " + Prec(  GetFnData( "SalesPerShare" )*1000,0), Hor+10, Ver+165 );
GfxTextOut("Bookvalue: " + Prec(  GetFnData( "BookValuePerShare" )*1000,0), Hor+10, Ver+185 );
GfxTextOut("ROE: " + Prec(  GetFnData( "ReturnOnEquity" ),0)+"%", Hor+10, Ver+205 );
GfxTextOut("ROA: " + Prec(  GetFnData( "ReturnOnAssets" ),0)+"%", Hor+10, Ver+225 );
GfxTextOut("KLCP: " + Prec( GetFnData("SharesOut")/1000000,3)+" (Trieu)", Hor+10, Ver+245 );
GfxTextOut("Float: " + Prec(  GetFnData("sharesfloat")/1000000,3)+" (Trieu)"+" = ("+ Prec(  GetFnData("sharesfloat")/GetFnData("SharesOut")*100,0)  +"%)", Hor+10, Ver+265 );
GfxTextOut("Von hoa: " + Prec( GetFnData("SharesOut")*C/1000000,0)+" (Ty)", Hor+10, Ver+285 );
GfxTextOut("VCSH: " + Prec(  GetFnData("SharesOut") * GetFnData( "BookValuePerShare" ) / 1000000,0) +" (Ty)", Hor+10, Ver+305 );
GfxTextOut("Market: " + MarketID(1), Hor+10, Ver+325 );
GfxTextOut("Nganh: " + IcbID(1), Hor+10, Ver+345 );
GfxTextOut("Nhom: " + SectorID(1), Hor+10, Ver+365 );

}

//    END Hien thi gia thi truong  

_SECTION_END();












//*******************************************************************************************************




//==========================================================================|
//                   Dash Board - Bang dieu khien                                 |
//==========================================================================|

_SECTION_BEGIN(" - Dash Board - Do thi Ap luc Cung Cau");


Vlb  = Param(" - Khoang thoi gian xem lai Volume",60,20,300,10);
xf=Param(" - Horizontal - Toa do Ngang",570,-200,1300,1);  //Ngang
yf=Param(" - Vertical - Toa do Doc", 0,-130,600,1); //Doc


//==========================================================================|
//                   Hien thi Dash Board - Bang dieu khien                                 |
//==========================================================================|

if (ParamToggle( "* - Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))
{

sp 		= H-C;  //Bien dong tren close
bp 		= C-L;  //Bien dong duoi Close
bpavg 	= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close
spavg 	= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close
nbp 	= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh
nsp 	= sp/spavg;  //ty le cua bien dong tren so voi trung binh
diff 	= nbp-nsp;  //Hieu so giua 2 ty le
Varg = WMA(V,10);  //Trung binh Volume 10 ngay
nv = V/Varg;        //ty le volume so voi trung binh
nbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh
nsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh
nbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)
nsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)
bfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)
bfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)
nfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            
nfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     
//Luc Cau (Mua)
bfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); 
//Luc Cung (Ban)
nfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  

//Phong nen

GfxSetBkMode( colorWhite );

//Vi tri toan bo bieu bo 
xDashBoard=Status("pxchartleft")+xf;  
yDashBoard=Status("pxcharttop")+yf;


//================= Buying Pressure Bar graph ================
//--------------Bieu do luc Cau - Mua-------------------------
//============================================================

//Gia tri tinh luc Cau - Mua
x1Buy = SelectedValue(bfnor);   
//Vi tri hinh chu nhat the hien Gia tri tinh luc Cau - Mua trong bieu do
y1Buy = yDashBoard + 100-x1Buy;

//--------------bargraph---------------------------------------
//Nen chu nhat co dinh 
GfxSelectSolidBrush( colorLime ); 
//Vien chu nhat co dinh
GfxSelectPen( colorPaleTurquoise );  
//Vi tri chu nhat co dinh
GfxRectangle(   xDashBoard+55-40-20,    yDashBoard+100+1  , 
                xDashBoard+65-40-20+3,    yDashBoard +1     );
//Vi tri luc Cau - Mua
GfxGradientRect(xDashBoard+55-40-20+1,  y1Buy +3,
                xDashBoard+65-40-20+3-1,  yDashBoard+100,
//Mau sac luc Cau - Mua
colorDarkGreen,colorGreen);
//Chu "Buy"
GfxSelectFont("Times New Roman", 8, xf );
GfxSetTextColor( colorYellow ); 
GfxTextOut("Buy", xDashBoard+55-40-22-3,yDashBoard+100+6 );

//================= Selling Pressure Bar graph ================
//--------------Bieu do luc Cung - Ban-------------------------
//=============================================================

//Gia tri tinh luc Cung - Ban
x2Sell = SelectedValue(nfnor);  
//Vi tri hinh chu nhat the hien Gia tri tinh luc Cung - Ban trong bieu do
y2Sell = yDashBoard + 100-x2Sell;

//--------------bargraph---------------------------------------
//Nen chu nhat co dinh 
GfxSelectSolidBrush( colorLightOrange );
//Vien chu nhat co dinh 
GfxSelectPen( colorRose );
//Vi tri chu nhat co dinh
GfxRectangle(    xDashBoard+75+20-60-10-3,   yDashBoard+100+1, 
                 xDashBoard+85+20-60-10,   yDashBoard +1      );
//Vi tri luc Cung - Ban
GfxGradientRect( xDashBoard+75+20-60-10-3+1, y2Sell+2,
                 xDashBoard+85+20-60-10-1, yDashBoard+100,
//Mau sac luc Cung - Ban                
colorDarkRed,colorBrown);
//Chu "Sell"
GfxSelectFont("Times New Roman", 8, xf );
GfxSetTextColor( colorYellow ); 
GfxTextOut("Sell", xDashBoard+75+17-60-10-3,yDashBoard+100+6 );

//======================
//Dau cach
GfxSelectSolidBrush( colorOrange );
//Vien chu nhat co dinh 
GfxSelectPen( colorRose );
//Vi tri chu nhat co dinh
GfxRectangle(    xDashBoard+75+20-60+5,   yDashBoard+100+1, 
                 xDashBoard+85+20-60+5,   yDashBoard +97      );



//========================Effort (Volume - No luc)===============================
//------------------------------------------------
//Effort (Volume - No luc)
//------------------------------------------------
Vrg1  = WMA(V,40);// average volume - Volume trung binh
Vro  = V/Vrg1;//ratio of volume to average  - Ty le Volume hien tai so voi trung binh
Vmax = HHV(Vro,40); //High cua Ty le Volume hien tai so voi trung binh
Vmin = LLV(Vro,40); //Low cua Ty le Volume hien tai so voi trung binh

//Gia tri tinh Effort (Volume - No luc)
Vnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai
//------------------------------------------------
//========Effort===========
//Gia tri tinh Effort
x5Effort = SelectedValue(vnor);
//Vi tri cua Gia tri tinh Effort
y5Effort = yDashBoard+230-39-90-x5Effort;

//Nen chu nhat co dinh 
GfxSelectSolidBrush(colorTurquoise); 
//Vien chu nhat co dinh 
GfxSelectPen(colorLightYellow );

//Vi tri chu nhat co dinh
GfxRectangle(   xDashBoard+55-1,    yDashBoard+230-39-90   , 
                xDashBoard+65+1,    yDashBoard+130-39 -90    );
//Vi tri bien dong Effort
GfxGradientRect(xDashBoard+55,     yDashBoard+130+x5Effort-39-90+1   ,
                xDashBoard+65,     yDashBoard+230-39-90-1    ,
//Mau cua bien dong Effort
colorIndigo,colorViolet);

//Chu "Ef"
GfxSelectFont("Times New Roman", 8, xf );
GfxSetTextColor(colorYellow ); 
GfxTextOut("Ef", xDashBoard+55,yDashBoard+235-39-90 );




//========================Result - Danh gia ket qua tang giam Gia===============================
//------------------------------------------------
//Result - Danh gia ket qua tang giam Gia
//------------------------------------------------
rs   = abs(C-Ref(C,-1));//Result - Ket qua hien tai (Gia hien tai tang giam so voi hom truoc)
rsg  = Wilders(rs,40);//Average Result - Ket qua trung binh
rso  = rs/rsg; //ratio of result to average - Ty le Ket qua hien tai so voi Trung binh
rmax = HHV(rso,40); //High cua Ty le Ket qua hien tai so voi Trung binh
RMIn = LLV(rso,40); //Low cua Ty le Ket qua hien tai so voi Trung binh
//Gia tri tinh Result
rnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua 
//------------------------------------------------
//========Result===========
//Gia tri tinh Result
x4Result = SelectedValue(rnor);
//Vi tri cua Gia tri tinh Spread
y4Result = yDashBoard+230-39-90-x4Result;
//Nen chu nhat co dinh 
GfxSelectSolidBrush(colorTurquoise); 
//Vien chu nhat co dinh 
GfxSelectPen(colorRose);
//Vi tri chu nhat co dinh
GfxRectangle(    xDashBoard+75-1,     yDashBoard+230-39-90,
                 xDashBoard+85+1,     yDashBoard+130-39-90);
//Vi tri bien dong Result
GfxGradientRect( xDashBoard+75,     yDashBoard+130+x4Result-39-90+1,
                 xDashBoard+85,     yDashBoard+230-39-90-1,
//Mau cua bien dong Result
colorGrey40,colorSeaGreen) ;
//Chu "Re"
GfxSelectFont("Times New Roman", 8, xf );
GfxSetTextColor( colorYellow ); 
GfxTextOut("Re", xDashBoard+75,yDashBoard+235-39-90 );




//=======================Spread - Chenh lech gia========================================
//------------------------------------------------
//Tinh Spread la chenh lech giua gia mo cua (Open) va dong cua (Close)
//------------------------------------------------
//Tinh gia tri cua Spread
spC_O   = IIf(/*Neu tang gia (Open>Close)*/ (C > O), sp1 = (H-L)-(H-C)-(O-L),IIf(/*Neu giam gia (Open<Close)*/ (C < O), sp2 = (H-L)-(H-O)-(C-L), /*Neu tham chieu (Open=Close)*/ 0)); //Spread - Chenh lech gia
arg2 = Wilders(spC_O,40);//Average Spread - Muc Spread trung binh
sro2  = spC_O/arg2;//ratio of spread to average - Ty le Spread hien tai so voi trung binh
smax2 = HHV(sro2,40); //High cua Ty le Spread hien tai so voi trung binh
smin2 = LLV(sro2,40); //Low cua Ty le Spread hien tai so voi trung binh
//Gia tri tinh Spread
snor2 = ( smax2-sro2 )*100/(smax2-Smin2 + 1e-9); //Danh gia gia tri cua Spread hien tai
//------------------------------------------------
//========Spread===========
//Gia tri tinh Spread
x6Spread = SelectedValue(snor2);
//Vi tri cua Gia tri tinh Spread
y6Spread = yDashBoard+230-39-90-x6Spread;

//Nen chu nhat co dinh 
GfxSelectSolidBrush(colorTurquoise); 
//Vien chu nhat co dinh 
GfxSelectPen(colorAqua);

//Vi tri chu nhat co dinh
GfxRectangle(   xDashBoard+95-1,     yDashBoard+230-39-90, 
                xDashBoard+105+1,    yDashBoard+130-39-90    );
//Vi tri bien dong Spread
GfxGradientRect(xDashBoard+95,     yDashBoard+130+x6Spread-39-90+1,
                xDashBoard+105,    yDashBoard+230-39-90-1    ,
                
//Mau cua bien dong Spread
colorDarkBlue,colorBlue);

//Chu "Sp"
GfxSelectFont("Times New Roman", 8, xf );
GfxSetTextColor( colorYellow ); 
GfxTextOut("Sp", xDashBoard+95,yDashBoard+235-39 -90    );




//=======================Range - Bien dong gia========================================
//------------------------------------------------
//Range - Bien dong gia
//------------------------------------------------
rg   = (H-L); //Range - Bien dong gia
arg1 = Wilders(rg,40);//Average Range - Muc Range trung binh
sro  = rg/arg1;//ratio of Range to average - Ty le Range hien tai so voi trung binh
smax = HHV(sro,40); //High cua Ty le Range hien tai so voi trung binh
smin = LLV(sro,40); //Low cua Ty le Range hien tai so voi trung binh
//Gia tri tinh Range
snor = ( smax-sro )*100/(smax-Smin + 1e-9); //Danh gia gia tri cua Range hien tai
//------------------------------------------------
//========Range===========
//Gia tri tinh Range
x3Range = SelectedValue(snor);
//Vi tri cua Gia tri tinh Range
y3Range = yDashBoard+230-39-90-x3Range;

//Nen chu nhat co dinh 
GfxSelectSolidBrush(colorTurquoise); 
//Vien chu nhat co dinh 
GfxSelectPen(colorSkyblue);

//Vi tri chu nhat co dinh
GfxRectangle(   xDashBoard+95+20-1,     yDashBoard+230-39-90, 
                xDashBoard+105+20+1,    yDashBoard+130-39-90    );
//Vi tri bien dong Range
GfxGradientRect(xDashBoard+95+20,     yDashBoard+130+x3Range-39-90+1,
                xDashBoard+105+20,    yDashBoard+230-39-90-1    ,
                
//Mau cua bien dong Range
colorOrange,colorYellow);

//Chu "Ra"
GfxSelectFont("Times New Roman", 8, xf );
GfxSetTextColor( colorYellow ); 
GfxTextOut("Ra", xDashBoard+95+20,yDashBoard+235-39 -90    );

//*********************************************************************

//========Strength RSI===========
RSIPeriod =  Param(" - Time RSI", 14, 2, 100, 1);
LbRSI     = Param("LookBack RSI Period",60,40,120,1); // Vung theo doi tin hieu
mySig1 = RSI(RSIPeriod);  //Tin hieu RSI
Adev = StDev(mySig1, 3*RSIPeriod); //Suc manh RSI
jhRSI = HHV(mySig1,LbRSI); //High cua muc RSI trong ky
jlRSI = LLV(mySig1,LbRSI); //Low cua muc RSI trong ky
jcRSI = (WMA((jhRSI-jlRSI),RSIPeriod)*0.60)+WMA(jlRSI,RSIPeriod); //trung binh cua muc RSI trong ky
Hiline = jhRSI-jcRSI*0.2; //Vung gia tri tren
Loline = jlRSI+jcRSI*0.2; //Vung gia tri duoi
midline = (jhRSI-jlRSI)/2; //Vung gia tri giua

RStrengthRSI =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;

RxRSI =IIf(RStrengthRSI>HiLine,1,IIf(RStrengthRSI<loLine,0,2));
PARSI =SelectedValue(RxRSI);
//Vong tron Den co dinh
GfxSelectSolidBrush( colorBlack ); 
//Vien vong tron Den co dinh
GfxSelectPen( colorWhite );
//Vi tri vong tron Den co dinh
GfxCircle(              xDashBoard+135+20,   yDashBoard+200-39 -90      ,12);//GfxCircle( fvb+480,fvb-475,  10);
GfxCircle(              xDashBoard+135+20,   yDashBoard+200-39 -90      ,15);
//Chu "Strength"
GfxSelectFont("Times New Roman", 8, 800 );
GfxSetTextColor( colorLime ); 
GfxTextOut("Strength", xDashBoard+120+20,    yDashBoard+235-39-90 ); 

for(i = 10; i < BarCount; i++)


if (PARSI[i]==1)
{
GfxSelectSolidBrush( colorLime ); 
GfxSelectPen( colorLime );
GfxCircle(  xDashBoard+135+20,   yDashBoard+200-39 -90   ,12);//GfxCircle( fvb+480,fvb-475,  10);
}
	else if (PARSI[i] == 0)
{
GfxSelectSolidBrush( colorRed ); 
GfxSelectPen( colorRed );
GfxCircle( xDashBoard+135+20,   yDashBoard+200-39 -90   ,12);//GfxCircle( fvb+480,fvb-475,  10);
}
	else 
{
GfxSelectSolidBrush( colorYellow ); 
GfxSelectPen( colorYellow );
GfxCircle( xDashBoard+135+20,   yDashBoard+200-39 -90    ,12);//GfxCircle( fvb+480,fvb-475,  10);
}

 



}
 

////END Dash Board

_SECTION_END();




//**************************************************************************************************

















//=========================================================================|
//                     Trend Analysis Module - Random Walk Method  
//                        Phan tich Xu huong                               |
//=========================================================================|

_SECTION_BEGIN(" - Phan tich Trend xu huong");


 //========================Trend Estimation ================================


 minperiodsRWIst = Param ( " - Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); 
 maxperiodsRWIst = Param ( " - Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); 
 
 kTrend      = RWI   (minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo
 Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground > 1, 1,0); //Xu huong ngan han: TANG - UP    OK
 Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky > 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK




 minperiodsRWIlt = Param ( " - Chon Min vung dao dong dai", 11 , 1 , 200 , 1); 
 maxperiodsRWIlt = Param ( " - Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  

 jTrend      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo

 j2Trend     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2>1,1,-1); //Xu huong trung han: TANG - UP     OK
 k2Trend     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2>1,1,-1); //Xu huong trung han:     GIAM - DOWN
 


 // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what
 ja     = Cross(jTrend,1); //Giao cat j vuot len dinh tren ngan han
 jb     = Cross(1,jTrend); //Giao cat j giam xuong dinh tren ngan han
 jc     = Cross(-1,jTrend); //Giao cat j voi day ngan han                bao muon hon k2a
 jd     = Cross(jTrend,-1); //Giao cat j quay lai day ngan han
 j2a    = Cross(j2Trend,1); //vuot dinh trung han
 j2b    = Cross(1,j2Trend); // quay tro lai dinh trung han
 k2a    = Cross(k2Trend,1); //pha dinh trung han             ok bao som hown jc
 k2b    = Cross(1,k2Trend); //quay tro lai day trung han
 


//Define the Major, Minor and Immediate trend Sttatus

upmajoron   = jTrend > 1 AND Ref(ja,-1);
dnmajoron   = jTrend < -1 AND Ref(jc,-1);
upminoroff  = jTrend < 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK
dnminoroff  = jTrend > -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK 

upminoron   = j2Trend > 1 AND Ref(j2a,-1); 
dnminoron   = k2Trend > 1 AND Ref(k2a,-1); 
upmajoroff  = j2Trend < 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   
dnmajoroff  = k2Trend < 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   

//Ngan han
upimd       = IIf(ground > 1, 1,0); //Xu huong ngan han: TANG - UP    OK
dnimd       = IIf(sky > 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK

//Trung han
upminor     = IIf(j2Trend>1,1,-1); //Xu huong trung han: TANG - UP     OK
dnminor     = IIf(k2Trend>1,1,-1); //Xu huong trung han:     GIAM - DOWN

//Dai han
upmajor     = IIf(jTrend>1,1,IIf(jTrend<(-1),-1,0));  
updaihan    = upminor AND  C > MA(C,100) AND C > MA(C,150) AND C > MA(C,200) AND   MA(C,10) > MA(C,200);
downdaihan  = dnminor AND C < MA(C,100) AND C < MA(C,150) AND C < MA(C,200)  AND   MA(C,10) < MA(C,200);
trenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  


//======================================================================================================

//====================================================================================|

//0.Loc gia thap nhat
PriceMin = C >= 10;

//1. Gia tang trong Uptrend kem thanh khoan cao
//===============================================
//Gia dang tang so voi hom qua 
Priceup = C >= 1.01*Ref(C,-1) ;

//Gia dang tang so voi hom qua 
PriceupMarketdown = C >= 1.0*Ref(C,-1) ;


//Loc CP co thanh khoan cao
HighVolume = Volume > 50000 AND MA(V,30) > 100000 AND Ref(V,-5) > 50000 AND Ref(V,-10) > 50000 AND Ref(V,-20) > 50000 ;  

//Gia cao hon cac duong MA10,20,30,50,100
PriceUpMA = C > EMA(C,5) AND C > EMA(C,10) AND C > EMA(C,20)  AND C > EMA(C,30) AND C > MA(C,50) AND C > MA(C,100)  ;

//Duong EMA5 cao hon EMA10,20,30 MA50,100
EMA5up = EMA(C,5) > EMA(C,10) AND EMA(C,5) > EMA(C,20) AND EMA(C,5) > EMA(C,30)  AND EMA(C,5) > MA(C,50)   AND EMA(C,5) > MA(C,100) ;  

//Duong EMA10 cao hon EMA20,30 MA50,100
EMA10up = EMA(C,10) > EMA(C,20) AND EMA(C,10) > EMA(C,30)  AND EMA(C,10) > MA(C,50)   AND EMA(C,10) > MA(C,100); 
 
//Giai doan 2 Uptrend Mark Minervini     
UptrendMark = C > MA(C,150) AND C > MA(C,200)   
AND EMA(C,5) > MA(C,150)   AND EMA(C,5) > MA(C,200) 
AND EMA(C,10) > MA(C,150)   AND EMA(C,10) > MA(C,200) 
AND MA(C,50) > MA(C,150) AND MA(C,50) > MA(C,200) AND MA(C,200) > Ref(MA(C,200),-22)  ;  

//Gia cao hon Day it nhat 30% & gan Dinh it nhat 30% trong 52 tuan
Price52WeekLow  = C >= 1.3*LLV(C,260);
Price52WeekHigh = C >= 0.7*HHV(C,260) ;




//2. Gia giam trong Downtrend 
//===============================================
//Gia dang giam so voi hom qua 
Pricedown = C < 1.01*Ref(C,-1) ;

//Gia thap hon cac duong MA 10,20,30,50,100
PriceDownMA = C < EMA(C,10) AND C < EMA(C,20)  AND C < EMA(C,30) AND C < MA(C,50) AND C < MA(C,100)  ;

//Duong EMA5 thap hon EMA10,20,30 MA50,100
EMA5down = EMA(C,5) < EMA(C,10) AND EMA(C,5) < EMA(C,20) AND EMA(C,5) < EMA(C,30)  AND EMA(C,5) < MA(C,50)   AND EMA(C,5) < MA(C,100) ;  

//Duong EMA 10 thap hon EMA20,30 MA50,100
EMA10down = EMA(C,10) < EMA(C,20) AND EMA(C,10) < EMA(C,30)  AND EMA(C,10) < MA(C,50)   AND EMA(C,10) < MA(C,100);   

//Giai doan 4 Downtrend Mark Minervini 
DowntrendMark = C < MA(C,150) AND C < MA(C,200)                                                                                
AND EMA(C,5) < MA(C,150)   AND EMA(C,5) < MA(C,200) 
AND EMA(C,10) < MA(C,150)   AND EMA(C,10) < MA(C,200) 
AND MA(C,50) < MA(C,150) AND MA(C,50) < MA(C,200) AND MA(C,200) < Ref(MA(C,200),-22)  ;   


//====================================================================================|


//============== High Low MA ==============
HLMAPeriods = Param(" - High Low MA Periods",  20,  1,  260, 1);

HLMAUp =  C > ( MA( H, HLMAPeriods ) + MA( L, HLMAPeriods ) ) / 2;// then Buy next bar at market;

HLMADown = C < ( MA( H, HLMAPeriods ) + MA( L, HLMAPeriods ) ) / 2;// then Sell Short next bar at market;

HLMAstate = IIf( BarsSince( HLMAUp ) < BarsSince( HLMADown ), 1, 0 );

HLMABuy = HLMAstate == 1;

HLMASell = HLMAstate == 0;

//Chart
HLMAColorbar = IIf( HLMABuy, colorBlue, IIf( HLMASell, colorRed, colorGold ) );



//======== EMAStrength ===========

//Xac dinh xu huong
EMAStrengthUp   = C > ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) > EMA( Close, 40 );
EMAStrengthDown = C < ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) < EMA( Close, 40 );

EMAStrength = IIf( EMAStrengthUp, 1, IIf( EMAStrengthDown, -1, 0 ) ); 


//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang
EMAStrengthColor = IIf( EMAStrengthUp, colorBlue, IIf( EMAStrengthDown, colorRed, colorGold ) ); 



//*********************************************************************

//======== RSI Strength===========

RSIPeriod =  Param(" - RSI Periods", 14, 2, 100, 1);
LbRSI     =  Param(" - LookBack RSI Period",60,40,120,1); // Vung theo doi tin hieu
mySig1    =  RSI(RSIPeriod);  //Tin hieu RSI
Adev      =  StDev(mySig1, 3*RSIPeriod); //Suc manh RSI
jhRSI     =  HHV(mySig1,LbRSI); //High cua muc RSI trong ky
jlRSI     =  LLV(mySig1,LbRSI); //Low cua muc RSI trong ky
jcRSI     =  (WMA((jhRSI-jlRSI),RSIPeriod)*0.60)+WMA(jlRSI,RSIPeriod); //trung binh cua muc RSI trong ky
Hiline    =  jhRSI-jcRSI*0.2; //Vung gia tri tren
Loline    =  jlRSI+jcRSI*0.2; //Vung gia tri duoi
midline   =  (jhRSI-jlRSI)/2; //Vung gia tri giua

RStrengthRSI =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;


RSIStrength = IIf( RStrengthRSI>HiLine, 1, IIf( RStrengthRSI<loLine, -1, 0 ) ); 

RSIStrengthColor = IIf(RStrengthRSI>HiLine,colorBlue,IIf(RStrengthRSI<loLine,colorRed,colorGold));



//**********************************************************************
//MADC Strength
//Alexander Elder Impulse

//MACD
r1MACD   = Param( " - MACD Impulse Fast Avg", 12, 2, 200, 1 );
r2MACD   = Param( " - MACD Impulse Slow Avg", 26, 2, 200, 1 );
r3MACD   = Param( " - MACD Impulse Signal Avg", 9, 2, 200, 1 );

mlMACD   = MACD(r1MACD, r2MACD);
slMACD   = Signal(r1MACD,r2MACD,r3MACD);

//Histogram
HistMACD = mlMACD-slMACD;
HistMACDUp   = HistMACD > Ref(HistMACD,-1);
HistMACDDown = HistMACD < Ref(HistMACD,-1);

//MAImpluse
MAImpluse  = Param( " - MA Impluse ", 20, 5, 200, 1 );
MAImpluseUp   = EMA(C,MAImpluse) > Ref(EMA(C,MAImpluse),-1);
MAImpluseDown = EMA(C,MAImpluse) < Ref(EMA(C,MAImpluse),-1);

//MACDStrength
MACDStrength       = IIf(HistMACDUp AND MAImpluseUp,  1  ,    IIf(HistMACDDown AND MAImpluseDown,-1,0));
MACDStrengthColor  = IIf(HistMACDUp AND MAImpluseUp,colorBlue,IIf(HistMACDDown AND MAImpluseDown,colorRed,colorGold));

//===================================================================

//Chi bao
//Cac chi bao ky thuat



//============== Accumulation/Distribution ==============
TRHWilliamR = IIf( Ref( C, -1 ) > H, Ref( C, -1 ), H );
TRLWilliamR = IIf( Ref( C, -1 ) < L, Ref( C, -1 ), L );
adWilliamR = IIf( C > Ref( C, -1 ), C - TRLWilliamR, IIf( C < Ref( C, -1 ), C - TRHWilliamR, 0 ) );
WADWilliamR = Cum( adWilliamR );
wuWilliamR = WADWilliamR > Ref( WADWilliamR, -1 ); //Tich luy
wdWilliamR = WADWilliamR < Ref( WADWilliamR, -1 ); //Phan phoi

//============== RSIBUY ==============
RSIbuy =  Cross( RSI( 14 ), EMA( RSI( 14 ), 9 ) );//Buy RSI
RSIsell = Cross( EMA( RSI( 14 ), 9 ), RSI( 14 ) );//Sell RSI
RSIbuy = ExRem( RSIbuy, RSIsell );
RSIsell = ExRem( RSIsell, RSIbuy );
RSIBullish = RSI( 14 ) > EMA( RSI( 14 ), 9 );//Bullish
RSIBearish = RSI( 14 ) < EMA( RSI( 14 ), 9 );//Bearish

//============== MACD ==============
MACDbuy = Cross ( MACD(), Signal() ); //Buy MACD
MACDsell = Cross( Signal(), MACD() );  //Sell MACD
MACDbuy = ExRem( MACDbuy, MACDsell );
MACDsell = ExRem( MACDsell, MACDbuy );
MACDBulish = MACD() > Signal();
MACDBearish = MACD() < Signal();

//============== STOCHASTIC ==============
StochKval = StochK( 14, 5 );
StochDval = StochD( 14, 5, 5 );
StochBuy = Cross( StochK( 14, 5 ), StochD( 14, 5, 5 ) ); //Buy Stochastic
StochSell = Cross ( StochD( 14, 5, 5 ), StochK( 14, 5 ) );//Sell Stochastic
StochBullish = StochK( 14, 5 ) > StochD( 14, 5, 5 ); //Bullish
StochBearish = StochK( 14, 5 ) < StochD( 14, 5, 5 ); //Bearish

//============== ADX ==============
ADXBuy =  Cross( PDI( 14 ), MDI( 14 ) );//Buy ADX
ADXSell = Cross( MDI( 14 ), PDI( 14 ) );//Sell ADX
ADXBuy = ExRem( adxBuy, adxSell );
ADXSell = ExRem( adxSell, adxBuy );
ADXBullish = PDI( 14 ) > MDI( 14 );//Bullish
ADXBearish = MDI( 14 ) > PDI( 14 );//Bearish

//============== WILLIAM'S %R ==============
WilliamR = ( ( HHV( H, 14 ) - C ) / ( HHV ( H, 14 ) - LLV ( L, 14 ) ) ) * -100;

//==============ZeroLagTMA ==============
//---------------Heiken Ashi Color------------------------
per1HA = 6;
per2HA = 2;
OmHA = MA( O, per1HA );
hmHA = MA( H, per1HA );
lmHA = MA( L, per1HA );
CmHA = MA( C, per1HA );

// 1. Heiken Ashi
HACLOSE = ( OmHA + hmHA + LmHA + CmHA ) / 4;
HaOpen = AMA( Ref( HaClose,  -1 ),  0.5 );
HaHigh = Max( hmHA,  Max( HaClose,  HaOpen ) );
HaLow = Min( lmHA,  Min( HaClose,  HaOpen ) );

// 2. Heiken Ashi MA2
Of = MA( Haopen, per2HA );
Cf = MA( Haclose, per2HA );
Lf = IIf( haOpen < haClose, MA( Halow, per2HA ), MA( Hahigh, per2HA ) );
Hf = IIf( haOpen < haClose, MA( Hahigh, per2HA ), MA( Halow, per2HA ) );
//HeikenAshiColor = IIf( Cf > Of, colorGreen, colorRed );

function ZeroLagTEMA( array, period )
{
    TMA1 = TEMA( array, period );
    TMA2 = TEMA( TMA1, period );
    Diff = TMA1 - TMA2;
    return TMA1 + Diff ;
}

haClose = ( haClose + haOpen + haHigh + haLow ) / 4;

periodtm = 55;
ZLHa = ZeroLagTEMA( haClose, periodtm );
ZLTyp = ZeroLagTEMA( Avg, periodtm );
TMBuy = Cross( ZLTyp, ZLHa );//Buy
TMSell = Cross( ZLHa, ZLTyp );//Sell
TMBuy1 = ZLTyp > ZLHa ;//Bullish
TMSell1 = ZLHa > ZLTyp ;//Bearish

//============== ZeroLagEMA ==============
ZeroLagEMA = ( ( HHV( H, 14 ) - C ) / ( HHV ( H, 14 ) - LLV ( L, 14 ) ) ) * -100;
MaxGraph = 10;
PeriodZ = 10;
EMA1ZeroLag = EMA( ZeroLagEMA, PeriodZ );
EMA2ZeroLag = EMA( EMA1ZeroLag, 5 );
Difference = EMA1ZeroLag - EMA2ZeroLag;
ZeroLagEMA = EMA1ZeroLag + Difference;
PRZeroLag = 100 - abs( ZeroLagEMA );
MoveAvgZeroLag = MA( PRZeroLag, 5 );
ZeroLagBuy = Cross( PRZeroLag, MoveAvgZeroLag ) AND PRZeroLag < 30;
ZeroLagSell = Cross( MoveAvgZeroLag, PRZeroLag ) AND PRZeroLag > 70;
ZeroLagBuy1 = PRZeroLag >= MoveAvgZeroLag AND PRZeroLag >= Ref( PRZeroLag, -1 ) ;
ZeroLagSell1 = ( PRZeroLag < MoveAvgZeroLag ) OR PRZeroLag >= MoveAvgZeroLag AND PRZeroLag < Ref( PRZeroLag, -1 ) ;

//============== Support Resistance ==============
//Chinh lai theo muc ho tro khang cu Gan nhat

RSPrice = ( H + L + C ) / 3;
r1RS = ( 2 * RSPrice ) - L;
s1RS = ( 2 * RSPrice ) - H;
r2RS = RSPrice + ( r1RS - s1RS );
s2RS = RSPrice - ( r2RS - s1RS );
R3RS = RSPrice + ( R2RS - S2RS );
S3RS = RSPrice - ( R3RS - S2RS );


//===============================================================


//Moving Average (Short, Mid & Long Term)
//=========================================
MA20Short = C>MA(C,20);
MA50Mid   = C>MA(C,50);
MA100Long  = C>MA(C,100);
ShortStatus = WriteIf(MA20Short,"Bullish",WriteIf(IsNull(MA(C,20)) ,"N/A","Bearish"));
ShortColor  = IIf(MA20Short,colorSeaGreen,colorRed);
MidStatus   = WriteIf(MA50Mid,"Bullish",WriteIf(IsNull(MA(C,50))," N/A","Bearish"));
MidColor    = IIf(MA50Mid,colorSeaGreen,colorRed);
LongStatus  = WriteIf(MA100Long,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));
LongColor   = IIf(MA100Long,colorSeaGreen,colorRed);


//MACD
//=========================================
MACDBull    = MACD(12,26)>Signal(12,26,9);
MACDStatus  = WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));
MACDColor   = IIf(MACDBull,colorSeaGreen,colorRed);


//RSI
//=========================================
RSI1      = RSI(14)>70 ;
RSI2      = RSI(14)<30 ;
RSI3      = RSI(14)>50 ;
RSI4      = RSI(14)<50 ;
RSIStatus = WriteIf(RSI1,"Overbought",WriteIf(RSI2,"Oversold",WriteIf(RSI3,"Bullish",WriteIf(RSI4,"Bearish","Neutral"))));
RSIColor  = IIf(RSI1,colorSeaGreen,IIf(RSI2,colorRed,IIf(RSI3,colorLime,IIf(RSI4,colorRed,colorGold))));

//Stochastic
//=========================================
StochKBull    = StochK(14,5)>StochD(14,5,5);
StochKStatus  = WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,5)),"N/A","Bearish"));
StochKColor   = IIf(StochKBull,colorSeaGreen,colorRed);



//MFI
//=========================================
MFI1       = MFI(14)>80;
MFI2       = MFI(14)<20;
MFI3       = MFI(14)>50;
MFI4       = MFI(14)<50;
MFIStatus  = WriteIf(MFI1,"Overbought",WriteIf(MFI2,"Oversold",WriteIf(MFI3,"Bullish",WriteIf(MFI4,"Bearish","Neutral"))));
MFIColor   = IIf(MFI1,colorSeaGreen,IIf(MFI2,colorRed,IIf(MFI3,colorLime,IIf(MFI4,colorRed,colorGold))));

//Bollinger Band
//=========================================
BB1       = C>BBandTop(C,20,2) ;
BB2       = C<BBandBot(C,20,2) ;
BBStatus  = WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));
BBColor   = IIf(BB1,colorSeaGreen,IIf(BB2,colorRed,colorGold));


//Aroon
//=========================================
LLVBarsSince     = LLVBars(L,14)+1;
HHVBarsSince     = HHVBars(H,14)+1;
AroonDown        = 100*(14-LLVBarsSince)/(14-1);
AroonUp          = 100*(14-HHVBarsSince)/(14-1);
AroonOsc         = AroonUp-AroonDown;
Aroon            = AroonOsc>0;
AroonStatus      = WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));
AroonColor       = IIf(Aroon,colorSeaGreen,IIf(IsNull(RSI(14) ),colorGold,colorRed));


 TrendScore =
 IIf(MA20Short,1,0)+
 IIf(MA50Mid,1,0) + 
 IIf(MA100Long,1,0)+
 IIf(MACDBull,1,0) +
 IIf(RSI1 OR RSI3,1,0) +
 IIf(StochKBull,1,0)+
 IIf(MFI1 OR MFI3,1,0) +
 IIf(BB1,1,0)+
 IIf(Aroon,1,0) ;
 

_SECTION_END();

//=========================================================================|
// END Analysis Module - Random Walk Method           |
//=========================================================================|




//**************************************************************************************


//=========================================================================|
//                    VPA Basic Module                                     |
//=========================================================================|
_SECTION_BEGIN(" - VPA Basic Module");

    
//===================== Basic Definitions =======================================
volAvg			=	MA(V,45);  //Volume trung binh 45 ngay
volMean 		= 	StDev(volAvg,45); 
volUpBand3 		= 	volAvg + 3*volMean; 
volUpband2 		= 	volAvg + 2*volMean;; 
volUpBand1 		= 	volAvg + 1*volMean;; 
volDnBand1 		= 	volAvg -1*volMean; 
volDnBand2 		= 	volAvg -2*volMean; 
midprice		=	(H+L)/2;
spread			=	(H-L);
avgSpread		=	EMA(spread,45); //Spread trung binh
AvgSpreadBar    =  spread > Avgspread;//REVIEW
wideRangeBar	=	spread>(1.5*avgSpread);
narrowRangeBar	=	spread<(0.7*avgSpread);
lowVolume		=	V<Ref(V,-1) AND Ref(V,-1) < Ref(V,-2) AND V < VolAvg;// Third condition added
upBar		    =	C>Ref(C,-1); 
downBar			=	C<Ref(C,-1); 
highVol  		=	V>Ref(V,-1) AND Ref(V,-1) > Ref(V,-2) AND V > VolAvg;//REVIEW
closeFactor		=	C-L;
clsPosition		=	spread/(closeFactor+ 1e-9 );
closePosition	=	IIf(closeFactor==0,avgSpread,clsPosition);//????
Vb				=	V>volAvg OR V>Ref(V,-1);
upClose		    =	C>=((spread*0.7)+L);// close is above 70% of the Bar
downClose		=	C<=((spread*0.3)+L);// close is below the 30% of the bar
aboveClose		=	C>((spread*0.55)+L) AND C<((spread*0.7)+L);// close is between 55% and 70% of the bar
belowClose		=	C<((spread*0.45)+L) AND C>((spread*0.3)+L);// close is between 45% and 30% of the bar
midClose		=	C>=((spread*0.45)+L) AND C<=((spread*0.55)+L);// close is between 45% and 55% of the bar
veryLowClose	=	closePosition>4;//close is below 25% of the bar
veryHighClose	=	closePosition<1.25;// Close is above 80% of the bar
ClosePos		= 	IIf(C<=((spread*0.2)+L),1,IIf(C<=((spread*0.4)+L) AND C>((spread*0.2)+L) ,2,IIf((C<=((spread*0.6)+L) AND C>((spread*0.4)+L)) ,3,IIf(C<=((spread*0.8)+L) AND C>((spread*0.6)+L),4,5))));
                    //1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose
Volpos			=  	IIf(V>=volAvg*1.6,1,IIf(V>=volAvg*1.1 AND V<volAvg*1.6 ,2,IIf(V>=volAvg*0.9 AND V<volAvg*1.1,3,IIf(V<volAvg*0.9 AND V>=volAvg*0.5,4,5))));
                    //// 1 = Very High, 2 = High, 3 = Average, 4 = Less than Average, 5 = Low
freshGndHi      =  IIf(H == HHV(H,5),1,0);//Muc cao nhat 5 ngay gan day
freshGndLo      =  IIf(L == LLV(L,5),1,0);//Muc thap nhat 5 ngay gan day
//=================New code - FOM =========================
//---------------No Movement Bar --------------------
//- Thanh gia ko di chuyen khi co su thay doi Volume cao
pm       = abs(Close-Open); // price move
pma      = EMA(pm,45); // avg price move
Lpm	     = pm<(0.5*pma); // small price move
bw       =  IIf(C >O, H-C,H-O); // wick - Rau nen tren
bwh      =  bw >= 2*pm; // big wick - Rau dai
fom1     =  (Volume > 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu

//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------
//*******************Diem Manh***************************************
tbcd    =  Ref(C,-1) <  Ref(C,-5) AND Ref(C,-1) <  Ref(C,-4) AND Ref(C,-1) <  Ref(C,-3) AND Ref(C,-1) <  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (Ðang giam gia)
tbc1    =  L < Ref(L,-1)  AND H > Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim
tbc1a   = L < Ref(L,-1)  AND C > Ref(C,-1); // Nen xuyen thau
tbc2    = tbcd ==1 AND tbc1 ==1  AND V>  1.2 * volAvg AND upClose;
tbc2a   = tbcd ==1 AND tbc1a ==1  AND V>  1.2 * volAvg AND upClose AND NOT tbc1;
tbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V<= 1.2 *VolAvg;


//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------
//*******************Diem Yeu***************************************
tbcu   =  Ref(C,-1) >  Ref(C,-5) AND Ref(C,-1) >  Ref(C,-4) AND Ref(C,-1) >  Ref(C,-3) AND Ref(C,-1) >   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (Ðang tang gia)
tbc4   =  tbcu ==1 AND tbc1 ==1  AND V>  1.2 * volAvg AND downClose;
tbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V<= 1.2 * VolAvg;

_SECTION_END();


//======================================================================|
//                      VSA Signal generation                           |
//======================================================================| 
_SECTION_BEGIN(" - Signal Generation");
upThrustBar		=	wideRangeBar AND downClose  AND upimd==1 AND H>Ref(H,-1);//WRB and UHS and 
nut             =   wideRangeBar AND downClose  AND freshGndHi AND highVol;// NEW SIGNAL Upthrsut after a short up move
bc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax
upThrustBarA	=	wideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor>0 AND H>Ref(H,-1)AND (upimd>0 OR upmajor>0)AND VolPos <4;// after minor up trend
upThrustBartrue	=	wideRangeBar AND ClosePos==1 AND upmajor>0 AND H>Ref(H,-1)AND VolPos <4;//occurs after a major uptrend
upThrustCond1	=	Ref(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;
upThrustCond2	=	Ref(upThrustBar,-1) AND downBar AND VolPos == 2;
upThrustCond3	=	upThrustBar AND VolPos ==1;
topRevBar		=	Ref(V,-1)>volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor>0 AND H==HHV(H,10);
PseudoUpThrust	=	Ref(upBar,-1) AND H>Ref(H,-1) AND Ref(V,-1)>1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;
pseudoUtCond	=	Ref(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;
trendChange		=	Ref(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V>volAvg AND upmajor>0 AND upimd>0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;
noDemandBarUt	=	upBar AND narrowRangeBar AND lowVolume AND ClosePos> 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market
noDemandBarDt	=	upBar AND narrowRangeBar AND lowVolume AND ClosePos> 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market
noSupplyBar		=	downBar AND narrowRangeBar AND lowVolume  AND ClosePos<3 AND ((upminor<1 AND upimd<1) OR (upminor>0 AND upimd<1));
lowVolTest		=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L<Ref(L,-1) AND upClose;
lowVolTest1		= 	L==LLV(L,5) AND V<volAvg AND L<Ref(L,-1) AND upClose AND upminor>0 AND upmajor>0;// AND wideRangeBar;
lowVolTest2		= 	Ref(lowVolTest,-1) AND upBar AND upClose;
sellCond1		=	(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;
sellCond2		=	Ref(sellCond1,-1)==0;
sellCond		=	sellCond1 AND sellCond2;
strengthDown0	= 	upmajor<0 AND VolPos<4 AND Ref(downBar,-1) AND upBar AND ClosePos>3 AND upminor<0 AND upimd<=0;// strength after a long down trend
strengthDown	= 	VolPos<4 AND Ref(downBar,-1) AND upBar AND ClosePos>3 AND upimd<=00 AND upminor<0;// Strength after a down trend
strengthDown1	= 	upmajor<0 AND V>(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos>3 AND upminor<0 AND upimd<=0;//Strength after downtrend . High volume
strengthDown2	=	upimd<=0 AND Ref(V,-1)<volAvg  AND upBar AND veryHighClose AND VolPos<4;
buyCond1		= 	strengthDown OR strengthDown1;
buyCond			= 	upBar  AND Ref(buyCond1,-1);
stopVolume		= 	L==LLV(L,5)  AND (upClose OR midClose) AND V>1.5*volAvg AND upmajor<0;
revUpThrust		=	upmajor<0 AND upBar AND upClose AND V>Ref(V,-1) AND V>volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor<0;
effortUp		=	H>Ref(H,-1) AND L>Ref(L,-1) AND C>Ref(C,-1) AND C>=((H-L)*0.7+L) AND spread>avgSpread AND VolPos<4;//AND O<=((H-L)*0.3+L) 
effortUpfail	=	Ref(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));
effortDown		=	H<Ref(H,-1) AND L<Ref(L,-1) AND C<Ref(C,-1) AND  C<=((H-L)*0.25+L) AND wideRangeBar AND VolPos<4;//O>=((H-L)*0.75+
effortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);
upflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR
                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest	OR lowVolTest1 OR lowVolTest2 OR bc);
bullBar		   	=	(V>volAvg OR V>Ref(V,-1)) AND closePosition <2 AND upBar AND NOT upflag;
bearBar			=	vb  AND downClose AND downBar AND spread>avgSpread AND NOT upflag ;
sc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax


//**************************************************************
//-------------------------- Strength - Weakness ----------------------------------------------------

 // Diem Manh
strength	= sc OR tbc2a OR tbc2 or effortDownfail OR 	strengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;
// Diem Yeu
weakness	= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;
//Dau hieu canh bao thay doi xu huong
vsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; 
            
//**************************************************************

_SECTION_END();



//***************************************************************************************************




//====================================================================================|
//               Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |
//====================================================================================|

_SECTION_BEGIN(" - Chon che do Chart: Candle | Bar | Line");

//=========================================================================|
//                    Slope Calculation - Trend                                   |
//=========================================================================|
 sma5                 =  MA(C,5);
 trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)
 trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)
 trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)
 tls               =  LinRegSlope(sma5,5);

//=====================

//VSA Bar 
//Bar coloring formula 1 _ Preferred - Based on VSA Strength
Vscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,
IIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));

//=====================

//Bar coloring formula 2 _  Based on Trend 
Trcolor=IIf(trendShortTerm>0 AND trendMediumTerm>0 AND trendLongTerm>0,colorLime,IIf(trendShortTerm>0 AND trendMediumTerm>0 AND trendLongTerm<0,colorGreen,
IIf(trendShortTerm>0 AND trendMediumTerm<0 AND trendLongTerm<0,colorPaleGreen,IIf(trendShortTerm<0 AND trendMediumTerm<0 AND trendLongTerm<0,colorRed,IIf(trendShortTerm<0 AND trendMediumTerm>0 AND trendLongTerm>0,colorPaleGreen,
IIf(trendShortTerm<0 AND trendMediumTerm<0 AND trendLongTerm>0,colorOrange,colorBlue))))));

//=====================

//Bar coloring formula 3 _  Marar Histogram 
Vlp=Param(" - Khoang thoi gian xem lai Volume Bar Chart",130,20,300,10);
Vrg=MA(V,Vlp);// average volume
rg=(H-L);
arg=Wilders(rg,30);
Vh=V>Ref(V,-1) AND Ref(V,-1)>Ref(V,-2);
Cloc=C-L;
x=(H-L)/(Cloc+ 1e-9);
x1=IIf(Cloc == 0,arg,x);
Vb1 =V>Vrg OR V>Ref(V,-1);
ucls=x1<2;
dcls=x1>2;
mcls=x1<2.2 AND x1>1.8 ;
Vlcls=x1>4;
Vhcls=x1<1.35;
//upbar=C>Ref(C,-1); 
dnbar=C<Ref(C,-1); 
CloseUp =  C>Ref(C,-1);
Closedn =  C<Ref(C,-1);
VolUp   =  V>Ref(V,-1);
VolDn   =  V<Ref(V,-1);
bb1 = upbar AND CloseUp AND ucls AND L>Ref(L,-1);
bb2 = upbar AND VolUp;
bb3 = dnbar AND CloseDn AND VolDn;
bb4 = dnbar AND CloseDn AND C>Ref(L,-1);
db1 = dnbar AND CloseDn AND dcls;
db2 = dnbar AND VolUp  ;
db3 = upbar AND CloseDn AND VolUp;
db4 = upbar AND CloseDn AND C<Ref(L,-1) AND dcls;
db5 = upbar AND CloseUp AND ucls AND L<Ref(L,-1);
db6 = upbar AND CloseUp AND dcls;
bb=(bb1 OR bb2 OR bb3 OR bb4);
db=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);
Mcolor = IIf(bb AND tls>0, colorLime,IIf(db AND tls<0,colorRed,colorWhite)) ; 

//=====================

//Bar coloring formula 4 _ Price Action with Candle 
bubar = (upbar AND Close > Open AND spread > 0.3 * Avgspread);
bebar = (downbar AND Close < Open AND spread > 0.3 * Avgspread);
rngbar = (abs(C-O) < 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) < 0.5*(H-L)) ;
pacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));

//=====================

//Bar coloring formula 5 _  Back ground Strength
//-------------------------- Strength band ----------------------------------------------------
strengthbar	= 	strengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;

weaknessbar	= 	upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;

strength6	=	IIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));
strength5	=	IIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));
strength4	=	IIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));
strength3	=	IIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));
strength2	=	IIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));
strength1	=	IIf(strengthbar,1,IIf(weaknessbar,-1,0));

ConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;

//STrength Bar color
stmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),
IIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),
IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)>=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)<=0,ColorRGB(260,0,0),
IIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), 
IIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));

 
//=====================

//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************

//Chon mau sac thanh Bar

Colorup      = ParamColor( " - Color Bar Up ", colorBlue );
Colordown    = ParamColor( " - Color Bar Down", colorRed );
Colorsideway = ParamColor( " - Color Bar Sideway ", colorGold );
Colorceiling = ParamColor( " - Color Bar Ceiling ", colorViolet );
Colorfloor   = ParamColor( " - Color Bar Floor ", colorTurquoise );

//Change Color theo Gia so voi hom qua
Pcolor       = IIf(C>Ref(C,-1),Colorup,IIf(C<Ref(C,-1),Colordown,Colorsideway));

//Change Color theo Gia tran, san
ChangePcolor = IIf(/*Gia tran>=6%*/xx>=6,Colorceiling,/*Gia san<6%*/IIf(xx<=-6,Colorfloor,/*Tang gia*/IIf(xx>0 AND xx<6,Colorup,/*Giam gia*/IIf(xx<0 AND xx>-6,Colordown,/*Tham chieu*/Colorsideway))));

PStyle       = ParamStyle(" - Chart Style", styleThick );








//*******************************************************************

//***************Lua chon kieu hien thi Chart*************
//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);

//------------------------------------------------------------------------------------------

                                                                      
                                                                      
switch ( ParamList( "* - Chon che do hien thi Candle | Bar", "Candle (1)|Candle (2)|Candle MACD Strength|Candle RSI Strength|Candle High Low MA|Candle EMAStrength|Heiken Ashi|Heiken Ashi (MA)|Bar Close|Bar Based|Bar Trend|Bar VSA Based|Bar Trend Based|Bar Marar Trend Based|Bar Strength|Bar PA|Line", 0 ) )
{

//Nen Nhat 1
case "Candle (1)":

Plot(C, "Close", ChangePcolor , styleCandle | PStyle  );

break;

//*********************************

//Nen Nhat 2
case "Candle (2)":

Plot(C, "Close", Pcolor , styleCandle | PStyle  );

break;



//*********************************

//Candle MACDStrengt - Alexander Elder Impulse
case "Candle MACD Strength":


Plot( C, "Close", MACDStrengthColor, styleCandle | PStyle  );
break;

//*********************************

//Nen Nhat RSIStrength
case "Candle RSI Strength":

Plot(C, "Close", RSIStrengthColor , styleCandle | PStyle  );

break;



//*********************************

//Nen Nhat High Low MA
case "Candle High Low MA":

Plot( C, "Close", HLMAColorbar, styleCandle  | PStyle );

break;



//*********************************

//Nen Nhat EMAStrength
case "Candle EMAStrength":

Plot(C, "Close", EMAStrengthColor , styleCandle | PStyle  );

break;


//*********************************
case "Heiken Ashi":
HeikenAshiClose = (O + H + L + C)/4; 
HeikenAshiOpen = AMA( Ref( HeikenAshiClose, -1 ), 0.5 ); 
HeikenAshiHigh = Max( H, Max( HeikenAshiClose, HeikenAshiOpen ) ); 
HeikenAshiLow = Min( L, Min( HeikenAshiClose, HeikenAshiOpen ) ); 
xDiff = (HeikenAshiHigh - HeikenAshiLow) * 10000;
HeikenAshiColor = IIf(HeikenAshiClose >= HeikenAshiOpen,colorBlue,colorRed);
PlotOHLC( HeikenAshiOpen, HeikenAshiHigh, HeikenAshiLow, HeikenAshiClose, "", HeikenAshiColor, styleCandle );


break;

//*********************************

case "Heiken Ashi (MA)":
//---------------Color------------------------
Heikenper1 = 5;
Heikenper2 = 2;

CmHeiken = MA( C, Heikenper1 );
OmHeiken = MA( O, Heikenper1 );
HmHeiken = MA( H, Heikenper1 );
LmHeiken = MA( L, Heikenper1 );

// 1. Heiken Ashi MA
HaCloseMA = ( OmHeiken + HmHeiken + LmHeiken + CmHeiken ) / 4;
HaOpenMA = AMA( Ref( HaCloseMA,  -1 ),  0.5 );
HaHighMA = Max( HmHeiken,  Max( HaCloseMA,  HaOpenMA ) );
HaLowMA = Min( LmHeiken,  Min( HaCloseMA,  HaOpenMA ) );

// 2. New Heiken Ashi MA
CfMA = MA( HaCloseMA, Heikenper2 );
OfMA = MA( HaOpenMA, Heikenper2 );
HfMA = IIf( HaOpenMA < HaCloseMA, MA( HaHighMA, Heikenper2 ), MA( HaLowMA, Heikenper2 ) );
LfMA = IIf( HaOpenMA < HaCloseMA, MA( HaLowMA, Heikenper2 ), MA( HaHighMA, Heikenper2 ) );

HeikenAshiMAColor = IIf( CfMA > OfMA, colorBlue, colorRed);

PlotOHLC( OfMA, HfMA, LfMA, CfMA, "", HeikenAshiMAColor, styleCandle );

//----------------------------------------------------


break;

//*********************************		


//Bar Close
case "Bar Close":

PlotOHLC(Close,  High,  Low,  Close, "",  ChangePcolor, styleBar | PStyle  );

break;

//*********************************


//Bar Based
case "Bar Based":

PlotOHLC(Open,  High,  Low,  Close, "", ChangePcolor, styleBar | PStyle    );

break;

//*********************************


//Bar Uptrend - Downtrend
case "Bar Trend":

Plot(C, "Price",  EMAStrengthColor , styleBar | PStyle  );

break;


//*********************************


//Bar VSA Based
case "Bar VSA Based":

PlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleBar  | PStyle     );

break;

//*********************************


//Bar VSA Trend Based
case "Bar Trend Based":

PlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleBar | PStyle   );

break;

//*********************************

//Bar Marar Trend Based
case "Bar Marar Trend Based":

PlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleBar | PStyle    );

break;

//*********************************

//Strength Bars
case "Bar Strength":

PlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleBar   | PStyle   );

break;

//*********************************

//PA Bars
case "Bar PA":

PlotOHLC(Open,  High,  Low,  Close, "", pacolor, styleBar | PStyle    );

break;

//*********************************

//Line
case "Line":

//Ve duong gia CP hien tai
PlotOHLC(Open,High,Low,Close,"", ParamColor(" - Line Color", colorGold ), styleLine  | PStyle   ); 

break;

}



ColorPriceintraday = ParamColor( " - Color Price Intraday", colorSeaGreen ) ;



if (ParamToggle( "* - Hien thi Thong tin Gia",  "OFF|ON", 1 ))
{

y = LastValue( C ); 

PlotText(" " + Name() +"             " +"C: " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)" +
                "\n                      V: " +WriteVal(V,1)+   "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  MA30"+ " (" + WriteVal( MA(V,30),1.0) + ")"

, BarCount+ 2 , y, ColorPriceintraday );


}

/*

//Danh gia Volume
If(V>=MA(V,30)*1.6)
{PlotText(  "\n\n Danh gia:    " + "SIEU CAO" ,   BarCount+ 2 , y, ColorPriceintraday );}
If(V<MA(V,30)*1.6 AND V>=MA(V,30)*1.1)
{PlotText(  "\n\n Danh gia:    " + "CAO" ,        BarCount+ 2 , y, ColorPriceintraday );}
If(V<MA(V,30)*1.1 AND V>=MA(V,30)*0.9) 
{PlotText(  "\n\n Danh gia:    " + "TRUNG BINH" , BarCount+ 2 , y, ColorPriceintraday );}
If(V<MA(V,30)*0.9 AND V>=MA(V,30)*0.5)
{PlotText(  "\n\n Danh gia:    " + "THAP" ,       BarCount+ 2 , y, ColorPriceintraday );} 
If(V<MA(V,30)*0.5)
{PlotText(  "\n\n Danh gia:    " + "SIEU THAP" ,  BarCount+ 2 , y, ColorPriceintraday );}


*/

       

//END Plotting Module  -  Hien thi chon Chart: Bar | Candle 

_SECTION_END();



//************************************************************************************************



//==========================================================================|
//                   So sanh RS voi Ticker                                          |
//==========================================================================|


_SECTION_BEGIN(" - So sanh RS voi Ticker");

//CP can so sanh
Ticker            = ParamStr   (" - So sanh RS voi Ticker", "VNINDEX" );
ColorForeign      = ParamColor (" - Ticker Color ", colorAqua );
StyleForeign      =  ParamStyle(" - Ticker Style ",styleThick);
  
if (ParamToggle( "* - Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))
{

//Ve duong gia Ma so sanh
PlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale |styleNoRescale );

y = LastValue( C ); 

PlotText("\n\n\n\n^" + Ticker +  ":      " +  WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 2 , y, ColorForeign);


}


_SECTION_END();
//END So sanh RS voi Ticker 






//==========================================================================|
//                    Cac duong trung binh dong                  |
//==========================================================================|

_SECTION_BEGIN(" - Cac duong Trung binh dong");


/*

//Chon muc gia Dong cua
tye  =   ParamList("1 - Lua chon Gia","Close|Pivot = (H+L+C)/3" ,0);
pe = IIf(tye == "Close" , Close, (H+L+C)/3);
*/

//Cac duong EMAs
//EMA5
ema5Day              = Param(" - EMA5 Day",  5,  1,  500, 1);
LastHigh_ema5Day     = Ref( HHV( High, ema5Day ), -1 );
LastLow_ema5Day      = Ref( LLV( Low, ema5Day ), -1 );
MA_ema5Day           = EMA(C, ema5Day);

//EMA10
ema10Day              = Param(" - EMA10 Day",  10,  1,  500, 1);
LastHigh_ema10Day     = Ref( HHV( High, ema10Day ), -1 );
LastLow_ema10Day      = Ref( LLV( Low, ema10Day ), -1 );
MA_ema10Day           = EMA(C, ema10Day);

//EMA20
ema20Day              = Param(" - EMA20 Day",  20,  1,  500, 1);
LastHigh_ema20Day     = Ref( HHV( High, ema20Day ), -1 );
LastLow_ema20Day      = Ref( LLV( Low, ema20Day ), -1 );
MA_ema20Day           = EMA(C, ema20Day);

//EMA30
ema30Day              = Param(" - EMA30 Day",  30,  1,  500, 1);
LastHigh_ema30Day     = Ref( HHV( High, ema30Day ), -1 );
LastLow_ema30Day      = Ref( LLV( Low, ema30Day ), -1 );
MA_ema30Day           = EMA(C, ema30Day);

//EMA40
ema40Day              = Param(" - EMA40 Day",  40,  1,  500, 1);
LastHigh_ema40Day     = Ref( HHV( High, ema40Day ), -1 );
LastLow_ema40Day      = Ref( LLV( Low, ema40Day ), -1 );
MA_ema40Day           = EMA(C, ema40Day);


//Cac duong MAs

//EMA50
ma50Day              = Param(" - MA50 Day",  50,  1,  500, 1);
LastHigh_ma50Day     = Ref( HHV( High, ma50Day ), -1 );
LastLow_ma50Day      = Ref( LLV( Low, ma50Day ), -1 );
MA_ma50Day           = MA(C, ma50Day);

//EMA100
ma100Day              = Param(" - MA100 Day",  100,  1,  500, 1);
LastHigh_ma100Day     = Ref( HHV( High, ma100Day ), -1 );
LastLow_ma100Day      = Ref( LLV( Low, ma100Day ), -1 );
MA_ma100Day           = MA(C, ma100Day);

//EMA150
ma150Day              = Param(" - MA150 Day",  150,  1,  500, 1);
LastHigh_ma150Day     = Ref( HHV( High, ma150Day ), -1 );
LastLow_ma150Day      = Ref( LLV( Low, ma150Day ), -1 );
MA_ma150Day           = MA(C, ma150Day);

//EMA200
ma200Day              = Param(" - MA20 Day",  200,  1,  500, 1);
LastHigh_ma200Day     = Ref( HHV( High, ma200Day ), -1 );
LastLow_ma200Day      = Ref( LLV( Low, ma200Day ), -1 );
MA_ma200Day           = MA(C, ma200Day);







//==========================================================================|
//                    Ve duong EMA va MA                         |
//==========================================================================|

//Ve EMA 5,10,20
if (plotema5_10_20  =   ParamToggle("1 - EMAs 5,10,20","OFF|ON" , 0 ))
{
// Hien thi cac duong EMA ngan han EMA5,10,20
Plot(IIf(plotema5_10_20 ==1, MA_ema5Day ,Null), "EMA5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);
Plot(IIf(plotema5_10_20 ==1, MA_ema10Day ,Null),"EMA10", colorLightOrange,   styleLine|styleThick|styleNoRescale);
Plot(IIf(plotema5_10_20 ==1, MA_ema20Day ,Null),"EMA20", colorBlue,          styleLine|styleThick|styleNoRescale);

//**********************************************************************************
maupcolor   = ParamColor(" - MA Cloud Up Color",      colorTurquoise );  
madncolor   = ParamColor(" - MA Cloud Down Color",    colorLavender );

bullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  
bearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );


//Ve May EMA10,20
CloudMAswitch = ParamToggle("* - Fill MA10,20 Cloud Color",  "OFF|ON", 0 );
CloudMAcolor = IIf(MA_ema10Day > MA_ema20Day, bullColor , bearColor); 

//Ve may EMA 10 va 20
//PlotOHLC( MA_ema10Day, MA_ema20Day, MA_ema10Day, MA_ema20Day, "", IIf(MA_ema10Day > MA_ema20Day, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);
PlotOHLC( IIf(CloudMAswitch,MA_ema10Day,-1e10),IIf(CloudMAswitch,MA_ema10Day,-1e10),IIf(CloudMAswitch,MA_ema20Day,-1e10),IIf(CloudMAswitch,MA_ema10Day,-1e10), "", CloudMAcolor, styleCloud |styleNoLabel|styleNoRescale);

//Hien thong tin EMA20
if (ParamToggle("* - Thong tin EMA20","OFF|ON" , 0 ))
{
y = LastValue( MA_ema20Day ); 
PlotText("EMA" + WriteVal(ema20Day,1.0) +": "  +WriteVal(MA_ema20Day,1.1), BarCount+ 2 , y, colorSeaGreen );
}

}



// Ve duong EMA30,40
// Hien thi cac duong EMA30
Plot(IIf(ParamToggle("2 - EMA30","OFF|ON" , 0 )  ==1, MA_ema30Day ,Null),"EMA30", colorRed,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong EMA40
Plot(IIf(ParamToggle("3 - EMA40","OFF|ON" , 0 )  ==1, MA_ema40Day ,Null),"EMA40", colorSeaGreen,styleLine|styleThick|styleNoRescale);

//===============================================
// Ve duong MA50,100,150,200

// Hien thi cac duong MA50
Plot(IIf(ParamToggle("4 - MA50", "OFF|ON" , 0 ) ==1, MA_ma50Day ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong MA100
Plot(IIf(ParamToggle("5 - MA100","OFF|ON" , 0 ) ==1, MA_ma100Day ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong MA150
Plot(IIf(ParamToggle("6 - MA150","OFF|ON" , 0 ) ==1, MA_ma150Day ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong MA200
Plot(IIf(ParamToggle("7 - MA200","OFF|ON" , 0)  ==1, MA_ma200Day ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);


// END EMA va MA

_SECTION_END();







//*********************************************************************************************



//====================================================================================|
//                    Muc HO TRO | KHANG CU gan nhat                          |
//====================================================================================|
// START SCRIPT UNTUK SUPPORT / RESISTANT

_SECTION_BEGIN(" - Muc HO TRO - KHANG CU gan nhat");

	
 

 
 
 //==========================================================================|
//                    Ve duong HO TRO - KHANG CU gan nhat                       |
//==========================================================================
 
if (ParamToggle("* - Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))
{

WarnaResistant = ParamColor(" - Chon mau Resistant - Khang cu",colorRed);
WarnaSupport   = ParamColor(" - Chon mau Support - Ho tro",    colorBlue);
SRStyle        = ParamStyle(" - S/R Style",styleNoLabel);

R1_show = 0;
S1_show = 0;
 
	// RESISTANT
	LastHighestValue = LastVisibleValue(Ref(H,-1));
	if (LastVisibleValue(H) == H[LastValue(BarIndex())])
		LastHighestValue = LastVisibleValue(H);
 
	i = 1;
	
	if (LastHighestValue < HighestVisibleValue(H))
	{
			while (LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(H, -1), i)) < LastHighestValue)
				i++;
 
	    	R1 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(H, -1), i));
 
			R1x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));
			Plot(IIf(BarIndex() >= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale );
			PlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);
			R1_show = 1;
 
			i++;
 
			if (HighestVisibleValue( H ) > R1)
			{
				while (LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i)) <= R1)
					i++;
 
				R2 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i));
				R2x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));
	
				Plot(IIf(BarIndex() >= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale );
				PlotText("R2 : " + R2, BarCount + 3, LastValue(R2), WarnaResistant);
				i++;
				if (HighestVisibleValue( H )> R2)
				{ 		
					while (LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i)) <= R2)
						i++;
					R3 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i));
					R3x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));	
 
					Plot(IIf(BarIndex() >= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale);
					PlotText("R3 : " + R3, BarCount + 3, LastValue(R3), WarnaResistant);
				}
			}
	}
	else if (LastHighestValue == HighestVisibleValue(H))
	{
	   	R1 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(H, -1), i));
		R1x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));
		if (R1 == LastHighestValue)
		{
			Plot(IIf(BarIndex() >= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale);
			PlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);
			R1_show = 1;
		}
	}
 
	// SUPPORT
	LastLowestValue = LastVisibleValue(Ref(L,-1));
	if (LastVisibleValue(L) == L[LastValue(BarIndex())])
		LastLowestValue = LastVisibleValue(L);
 
	i = 1;
 
	if (LastLowestValue > LowestVisibleValue(L))
	{	
			while (LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(L, -1), i)) > LastLowestValue)
				i++;
 
			S1 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(L, -1), i));
			S1x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(BarIndex(), -1), i));
			Plot(IIf(BarIndex() >= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
			PlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);
			S1_show = 1;
			i++;
 
			if (LowestVisibleValue( L ) < S1)
			{
				while (LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i)) >= S1)
					i++;
 
				S2 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i));
				S2x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(BarIndex(),-1), i));	
 
				Plot(IIf(BarIndex() >= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
				PlotText("S2 : " + S2, BarCount + 3, LastValue(S2), WarnaSupport);
				i++;
				if (LowestVisibleValue( L )< S2)
				{ 		
					while (LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i)) >= S2)
						i++;
					S3 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i));
					S3x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(BarIndex(),-1), i));
					Plot(IIf(BarIndex() >= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
					PlotText("S3 : " + S3, BarCount + 3, LastValue(S3), WarnaSupport);
				}
			}
	}
	else if (LastLowestValue == LowestVisibleValue(L))
	{
	   	S1 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(L, -1), i));
		S1x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(BarIndex(), -1), i));
		if (S1 == LastLowestValue)
		{
			Plot(IIf(BarIndex() >= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
			PlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);
			S1_show = 1;
		}
	}
 
	if (S1_show AND R1_show)
	{
		SR = Prec((1-(S1/R1))*100,2);
	}
}

//END duong HO TRO - KHANG CU gan nhat  

_SECTION_END();
// END SCRIPT UNTUK SUPPORT / RESISTANT




//**********************************************************************************************




//====================================================================================|
//                       Muc HO TRO - KHANG CU tuy chinh                           |
//====================================================================================|
// AFL By Karthikmarar
// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00
// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines
// Depending on the Share Volatility, the Sensitivity Factor can be adjusted
// Support Lines are colored Blue and Resistance Line are colored Red.


_SECTION_BEGIN(" - Muc HO TRO - KHANG CU tuy chinh");

Rcolor=ParamColor( " - Resistance Color", colorRed );
Scolor=ParamColor( " - Support Color", colorBlue );
Per   =Param(" - Chon do nhay",5,1,100,1);
g     =Param(" - Chon so duong",5,1,20,1);

sr    =ParamToggle("* - Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);

x=Cum(1);
Pk1=PeakBars(H,per,1)== 0;
Tk1=TroughBars(L,per,1)== 0;
//peak detection
px1=LastValue(ValueWhen(pk1,x,1));
px2=LastValue(ValueWhen(Pk1,x,2));
px3=LastValue(ValueWhen(Pk1,x,3));
px4=LastValue(ValueWhen(pk1,x,4));
px5=LastValue(ValueWhen(Pk1,x,5));
px6=LastValue(ValueWhen(Pk1,x,6));
px7=LastValue(ValueWhen(pk1,x,7));
px8=LastValue(ValueWhen(Pk1,x,8));
px9=LastValue(ValueWhen(Pk1,x,9));
px10=LastValue(ValueWhen(Pk1,x,10));
//Trough  Detection
tx1=LastValue(ValueWhen(Tk1,x,1));
tx2=LastValue(ValueWhen(Tk1,x,2));
tx3=LastValue(ValueWhen(Tk1,x,3));
tx4=LastValue(ValueWhen(Tk1,x,4));
tx5=LastValue(ValueWhen(Tk1,x,5));
tx6=LastValue(ValueWhen(Tk1,x,6));
tx7=LastValue(ValueWhen(Tk1,x,7));
tx8=LastValue(ValueWhen(Tk1,x,8));
tx9=LastValue(ValueWhen(Tk1,x,9));
tx10=LastValue(ValueWhen(Pk1,x,10));
//values when Peaks occured
XT1 =LastValue(ValueWhen(pk1,H,1));
XT2 =LastValue(ValueWhen(Pk1,H,2));
XT3 =LastValue(ValueWhen(Pk1,H,3));
XT4 =LastValue(ValueWhen(pk1,H,4));
XT5 =LastValue(ValueWhen(Pk1,H,5));
XT6 =LastValue(ValueWhen(Pk1,H,6));
XT7 =LastValue(ValueWhen(pk1,H,7));
XT8 =LastValue(ValueWhen(Pk1,H,8));
XT9 =LastValue(ValueWhen(Pk1,H,10));
XT10 =LastValue(ValueWhen(Pk1,H,10));
//Value when troughs occured
YT1 =LastValue(ValueWhen(tk1,L,1));
YT2 =LastValue(ValueWhen(tk1,L,2));
YT3 =LastValue(ValueWhen(tk1,L,3));
YT4 =LastValue(ValueWhen(tk1,L,4));
YT5 =LastValue(ValueWhen(tk1,L,5));
YT6 =LastValue(ValueWhen(tk1,L,6));
YT7 =LastValue(ValueWhen(tk1,L,7));
YT8 =LastValue(ValueWhen(tk1,L,8));
YT9 =LastValue(ValueWhen(tk1,L,10));
YT10 =LastValue(ValueWhen(tk1,L,10));
LastBar = Cum(1) == LastValue(Cum(1));
//plot peak lines
Plot(IIf(x>px1 AND g>=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)>XT1, Scolor, Rcolor ));
Plot(IIf(x>px2 AND g>=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)>XT2, Scolor, Rcolor ));
Plot(IIf(x>px3 AND g>=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)>XT3, Scolor, Rcolor ));
Plot(IIf(x>px4 AND g>=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)>XT4, Scolor, Rcolor ));
Plot(IIf(x>px5 AND g>=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)>XT5, Scolor, Rcolor ));
Plot(IIf(x>px6 AND g>=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)>XT6, Scolor, Rcolor ));
Plot(IIf(x>px7 AND g>=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)>XT7, Scolor, Rcolor ));
Plot(IIf(x>px8 AND g>=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)>XT8, Scolor, Rcolor ));
Plot(IIf(x>px9 AND g>=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)>XT9, Scolor, Rcolor ));
Plot(IIf(x>px10 AND g>=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)>XT10, Scolor, Rcolor ));
//plot Trough lines
Plot(IIf(x>tx1 AND g>=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)>YT1, Scolor, Rcolor ));
Plot(IIf(x>tx2 AND g>=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)>YT2, Scolor, Rcolor ));
Plot(IIf(x>tx3 AND g>=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)>YT3, Scolor, Rcolor ));
Plot(IIf(x>tx4 AND g>=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)>YT4, Scolor, Rcolor ));
Plot(IIf(x>tx5 AND g>=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)>YT5, Scolor, Rcolor ));
Plot(IIf(x>tx6 AND g>=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)>YT6, Scolor, Rcolor ));
Plot(IIf(x>tx7 AND g>=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)>YT7, Scolor, Rcolor ));
Plot(IIf(x>tx8 AND g>=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)>YT8, Scolor, Rcolor ));
Plot(IIf(x>tx9 AND g>=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)>YT9, Scolor, Rcolor ));
Plot(IIf(x>tx10 AND g>=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)>YT10, Scolor, Rcolor ));
//Crossing Resistance Lines
xt1c=Cross(C,xt1);
xt2c=Cross(C,xt2);
xt3c=Cross(C,xt3);
xt4c=Cross(C,xt4);
xt5c=Cross(C,xt5);
xt6c=Cross(C,xt6);
xt7c=Cross(C,xt7);
xt8c=Cross(C,xt8);
xt9c=Cross(C,xt9);
xt10c=Cross(C,xt10);
//Breaking support Lines
yt1c=Cross(yt1,C);
yt2c=Cross(yt2,C);
yt3c=Cross(yt3,C);
yt4c=Cross(yt4,C);
yt5c=Cross(yt5,C);
yt6c=Cross(yt6,C);
yt7c=Cross(yt7,C);
yt8c=Cross(yt8,C);
yt9c=Cross(yt9,C);
yt10c=Cross(yt10,C);
//Resistance approaching 
ax1=C<xt1 AND C>xt1*0.97;
ax2=C<xt2 AND C>xt2*0.97;
ax3=C<xt3 AND C>xt3*0.97;
ax4=C<xt4 AND C>xt4*0.97;
ax5=C<xt5 AND C>xt5*0.97;
ax6=C<xt6 AND C>xt6*0.97;
ax7=C<xt7 AND C>xt7*0.97;
ax8=C<xt8 AND C>xt8*0.97;
ax9=C<xt9 AND C>xt9*0.97;
ax10=C<xt10 AND C>xt10*0.97;
//Support approaching
ay1=C>yt1 AND C<yt1*1.03;
ay2=C>yt2 AND C<yt2*1.03;
ay3=C>yt3 AND C<yt3*1.03;
ay4=C>yt4 AND C<yt4*1.03;
ay5=C>yt5 AND C<yt5*1.03;
ay6=C>yt6 AND C<yt6*1.03;
ay7=C>yt7 AND C<yt7*1.03;
ay8=C>yt8 AND C<yt8*1.03;
ay9=C>yt9 AND C<yt9*1.03;
ay10=C>yt10 AND C<yt10*1.03;

//*****************************************************************
//Resistance lines commentary - Dien gia duong ho tro khang cu
//*****************************************************************

src1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;
src2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;
WriteIf(src1 OR src2,"------------------------------------------","");
WriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \n","");
WriteIf(xt1c AND V>volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt1c AND V<volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt2c AND V>volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt2c AND V<volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt3c AND V>volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt3c AND V<volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt4c AND V>volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt4c AND V<volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt5c AND V>volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt5c AND V<volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt6c AND V>volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt6c AND V<volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt7c AND V>volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt7c AND V<volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt8c AND V>volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt8c AND V<volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt9c AND V>volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt9c AND V<volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(xt10c AND V>volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",
WriteIf(xt10c AND V<volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));
//Support line breaks Commentary
WriteIf(yt1c AND V>volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt1c AND V<volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt2c AND V>volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt2c AND V<volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt3c AND V>volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt3c AND V<volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt4c AND V>volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt4c AND V<volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt5c AND V>volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt5c AND V<volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt6c AND V>volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt6c AND V<volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt7c AND V>volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt7c AND V<volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt8c AND V>volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt8c AND V<volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt9c AND V>volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt9c AND V<volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+
WriteIf(yt10c AND V>volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",
WriteIf(yt10c AND V<volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));
//Resistance approaching Commentary
WriteIf(ax1 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+
WriteIf(ax2 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+
WriteIf(ax3 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+
WriteIf(ax4 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+
WriteIf(ax5 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+
WriteIf(ax6 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+
WriteIf(ax7 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+
WriteIf(ax8 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+
WriteIf(ax9 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+
WriteIf(ax10 AND tls>0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");
WriteIf(ay1 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+
WriteIf(ay2 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+
WriteIf(ay3 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+
WriteIf(ay4 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+
WriteIf(ay5 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+
WriteIf(ay6 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+
WriteIf(ay7 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+
WriteIf(ay8 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+
WriteIf(ay9 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+
WriteIf(ay10 AND tls<0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");
_SECTION_END();

//END Ho tro Khang cu tuy chinh




//******************************************************************************************************




//==========================================================================|
//                     Darvas Box    |
//==========================================================================|


_SECTION_BEGIN(" - Darvas Box");

Periods     = Param(" - Darvas Periods",5,1,260); 

boxHigh     = Ref(H,-3)>=Ref(HHV(H,Periods),-4) AND 
              Ref(H,-3)>Ref(H,-2) AND Ref(H,-3)>Ref(H,-1) AND Ref(H,-3)>H;
          

Topbox      = ValueWhen(boxHigh, Ref(H,-3)); 
Botbox      = ValueWhen(boxHigh,LLV(L,4)); 
 
 
if (darvas = ParamToggle( "* - Hien thi Darvas Box",  "OFF|ON", 0 ))
{

/*=========================
  - Allow color change
  - Style change 
 ==========================*/
Plot(TopBox, "Top", ParamColor(" - Box Top Color",  colorRed),  ParamStyle(" - Box Top Style",styleNoLabel)   |styleNoLabel  |styleNoRescale );
Plot(Botbox, "Bot", ParamColor(" - Box Bottom Color",colorBlue),  ParamStyle(" - Box Bottom Style",styleNoLabel)  |styleNoLabel  |styleNoRescale);

}


_SECTION_END();
// END Darvas Box 





//***********************************************************************************************************





//====================================================================================|
//                        Auto Trendline                                 |
//====================================================================================|
_SECTION_BEGIN(" - Auto Trenline");

 
 
 
 //====================================================================================|
//                       Ve duong Auto Trendline                                 |
//====================================================================================|

if (ParamToggle("* - Auto Trenline", "OFF|ON" ,0 ))
{


// Parallel lines defined by the automatic support and the HighestBetween point
xTrenline = Cum(1);
perTrenline = 3;
s1Trenline=L;
s11Trendline=H;
pSTrendline = TroughBars( s1Trenline, perTrenline, 1 ) == 0;
endtTrenline= LastValue(ValueWhen( pSTrendline, xTrenline, 1 ));
starttTrenline=LastValue(ValueWhen( pSTrendline, xTrenline, 2 ));
dtSTrenline =endtTrenline-starttTrenline;
endSTrendline = LastValue(ValueWhen( pSTrendline, s1Trenline, 1 ) );
startSTrendline = LastValue( ValueWhen( pSTrendline, s1Trenline, 2 ));
aSTrendline = (endSTrendline-startSTrendline)/dtSTrenline;
bSTrendline = endSTrendline;
trendlineS = aSTrendline * ( xTrenline -endtTrenline ) + bSTrendline;

Plot(IIf(xTrenline>starttTrenline-10,trendlineS,-1e10),"",colorBlue,styleNoLabel   |styleNoRescale);

H1Trendline=LastValue(Highest((Cum(1)>starttTrenline AND Cum(1)<endtTrenline)*H));
tH1Trendline=LastValue(ValueWhen(H==H1Trendline,Cum(1)));

UpperParallel=aSTrendline*(xTrenline-tH1Trendline)+H1Trendline;

Plot(IIf(xTrenline>starttTrenline-10,UpperParallel,-1e10),"UpperLine",colorOrange, styleNoLabel  |styleNoRescale);

// Parallel lines defined by the automatic resistance and the LowestBetween point

pRTrendline = PeakBars( s11Trendline, perTrenline, 1 ) == 0;
endt1Trendline= LastValue(ValueWhen( pRTrendline, xTrenline, 1 ));
startt1Trendline=LastValue(ValueWhen( pRTrendline, xTrenline, 2 ));
dtRTrendline =endt1Trendline-startt1Trendline;
endRTrendline = LastValue(ValueWhen( pRTrendline, s11Trendline, 1 ) );
startRTrendline = LastValue( ValueWhen( pRTrendline, s11Trendline, 2 ));
aRTrendline = (endRTrendline-startRTrendline)/dtRTrendline;
bRTrendline = endRTrendline;
trendlineR = aRTrendline * ( xTrenline -endt1Trendline ) + bRTrendline;

Plot(IIf(xTrenline>startt1Trendline-10,trendlineR,-1e10),"",colorBlue, styleNoLabel  |styleNoRescale);

L1=LastValue(Lowest(IIf(Cum(1)>startt1Trendline AND Cum(1)<endt1Trendline,L,10^10)));
tL1=LastValue(ValueWhen(L==L1,Cum(1)));
Color=IIf((Cum(1)==startt1Trendline OR Cum(1)==endt1Trendline),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));

LowerParallel=aRTrendline*(xTrenline-tL1)+L1;

Plot(IIf(xTrenline>startt1Trendline-10,LowerParallel,-1e10),"LowerLine",colorOrange, styleNoLabel  |styleNoRescale);


}

// END AUTO TRENDLINE

 _SECTION_END();



//**************************************************************************************************************





//====================================================================================|
//                      Fibonacci Internal & External Retracements                             |
//====================================================================================|
/* Fibonacci Internal & External Retracements */
// This is a Modified Version that shows Fibonacci 00% & 100% instead of WRONG Sup & Res


_SECTION_BEGIN(" - Fibonacci Internal + External Retracements");

	pctH  = Param (" - Pivot Hi %", 0.325,0.001,2.0,0.002);
	HiLB  = Param (" - Hi LookBack",1,1,BarCount-1,1);
	pctL  = Param (" - Pivot Lo %", 0.325,0.001,2.0,0.002);
	LoLB  = Param (" - Lo LookBack",1,1,BarCount-1,1);
	Back  = Param (" - Extend Left = 2",1,1,500,1);
	Fwd   = Param(" - Plot Forward", 0, 0, 500, 1);
	hts   = Param (" - Text Shift", -33.5,-50,50,0.10);
	style =ParamStyle(" - Line Style",styleLine,styleNoLabel);
	
	fibs = ParamToggle("1 - Hien thi duong ngang Fibonacci ","OFF|ON",0);
	text = ParamToggle("2 - Hien thi thong so","OFF|ON",0);
	
pRp  = PeakBars( H, pctH, 1) == 0;
yRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));
xRp0 = SelectedValue(ValueWhen( pRp, BarIndex(), HiLB));
pSp  = TroughBars( L, pctL, 1) == 0;
ySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));
xSp0 = SelectedValue(ValueWhen( pSp, BarIndex(), LoLB));
Delta = yRp0 - ySp0;

function fib(ret)
{
retval = (Delta * ret);
Fibval = IIf(ret < 1.0 
AND xSp0 < xRp0, yRp0 - retval, IIf(ret < 1.0 
AND xSp0 > xRp0, ySp0 + retval,IIf(ret > 1.0 
AND xSp0 < xRp0, yRp0 - retval, IIf(ret > 1.0 
AND xSp0 > xRp0, ySp0 + retval, Null)))); 
return FibVal;
}

x0Fibonacci = Min(xSp0,xRp0)-Back;
x1Fibonacci = (BarCount -1);
//////////////////////////////////////////////////////////////////
r236 = fib(0.236);	r236I = LastValue (r236,1);
r382 = fib(0.382);	r382I = LastValue (r382,1);
r050 = fib(0.50);		r050I = LastValue (r050,1);
r618 = fib(0.618);	r618I = LastValue (r618,1);
r786 = fib(0.786);	r786I = LastValue (r786,1);
e127 = fib(1.27);		e127I = LastValue (e127,1);
e162 = fib(1.62);		e162I = LastValue (e162,1);
e200 = fib(2.00);		e200I = LastValue (e200,1);
e262 = fib(2.62);		e262I = LastValue (e262,1);
e424 = fib(4.24);		e424I = LastValue (e424,1);
//////////////////////////////////////////////////////////////////
p00 = IIf(xSp0 > xRp0,ySp0,yRp0); 	p00I = LastValue (p00,1);
p100 = IIf(xSp0 < xRp0,ySp0,yRp0); 	p100I = LastValue (p100,1);
color00 =IIf(xSp0 > xRp0,colorLime,colorRed);
color100 =IIf(xSp0 < xRp0,colorLime,colorRed);
//////////////////////////////////////////////////////////////////
numbars = LastValue(Cum(Status("barvisible")));
fraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);
//////////////////////////////////////////////////////////////////

//************* Ve Fibonacci
if(fibs==1)
{
Plot(LineArray(xRp0-Fwd,yRp0,x1Fibonacci,yRp0,Back),"PR",32,8 |styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(xSp0-Fwd,ySp0,x1Fibonacci,ySp0,Back),"PS",27,8|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,r236,x1Fibonacci,r236,Back),"",45,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,r382,x1Fibonacci,r382,Back),"",44,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,r050,x1Fibonacci,r050,Back),"",41,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,r618,x1Fibonacci,r618,Back),"",43,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,r786,x1Fibonacci,r786,Back),"",42,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,e127,x1Fibonacci,e127,Back),"e127",47,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,e162,x1Fibonacci,e162,Back),"e162",47,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,e200,x1Fibonacci,e200,Back),"p200",47,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,e262,x1Fibonacci,e262,Back),"p262",47,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
Plot(LineArray(x0Fibonacci-Fwd,e424,x1Fibonacci,e424,Back),"p424",25,style|styleNoLabel  |styleNoRescale,Null,
Null,Fwd);
}
//////////////////////////////////////////////////////////////////
if(text==1)
{ 
PlotText(" 0% = " + WriteVal(p00,fraction),
	LastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);
PlotText("23% = " + WriteVal(r236,fraction),
LastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);
PlotText("38% = " + WriteVal(r382,fraction),
LastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);
PlotText("50% = " + WriteVal(r050,fraction),
LastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);
PlotText("62% = " + WriteVal(r618,fraction),
LastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);
PlotText("78% = " + WriteVal(r786,fraction),
LastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);
PlotText("100% = " + WriteVal(p100,fraction),
LastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);
PlotText("127% = " + WriteVal(e127,fraction),
LastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);
PlotText("162% = " + WriteVal(e162,fraction),
LastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);
PlotText("200% = " + WriteVal(e200,fraction),
LastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);
PlotText("262% = " + WriteVal(e262,fraction),
LastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);
PlotText("424% = " + WriteVal(e424,fraction),
LastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);
}
_SECTION_END();

// END Fibonacci Internal & External Retracements




//*******************************************************************************************



//==========================================================================|
//                    VAP - Volume At Price                               |
//==========================================================================|


_SECTION_BEGIN(" - VAP - Volume At Price");

VAPline  = Param      (" - VAP Lines - So luong thanh VAP", 200, 1, 1000, 1 );
VAPwidth = Param      (" - VAP Width - Chieu dai VAP", 10, 1, 100, 1 );
VAPcolor = ParamColor (" - VAP Color", colorLightOrange);
VAPLR    = ParamToggle("* - Chon ben Trai | Phai", "Left|Right" ) ;


PlotVAP  = ParamToggle( "* - VAP - Volume At Price ",  "OFF|ON", 0 ); 

//Ve VAP - Volume At Price
if (PlotVAP >0)
{
 PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );
 
}
_SECTION_END();

//        END  VAP - Volume At Price   
   
 


//*******************************************************************************************



 
          
//==========================================================================|
//                    Volume At Price Anna Coulling                                 |
//==========================================================================|

_SECTION_BEGIN(" - Volume At Price Anna Coulling");


/*
Author: Anderson Wilson, Beppe, Steve Walsh
based on PriceVolDistribution demo written by Tomasz Janeczko

Volume-by-Price is an indicator that shows the amount of volume for a particular price range,
The Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond
with these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume
Use double click to define range.
*/






//==========================================================================|
//                    Hien thi Volume At Price Anna Coulling                                 |
//==========================================================================|



if (VAPanna = ParamToggle( "* - Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))
{

QvapAnna       = Param( " - So luong thanh VAP", 50, 1, 300, 1 );
pRecHeight     = Param( " - Rectangle Height - Kich thuoc hop chu nhat", 0.80, 0.10, 1, 0.01 );


BarindexAna = BarIndex();
BeginValueAnna = BeginValue( BarindexAna );
EndValueAnna = EndValue( BarindexAna );

if( BeginValueAnna == 0 && EndValueAnna == LastValue( BarindexAna ) )
{
    BeginValueAnna = FirstVisibleValue( BarindexAna );
    EndValueAnna = LastVisibleValue( BarindexAna );
}

BeginValueAnna = Max( 0, BeginValueAnna );
EndValueAnna = Max( 0, EndValueAnna );


BullBearZone = ( High - Low ) / 3;
bullbarAnna = C > ( High - BullBearZone );
bearbarAnna = C < ( Low + BullBearZone );

mxAnna  = PriceVolDistribution( H, L, V, QvapAnna, True, BeginValueAnna, EndValueAnna );
mx1Anna = PriceVolDistribution( H, L, IIf( bullbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );
mx2Anna = PriceVolDistribution( H, L, IIf( bearbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );

bins  = MxGetSize( mxAnna, 0 );
bins1 = MxGetSize( mx1Anna, 0 );
bins2 = MxGetSize( mx2Anna, 0 );

GfxSetOverlayMode( 1 );
GfxSetCoordsMode( 1 );

if( bins > 1 && bins == bins1 && bins == bins2 )
{

    MaxVolume = mxAnna[ 0 ][ 1 ];

    // find max volume
    for( i = 1; i < bins; i++ )
    {
        if( mxAnna[ i ][ 1 ] > MaxVolume )
            MaxVolume = mxAnna[ i ][ 1 ]; // Volume for that bin 1...

        //printf( "mxAnna=%g", MaxVolume / 100000 );
    }

    // rectangle height
    RecHeight = ( mxAnna[ 1 ][ 0 ] - mxAnna[ 0 ][ 0 ] ) / 2 * pRecHeight;
    SelectFont     = GfxSelectFont( " - Arial", SelectsizeFont = Param( " - Chon Font Size", 8, 1, 30, 1 ) );  // Change the text size here

    for( i = 0; i < bins; i++ )
    {
        // mx1Anna = Bull
        price = mx1Anna[ i ][ 0 ]; // price level
        absVolume = mx1Anna[ i ][ 1 ];
        VolAcum = absVolume;
        relvolume = absVolume / MaxVolume;
        relbar = relvolume * ( EndValueAnna - BeginValueAnna + 1 );
        // upper left corner of the rectangle.
        x1Anna = BeginValueAnna;
        y1Anna = price + RecHeight;
        // lower right corner of the rectangle.
        x2Anna = BeginValueAnna + relbar;
        y2Anna = price - RecHeight;
        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );
        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bullColor );
        GfxSetBkColor( bullColor );
        GfxSetTextColor( colorBrightGreen );
        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );

        // mx2Anna = Bear
        absVolume = mx2Anna[ i ][ 1 ];
        VolAcum += absVolume;
        relvolume = absVolume / MaxVolume;
        relbar2 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );
        x1Anna = x2Anna;
        x2Anna = x1Anna + relbar2;
        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );
        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bearColor );
        GfxSetBkColor( bearColor );
        GfxSetTextColor( colorRed );
        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );

        // mxAnna = All Bars
        absVolume = mxAnna[ i ][ 1 ];
        relvolume = ( absVolume - VolAcum ) / MaxVolume;
        relbar3 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );
        x1Anna = x2Anna;
        x2Anna = x1Anna + relbar3;
        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );
        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, midColor );
        GfxSetBkColor( midColor );
        GfxSetTextColor( colorBlack );
        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );
    }
}


}

//END   Volume At Price Anna Coulling 


_SECTION_END();




//*******************************************************************************************





//==========================================================================|
//                    Volume Lines Module                                   |
//==========================================================================|
// AFL Karthikmarar
// HIGH VOLUME LINES AFL VERSION 1.00
// Provids upto total 20 lines. Number of lines Adjustable from Parameter window

_SECTION_BEGIN(" - High Volume Lines");

jVolumeLines        = Param(" - So luong thanh High Volume Lines",5,1,20,1);
kVolumeLines        = Param(" - He so Volume factor",2,1.5,3,0.5);
hvlColor            = ParamColor( " - HVL Colorr", colorOrange );
vronoff             =ParamToggle("* - Hien thi High volume lines","OFF|ON" ,0);
yVolumeLines =Cum(1);
Hk1=V>kVolumeLines*volAvg;
//High volume detection
hx1=LastValue(ValueWhen(hk1,yVolumeLines,1));
hx2=LastValue(ValueWhen(hk1,yVolumeLines,2));
hx3=LastValue(ValueWhen(hk1,yVolumeLines,3));
hx4=LastValue(ValueWhen(hk1,yVolumeLines,4));
hx5=LastValue(ValueWhen(hk1,yVolumeLines,5));
hx6=LastValue(ValueWhen(hk1,yVolumeLines,6));
hx7=LastValue(ValueWhen(hk1,yVolumeLines,7));
hx8=LastValue(ValueWhen(hk1,yVolumeLines,8));
hx9=LastValue(ValueWhen(hk1,yVolumeLines,9));
hx10=LastValue(ValueWhen(hk1,yVolumeLines,10));
hx11=LastValue(ValueWhen(hk1,yVolumeLines,11));
hx12=LastValue(ValueWhen(hk1,yVolumeLines,12));
hx13=LastValue(ValueWhen(hk1,yVolumeLines,13));
hx14=LastValue(ValueWhen(hk1,yVolumeLines,14));
hx15=LastValue(ValueWhen(hk1,yVolumeLines,15));
hx16=LastValue(ValueWhen(hk1,yVolumeLines,16));
hx17=LastValue(ValueWhen(hk1,yVolumeLines,17));
hx18=LastValue(ValueWhen(hk1,yVolumeLines,18));
hx19=LastValue(ValueWhen(hk1,yVolumeLines,19));
hx20=LastValue(ValueWhen(hk1,yVolumeLines,20));
//values when High volume occured
XV1 =LastValue(ValueWhen(hk1,H,1));
XV2 =LastValue(ValueWhen(hk1,H,2));
XV3 =LastValue(ValueWhen(hk1,H,3));
XV4 =LastValue(ValueWhen(hk1,H,4));
XV5 =LastValue(ValueWhen(hk1,H,5));
XV6 =LastValue(ValueWhen(hk1,H,6));
XV7 =LastValue(ValueWhen(hk1,H,7));
XV8 =LastValue(ValueWhen(hk1,H,8));
XV9 =LastValue(ValueWhen(hk1,H,9));
XV10 =LastValue(ValueWhen(hk1,H,10));
XV11 =LastValue(ValueWhen(hk1,C,11));
XV12 =LastValue(ValueWhen(hk1,C,12));
XV13 =LastValue(ValueWhen(hk1,C,113));
XV14 =LastValue(ValueWhen(hk1,C,14));
XV15 =LastValue(ValueWhen(hk1,C,15));
XV16 =LastValue(ValueWhen(hk1,C,16));
XV17 =LastValue(ValueWhen(hk1,C,17));
XV18 =LastValue(ValueWhen(hk1,C,18));
XV19 =LastValue(ValueWhen(hk1,C,19));
XV20 =LastValue(ValueWhen(hk1,C,20));
LastBar = Cum(1) == LastValue(Cum(1));

//plot High Volume lines - Ve duong High Volume
Plot(IIf(yVolumeLines>hx1 AND jVolumeLines>=1 AND vronoff,xv1,Null),"v1",hvlColor);
Plot(IIf(yVolumeLines>hx2 AND jVolumeLines>=2 AND vronoff,xv2,Null),"v2",hvlColor);
Plot(IIf(yVolumeLines>hx3 AND jVolumeLines>=3 AND vronoff,xv3,Null),"v3",hvlColor);
Plot(IIf(yVolumeLines>hx4 AND jVolumeLines>=4 AND vronoff,xv4,Null),"v4",hvlColor);
Plot(IIf(yVolumeLines>hx5 AND jVolumeLines>=5 AND vronoff,xv5,Null),"v5",hvlColor);
Plot(IIf(yVolumeLines>hx6 AND jVolumeLines>=6 AND vronoff,xv6,Null),"v6",hvlColor);
Plot(IIf(yVolumeLines>hx7 AND jVolumeLines>=7 AND vronoff,xv7,Null),"v7",hvlColor);
Plot(IIf(yVolumeLines>hx8 AND jVolumeLines>=8 AND vronoff,xv8,Null),"v8",hvlColor);
Plot(IIf(yVolumeLines>hx9 AND jVolumeLines>=9 AND vronoff,xv9,Null),"v9",hvlColor);
Plot(IIf(yVolumeLines>hx10 AND jVolumeLines>=10 AND vronoff,xv10,Null),"v10",hvlColor);
Plot(IIf(yVolumeLines>hx11 AND jVolumeLines>=11 AND vronoff,xv11,Null),"v11",hvlColor);
Plot(IIf(yVolumeLines>hx12 AND jVolumeLines>=12 AND vronoff,xv12,Null),"v12",hvlColor);
Plot(IIf(yVolumeLines>hx13 AND jVolumeLines>=13 AND vronoff,xv13,Null),"v13",hvlColor);
Plot(IIf(yVolumeLines>hx14 AND jVolumeLines>=14 AND vronoff,xv14,Null),"v14",hvlColor);
Plot(IIf(yVolumeLines>hx15 AND jVolumeLines>=15 AND vronoff,xv15,Null),"v15",hvlColor);
Plot(IIf(yVolumeLines>hx16 AND jVolumeLines>=16 AND vronoff,xv16,Null),"v16",hvlColor);
Plot(IIf(yVolumeLines>hx17 AND jVolumeLines>=17 AND vronoff,xv17,Null),"v17",hvlColor);
Plot(IIf(yVolumeLines>hx18 AND jVolumeLines>=18 AND vronoff,xv18,Null),"v18",hvlColor);
Plot(IIf(yVolumeLines>hx19 AND jVolumeLines>=19 AND vronoff,xv19,Null),"v19",hvlColor);
Plot(IIf(yVolumeLines>hx20 AND jVolumeLines>=20 AND vronoff,xv20,Null),"v20",hvlColor);
_SECTION_END();

// END High Volume Lines




//*******************************************************************************************





//==========================================================================|
//            Hien thi VWAP - Volume Weighted Average Price                                  |
//==========================================================================|


_SECTION_BEGIN(" - VWAP - Volume Weighted Average Price");

Pvwap       = ParamField(" - Volume Weighted Average Price Field",-1);
VwapPeriods = Param(" - Volume Weighted Average Price Periods", 20, 2, 300, 1, 10 );
VWAPcolor   = ParamColor( " - VWAP Color", colorYellow );
VWAPstyle   = ParamStyle( " - VWAP Style" , styleThick); 

if(ParamToggle("1 - VWAP tuy chinh","OFF|ON",0) )
{
Plot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle |styleNoLabel  |styleNoRescale);


}

//****************************************************************************

VWAPPeriod = ParamList( " - Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );
pwap = ParamToggle("2 - WAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);

function Lastthursday()
{
    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );
    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );
    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );
    returnvalue = IIf( Daysinmonthfinal - Day() < 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() < 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );
    return returnvalue;
}



if(VWAPPeriod=="Daily" )
{
Bars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));
StartBar = ValueWhen(TimeNum() == 091500, BarIndex());
TodayVolume = Sum(V,Bars_so_far_today);
average = (H+L+C)/3;
IIf (BarIndex() >= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);
}

if(VWAPPeriod=="Weekly" OR Interval()==24 * 3600 )
{ 
Bars_so_far_today = 1 + BarsSince(DayOfWeek() < Ref( DayOfWeek(), -1 ));
StartBar = ValueWhen(TimeNum() == 091500, BarIndex());
Vol = TimeFrameGetPrice("V", inWeekly, 0);
TodayVolume = Sum(Vol,Bars_so_far_today);
average = (H+L+C)/3;
IIf (BarIndex() >= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);
}

if(VWAPPeriod=="Monthly"  )
{
Bars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));
Vol = TimeFrameGetPrice("V", inMonthly, 0);
StartBar = ValueWhen(TimeNum() == 091500, BarIndex());
TodayVolume = Sum(Vol,Bars_so_far_today);
average = (H+L+C)/3;
IIf (BarIndex() >= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);
}

Plot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor,styleNoLabel  |styleNoRescale);


_SECTION_END();

//END VWAP

//********************************************************************************************


//==========================================================================|
//                    Bollinger Bands                                  |
//==========================================================================|


_SECTION_BEGIN(" - Bollinger Bands");


//==========================================================================|
//                    Hien thi Bollinger Bands                                  |
//==========================================================================|

if (bBollingerBands = ParamToggle( "* - Hien thi Bollinger Bands",  "OFF|ON", 0 ))
{

// Hien thi Bollinger Band cloud
Plot( bbt = BBandTop( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBTop" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); 
Plot( bbb = BBandBot( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBBot" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); 
PlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( ParamColor(" - Bollinger Color", colorDarkOliveGreen), colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );


}

// END Bollinger Bands  

_SECTION_END();


//*******************************************************************************************




//==========================================================================|
//                     Keltner Bands system                                 |
//==========================================================================|


_SECTION_BEGIN(" - Keltner Bands system");

//Keltner Band Code

Kma        = Param(" - Keltner MA", 20, 1, 300, 1 ); 
KMid       = MA (Close, Kma);  //Middle Line

ATRPeriod  = Param(" - ATR Period", 20, 2, 300, 1 ); //ATR Period
KFactor    = Param(" - ATR Width", 3, 0, 10, 0.05 ); //Multiplier
KValue     = ATR(ATRPeriod) * KFactor; 

KTop       = KMid + KValue;   //Upper Band
KBottom    = KMid - KValue;    //Lower Ban
 

BuyKeltner = Cross(High,KTop)

//Volume - Co thanh khoan cao
AND Volume > 0.7*EMA( Volume, 30 ) AND volume > 50000 AND Ref(V,-5) > 50000 AND Ref(V,-10) > 50000 AND MA(V,20) > 100000  
//Gia dang tang so voi hom qua                                        
AND C >= 1.01*Ref(C,-1) 
//Gia cao hon cac duong MA 10,20
AND C >= EMA(C,10) AND C >= EMA(C,20)  
//EMA10 cao hon cac duong 20                         
AND EMA(C,10) >= EMA(C,20)  
//Giai doan 2 Uptrend Mark Minervini  
AND C >  MA(C,200)                                                                                    
AND MA(C,50) >= MA(C,150) AND MA(C,50) >= MA(C,200) AND MA(C,200) > Ref(MA(C,200),-20) ;

//Ban khong
ShortKeltner= ( Cross(KBottom,Low)  AND C <= EMA(C,10) AND C <= EMA(C,20) AND EMA(C,10) <= EMA(C,20) )  ;



SellKeltner =   ( Cross(KMid,Low) AND C <= EMA(C,10) )
     OR ( Cross(KMid,Low) AND C <= EMA(C,20) )
     OR ( Cross(KMid,Low) AND EMA(C,10) <= EMA(C,20) )
     OR ( Cross(KMid,Low) AND C <= EMA(C,10) AND C <= EMA(C,20) AND EMA(C,10) <= EMA(C,20) );

     
CoverKeltner = Cross(High,KMid);
 
BuyPrice=KTop;
SellPrice=KMid;
ShortPrice=KBottom;
CoverPrice=KMid;
 
BuyKeltner   = ExRem(BuyKeltner,SellKeltner);
SellKeltner  = ExRem(SellKeltner,BuyKeltner);
ShortKeltner = ExRem(ShortKeltner,CoverKeltner);
CoverKeltner = ExRem(CoverKeltner,ShortKeltner);
   
 
 
 
 //==========================================================================|
//                 Ve duong Keltner Bands system                                 |
//==========================================================================|  
   
  
if (Keltner = ParamToggle( "* - Hien thi Keltner Bands system",  "OFF|ON", 0 ))
{

printf("\nKTop : " + KTop );  
printf("\nKBottom : " + KBottom );  
printf("\nKMid : " + KMid );  
 
Plot(KTop," - KTop",colorRed,styleLine|styleNoLabel  |styleNoRescale);
Plot(KMid," - KMid",colorGold,styleDashed|styleNoLabel|styleNoRescale);
Plot(KBottom," - KBottom",colorBlue,styleLine|styleNoLabel|styleNoRescale);
 
 
 
printf("\nBuy : " + BuyKeltner );  
printf("\nSell : " + SellKeltner );  
printf("\nShort : " + ShortKeltner );  
printf("\nCover : " + CoverKeltner );  

// Hien thi cac tin hieu Mua Ban theo  Keltner Bands system     
/* Plot Buy and Sell Signal Arrows */
PlotShapes(IIf(BuyKeltner, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-25);
PlotShapes(IIf(SellKeltner, shapeDownArrow, shapeNone),colorRed, 0, H, Offset=-25);

PlotShapes(IIf(ShortKeltner, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-25);
PlotShapes(IIf(ShortKeltner, shapeStar, shapeNone),colorYellow, 0,H, Offset=40);

//Hien chu E10
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyKeltner[i] == 1 )
    {
 PlotText( "Kel", i , L[ i ], colorBlack, colorBrightGreen,Offset=-50  ) ;
     }  
  //Sell   
 if( SellKeltner[i] == 1 )
    {
PlotText( "Kel", i , H [ i ], colorBlack, colorRed,Offset= 40  ) ;
     }      
 }  
 

}
// END Keltner Bands system 


_SECTION_END();




//*******************************************************************************************





//==========================================================================|
//         Center of Gravity indicator  - Trung tam cua Trong luc  |
//==========================================================================|
// 
// 
_SECTION_BEGIN(" - Center of Gravity - Trung tam cua trong luc");

sx=Null;b=Null;ai=Null;x=Null;
reg=x1=x2=x3=z1=z2=z3=Null;	
rega=x1a=x2a=x3a=z1a=z2a=z3a=Null;	
	
bi=BarIndex();	
eb=LastValue(bi);	
order=Param(" - n-th Order",3,1,20,1);	
bars=Param(" - Chon time qua khu",260,50,1000,1);
alt=ParamToggle(" - Chon kieu gia tri","Fibonacci|Standard",0);
ecart=1.61803399;
sv=ParamToggle("* - Chon che do hien thi theo Click chuot","OFF|ON",1);
 
 
if (Gravity = ParamToggle( "* - Hien thi Center of Gravity",  "OFF|ON", 0 ))
{

  
if(sv)
{
	eb=SelectedValue(bi);
	bb=Max(0,eb-bars);
}
else
{
	bb=Max(0,eb-bars);
}
fin=eb;
nn=order+1;
sx[1]=bars+1;

if(fin>bars)
{
for(mi=1;mi<=2*nn-2;mi++)
{
	suml=0;
	for(n=0;n<=bars;n++)
	{
		suml=suml+n^mi;
	}
	sx[mi+1]=suml;
}
for(mi=1;mi<=nn;mi++)
{
	suml=0;
	for(n=0;n<=bars;n++)
	{
		if (mi==1)
			suml=suml+Close[fin-n];
		else
			suml=suml+Close[fin-n]*n^(mi-1);
			b[mi]=suml;
	}
}
for(jj=1;jj<=nn;jj++)
{
	for(ii=1;ii<=nn;ii++)
	{
		kk=ii+jj-1;
		ai[(ii-1)*nn+jj]=sx[kk];
	}
}
for(kk=1;kk<=nn-1;kk++)
{
	ll=0;
	mm=0;
	for(ii=kk;ii<=nn;ii++)
	{
		if(abs(ai[(ii-1)*nn+kk])>mm)
		{
			mm=abs(ai[(ii-1)*nn+kk]);
			ll=ii;
		}
	}
    if(ll==0) break;
	if(ll!=kk)
	{
		for(jj=1;jj<=nn;jj++)
		{
			tt=ai[(kk-1)*nn+jj];
			ai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];
			ai[(ll-1)*nn+jj]=tt;
		}
		tt=b[kk];
		b[kk]=b[ll];
		b[ll]=tt;
	}
	for(ii=kk+1;ii<=nn;ii++)
	{
		qq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];
		for(jj=1;jj<=nn;jj++)
		{
			if(jj==kk)
				ai[(ii-1)*nn+jj]=0;
			else
				ai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];
		}
		b[ii]=b[ii]-qq*b[kk];
	}
}
x[nn]=b[nn]/ai[nn*nn];
for(kk=1;kk<=nn-1;kk++)
{
	tt=0;
	ii=nn-kk;
	for(jj=1;jj<=nn-ii;jj++)
	{
		tt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];
		if(ai[(ii-1)*nn+ii]!=0)
			x[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];
	}
}
for(n=0;n<=bars;n++)
{
	suml=0;
	for(kk=1;kk<=order;kk++)
	{
		suml=suml+x[kk+1]*n^kk;
	}
	reg[fin-n]=x[1]+suml;
}
}

if(alt)
{
dev=StDev(Close-reg,bars);
sd=dev[fin];
x1a=reg+sd*1;//68%
x2a=reg+sd*2;//95%
x3a=reg+sd*3;//99.83%
z1a=reg-sd*1;
z2a=reg-sd*2;
z3a=reg-sd*3;
//Plot(C, "Close",colorLightGrey,styleCandle);
Plot(reg,"reg",colorBlue,1 |styleNoLabel|styleNoRescale );
Plot(x3a,"x3a",ColorRGB(255,0,0),styleThick |styleNoLabel|styleNoRescale );
Plot(x2a,"x2a",ColorRGB(255,100,100),styleDashed |styleNoLabel|styleNoRescale );
Plot(x1a,"x1a",ColorRGB(255,200,200),styleDashed |styleNoLabel|styleNoRescale );
Plot(z3a,"z3a",ColorRGB(0,255,0),styleThick |styleNoLabel|styleNoRescale );
Plot(z2a,"z2a",ColorRGB(100,255,100),styleDashed |styleNoLabel|styleNoRescale );
Plot(z1a,"z1a",ColorRGB(200,255,200),styleDashed |styleNoLabel|styleNoRescale );
PlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); 
PlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); 
}
else
{
dev=StDev(Close,bars);
sd=ecart*dev[fin];
x1=reg+sd/(1.382*1.618);
x2=reg+sd/1.382;
x3=reg+sd;
z1=reg-sd/(1.382*1.618);
z2=reg-sd/1.382;
z3=reg-sd;
//Plot(C, "Close",colorLightGrey,styleCandle);
Plot(reg,"reg",colorBlue,1 |styleNoLabel|styleNoRescale );
Plot(x3,"x3",ColorRGB(255,0,0),styleThick |styleNoLabel|styleNoRescale );
Plot(x2,"x2",ColorRGB(255,100,100),styleDashed |styleNoLabel|styleNoRescale );
Plot(x1,"x1",ColorRGB(255,200,200),styleDashed |styleNoLabel|styleNoRescale );
Plot(z3,"z3",ColorRGB(0,255,0),styleThick |styleNoLabel|styleNoRescale );
Plot(z2,"z2",ColorRGB(100,255,100),styleDashed |styleNoLabel|styleNoRescale );
Plot(z1,"z1",ColorRGB(200,255,200),styleDashed |styleNoLabel|styleNoRescale );
PlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); 
PlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); 
}

}

//END Center of Gravity indicator

_SECTION_END();





//*******************************************************************************************




 
//==========================================================================|
//                    Psar - Parabolic Stop And Reverse                           |
//==========================================================================|


_SECTION_BEGIN(" - Psar - Parabolic Stop And Reverse");

acc = Param(" - Acceleration", 0.02, 0, 1, 0.001 );
accm = Param(" - Max. acceleration", 0.2, 0, 1, 0.001 );

if (psar = ParamToggle( "* - Hien thi Psar ",  "OFF|ON", 0 ))
{

Plot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault)  |styleNoLabel|styleNoRescale );

}


_SECTION_END();

//END Psar - Parabolic Stop And Reverse





//*****************************************************************************************************



 
//==========================================================================|
//                     Zig Zag Indicator                           |
//==========================================================================|


_SECTION_BEGIN(" - Zig Zag Indicator ");



if (ParamToggle( "* - Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))
{

Plot( Zig(ParamField( "Zig Zag Price field" ), Param("Zig Zag % Change",5,0.1,25,0.1)), "Zig Zag", ParamColor( "Zig Zag Color", colorBlue ), ParamStyle( "Zig Zag Style" , styleThick |styleNoLabel|styleNoRescale  ));
}

_SECTION_END();

// END Zig Zag Indicator  




//*****************************************************************************************************





//==========================================================================|
//                   GAP Indicator                           |
//==========================================================================|


_SECTION_BEGIN(" - GAP Indicator ");

LinLen = Param(" - Chon do dai Gap Line",3,1,15,1);

Gup = L>Ref(H,-1);  
Gdn = H<Ref(L,-1);  
Gap = Gup OR Gdn;  

ShowLine = BarsSince(Gup OR Gdn) < LinLen;  
TextPos = Showline < Ref(ShowLine,-1);  

GapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  
GapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  
GapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  
GapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  
GapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  
GapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null);  


//======================================================

//Ve Gap
if (gapindicator = ParamToggle( "* - Hien thi GAP Indicator ",  "OFF|ON", 0 ))
{
 
//Ve duong Gapline
Plot(GapLineHi,"",ParamColor( " - GapLine High Color", colorGold ), styleLine |styleNoLabel|styleNoRescale );  
Plot(GapLineLo,"",ParamColor( " - GapLine Low Color", colorBlue ), styleLine |styleNoLabel|styleNoRescale );  

FirstVisibleBar = Status( "FirstVisibleBar" );  
Lastvisiblebar = Status("LastVisibleBar");  
for( b = Max(LinLen,Firstvisiblebar); b <= Lastvisiblebar AND b < BarCount; b++)  
{  
if( Gap[b-LinLen+1] )  
{  

//Hien so Number
PlotText(     NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],ParamColor( " - GapLine High Color", colorGold ));  
PlotText("\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],ParamColor( " - GapLine Low Color", colorBlue ));  
}  
}

}
// END GAP Indicator 


_SECTION_END();






//*****************************************************************************************************








//|============================================================================================|
//|                Chien luoc giao dich Luot song ngan han                  
//|============================================================================================|

_SECTION_BEGIN(" - Chien luoc giao dich luot song ngan han");




//===========================================================================
// 1. Chien luoc Breakout vung tich luy Sideway ngan han
//===========================================================================

Bside = Param(" ****** Breakout Sideway ****** ",0,0,0,0); 

SidewayDay           = Param(" - Chon ky cho vung Sideway",  10, 1, 260, 1);
LastHigh_SidewayDay  = Ref( HHV( High, SidewayDay ), -1 );
LastLow_SidewayDay   = Ref( LLV( Low, SidewayDay ), -1 );

//Chon % Giao dong cua vung Sideway
SidewayDay_Percent    = Param( " - Gioi han bien dong % trong vung Sideway", 0.1, 0.01, 0.5, 0.01 ); //Bien dong gia trong vung sideway

//Gioi han cao nhat va thap nhat vung Sideway thoa man dieu kien da chon
LowHigh_SidewayDay    = ( LastHigh_SidewayDay - LastLow_SidewayDay ) / LastLow_SidewayDay <= SidewayDay_Percent;


//Dieu kien Mua khi xay ra Breakout thoat vung Sideway
Breakout_SidewayDay   = 
//1. Vuot dinh 10 ngay
(Close > LastHigh_SidewayDay  AND LowHigh_SidewayDay  AND C > MA_ema5Day AND C > MA_ema10Day AND MA_ema5Day > MA_ema10Day)
//2. EMA14 vuot duong tin hieu 9 va vuot dinh 5 ngay
OR (EMA(C,14)>EMA(EMA(C,14),9) AND  Cross (C,Peak(C,5,1)));



// Tin hieu Mua cua Chien luoc Breakout vung tich luy Sideway ngan han
//===========================================================================


New_Breakout_SidewayDay[0] = 0;
New_Breakout_SidewayDay[1] = 0;
 
for( i = 0; i <= BarCount - 1; i++ )
{
    if( Breakout_SidewayDay[i] == 1 AND( Breakout_SidewayDay[i - 1] == 1 OR Breakout_SidewayDay[i - 2] == 1 OR Breakout_SidewayDay[i - 3] == 1 ) )
    {
        New_Breakout_SidewayDay[i] = 0;
    }
    else
        if( Breakout_SidewayDay[i] == 0 )
        {
            New_Breakout_SidewayDay[i] = 0;
        }
        else
        {
            New_Breakout_SidewayDay[i] = 1;
        }
        
}

//Buy Breakout
BuyBreakout_SidewayDay =  New_Breakout_SidewayDay AND Priceup AND HighVolume AND UptrendMark;


//Sell Breakout
SellBreakout_SidewayDay =  
//1. Pha day 10 ngay
((Close < LastLow_SidewayDay AND C < MA_ema5Day AND C < MA_ema10Day AND MA_ema5Day < MA_ema10Day )
//2.EMA14 cat xuong duong tin hieu 9
OR (Cross (EMA(EMA(C,14),9),EMA(C,14))))
AND Pricedown ;

BuyBreakout_SidewayDay =  ExRem (BuyBreakout_SidewayDay , SellBreakout_SidewayDay);
SellBreakout_SidewayDay =  ExRem (SellBreakout_SidewayDay , BuyBreakout_SidewayDay);

BuySellBreakout_SidewayDay = BuyBreakout_SidewayDay OR SellBreakout_SidewayDay;



//===========================================================================
//1. Ve kenh Chien luoc Breakout vung tich luy Sideway ngan han
//===========================================================================

if (Sidewayon = ParamToggle( "1 - Hien thi vung Sideway",  "OFF|ON", 0 ))
{

Above_SidewayDay = ValueWhen( Breakout_SidewayDay, LastHigh_SidewayDay, 0 );
Below_SidewayDay = ValueWhen( Breakout_SidewayDay, LastLow_SidewayDay, 0 );
Plot( Above_SidewayDay, "Resistance", colorRed, styleDashed|styleThick|styleNoLabel|styleNoRescale );
Plot( Below_SidewayDay, "Support", colorBlue, styleDashed|styleThick|styleNoLabel|styleNoRescale );

//Ve kenh gia cao nhat n Ngay
Plot(LastHigh_SidewayDay, " HHV(H, " + WriteVal(SidewayDay, 1) + ")", colorYellow, styleDashed|styleThick|styleNoLabel|styleNoRescale );

}

//Ve tin hieu Mua Ban - Chien luoc Breakout vung tich luy Sideway ngan han
//===========================================================================

//Plot Breakout vuot vung tich luy
//Ve tin hieu Mua va hien chu (Bo)

if (ParamToggle( "2 - Breakout Sideway",  "OFF|ON", 0 ))
{

for( i = 0; i <= BarCount - 1; i++ )
{       
 //Buy Neu xay ra but pha thi hien chu (Bo)
     if( BuyBreakout_SidewayDay[i] == 1 )
    {
       // PlotText( "Br", i, L[i], colorBlack, colorYellow,Offset=-75 );  //phong nen mau Xanh, chu mau den
    }
//Sell Breakout  
 if( SellBreakout_SidewayDay[i] == 1 )
    {
       //  PlotText( "Br", i , H [ i ], colorBlack, colorRed,Offset= 68  ) ;
     }  
} 
//Buy
PlotShapes( IIf( BuyBreakout_SidewayDay , shapeUpArrow + shapeDigit0 , shapeNone ), colorGold, 0, L, Offset = 10 );  //Hien thi so 0
PlotShapes(IIf(BuyBreakout_SidewayDay, shapeUpArrow, shapeNone),colorGold, 0,L, Offset=-25); //Hien thi tin hieu mui ten
//PlotShapes( IIf( New_Breakout_SidewayDay , shapeUpArrow + shapeHollowCircle, shapeNone ), colorGold, 0, H, Offset = -35 );  // dau hieu Hoa vang phia tren Gia
//Sell
PlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow + shapeHollowStar , shapeNone ), colorGold, 0, H , Offset=10 );
PlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25 );

 }

 
 
 
 //*****************************************************************************************************************
 
 
 
 

//===========================================================================
// 2. Chien luoc luot song ngan han T+ 
//===========================================================================

//A.  Mua khi gia vuot dinh 5 ngay, Ban khi gia pha day 5 ngay
//===========================================================================

//Buy T+5
Buy5Day = C > LastHigh_ema5Day  AND C > MA_ema5Day AND C > MA_ema10Day  
AND Priceup AND HighVolume AND UptrendMark;
                                                                
//Sell T+5
Sell5Day =  C < LastLow_ema5Day AND C < MA_ema5Day AND C < MA_ema10Day AND Pricedown ;

//Loc Tin hieu Buy Sell T+5
Buy5Day  = ExRem(Buy5Day, Sell5Day);
Sell5Day = ExRem(Sell5Day, Buy5Day); 

BuySell5Day = Buy5Day OR Sell5Day;

//B.  Mua khi gia vuot dinh 10 ngay, Ban khi gia pha day 10 ngay  
//===========================================================================

//Buy T+10
Buy10Day = Buy5Day AND  C > LastHigh_ema10Day AND C > MA_ema20Day  AND MA_ema5Day > MA_ema10Day AND MA_ema5Day > MA_ema20Day
AND Priceup AND HighVolume AND UptrendMark; 
                       
                                                                 
//Sell T+10
Sell10Day =  Sell5Day AND C < LastLow_ema10Day AND C < MA_ema20Day AND MA_ema5Day < MA_ema10Day AND MA_ema5Day < MA_ema20Day
AND Pricedown ;


//Loc Tin hieu Buy Sell T+10
Buy10Day  = ExRem(Buy10Day, Sell10Day);
Sell10Day = ExRem(Sell10Day, Buy10Day);  
//Tong hop
BuySell10Day = Buy10Day OR Sell10Day;




//===========================================================================
// 2. Ve tin hieu Mua Ban - Chien luoc luot song ngan han T+ 
//===========================================================================

if (ParamToggle( "3 - Luot song T+",  "OFF|ON", 0 ))
{


/*

//Hien chu duoi tin hieu 
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy T+5         
 if( Buy5Day[i] == 1 )
    {
PlotText( "B4", i , L[ i ], colorBlack, colorSeaGreen,Offset=-92  ) ;
     }  
   //Buy T+10        
 if( Buy10Day[i] == 1 )
    {
PlotText( "B8", i , L[ i ], colorBlack, colorLime,Offset=-110  ) ;
     }    
  //Sell T5   
 if( Sell5Day[i] == 1 )
    {
PlotText( "S4", i , H [ i ], colorBlack, colorRed,Offset= 86  ) ;
     }  
    //Sell T+10   
 if( Sell5Day[i] == 1 )
    {
PlotText( "S8", i , H [ i ], colorBlack, colorRed,Offset= 104  ) ;
     }          
 }  

*/



// Hien thi lenh Mua T+5 T+10

PlotShapes( IIf( Buy5Day , shapeUpArrow + shapeDigit4 , shapeNone ), colorSeaGreen, 0, L, Offset =55 );
PlotShapes( IIf( Buy5Day , shapeUpArrow , shapeNone ), colorSeaGreen, 0, L, Offset =-25 );

PlotShapes( IIf( Buy10Day , shapeUpArrow + shapeDigit8 , shapeNone ), colorLime, 0, L, Offset =85 );
PlotShapes( IIf( Buy10Day , shapeUpArrow , shapeNone ), colorLime, 0, L, Offset =-25 );



// Hien thi lenh Ban T+5 T+10


PlotShapes( IIf( Sell5Day , shapeDownArrow + shapeDigit3 , shapeNone ), colorOrange, 0, H , Offset=55 );
PlotShapes( IIf( Sell5Day , shapeDownArrow , shapeNone ), colorOrange, 0, H , Offset=-25 );
  
PlotShapes( IIf( Sell10Day , shapeDownArrow + shapeDigit7 , shapeNone ), colorBrown, 0, H , Offset=85 );
PlotShapes( IIf( Sell10Day , shapeDownArrow , shapeNone ), colorBrown, 0, H , Offset=-25 );

}


//***********************************************************************************************************




//===========================================================================
// 3. Chien luoc Giao cat giua EMA5 voi cac duong EMA 10,20,30
//===========================================================================



//Buy Cross EMA 5 vs EMA 10,20,30
//============================
BuyEMA5cross = 
(//A. Cross EMA 5 vs 10
Cross(MA_ema5Day, MA_ema10Day) 
OR 
//B. Cross EMA 5 vs 20
Cross(MA_ema5Day, MA_ema20Day) 
OR 
//C. Cross EMA 5 vs 30
Cross(MA_ema5Day, MA_ema30Day) 
OR 
//C. Cross EMA 5 vs 40
Cross(MA_ema5Day, MA_ema40Day) 
OR 
//D. Cross EMA 5 vs 50
Cross(MA_ema5Day, MA_ma50Day)  )

//Gia cao hon dinh 5, 10 ngay
AND C > LastHigh_ema5Day AND C > LastHigh_ema10Day
//Gia cao hon cac duong MA 
AND C > MA_ema5Day AND C > MA_ema10Day AND C > MA_ema20Day AND C > MA_ema30Day AND C > MA_ema40Day AND C > MA_ma50Day

AND Priceup AND HighVolume AND UptrendMark ;


//Sell Cross EMA 10 vs 20,30,50   
//==============================
SellEMA5cross = 
(//A. Cross EMA 5 vs 10
Cross(MA_ema10Day, MA_ema5Day) 
OR 
//B. Cross EMA 5 vs 20
Cross(MA_ema20Day, MA_ema5Day) 
OR 
//C. Cross EMA 5 vs 30
Cross(MA_ema30Day, MA_ema5Day) 
OR 
//C. Cross EMA 5 vs 40
Cross(MA_ema40Day, MA_ema5Day) 
OR 
//D. Cross EMA 5 vs 50
Cross(MA_ma50Day, MA_ema5Day)  )

//Gia cao hon dinh 5, 10 ngay
AND C < LastHigh_ema5Day AND C < LastHigh_ema10Day
//Gia cao hon cac duong MA 
AND C < MA_ema5Day AND C < MA_ema10Day AND C < MA_ema20Day 

AND Pricedown ;


//Loc tin hieu Buy Sell theo EMA giao cat nhau

BuyEMA5cross  = ExRem(BuyEMA5cross, SellEMA5cross) ;
SellEMA5cross = ExRem(SellEMA5cross, BuyEMA5cross) ;
//Tong hop
BuySellEMA5cross = BuyEMA5cross OR SellEMA5cross;





//====================================================================================
// 3. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50
//====================================================================================

if (ParamToggle( "4 - EMA5 Cross",  "OFF|ON", 0 ))
{

/*

//Hien chu E5
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyEMA5cross[i] == 1 )
    {
 //PlotText( "E5", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;
     }  
  //Sell   
 if( SellEMA5cross[i] == 1 )
    {
 //PlotText( "E5", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;
     }      
 }  

*/


// Hien thi lenh Mua Ban
PlotShapes( IIf( BuyEMA5cross , shapeUpArrow + shapeDigit5 , shapeNone ), colorGreen, 0, L, Offset =70 );
PlotShapes( IIf( BuyEMA5cross , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );

PlotShapes( IIf( SellEMA5cross , shapeDownArrow + shapeDigit4 , shapeNone ), colorRed, 0, H , Offset=70 );
PlotShapes( IIf( SellEMA5cross , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );


}



//********************************************************************************************************************






//===========================================================================
// 4. Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50
//===========================================================================



//Buy Cross EMA 10 vs 20,30,50
//============================
BuyEMA10cross = 
(//A. Cross EMA 10 vs 20
Cross(MA_ema10Day, MA_ema20Day)  
OR 
//B. Cross EMA 10 vs 30
Cross(MA_ema10Day, MA_ema30Day)
OR 
//C. Cross EMA 10 vs 40
Cross(MA_ema10Day, MA_ema40Day) 
OR 
//D. Cross EMA 10 vs 50
Cross(MA_ema10Day, MA_ma50Day) ) 

//Gia cao hon dinh 5, 10 ngay
AND C > LastHigh_ema5Day AND C > LastHigh_ema10Day
//Gia cao hon cac duong MA 
AND C > MA_ema5Day AND C > MA_ema10Day AND C > MA_ema20Day AND C > MA_ema30Day AND C > MA_ema40Day AND C > MA_ma50Day

AND Priceup AND HighVolume AND UptrendMark ;

//Sell Cross EMA 10 vs 20,30,50   
//==============================
SellEMA10cross =  Cross(MA_ema20Day, MA_ema10Day) AND C < MA_ema10Day AND C < MA_ema20Day AND Pricedown ;
(//A. Cross EMA 10 vs 20
Cross(MA_ema20Day, MA_ema10Day)  
OR 
//B. Cross EMA 10 vs 30
Cross(MA_ema30Day, MA_ema10Day)
OR 
//C. Cross EMA 10 vs 40
Cross(MA_ema40Day, MA_ema10Day) 
OR 
//D. Cross EMA 10 vs 50
Cross(MA_ma50Day, MA_ema10Day) ) 

//Gia thap hon dinh 5, 10 ngay
AND C < LastHigh_ema5Day AND C < LastHigh_ema10Day
//Gia cao hon cac duong MA 
AND C < MA_ema5Day AND C < MA_ema10Day AND C < MA_ema20Day 

AND Pricedown ;

//Loc tin hieu Buy Sell theo EMA giao cat nhau

BuyEMA10cross  = ExRem(BuyEMA10cross, SellEMA10cross) ;
SellEMA10cross = ExRem(SellEMA10cross, BuyEMA10cross) ;
//Tong hop
BuySellEMA10cross = BuyEMA10cross OR SellEMA10cross;






//====================================================================================
// 4. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50
//====================================================================================

if (ParamToggle( "5 - EMA10 Cross",  "OFF|ON", 0 ))
{

/*

//Hien chu E10
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyEMA10cross[i] == 1 )
    {
 //PlotText( "E10", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;
     }  
  //Sell   
 if( SellEMA10cross[i] == 1 )
    {
 //PlotText( "E10", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;
     }      
 }  

*/


// Hien thi lenh Mua Ban
PlotShapes( IIf( BuyEMA10cross , shapeUpArrow + shapeDigit6 , shapeNone ), colorBlue, 0, L, Offset =70 );
PlotShapes( IIf( BuyEMA10cross , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );

PlotShapes( IIf( SellEMA10cross , shapeDownArrow + shapeDigit5 , shapeNone ), colorDarkRed, 0, H , Offset=70 );
PlotShapes( IIf( SellEMA10cross , shapeDownArrow , shapeNone ), colorDarkRed, 0, H , Offset=-25 );


}




//******************************************************************************************************************





//=====================================================================================
// 5. Chien luoc Giao cat giua EMA20 voi cac duong EMA 40 - Turtle Trading System
//=====================================================================================
Turtletrade = Param(" ****** Turtle Trading System ****** ",0,0,0,0); 

//Buy Vuot dinh kenh Turtle EMA20 va EMA20 > EMA40
//=============================================================
Buyturtle = Close > LastHigh_ema20Day AND MA_ema20Day > MA_ema40Day
AND Priceup;


// Enters short trade - Vao lenh Ban (Short)
//Pha day kenh Turtle va EMAfast < EMASlow

//Ban khong (Short Sell)
Shortturtle = MA_ema20Day < MA_ema40Day AND C < LastLow_ema20Day
AND Pricedown;


//Diem thoat lenh (Cat lo)
//=============================================================

Multiple   = Param( " - So ATR thoat lenh", 3, 0.5, 10, 0.1 ); // How many ATRs to be allowed below the highest high since latest "buy" bar
ATRPeriods = Param( " - ATR Periods", 20, 1, 100, 1 ); // How many periods to use for the ATR

stopArray = Null;
atrArray = ATR( ATRPeriods );
HHArray = Null;
LLArray = Null;
exitArray = Null;
trendDirection = 0;

for ( i = 0; i < BarCount; i++ )
{
    if ( Shortturtle[i] )
    {
        // we just triggered a short trade. Set up starting values
        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );
        LLArray[i] = Low[i]; // initialize the lowest low array
        trendDirection = 0 - 1; // going short. Base bar.
    }

    if ( Buyturtle[i] )
    {
        // we just triggered a long trade. Set up starting values
        stopArray[i] = High[i] - ( Multiple * atrArray[i] );
        HHArray[i] = High[i]; // initialize the highest high array
        trendDirection = 1; // going long. Base bar flag is now set.
        
    }

    exitArray[i] = 0;

    if ( trendDirection > 0 )
    {
        // keep track of the highest high, highest close, highest low, etc..
        if ( trendDirection > 1 )
        {
            // We are in the trade (2nd day or later)
            if ( Low[i] < stopArray[i-1] )
            {
                //stop got hit. Reset the trade.
                trendDirection = 0; // OK. wait until we trigger another trade.
                exitArray[i] = 1;
            }
            else
            {
                // keep track of the HHV since trade was entered.
                if ( High[i] > HHArray[i-1] )
                    HHArray[i] = High[i];
                else
                    HHArray[i] = HHArray[i-1];

                // Compute the stop based on the HHV.
                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );
            }
        }

        trendDirection = trendDirection + 1;
    }

    if ( trendDirection < 0 )
    {
        // keep track of the lowest low, lowest close, lowest high, etc..
        if ( trendDirection < 0 - 1 )
        {
            // We are in the trade (2nd day or later)
            if ( High[i] > stopArray[i-1] )
            {
                // our stop got hit. Reset the trade.
                trendDirection = 0;
                exitArray[i] = 0 - 1;
            }
            else
            {
                // keep track of the LLV since trade was entered.
                if ( Low[i] < LLArray[i-1] )
                    LLArray[i] = Low[i];
                else
                    LLArray[i] = LLArray[i-1];

		// Compute the stop based on the LLV.
                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );
            }
        }

        trendDirection = trendDirection - 1;
    }

    if ( trendDirection == 0 )
    {
        stopArray[i] = 0;
        LLArray[i] = 0;
        HHArray[i] = 0;
    }
}

//Sell 
//=============================================================

Sellturtle = Coverturtle = 
exitarray AND C <= MA_ema10Day  AND C <= MA_ema20Day AND MA_ema10Day <= MA_ema20Day;

        


//Buy
BuyTurtle   = ExRem( BuyTurtle, Sellturtle ) 
AND Priceup AND HighVolume AND PriceUpMA AND EMA5up AND EMA10up AND UptrendMark;

//Sell
Sellturtle  = ExRem( Sellturtle, BuyTurtle ) AND Pricedown;

Shortturtle       = ExRem( Shortturtle, Coverturtle );
Coverturtle       = ExRem( Coverturtle, Shortturtle );


//Tong hop 
BuySellTurtle = BuyTurtle OR SellTurtle;








//======================================================================================================
// 5. Tin hieu Mua Ban theo Chien luoc Giao cat giua EMA20 voi cac duong EMA 40 - Turtle Trading System
//======================================================================================================



//                 Buy - Sell Turtle trading system                 |
//==========================================================================|
 
if (ParamToggle( "6 - Turtle trading system",  "OFF|ON", 0 ))
{



//Hien chu Tur
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyTurtle[i] == 1 )
    {
PlotText( "Tur", i , L[ i ], colorSeaGreen, Colorback=-1 , Offset= -90 ) ;
     }  
  //Sell   
 if( SellTurtle[i] == 1 )
    {
PlotText( "Tur", i , H [ i ], colorRed, Colorback=-1 ,  Offset= 90  ) ;
     }      
 }  




// Hien thi lenh Mua Ban
PlotShapes( IIf( BuyTurtle ,  shapeUpArrow ,   shapeNone ), colorBlue,   0, L,  Offset =-25 );
PlotShapes( IIf( SellTurtle , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset =-25 );


//Tin hieu thoat lenh
PlotShapes( abs( exitArray )*shapeHollowCircle  , colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 ); //Vong tron mau Vang
PlotShapes( IIf( exitArray , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );


}

//Bat tat Turtle Trading System

if (Turtle = ParamToggle( "7 - Kenh Turtle trading system",  "OFF|ON", 0 ))
{
//Ve cac duong Turtle
// Plots a 20 period Donchian channel (pdsTurtle)
//Duong tren
Plot( LastHigh_ema20Day,  "Donchian Uper",   ParamColor(  "Donchian Uper Color", colorBlue ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale );
//Duong duoi
Plot( LastLow_ema20Day,   "Donchian Lower",  ParamColor(  "Donchian Lower Color", colorRed ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale  );

//Ve kenh thoat lenh
Plot( stopArray, "Chand Stop", ParamColor( "Chand Color:", colorYellow ), ParamStyle( "Chand Style", styleDashed )  |styleNoLabel|styleNoRescale );

//plot color ribbon - Thanh xu huong duoi man hinh
//Plot(1, "", TurtleColor, styleArea | styleOwnScale | styleNoLabel, -0.1, 100 );

}





//**********************************************************************************************





//====================================================================================|
// 6. Chien luoc MUA - Ban theo ATR                                 |
//====================================================================================|

//Dung de bat Dinh Day
//Mua ban theo muc % co dinh tu Dinh hoac Day hoac theo so ATR
//(Noi them mot chut ve chien luoc ty le phan tram: gia tang tu day len x % thi mua, giam tu dinh xuong x% thi ban, rat phu hop cho nhung ma co phieu dang co xu huong tang).
//La cong cu de chot loi mot cach co he thong (danh cho ai khong biet phai chot loi nhu the nao)

ATRtrade = Param(" ****** ART Trading System ****** ",0,0,0,0); 

// get start date 

Start         = Cross( DateNum(), ParamDate(" - Chon ngay bat dau tinh Diem Mua - Ban", "2020-01-01" ) ); 
Started       = Flip( Start, 0 ); 
 
StopMode      = ParamToggle(" - Chon che do vao Lenh theo", "Ty le % | So ATR" ); 
StopLevel     = Param(" - Vao lenh theo Ty le % ", 15, 0.1, 50, 0.1)/100; 
StopATRFactor = Param(" - Vao lenh theo so ATR", 3, 0.5 , 10, 0.1 ); 
StopATRPeriod = Param(" - Time ATR period", 20, 1 , 100 , 1 ); 


 
// calculate support and resistance levels 
//Xac dinh muc Ho tro Khang cu
if( StopMode == 0 ) // fixed percent trailing stop 
{ 
 sup = C * ( 1 - stoplevel ); // Ho tro
 res = C * ( 1 + stoplevel ); // Khang cu
} 
else // Chandelier ATR-based stop 
{ 
 sup = C - StopATRFactor * ATR( StopATRPeriod ); // Muc ho tro theo so ATR
 res = C + StopATRFactor * ATR( StopATRPeriod ); // Muc khang cu theo so ATR
} 
 
// calculate trailing stop line - Tinh toan diem Vao va thoat lenh
trailARRAY = Null; 
trailstop = 0; 
for( i = 1; i < BarCount; i++ ) 
{ 
if( Started[ i ] == 0 ) continue; 
 
if( C[ i ] > trailstop AND C[ i - 1 ] > trailstop ) 
   trailstop = Max( trailstop, sup[ i ] ); 
else
if( C[ i ] < trailstop AND C[ i - 1 ] < trailstop ) 
   trailstop = Min( trailstop, res[ i ] ); 
else
   trailstop = IIf( C[ i ] > trailstop, sup[ i ], res[ i ] );       
 
trailARRAY[ i ] = trailstop; 
} 
 
 //Tin hieu MUA - Ban theo ATR        
 
// generate buy/sell signals based on crossover with trail stop line 
Buyatr = ( Start OR Cross(C,trailArray) )
AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;   
                                                                           
                                                                                                 
Sellatr = Cross( trailArray, C ) AND Pricedown AND C <= EMA(C,10) AND C <= EMA(C,20) ;


Buyatr       = ExRem( Buyatr, Sellatr );
Sellatr      = ExRem( Sellatr, Buyatr );

BuySellatr   = Buyatr OR Sellatr;






//====================================================================================|
// 6. Tin hieu Mua Ban theo Chien luoc ATR                                 |
//====================================================================================|


 
if (ParamToggle("8 - Buy - Sell theo % (Dinh - Day) or ATR", "OFF|ON" , 0 ))
{
//Hien chu ATR
 for ( i = 0; i < BarCount; i++ )
{
//Buy
 if( Buyatr[i] == 1 )
    {
 PlotText( "Atr", i , L[ i ],  colorGreen, colorback=-1 , Offset=-105  ) ;
     }   
//Sell     
 if( Sellatr[i] == 1 )
    {
 PlotText( "Atr", i , H [ i ],  colorRed, colorback=-1 , Offset= 105  ) ;
     }        
 
 }
 
 // Vao lenh Mua Ban
PlotShapes( IIf( Buyatr , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );
PlotShapes( IIf( Sellatr , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );
  
}



/*
 
 
// Ve kenh thoat lenh theo ATR 
  
if (ParamToggle("8 - Kenh thoat lenh theo ATR", "OFF|ON" , 0 ))
{

//Kenh thoat lenh ATR
Plot( trailARRAY,"Trailing stop level", ParamColor( " - ATR Color", colorBlue ) , styleLine | ParamStyle(" - ATR Style" , styleThick) |styleNoLabel|styleNoRescale  );

}

*/


 

// END Diem MUA - Ban theo ATR



   

//***********************************************************************************************************






//====================================================================================
// 7. Canh bao Dinh - Day
//====================================================================================




//****************************************
//Code to automatically identify pivots
//****************************************

// -- what will be our lookback range for the hh and ll?
// - pham vi xem lai cua chung ta cho HH va LL se la bao nhieu?
//Thoi gian theo doi tin hieu trong qua khu

Dinhday = Param(" ****** Canh bao Dinh - Day ****** ",0,0,0,0); 

//----------------------------------------------------

farback = Param(" - So Ngay xem lai Tin hieu",130,20,10000,20);//How Far back to go
nBars   = Param(" - So Ngay tinh vung Dinh - Day ", 20, 1, 200,1);//Number of bars

// -- Create 0-initialized arrays the size of barcount
aHPivs = H - H;
aLPivs = L - L;

// -- More for future use, not necessary for basic plotting
aHPivHighs = H - H;
aLPivLows = L - L;
aHPivIdxs = H - H;
aLPivIdxs = L - L;
nHPivs = 0;
nLPivs = 0;
lastHPIdx = 0;
lastLPIdx = 0;
lastHPH = 0;
lastLPL = 0;
curPivBarIdx = 0;

// -- looking back from the current bar, how many bars
// back were the hhv and llv values of the previous
// n bars, etc.?
aHHVBars = HHVBars( H, nBars );
aLLVBars = LLVBars( L, nBars );
aHHV = HHV( H, nBars );
aLLV = LLV( L, nBars );

// -- Would like to set this up so pivots are calculated back from
// last visible bar to make it easy to "go back" and see the pivots
// this code would find. However, the first instance of
// _Trace output will show a value of 0
aVisBars = Status( "barvisible" );
nLastVisBar = LastValue( Highest( IIf( aVisBars, BarIndex(), 0 ) ) );
_TRACE( "Last visible bar: " + nLastVisBar );

// -- Initialize value of curTrend
curBar = ( BarCount - 1 );
curTrend = "";

if ( aLLVBars[curBar] < aHHVBars[curBar] )
{
    curTrend = "D";
}
else
{
    curTrend = "U";
}

// -- Loop through bars. Search for
// entirely array-based approach
// in future version
for ( i = 0; i < BarCount; i++ )
{
    curBar = ( BarCount - 1 ) - i;
// -- Have we identified a pivot? If trend is down...

    if ( aLLVBars[curBar] < aHHVBars[curBar] )
    {
// ... and had been up, this is a trend change
        if ( curTrend == "U" )
        {
            curTrend = "D";
// -- Capture pivot information
            curPivBarIdx = curBar - aLLVBars[curBar];
            aLPivs[curPivBarIdx] = 1;
            aLPivLows[nLPivs] = L[curPivBarIdx];
            aLPivIdxs[nLPivs] = curPivBarIdx;
            nLPivs++;
        }

// -- or current trend is up
    }
    else
    {
        if ( curTrend == "D" )
        {
            curTrend = "U";
            curPivBarIdx = curBar - aHHVBars[curBar];
            aHPivs[curPivBarIdx] = 1;
            aHPivHighs[nHPivs] = H[curPivBarIdx];
            aHPivIdxs[nHPivs] = curPivBarIdx;
            nHPivs++;
        }

// -- If curTrend is up...else...
    }

// -- loop through bars
}

// -- Basic attempt to add a pivot this logic may have missed
// -- OK, now I want to look at last two pivots. If the most
// recent low pivot is after the last high, I could
// still have a high pivot that I didn't catch
// -- Start at last bar
curBar = ( BarCount - 1 );

candIdx = 0;

candPrc = 0;

lastLPIdx = aLPivIdxs[0];

lastLPL = aLPivLows[0];

lastHPIdx = aHPivIdxs[0];

lastHPH = aHPivHighs[0];

if ( lastLPIdx > lastHPIdx )
{
// -- Bar and price info for candidate pivot
    candIdx = curBar - aHHVBars[curBar];
    candPrc = aHHV[curBar];

    if (
        lastHPH < candPrc AND
        candIdx > lastLPIdx AND
        candIdx < curBar )
    {
// -- OK, we'll add this as a pivot...
        aHPivs[candIdx] = 1;
// ...and then rearrange elements in the
// pivot information arrays

        for ( j = 0; j < nHPivs; j++ )
        {
            aHPivHighs[nHPivs-j] = aHPivHighs[nHPivs- ( j+1 )];
            aHPivIdxs[nHPivs-j] = aHPivIdxs[nHPivs-( j+1 )];
        }

        aHPivHighs[0] = candPrc ;

        aHPivIdxs[0] = candIdx;
        nHPivs++;
    }
}
else
{
// -- Bar and price info for candidate pivot
    candIdx = curBar - aLLVBars[curBar];
    candPrc = aLLV[curBar];

    if (
        lastLPL > candPrc AND
        candIdx > lastHPIdx AND
        candIdx < curBar )
    {
// -- OK, we'll add this as a pivot...
        aLPivs[candIdx] = 1;
// ...and then rearrange elements in the
// pivot information arrays

        for ( j = 0; j < nLPivs; j++ )
        {
            aLPivLows[nLPivs-j] = aLPivLows[nLPivs-( j+1 )];
            aLPivIdxs[nLPivs-j] = aLPivIdxs[nLPivs-( j+1 )];
        }

        aLPivLows[0] = candPrc;

        aLPivIdxs[0] = candIdx;
        nLPivs++;
    }
}


DinhTop    = aHPivs;
DayBottom  = aLPivs;

DinhDayTopBottom = DinhTop OR DayBottom;



//====================================================================================
// 7. Buy Sell Canh bao Dinh - Day
//====================================================================================

//============== EXPLORATION ==============


PivotTrailStop = HHV( C - 2 * ATR( 10 ), 15 );
PivotProfitTaker = EMA( H, 13 ) + 2 * ATR( 10 );

//----------------------------------------------------


BuyDayBottom =  aLPivs == 1 AND HighVolume;

SellDinhTop  =  aHPivs == 1 AND HighVolume;

 
PivotSellPrice = ValueWhen( SellDinhTop, C, 1 );

PivotBuyPrice = ValueWhen( BuyDayBottom, C, 1 );

PivotLong = Flip( BuyDayBottom, SellDinhTop );

PivotShort = Flip( SellDinhTop, BuyDayBottom );

//============================================



if (BsTurtle = ParamToggle( "9 - Canh bao Dinh - Day",  "OFF|ON", 0 ))
{

//Hien canh bao Dinh Day
//Hien chu Text

 for ( i = 0; i < BarCount; i++ )
{ 

//Day
if( DayBottom[i] == 1 )
    {
 PlotText( "Bot ("+NumToStr(PivotBuyPrice[i],1.1)+")", i , L[ i ], colorGold, colorback=-1 , Ofset = -15 ) ;
     }  

//Dinh
if( DinhTop[i] == 1 )
    {
 PlotText( "Top ("+NumToStr(PivotSellPrice[i], 1.1)+")", i , H [ i ],  colorGold, colorback=-1 , Ofset = 5 ) ;
     }     
            
     
 }  

//*********************************************************************
// Dau hieu Buy Day + Sell Dinh

//Mua Day
PlotShapes( IIf( DayBottom==1 , shapeUpArrow , shapeNone ), colorGold, 0, L, Offset =-25 );
PlotShapes( IIf(BuyDayBottom, shapeStar, shapeNone),colorYellow, 0, H, Offset = 0 );
PlotShapes( IIf(BuyDayBottom, shapeHollowCircle, shapeNone),colorGold, 0, H, Offset = 0 );

//Ban Dinh
PlotShapes( IIf( DinhTop==1 , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25);
PlotShapes( IIf(SellDinhTop, shapeStar, shapeNone),colorYellow, 0 ,L,  Offset = 0  );
PlotShapes( IIf(SellDinhTop, shapeHollowCircle, shapeNone),colorYellow, 0 ,L,  Offset = 0  );



}



//**********************************************************************************************



//***********RSI Divergence***************
//RSI Phan ky
//RSI Divergence
RSIDivergence          = Param(" ****** RSI Divergence - Phan ky ****** ",0,0,0,0); 

RSIPrice               = ParamField( " - RSI Price field" );
RSIperiods             = Param(" - RSI Periods", 14, 1, 200, 1 );
ZigZagRSIPeriods       = Param(" - Zig Zag RSI Periods",20,0,100,1);
VarRSI                 = Zig(RSIa( RSIPrice, RSIperiods), ZigZagRSIPeriods); 
tRSI                   = Trough(RSIa( RSIPrice, RSIperiods), ZigZagRSIPeriods, 1); 
pRSI                   = Peak(RSIa( RSIPrice, RSIperiods), ZigZagRSIPeriods, 1); 
xRSI[0] =VarRSI[0];
priceRSI[0] = C[0];
j=0;
BuyRSIDivergence=0;
SellRSIDivergence=0;
// bearish divergence
for ( i=0; i<BarCount; i++) 
{
if(VarRSI[i] == pRSI[i])
{
  
j++;
xRSI[j] =VarRSI[i];
priceRSI[j] =C[i];
if(xRSI[j] <xRSI[j-1] && priceRSI[j-1]< priceRSI[j]) 
SellRSIDivergence[i] =1;
 
}
}
  
// bullish divergence
for ( i=0; i<BarCount; i++) 
{
if(VarRSI[i] == tRSI[i])
{
j++;
xRSI[j] =VarRSI[i];
priceRSI[j] =C[i];
if(xRSI[j] >xRSI[j-1] && priceRSI[j]<priceRSI[j-1]) 
BuyRSIDivergence[i] =1;


}
}
  
  
  
//***********************************************************************************************
  

//====================================================================================|
// 8. Tin hieu Mua Ban theo RSI Divergence                                |
//====================================================================================|


 
if (ParamToggle("10 - Buy - Sell theo RSI Divergence", "OFF|ON" , 0 ))
{
//Hien chu RSI
 for ( i = 0; i < BarCount; i++ )
{
//Buy
 if( BuyRSIDivergence[i] == 1 )
    {
 PlotText( "Rsi", i , L[ i ],  colorBlue, colorback=-1 , Offset=-40  ) ;
     }   
//Sell     
 if( SellRSIDivergence[i] == 1 )
    {
 PlotText( "Rsi", i , H [ i ],  colorRed, colorback=-1 , Offset= 40  ) ;
     }        
 
 }
 
 // Vao lenh Mua Ban
PlotShapes( IIf( BuyRSIDivergence , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );
PlotShapes( IIf( SellRSIDivergence , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );
  
}


  
//***********END RSI Divergence***************




//======================================================================================






//*****************************************************
//Tong hop toan bo tin hieu Buy Sell ngan han
//*****************************************************


Buyluotsong = BuyBreakout_SidewayDay OR Buy5Day OR Buy10Day OR BuyEMA5cross OR BuyEMA10cross OR BuyTurtle OR Buyatr OR DayBottom OR BuyDayBottom OR BuyRSIDivergence;

Sellluotsong = SellBreakout_SidewayDay OR Sell5Day OR Sell10Day OR SellEMA5cross OR SellEMA10cross OR SellTurtle OR exitArray OR Sellatr OR DinhTop OR SellDinhTop OR SellRSIDivergence;

luotsong = Buyluotsong OR Sellluotsong ;


//*****************************************************



//|============================================================================================|
//|             END Chien luoc giao dich Luot song ngan han                  
//|============================================================================================|



_SECTION_END();









//*****************************************************************************************************









//====================================================================================|
//                       Ichimoku Kinko Hyo                             |
//====================================================================================|


_SECTION_BEGIN(" - Ichimoku Kinko Hyo");



//*********************************************
//Cac thong so Ichimoku co ban 
// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257
// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129
// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 33 + Chon Dao gam 65
//*********************************************
 


//****Chon hieu Ichimoku so 1 hoac so 2
/*
 
//Chon bo so Ichimoku kieu so 1
 cprds1=9;
 cturn1=26;
 cdelay1=26;
 cspan1=52;
 cDG1=129;
 ctimeKumo1=26;
 
 //Chonj bo so Ichimoku kieu so2
 cprds2=9;
 cturn2=17;
 cdelay2=26;
 cspan2=33;
 cDG2=65;
 ctimeKumo2=26;
 */


SelectedIchimoku = ParamList( "* - Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 0 );

switch ( SelectedIchimoku )
{

//*************Truong hop chon Kieu Ichimoku truyen thong so 1

case "Ichimoku truyen thong 9-26-26-52-DG129":

 cprds1=9;
 cturn1=26;
 cdelay1=26;
 cspan1=52;
 cDG1=129;
 ctimeKumo1=26;


//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien
prds = Param( " - Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  

//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien 
// Co the thay doi sang kieu Ichimoku so 2 (17 phien)

turn = Param( " - Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau


//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)
//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)
//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong
delay = Param( " - Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); 

//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) 
// Co the thay doi sang kieu Ichimoku so 2 (26 phien)
span = Param( " - Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); 


//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han 
//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)
DG = Param(" - Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); 

// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)
timeKumo=Param( " - Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  




break;


//*************Truong hop chon Kieu Ichimoku kieu moi so2



case "Ichimoku kieu VN 9-17-26-33-DG65":

 //Chon bo so Ichimoku kieu so 2
 cprds2=9;
 cturn2=17;
 cdelay2=26;
 cspan2=33;
 cDG2=65;
 ctimeKumo2=26;



//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien
prds = Param( " - Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  

//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien 
// Co the thay doi sang kieu Ichimoku so 2 (17 phien)

turn = Param( " - Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau


//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)
//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)
//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong
delay = Param( " - Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); 

//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) 
// Co the thay doi sang kieu Ichimoku so 2 (26 phien)
span = Param( " - Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); 


//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han 
//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)
DG = Param(" - Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); 

// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)
timeKumo=Param( " - Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  




break;


}
 
 
 



 

//*********************************************
//Cac duong Ichimoku co ban
//*********************************************
//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)

    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han 
        //Duong Taken Sen (Kieu truyen thong la 9 phien)
        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon
        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han 
        //Taken Sen do luong xu huong ngan han
        //Taken Sen do luong bien dong gia ngan han

TL = ( HHV( H, prds ) + LLV( L, prds ) )/2;

    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien 
        //Duong Kijun Sen (Kieu truyen thong la 26 phien)
        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam 
        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon
        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han 
        //Kijun Sen do luong xu huong trung han
        //Kijun Sen do luong bien dong gia trung han

SL = ( HHV( H, turn ) + LLV( L, turn) )/2;

    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han 
        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129
        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65
        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)
        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon
        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han
        // Dao gam do luong xu huong trung han
        // Dao gam do luong bien dong gia trung han

DG = ( HHV( H, DG ) + LLV( L, DG) )/2;


//II. Chikou Span = Lagging Span 
        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)
        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)
        //Dung de xac nhan cho xu huong qua khu
        //Hoac dung de danh gia cho xu huong hien tai
        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang
        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam

Lagging = Ref( C, -delay );

//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)

        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai
        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai
        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?
        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac
        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan
        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan
        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)

    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2
        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. 
        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) 
        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) 
Span1 = (( SL + TL )/2);

    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2
        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) 
        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)
        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  
        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) 

Span2 = (HHV( H, span) + LLV(L, span))/2;

    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B
        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai
        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai
        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi
        
    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo
        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong
        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day
        
    //Hien tuong May Kumo phang (nam ngang): 
        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) 
        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon
        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi
        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.
        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.
        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat




//************************************************
// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku
//************************************************

//************Cac tin hieu Mua ban co ban*********

//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)

     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan
     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan
     
  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku
  
  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo

     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo
     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo

     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo
     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo

     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo
     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo

  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span

     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh
     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh
     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu

  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). 
  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu
  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac



//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)

     // Span A cat len Span B: Du doan Xu huong tuong lai tang 
     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam 
     
  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku

  //Cuong do tin hieu giao cat Span A va B duoc phan thanh

     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)
     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra
     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)

//3. Chien luoc giao cat giua Gia va duong Chikou Span

     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku
     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)
     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)

  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do

     //*Tin hieu Manh
     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo
     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo

     //*Tin hieu Trung binh
     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo
     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo

     //*Tin hieu Yeu
     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo 
     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo

//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia
//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai



//************************************************
//   Tin Hieu Mua Ban theo Ichimoku
//************************************************


//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span

   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)
   //Dung de danh gia ve Xu huong trung han hien tai


      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B 
      //Xu huong tang trung han duoc xac nhan
aboveKumo=IIf((C>Ref(Span1,-timeKumo) AND C>Ref(Span2,-timeKumo)),1,0);

      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B
      //Xu huong trung han khong ro rang
      
      
withinKumo=IIf((C>=Ref(Span2,-timeKumo) AND C<=Ref(Span1,-timeKumo)),1,0) OR IIf((C>=Ref(Span1,-timeKumo) AND C<=Ref(Span2,-timeKumo)),1,0);

      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B
      //Xu huong giam trung han duoc xac nhan
belowKumo=IIf((C<Ref(Span1,-timeKumo) AND C<Ref(Span2,-timeKumo)),1,0);


   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) 
   //Dung de danh gia ve Xu huong ngan han hien tai 


      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen
      //Xu huong tang ngan han hien tai duoc xac nhan
aboveSenCloud = IIf ( (C > Ref(TL,-prds) AND  C > Ref(SL,-turn)),1,0); 

      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen
      //Xu huong ngan han hien tai khong ro rang
withinSenCloud = IIf ((C >=Ref(TL,-prds) AND C<=Ref(SL,-turn)),1,0) OR IIf((C>=Ref(SL,-turn) AND C<=Ref(TL,-prds)),1,0); 

      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen
      // Xu huong giam ngan han hien tai duoc xac nhan
belowSenCloud = IIf ((C <Ref(TL,-prds) AND C<Ref(SL,-turn)),1,0)  ; 


//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************



   //3. So sanh gia voi duong tre Chikou Span
   //Price26 above Lagging, lag26 above C, Lag26 is rising 
   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang

      //dlUp - Xu huong hien tai Tang gia: 
      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia
      //Vuot vung khang cu ngan han (1 thang)
      //Xu huong tang ngan han hien tai duoc xac nhan
dlUp =   Ref(Lagging, -1) > C AND Lagging < C AND C > Ref(C,-1); 

      //dlDown - Xu huong hien tai Giam gia: 
      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia
      //Pha vung ho tro ngan han (1 thang)
      //Xu huong giam ngan han hien tai duoc xac nhan
      
dlDown = Ref(Lagging, -1) < C AND Lagging > C AND C < Ref(C,-1); 



//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen
//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau

//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen

             //************** Tin hieu Mua theo Taken Sen va Kijun Sen******************

        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen

        //Tin hieu Mua so 2 (Tinhieu2)
        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen 
        //Tinhieu2 Manh hon Tinhieu1

BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C > TL AND C > SL ; //OK

        //Tin hieu Mua so 3 (Tinhieu3)
        //Kijun Sen Cross 
        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo
        //Tinhieu3 manh hon Tinhieu2

BuyStrongPriceCross = (Cross(C,SL)  AND (C > TL)  and C > SL AND (TL > SL) AND aboveKumo  ) 
                   OR (Cross(C,TL)  AND (C > TL)  and C > SL AND (TL > SL) AND aboveKumo  ) ; //OK 
                   



             //*************** Tin hieu Mua khi pha vo may Kumo - Kumo Breakout ***************
			
        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).

        //Tin hieu Mua so 1 (Tinhieu1)
        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen

BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C > SL AND  C> TL  ; //OK

        //Tin hieu mua khi Gia vuot may Sen
        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen
BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  ; //OK

             
 


//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)
     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai
     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc
     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay
     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai
     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)
     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B

             //************** Tin hieu Mua ******************


     //Tin hieu mua so 4 (Tinhieu4)
     //Gia nam tren May Kumo va Span A cat len Span B 
     //Tin hieu mua gia tang trong xu huong tang Trung han

BuyStrongSenkouSpanCross = aboveKumo AND Cross(span1,span2) ; //OK

//3. Tin hieu giao cat voi duong tre Chikou Span
     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)
     //Xu huong tang khi Chikou Span tang len va cat len duong Gia
     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia
     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)
     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.
     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo
     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban
     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia


     //Tin hieu mua so 5 (Tinhieu5)
     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen
     
     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span
      //Gia tang vuot vung khang cu ngan han (1 thang)
      //Xu huong tang ngan han duoc xac nhan
    

BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C > TL AND C > SL; //OK (da co DK  AND C > Ref(C,-1) trong dlUP)

//************************************************
//   Tong hop cac tin hieu Mua (Long) theo Ichimoku
//************************************************


//1. Tin hieu Mua so 1 (Tinhieu1)

//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen
//Xu huong tang trung han duoc xac nhan

TinHieu1 = BuyKumoBreakout AND TL> SL AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;
                                                                     
//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C > SL AND  C> TL  ; //OK

//2. Tin hieu Mua so 2 (Tinhieu2)

//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen 
//Tinhieu2 Manh hon Tinhieu1

TinHieu2 = BuyStrongTKCross AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;
                                                                         
//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C > TL AND C > SL ; //OK

//3. Tin hieu Mua so 3 (Tinhieu3)

//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo
//Tinhieu3 manh hon Tinhieu2

TinHieu3 = BuyStrongPriceCross AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;
                                                                            
//BuyStrongPriceCross = (Cross(C,SL)  AND (C > TL)  and C > SL AND (TL > SL) AND aboveKumo  ) 
//                   OR (Cross(C,TL)  AND (C > TL)  and C > SL AND (TL > SL) AND aboveKumo  ) ; //OK 


//4. Tin hieu mua so 4 (Tinhieu4)

//Gia nam tren May Kumo va Span A cat len Span B 
//Tin hieu mua gia tang trong xu huong tang Trung han truoc do
//Tinhieu4 manh hon Tinhieu3

TinHieu4 = BuyStrongSenkouSpanCross AND C > TL AND C > SL AND TL > SL AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;
                                                                           
//BuyStrongSenkouSpanCross = aboveKumo AND Cross(span1,span2) ; //OK

//5. Tin hieu mua so 5 (Tinhieu5)

//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen
      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span
                       //Gia tang vuot vung khang cu ngan han (1 thang)
                       //Xu huong tang ngan han duoc xac nhan
//Tinhieu5 manh hon Tinhieu4

TinHieu5 = BuyStrongChikouSpanCross AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;

//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C > TL AND C > SL; //OK (da co DK  AND C > Ref(C,-1) trong dlUP)
//dlUp =   Ref(Lagging, -1) > C AND Lagging < C AND C > Ref(C,-1); 


//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen

//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen
//VuotMay manh hon Tinhieu5

VuotMay = BuySenBreakout AND C>TL AND C>SL  and aboveKumo AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;
                                                                            
//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  ; //OK

//7. Tin hieu Vuot May Sen va may Kumo

//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)
//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen
//VuotMaySenKumo manh hon VuotMay

VuotMaySenKumo =  BuyKumoBreakout AND VuotMay AND TL > SL;
                                                                         
//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C > SL AND  C> TL  ; //OK
//VuotMay = BuySenBreakout AND C>TL AND C>SL  and aboveKumo AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;


//8. Tin hieu HopBich

//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen
//The hien Xu huong tang ngan han van duong giu vung
//Tin hieu mua gia tang trong xu the tang truoc do

HopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL>=DG) )  AND (TL > Ref(TL,-1)) AND (C>TL)  AND C>SL   AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;
                                                                             
//9. Tin hieu Bom no
//Bom no = (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] > span2[i]) AND (TL[i]>SL[i]))
// Vuot may Sen va Kumo, Span A > Span B, Tenkan > Kijun

Bomno = VuotMaySenKumo AND VuotMay  AND span1 > span2 ;

//VuotMaySenKumo =  BuyKumoBreakout AND VuotMay AND TL > SL;                                                                        
//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C > SL AND  C> TL  ; //OK
//VuotMay = BuySenBreakout AND C>TL AND C>SL  and aboveKumo AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;


//***************************************************************************************************************
                                                                         
//************** Tin hieu Mua som theo Tenkan Sen va Kijun Sen******************

//1. Tin hieu Mua som - Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen
        
BuyPriceCross    =      ( Ref(belowSenCloud,-1) AND withinSenCloud )  
                      OR ( Ref(belowSenCloud ,-1) AND aboveSenCloud ) 
                      OR ( Ref(withinSenCloud,-1) AND aboveSenCloud )
                      OR ( Cross(TL,SL) AND C > TL AND C > SL       ); 

//2. Tin hieu Mua som khi Gia vuot may Kumo - Kumo Breakout

        //Tin hieu Mua som khi pha len may Kumo
        //Ban khi Gia tu trong may hoac tren may vuot len may Kumo 
BuyKumoBreakdown = (aboveKumo AND Ref(withinKumo,-1))   OR (aboveKumo AND Ref(belowKumo ,-1));

//********************************************************************************

        //Tin hieu Mua som ngan han Yeu 
        //Tin hieu Mua som - Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen, van nam duoi may Kumo

Buyichimoku1  = BuyPriceCross AND belowKumo AND Priceup AND HighVolume;


        //Tin hieu Mua som ngan han Trung lap (Ko ro rang)
        //Tin hieu Mua som ngan han Trung lap (Ko ro rang) Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen, nam trong may Kumo

Buyichimoku2  = BuyPriceCross AND withinKumo AND Priceup AND HighVolume;


        //Tin hieu Mua som ngan han Manh
        //Tin hieu Mua som ngan han Manh Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen, nam tren may Kumo


Buyichimoku3  = (BuyPriceCross OR BuyKumoBreakdown) AND aboveKumo AND Priceup AND HighVolume;




//***************************************************************************************************************

//***************************************************
//   Tong hop cac tin hieu Ban (Short) theo Ichimoku
//***************************************************


//************** Tin hieu Ban theo Tenkan Sen va Kijun Sen******************

//1. Tin hieu Ban - Xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen
        
SellPriceCross    =      ( Ref(aboveSenCloud,-1) AND withinSenCloud )  
                      OR ( Ref(aboveSenCloud ,-1) AND belowSenCloud ) 
                      OR ( Ref(withinSenCloud,-1) AND belowSenCloud )
                      OR ( Cross(SL,TL) AND C < TL AND C < SL       ); 

//2. Tin hieu Ban khi pha xuong may Kumo - Kumo Breakdown

        //Tin hieu Ban khi pha vo may Kumo
        //Ban khi Gia tu trong may hoac tren may cat xuong may Kumo 
SellKumoBreakdown = (belowKumo AND Ref(withinKumo,-1))   OR (belowKumo AND Ref(aboveKumo ,-1));


//********************************************************************************

        //Tin hieu ban ngan han Yeu 
        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen, van nam tren may Kumo

Sellichimoku1  = SellPriceCross AND Pricedown AND aboveKumo;

        //Tin hieu ban ngan han Trung lap (Ko ro rang)
        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen, nam trong may Kumo

Sellichimoku2  = SellPriceCross AND Pricedown AND withinKumo;

        //Tin hieu ban ngan han Manh
        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen, nam duoi may Kumo


Sellichimoku3  = (SellPriceCross OR SellKumoBreakdown) AND Pricedown AND belowKumo;


//*****************************************************************************


//********Tong hop hien thi cac tin hieu Mua Ichimoku*************

Buyichimoku  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich OR Bomno OR Buyichimoku2 OR Buyichimoku3 ;



//********Tong hop hien thi cac tin hieu Ban Ichimoku*************



Sellichimoku  =   Sellichimoku1  OR Sellichimoku2  OR Sellichimoku3 ;


//Loc tin hieu Mua 
TinHieu1         = ExRem (TinHieu1,Sellichimoku);
TinHieu2         = ExRem (TinHieu2,Sellichimoku);
TinHieu3         = ExRem (TinHieu3,Sellichimoku);
TinHieu4         = ExRem (TinHieu4,Sellichimoku);
TinHieu5         = ExRem (TinHieu5,Sellichimoku);
VuotMay          = ExRem (VuotMay,Sellichimoku);
VuotMaySenKumo   = ExRem (VuotMaySenKumo,Sellichimoku);
Bomno            = ExRem (Bomno,Sellichimoku);
Buyichimoku2 OR Buyichimoku3  = ExRem (Buyichimoku2 OR Buyichimoku3,Sellichimoku);


//Loc tin hieu Ban 
Sellichimoku1    = ExRem (Sellichimoku1,Buyichimoku);  
Sellichimoku2    = ExRem (Sellichimoku2,Buyichimoku);  
Sellichimoku3    = ExRem (Sellichimoku3,Buyichimoku);  







//================================================================================|
//   Thanh xac dinh xu huong Ichimoku
//================================================================================|
//********Xac dinh xu huong Ichimiku -Duong mau Xanh Do o duoi cung man hinh******
//Xu huong Tang: mau Xanh - Giam: mau Do - Ko ro rang: mau Vang
// Ve Ribbon - Xac dinh xu huong 

//Xu huong Tang: Tren may Kumo, tren may sen, gia dang tang, Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam
XuhuongIchimokuTang = ( aboveKumo AND aboveSenCloud  AND TL >= SL AND C>=DG )

OR   ( aboveKumo AND aboveSenCloud AND PriceUpMA AND EMA10up AND UptrendMark )                      
                       
OR   ( aboveKumo AND aboveSenCloud AND PriceUpMA )
                      
OR   ( aboveKumo AND aboveSenCloud  AND TL >= SL AND C>=DG AND PriceUpMA AND EMA10up AND UptrendMark  )

OR   ( aboveKumo AND aboveSenCloud  AND PriceUpMA AND EMA10up );
                                                                      

//Xu huong Giam: Duoi may Kumo, duoi may sen, gia dang giam, Tenkan Sen nam duoi Kijun Sen va Gia nam duoi duong ho tro dai han Dao gam
XuhuongIchimokuGiam = (belowKumo AND belowSenCloud AND TL < SL AND C<DG )

OR  (belowKumo AND belowSenCloud AND TL < SL AND C<DG 
AND PriceDownMA AND EMA10down )

OR  (belowKumo AND belowSenCloud AND TL < SL AND C<DG 
AND PriceDownMA AND EMA10down AND DowntrendMark )

OR  (belowKumo AND belowSenCloud 
AND PriceDownMA AND EMA10down )   

OR  (belowKumo AND belowSenCloud 
AND PriceDownMA AND EMA10down AND DowntrendMark );   
                                     

//******************************************************

XuhuongIchimokuTangoff = Sellichimoku2 OR Sellichimoku3;    

XuhuongIchimokuGiamoff = Buyichimoku2 OR Buyichimoku3;                     

  


//****************************************************************************
//Dieu kien ve xu huong Ichimoku

 Xuhuongichimoku   = IIf(XuhuongIchimokuTang,1,IIf(XuhuongIchimokuGiam,-1,0));  

 XuhuongichimokuColor   = IIf(XuhuongIchimokuTang,colorBlue,IIf(XuhuongIchimokuGiam,colorRed,colorYellow));  


//****************************************************************************************


//====================================================================================|
//         Hien thi tin hieu Mua Ban theo Ichimoku Kinko Hyo                             |
//====================================================================================|



//  Ve Tenkan Kijun Chikou Dao gam cua Ichimoku
//==========================================================

TenkanKijunIchimoku = ParamToggle("* - Hien thi Tenkan Sen + Kijun Sen","OFF|ON",0);


if(TenkanKijunIchimoku==1)
{

//Ve duong Tenkan Sen va Kijun Sen
  
Plot(TL ,"Tenkan Sen ",colorLightOrange,styleThick|styleNoLabel|styleNoRescale ); //Duong TenkanSen
Plot(SL,"Kijun Sen",colorBlue,styleThick |styleNoLabel|styleNoRescale ); // Duong Kijun Sen

//Ve May Sen va chon mau May Sen 
PlotOHLC( TL, SL, TL, SL, "", IIf(TL>SL,colorSkyblue, colorTeal),styleCloud| styleNoLabel|styleNoRescale  );

}


//  Ve Chikou Span cua Ichimoku
//==========================================================

ChikouIchimoku = ParamToggle("* - Hien thi Chikou Span","OFF|ON", 0);

if(ChikouIchimoku==1)
{

// Ve duong Chikou Span
Plot(C,"",colorLightGrey,styleThick|styleThick| styleNoLabel|styleNoRescale ,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span

}
  

//  Ve Dao gam cua Ichimoku
//==========================================================


DaogamIchimoku = ParamToggle("* - Hien thi Dao gam","OFF|ON",0);


if(DaogamIchimoku==1)
{

// Ve duong Dao Gam

Plot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick |styleNoLabel|styleNoRescale ); //Duong ho tro dai han Dao Gam

}
 
 

//  Ve May Kumo cua Ichimoku
//==========================================================


if(ParamToggle("* - Hien thi May Kumo","OFF|ON", 0))
{

// Ve duong Senkou Span A va Senkou Span B
Plot(Span1,"",colorLightOrange,1| styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span A
Plot(Span2,"",colorLime,1 |styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span B

//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien
//PlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1>Span2, ColorBlend( colorLime, colorBlack, 0.01 ) , ColorBlend( colorLightOrange, colorBlack, 0.4 )),styleCloud|4096,0,0,timeKumo); 
PlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1>Span2,colorLime,colorLightOrange),styleCloud |styleNoLabel|styleNoRescale ,0,0,timeKumo); 

}


//   Thanh xac dinh xu huong Ichimoku
//==========================================================================|

// Ve xu huong Ichimoku - Thanh xu huong cuoi man hinh

if (ParamToggle("* - Ichimoku Kinko Hyo Trend - Xu huong Ichimoku","OFF|ON" , 0 ))
{
// Hien thi xu huong Ichimoku - Thanh xu huong cuoi man hinh
Plot( 0.9,"Ichimoku Trend",XuhuongichimokuColor, styleArea | styleOwnScale | styleNoLabel |styleNoRescale, 0, 100 );
Plot( 1.1,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100 );

}





  
  
 
//                 Mua Ban theo Ichimoku                |
//==========================================================================|
//    Ve cac tin hieu Mua Ban Ichimoku
//************************************************



if(ParamToggle("* - Buy - Sell Ichimoku","OFF|ON", 0 ))
{

//Tin hieu Mua so 0
PlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow + shapeDigit0 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so0
PlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 1
PlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so1
PlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 2
PlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so2
PlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 3
PlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so3
PlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 4
PlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so4
PlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 5
PlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so5
PlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua Vuot May Sen
//PlotShapes( IIf( VuotMay , shapeUpArrow + shapeStar, shapeNone ), colorSeaGreen, 0, H, Offset =-25 ); // dau hieu Hoa xanh la phia tren Gia
PlotShapes( IIf( VuotMay , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu Sen

//Tin hieu Mua Vuot May Sen va May Kumo
//PlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 > Span2 , shapeUpArrow + shapeStar, shapeNone ), colorLime, 0, H, Offset =-35 ); // dau hieu Hoa xanh la phia tren Gia
PlotShapes( IIf( VuotMaySenKumo , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu SenKumo

//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han
//Tin hieu Mua gia tang them vi then
PlotShapes( IIf( HopBich , shapeStar, shapeNone ), colorGold, 0, H, Offset = -25 );  // dau hieu Hoa vang phia tren Gia

//Tin hieu Mua Bom no
PlotShapes( IIf( Bomno , shapeUpArrow + shapeStar, shapeNone ), colorViolet, 0, H, Offset =-25 ); // dau hieu Hoa xanh phia tren Gia
PlotShapes( IIf( Bomno , shapeUpArrow , shapeNone ), colorViolet, 0, L, Offset =-25 ); //Mui ten vang va chu Bom No

//Buy Ichimoku

for( i = 0; i < BarCount; i++ ) 
{ 
if ( VuotMay[i] ) 
	PlotText( "Sen", i , L [i], colorSeaGreen, Colorback=-1 , Offset =-75 ) ;  //Hien chu Sen
if ( VuotMaySenKumo[i] ) 
	PlotText( "SenKumo", i , L [i],  colorLime, Colorback=-1 , Offset =-90 ) ;  //Hien chu SenKumo	
if (Bomno[i] )
	PlotText( "Bom No", i , L [i],  colorViolet , Colorback=-1 , Offset =-105 ); //Hien chu Bom No
} 

//*****************************
//Sell Ichimoku
//*****************************




//Tin hieu Ban tren may Kumo

PlotShapes( IIf( Sellichimoku1 , shapeDownArrow + shapeDigit0, shapeNone ), colorRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia
PlotShapes( IIf( Sellichimoku1 , shapeDownArrow , shapeNone ), colorRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1

//Tin hieu Ban trong may Kumo

PlotShapes( IIf( Sellichimoku2 , shapeDownArrow + shapeDigit1, shapeNone ), colorBrown, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia
PlotShapes( IIf( Sellichimoku2 , shapeDownArrow , shapeNone ), colorBrown, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1

//Tin hieu Ban duoi may Kumo

PlotShapes( IIf( Sellichimoku3 , shapeDownArrow + shapeDigit2, shapeNone ), colorDarkRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia
PlotShapes( IIf( Sellichimoku3 , shapeDownArrow , shapeNone ), colorDarkRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1


/*

//Hien chu
for( i = 0; i < BarCount; i++ ) 
{ 
//Tin hieu Ban tren may Kumo
if ( Sellichimoku1[i] ) 
PlotText( "I1", i , H [i], colorBlack, colorRed, Offset = 50 ) ;  

//Tin hieu Ban trong may Kumo	
if ( Sellichimoku2[i] ) 
PlotText( "I2", i , H [i], colorBlack, colorGold, Offset = 50 ) ; 	

//Tin hieu Ban duoi may Kumo	
if (Sellichimoku3[i] )
PlotText( "I3", i , H [i], colorBlack, colorDarkRed, Offset = 50 ) ; 	
} 

*/

}
  




//========================================================================================


//=======================================================
//Ichimuko Time Series
//=======================================================

IchiTimeonoff = ParamToggle("* - Ichimuko Time Series","OFF|ON", 0 );

ValueY = LowestVisibleValue(L);

//IIf(IchiTimeonoff,-1e10,0)

//1. Ichimuko Time Series
//============================================

function DrawSeries( start, series, Color )
{
	x = BarsSince( start );
	result = 0;
	for( i = 0; ( bar = StrToNum( StrExtract( series, i ) ) ) != 0; i++ )
	{
		result += x == bar;
		ValueX = SelectedValue(BarIndex()+1)+bar;
		
PlotText(""+bar,IIf(IchiTimeonoff,ValueX,-1e10),IIf(IchiTimeonoff,ValueY,-1e10),Color );
	}
	
Plot(IIf(IchiTimeonoff,result,-1e10) , "", Color, styleHistogram|styleOwnScale|styleNoLabel|styleDashed , 0,1 );

}
IchiSeries = "9,13,17,26,33,42,52,83,97";
bi = BarIndex();
start = bi == SelectedValue( bi-0);
DrawSeries( start, IchiSeries, ParamColor( " - Ichimuko Time Series Line Color", colorLightGrey)  );


//2. Ichimuko Time Series Reserver
//============================================

function DrawSeriesReserver( start, series, Color )
{
	x = BarsSince( start );
	result = 0;
	for( i = 0; ( bar = StrToNum( StrExtract( series, i ) ) ) != 0; i++ )
	{
		result += x == (52-bar);
		ValueX = SelectedValue(BarIndex()+1-51)+(52-bar);
		PlotText("-"+bar,IIf(IchiTimeonoff,ValueX,-1e10),IIf(IchiTimeonoff,ValueY,-1e10),Color );

	}
	Plot( IIf(IchiTimeonoff,result,-1e10), "", Color, styleHistogram|styleOwnScale|styleNoLabel|styleDashed , 0, 1 );
}
IchiSeries = "9,26,52";
bi = BarIndex();
start = bi == SelectedValue( bi - 52 );
DrawSeriesReserver( start, IchiSeries, ParamColor( " - Ichimuko Time Series Line Color", colorLightGrey)  );

//End Ichimuko Time Series






_SECTION_END();

//***************************************************************
// END Ichimoku Kinko Hyo 
//***************************************************************











//***************************************************************************************************











//***************************************************************************
//===========================================================================
//***************************************************************************


//==========================================================================|
//                    Tong hop Cac chi bao thuong dung                         |
//==========================================================================|

_SECTION_BEGIN(" - Cac chi bao thuong dung");





//==========================================================================|
//                    Ve duong EMA va MA                         |
//==========================================================================|

//Ve EMA 5,10,20
if (plotema5_10_20  =   ParamToggle("1 - EMAs 5,10,20","OFF|ON" , 0 ))
{
// Hien thi cac duong EMA ngan han EMA5,10,20
Plot(IIf(plotema5_10_20 ==1, MA_ema5Day ,Null), "EMA5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);
Plot(IIf(plotema5_10_20 ==1, MA_ema10Day ,Null),"EMA10", colorLightOrange,   styleLine|styleThick|styleNoRescale);
Plot(IIf(plotema5_10_20 ==1, MA_ema20Day ,Null),"EMA20", colorBlue,          styleLine|styleThick|styleNoRescale);

//**********************************************************************************
maupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  
madncolor   = ParamColor(" - MA Down Color",    colorGrey40 );

bullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  
bearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );


//Ve may EMA 10 va 20
PlotOHLC( MA_ema10Day, MA_ema20Day, MA_ema10Day, MA_ema20Day, "", IIf(MA_ema10Day > MA_ema20Day, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);

}



// Ve duong EMA30,40
// Hien thi cac duong EMA30
Plot(IIf(ParamToggle("2 - EMA30","OFF|ON" , 0 )  ==1, MA_ema30Day ,Null),"EMA30", colorRed,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong EMA40
Plot(IIf(ParamToggle("3 - EMA40","OFF|ON" , 0 )  ==1, MA_ema40Day ,Null),"EMA40", colorSeaGreen,styleLine|styleThick|styleNoRescale);

//===============================================
// Ve duong MA50,100,150,200

// Hien thi cac duong MA50
Plot(IIf(ParamToggle("4 - MA50", "OFF|ON" , 0 ) ==1, MA_ma50Day ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong MA100
Plot(IIf(ParamToggle("5 - MA100","OFF|ON" , 0 ) ==1, MA_ma100Day ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong MA150
Plot(IIf(ParamToggle("6 - MA150","OFF|ON" , 0 ) ==1, MA_ma150Day ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);

// Hien thi cac duong MA200
Plot(IIf(ParamToggle("7 - MA200","OFF|ON" , 0 )  ==1, MA_ma200Day ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);


// END EMA va MA


//*********************************************************************************************************************




 
 
 //==========================================================================|
//                    Ve duong HO TRO - KHANG CU gan nhat                       |
//==========================================================================
 
if (ParamToggle("* - Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))
{

WarnaResistant = ParamColor(" - Chon mau Resistant - Khang cu",colorRed);
WarnaSupport   = ParamColor(" - Chon mau Support - Ho tro",    colorBlue);
SRStyle        = ParamStyle(" - S/R Style",styleNoLabel);

R1_show = 0;
S1_show = 0;
 
	// RESISTANT
	LastHighestValue = LastVisibleValue(Ref(H,-1));
	if (LastVisibleValue(H) == H[LastValue(BarIndex())])
		LastHighestValue = LastVisibleValue(H);
 
	i = 1;
	
	if (LastHighestValue < HighestVisibleValue(H))
	{
			while (LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(H, -1), i)) < LastHighestValue)
				i++;
 
	    	R1 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(H, -1), i));
 
			R1x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));
			Plot(IIf(BarIndex() >= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale );
			PlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);
			R1_show = 1;
 
			i++;
 
			if (HighestVisibleValue( H ) > R1)
			{
				while (LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i)) <= R1)
					i++;
 
				R2 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i));
				R2x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));
	
				Plot(IIf(BarIndex() >= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale );
				PlotText("R2 : " + R2, BarCount + 3, LastValue(R2), WarnaResistant);
				i++;
				if (HighestVisibleValue( H )> R2)
				{ 		
					while (LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i)) <= R2)
						i++;
					R3 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1), Ref(H,-1), i));
					R3x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));	
 
					Plot(IIf(BarIndex() >= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale);
					PlotText("R3 : " + R3, BarCount + 3, LastValue(R3), WarnaResistant);
				}
			}
	}
	else if (LastHighestValue == HighestVisibleValue(H))
	{
	   	R1 = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(H, -1), i));
		R1x = LastVisibleValue(ValueWhen(H <= Ref(H,-1) AND Ref(H,-2) <= Ref(H, -1),Ref(BarIndex(), -1), i));
		if (R1 == LastHighestValue)
		{
			Plot(IIf(BarIndex() >= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale);
			PlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);
			R1_show = 1;
		}
	}
 
	// SUPPORT
	LastLowestValue = LastVisibleValue(Ref(L,-1));
	if (LastVisibleValue(L) == L[LastValue(BarIndex())])
		LastLowestValue = LastVisibleValue(L);
 
	i = 1;
 
	if (LastLowestValue > LowestVisibleValue(L))
	{	
			while (LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(L, -1), i)) > LastLowestValue)
				i++;
 
			S1 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(L, -1), i));
			S1x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(BarIndex(), -1), i));
			Plot(IIf(BarIndex() >= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
			PlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);
			S1_show = 1;
			i++;
 
			if (LowestVisibleValue( L ) < S1)
			{
				while (LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i)) >= S1)
					i++;
 
				S2 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i));
				S2x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(BarIndex(),-1), i));	
 
				Plot(IIf(BarIndex() >= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
				PlotText("S2 : " + S2, BarCount + 3, LastValue(S2), WarnaSupport);
				i++;
				if (LowestVisibleValue( L )< S2)
				{ 		
					while (LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i)) >= S2)
						i++;
					S3 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(L,-1), i));
					S3x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1), Ref(BarIndex(),-1), i));
					Plot(IIf(BarIndex() >= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
					PlotText("S3 : " + S3, BarCount + 3, LastValue(S3), WarnaSupport);
				}
			}
	}
	else if (LastLowestValue == LowestVisibleValue(L))
	{
	   	S1 = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(L, -1), i));
		S1x = LastVisibleValue(ValueWhen(L >= Ref(L,-1) AND Ref(L,-2) >= Ref(L, -1),Ref(BarIndex(), -1), i));
		if (S1 == LastLowestValue)
		{
			Plot(IIf(BarIndex() >= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);
			PlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);
			S1_show = 1;
		}
	}
 
	if (S1_show AND R1_show)
	{
		SR = Prec((1-(S1/R1))*100,2);
	}
}

//END duong HO TRO - KHANG CU gan nhat  


//************************************************************************************************************************



 //====================================================================================|
//                       Ve duong Auto Trendline                                 |
//====================================================================================|

if (ParamToggle("* - Auto Trenline", "OFF|ON" ,0 ))
{


// Parallel lines defined by the automatic support and the HighestBetween point
xTrenline = Cum(1);
perTrenline = 3;
s1Trenline=L;
s11Trendline=H;
pSTrendline = TroughBars( s1Trenline, perTrenline, 1 ) == 0;
endtTrenline= LastValue(ValueWhen( pSTrendline, xTrenline, 1 ));
starttTrenline=LastValue(ValueWhen( pSTrendline, xTrenline, 2 ));
dtSTrenline =endtTrenline-starttTrenline;
endSTrendline = LastValue(ValueWhen( pSTrendline, s1Trenline, 1 ) );
startSTrendline = LastValue( ValueWhen( pSTrendline, s1Trenline, 2 ));
aSTrendline = (endSTrendline-startSTrendline)/dtSTrenline;
bSTrendline = endSTrendline;
trendlineS = aSTrendline * ( xTrenline -endtTrenline ) + bSTrendline;

Plot(IIf(xTrenline>starttTrenline-10,trendlineS,-1e10),"",colorBlue,styleNoLabel   |styleNoRescale);

H1Trendline=LastValue(Highest((Cum(1)>starttTrenline AND Cum(1)<endtTrenline)*H));
tH1Trendline=LastValue(ValueWhen(H==H1Trendline,Cum(1)));

UpperParallel=aSTrendline*(xTrenline-tH1Trendline)+H1Trendline;

Plot(IIf(xTrenline>starttTrenline-10,UpperParallel,-1e10),"UpperLine",colorOrange, styleNoLabel  |styleNoRescale);

// Parallel lines defined by the automatic resistance and the LowestBetween point

pRTrendline = PeakBars( s11Trendline, perTrenline, 1 ) == 0;
endt1Trendline= LastValue(ValueWhen( pRTrendline, xTrenline, 1 ));
startt1Trendline=LastValue(ValueWhen( pRTrendline, xTrenline, 2 ));
dtRTrendline =endt1Trendline-startt1Trendline;
endRTrendline = LastValue(ValueWhen( pRTrendline, s11Trendline, 1 ) );
startRTrendline = LastValue( ValueWhen( pRTrendline, s11Trendline, 2 ));
aRTrendline = (endRTrendline-startRTrendline)/dtRTrendline;
bRTrendline = endRTrendline;
trendlineR = aRTrendline * ( xTrenline -endt1Trendline ) + bRTrendline;

Plot(IIf(xTrenline>startt1Trendline-10,trendlineR,-1e10),"",colorBlue, styleNoLabel  |styleNoRescale);

L1=LastValue(Lowest(IIf(Cum(1)>startt1Trendline AND Cum(1)<endt1Trendline,L,10^10)));
tL1=LastValue(ValueWhen(L==L1,Cum(1)));
Color=IIf((Cum(1)==startt1Trendline OR Cum(1)==endt1Trendline),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));

LowerParallel=aRTrendline*(xTrenline-tL1)+L1;

Plot(IIf(xTrenline>startt1Trendline-10,LowerParallel,-1e10),"LowerLine",colorOrange, styleNoLabel  |styleNoRescale);


}

// END AUTO TRENDLINE


//************************************************************************************************************************






//==========================================================================|
//                    Hien thi Volume At Price Anna Coulling                                 |
//==========================================================================|



if (VAPanna = ParamToggle( "* - Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))
{

QvapAnna       = Param( " - So luong thanh VAP", 15, 1, 200, 1 );
pRecHeight     = Param( " - Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );


BarindexAna = BarIndex();
BeginValueAnna = BeginValue( BarindexAna );
EndValueAnna = EndValue( BarindexAna );

if( BeginValueAnna == 0 && EndValueAnna == LastValue( BarindexAna ) )
{
    BeginValueAnna = FirstVisibleValue( BarindexAna );
    EndValueAnna = LastVisibleValue( BarindexAna );
}

BeginValueAnna = Max( 0, BeginValueAnna );
EndValueAnna = Max( 0, EndValueAnna );


BullBearZone = ( High - Low ) / 3;
bullbarAnna = C > ( High - BullBearZone );
bearbarAnna = C < ( Low + BullBearZone );

mxAnna  = PriceVolDistribution( H, L, V, QvapAnna, True, BeginValueAnna, EndValueAnna );
mx1Anna = PriceVolDistribution( H, L, IIf( bullbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );
mx2Anna = PriceVolDistribution( H, L, IIf( bearbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );

bins  = MxGetSize( mxAnna, 0 );
bins1 = MxGetSize( mx1Anna, 0 );
bins2 = MxGetSize( mx2Anna, 0 );

GfxSetOverlayMode( 1 );
GfxSetCoordsMode( 1 );

if( bins > 1 && bins == bins1 && bins == bins2 )
{

    MaxVolume = mxAnna[ 0 ][ 1 ];

    // find max volume
    for( i = 1; i < bins; i++ )
    {
        if( mxAnna[ i ][ 1 ] > MaxVolume )
            MaxVolume = mxAnna[ i ][ 1 ]; // Volume for that bin 1...

        //printf( "mxAnna=%g", MaxVolume / 100000 );
    }

    // rectangle height
    RecHeight = ( mxAnna[ 1 ][ 0 ] - mxAnna[ 0 ][ 0 ] ) / 2 * pRecHeight;
    SelectFont     = GfxSelectFont( " - Arial", SelectsizeFont = Param( " - Chon Font Size", 9, 1, 30, 1 ) );  // Change the text size here

    for( i = 0; i < bins; i++ )
    {
        // mx1Anna = Bull
        price = mx1Anna[ i ][ 0 ]; // price level
        absVolume = mx1Anna[ i ][ 1 ];
        VolAcum = absVolume;
        relvolume = absVolume / MaxVolume;
        relbar = relvolume * ( EndValueAnna - BeginValueAnna + 1 );
        // upper left corner of the rectangle.
        x1Anna = BeginValueAnna;
        y1Anna = price + RecHeight;
        // lower right corner of the rectangle.
        x2Anna = BeginValueAnna + relbar;
        y2Anna = price - RecHeight;
        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );
        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bullColor );
        GfxSetBkColor( bullColor );
        GfxSetTextColor( colorBrightGreen );
        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );

        // mx2Anna = Bear
        absVolume = mx2Anna[ i ][ 1 ];
        VolAcum += absVolume;
        relvolume = absVolume / MaxVolume;
        relbar2 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );
        x1Anna = x2Anna;
        x2Anna = x1Anna + relbar2;
        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );
        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bearColor );
        GfxSetBkColor( bearColor );
        GfxSetTextColor( colorRed );
        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );

        // mxAnna = All Bars
        absVolume = mxAnna[ i ][ 1 ];
        relvolume = ( absVolume - VolAcum ) / MaxVolume;
        relbar3 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );
        x1Anna = x2Anna;
        x2Anna = x1Anna + relbar3;
        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );
        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, midColor );
        GfxSetBkColor( midColor );
        GfxSetTextColor( colorBlack );
        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );
    }
}


}

//END   Volume At Price Anna Coulling 




//************************************************************************************************************************




//==========================================================================|
//                    Hien thi Bollinger Bands                                  |
//==========================================================================|

if (bBollingerBands = ParamToggle( "* - Hien thi Bollinger Bands",  "OFF|ON", 0 ))
{

// Hien thi Bollinger Band cloud
Plot( bbt = BBandTop( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBTop" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); 
Plot( bbb = BBandBot( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBBot" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); 
PlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( ParamColor(" - Bollinger Color", colorDarkOliveGreen), colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );


}

// END Bollinger Bands  






//************************************************************************************************************************







 
 //==========================================================================|
//                 Ve duong Keltner Bands system                                 |
//==========================================================================|  
   
  
if (Keltner = ParamToggle( "* - Hien thi Keltner Bands system",  "OFF|ON", 0 ))
{

printf("\nKTop : " + KTop );  
printf("\nKBottom : " + KBottom );  
printf("\nKMid : " + KMid );  
 
Plot(KTop," - KTop",colorRed,styleLine|styleNoLabel  |styleNoRescale);
Plot(KMid," - KMid",colorGold,styleDashed|styleNoLabel|styleNoRescale);
Plot(KBottom," - KBottom",colorBlue,styleLine|styleNoLabel|styleNoRescale);
 
 
 
printf("\nBuy : " + BuyKeltner );  
printf("\nSell : " + SellKeltner );  
printf("\nShort : " + ShortKeltner );  
printf("\nCover : " + CoverKeltner );  

// Hien thi cac tin hieu Mua Ban theo  Keltner Bands system     
/* Plot Buy and Sell Signal Arrows */
PlotShapes(IIf(BuyKeltner, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-25);
PlotShapes(IIf(SellKeltner, shapeDownArrow, shapeNone),colorRed, 0, H, Offset=-25);

PlotShapes(IIf(ShortKeltner, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-25);
PlotShapes(IIf(ShortKeltner, shapeStar, shapeNone),colorYellow, 0,H, Offset=40);

//Hien chu E10
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyKeltner[i] == 1 )
    {
 PlotText( "Kel", i , L[ i ], colorBlack, colorBrightGreen,Offset=-50  ) ;
     }  
  //Sell   
 if( SellKeltner[i] == 1 )
    {
PlotText( "Kel", i , H [ i ], colorBlack, colorRed,Offset= 40  ) ;
     }      
 }  
 

}
// END Keltner Bands system 






//************************************************************************************************************************







//======================================================

//Ve Gap
if (gapindicator = ParamToggle( "* - Hien thi GAP Indicator ",  "OFF|ON", 0 ))
{
 
//Ve duong Gapline
Plot(GapLineHi,"",ParamColor( " - GapLine High Color", colorGold ), styleLine |styleNoLabel|styleNoRescale );  
Plot(GapLineLo,"",ParamColor( " - GapLine Low Color", colorBlue ), styleLine |styleNoLabel|styleNoRescale );  

FirstVisibleBar = Status( "FirstVisibleBar" );  
Lastvisiblebar = Status("LastVisibleBar");  
for( b = Max(LinLen,Firstvisiblebar); b <= Lastvisiblebar AND b < BarCount; b++)  
{  
if( Gap[b-LinLen+1] )  
{  

//Hien so Number
PlotText(     NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],ParamColor( " - GapLine High Color", colorGold ));  
PlotText("\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],ParamColor( " - GapLine Low Color", colorBlue ));  
}  
}

}
// END GAP Indicator 


//*************************************************************************************************************



//  Ve May Kumo cua Ichimoku
//==========================================================


if(ParamToggle("* - Hien thi May Kumo","OFF|ON", 0))
{

// Ve duong Senkou Span A va Senkou Span B
Plot(Span1,"",colorLightOrange,1| styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span A
Plot(Span2,"",colorLime,1 |styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span B

//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien
//PlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1>Span2, ColorBlend( colorLime, colorBlack, 0.01 ) , ColorBlend( colorLightOrange, colorBlack, 0.4 )),styleCloud|4096,0,0,timeKumo); 
PlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1>Span2,colorLime,colorLightOrange),styleCloud |styleNoLabel|styleNoRescale ,0,0,timeKumo); 

}


//   Thanh xac dinh xu huong Ichimoku
//==========================================================================|

// Ve xu huong Ichimoku - Thanh xu huong cuoi man hinh

if (ParamToggle("* - Ichimoku Kinko Hyo Trend - Xu huong Ichimoku","OFF|ON" , 0 ))
{
// Hien thi xu huong Ichimoku - Thanh xu huong cuoi man hinh
Plot( 0.9,"Ichimoku Trend",XuhuongichimokuColor, styleArea | styleOwnScale | styleNoLabel |styleNoRescale, 0, 100 );
Plot( 1.1,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100 );

}



//************************************************************************************************************************






_SECTION_END();



//====================================================================================|
//    END Tong hop Cac chi bao thuong dung                                 |
//====================================================================================|






//********************************************************************************************








//===========================================================================
//*************Tong hop Tin hieu Buy Sell Luot song ngan han*****************
//===========================================================================

_SECTION_BEGIN(" - Tong hop Tin hieu Buy Sell Luot song ngan han");




//===========================================================================
//1. Ve kenh Chien luoc Breakout vung tich luy Sideway ngan han
//===========================================================================

if (Sidewayon = ParamToggle( "1 - Hien thi vung Sideway",  "OFF|ON", 0 ))
{

Above_SidewayDay = ValueWhen( Breakout_SidewayDay, LastHigh_SidewayDay, 0 );
Below_SidewayDay = ValueWhen( Breakout_SidewayDay, LastLow_SidewayDay, 0 );
Plot( Above_SidewayDay, "Resistance", colorRed, styleDashed|styleThick|styleNoLabel|styleNoRescale );
Plot( Below_SidewayDay, "Support", colorBlue, styleDashed|styleThick|styleNoLabel|styleNoRescale );

//Ve kenh gia cao nhat n Ngay
Plot(LastHigh_SidewayDay, " HHV(H, " + WriteVal(SidewayDay, 1) + ")", colorYellow, styleDashed|styleThick|styleNoLabel|styleNoRescale );

}

//Ve tin hieu Mua Ban - Chien luoc Breakout vung tich luy Sideway ngan han
//===========================================================================

//Plot Breakout vuot vung tich luy
//Ve tin hieu Mua va hien chu (Bo)

if (ParamToggle( "2 - Breakout Sideway",  "OFF|ON", 0 ))
{

for( i = 0; i <= BarCount - 1; i++ )
{       
 //Buy Neu xay ra but pha thi hien chu (Bo)
     if( BuyBreakout_SidewayDay[i] == 1 )
    {
       // PlotText( "Br", i, L[i], colorBlack, colorYellow,Offset=-75 );  //phong nen mau Xanh, chu mau den
    }
//Sell Breakout  
 if( SellBreakout_SidewayDay[i] == 1 )
    {
       //  PlotText( "Br", i , H [ i ], colorBlack, colorRed,Offset= 68  ) ;
     }  
} 
//Buy
PlotShapes( IIf( BuyBreakout_SidewayDay , shapeUpArrow + shapeDigit0 , shapeNone ), colorGold, 0, L, Offset = 10 );  //Hien thi so 0
PlotShapes(IIf(BuyBreakout_SidewayDay, shapeUpArrow, shapeNone),colorGold, 0,L, Offset=-25); //Hien thi tin hieu mui ten
//PlotShapes( IIf( New_Breakout_SidewayDay , shapeUpArrow + shapeHollowCircle, shapeNone ), colorGold, 0, H, Offset = -35 );  // dau hieu Hoa vang phia tren Gia
//Sell
PlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow + shapeHollowStar , shapeNone ), colorGold, 0, H , Offset=10 );
PlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25 );

 }

 
 
 
 //*****************************************************************************************************************
 
 
 
 
//===========================================================================
// 2. Ve tin hieu Mua Ban - Chien luoc luot song ngan han T+ 
//===========================================================================

if (ParamToggle( "3 - Luot song T+",  "OFF|ON", 0 ))
{


/*

//Hien chu duoi tin hieu 
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy T+5         
 if( Buy5Day[i] == 1 )
    {
PlotText( "B4", i , L[ i ], colorBlack, colorSeaGreen,Offset=-92  ) ;
     }  
   //Buy T+10        
 if( Buy10Day[i] == 1 )
    {
PlotText( "B8", i , L[ i ], colorBlack, colorLime,Offset=-110  ) ;
     }    
  //Sell T5   
 if( Sell5Day[i] == 1 )
    {
PlotText( "S4", i , H [ i ], colorBlack, colorRed,Offset= 86  ) ;
     }  
    //Sell T+10   
 if( Sell5Day[i] == 1 )
    {
PlotText( "S8", i , H [ i ], colorBlack, colorRed,Offset= 104  ) ;
     }          
 }  

*/



// Hien thi lenh Mua T+5 T+10

PlotShapes( IIf( Buy5Day , shapeUpArrow + shapeDigit4 , shapeNone ), colorSeaGreen, 0, L, Offset =55 );
PlotShapes( IIf( Buy5Day , shapeUpArrow , shapeNone ), colorSeaGreen, 0, L, Offset =-25 );

PlotShapes( IIf( Buy10Day , shapeUpArrow + shapeDigit8 , shapeNone ), colorLime, 0, L, Offset =85 );
PlotShapes( IIf( Buy10Day , shapeUpArrow , shapeNone ), colorLime, 0, L, Offset =-25 );



// Hien thi lenh Ban T+5 T+10


PlotShapes( IIf( Sell5Day , shapeDownArrow + shapeDigit3 , shapeNone ), colorOrange, 0, H , Offset=55 );
PlotShapes( IIf( Sell5Day , shapeDownArrow , shapeNone ), colorOrange, 0, H , Offset=-25 );
  
PlotShapes( IIf( Sell10Day , shapeDownArrow + shapeDigit7 , shapeNone ), colorBrown, 0, H , Offset=85 );
PlotShapes( IIf( Sell10Day , shapeDownArrow , shapeNone ), colorBrown, 0, H , Offset=-25 );

}


//***********************************************************************************************************





//====================================================================================
// 3. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50
//====================================================================================

if (ParamToggle( "4 - EMA5 Cross",  "OFF|ON", 0 ))
{

/*

//Hien chu E5
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyEMA5cross[i] == 1 )
    {
 //PlotText( "E5", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;
     }  
  //Sell   
 if( SellEMA5cross[i] == 1 )
    {
 //PlotText( "E5", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;
     }      
 }  

*/


// Hien thi lenh Mua Ban
PlotShapes( IIf( BuyEMA5cross , shapeUpArrow + shapeDigit5 , shapeNone ), colorGreen, 0, L, Offset =70 );
PlotShapes( IIf( BuyEMA5cross , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );

PlotShapes( IIf( SellEMA5cross , shapeDownArrow + shapeDigit4 , shapeNone ), colorRed, 0, H , Offset=70 );
PlotShapes( IIf( SellEMA5cross , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );


}



//********************************************************************************************************************



//====================================================================================
// 4. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50
//====================================================================================

if (ParamToggle( "5 - EMA10 Cross",  "OFF|ON", 0 ))
{

/*

//Hien chu E10
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyEMA10cross[i] == 1 )
    {
 //PlotText( "E10", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;
     }  
  //Sell   
 if( SellEMA10cross[i] == 1 )
    {
 //PlotText( "E10", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;
     }      
 }  

*/


// Hien thi lenh Mua Ban
PlotShapes( IIf( BuyEMA10cross , shapeUpArrow + shapeDigit6 , shapeNone ), colorBlue, 0, L, Offset =70 );
PlotShapes( IIf( BuyEMA10cross , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );

PlotShapes( IIf( SellEMA10cross , shapeDownArrow + shapeDigit5 , shapeNone ), colorDarkRed, 0, H , Offset=70 );
PlotShapes( IIf( SellEMA10cross , shapeDownArrow , shapeNone ), colorDarkRed, 0, H , Offset=-25 );


}




//******************************************************************************************************************



//======================================================================================================
// 5. Tin hieu Mua Ban theo Chien luoc Giao cat giua EMA20 voi cac duong EMA 40 - Turtle Trading System
//======================================================================================================



//                 Buy - Sell Turtle trading system                 |
//==========================================================================|
 
if (BsTurtle = ParamToggle( "6 - Turtle trading system",  "OFF|ON", 0 ))
{



//Hien chu Tur
 for ( i = 0; i < BarCount; i++ )
{ 
 //Buy         
 if( BuyTurtle[i] == 1 )
    {
PlotText( "Tur", i , L[ i ], colorSeaGreen, Colorback=-1 , Offset= -90 ) ;
     }  
  //Sell   
 if( SellTurtle[i] == 1 )
    {
PlotText( "Tur", i , H [ i ], colorRed, Colorback=-1 ,  Offset= 90  ) ;
     }      
 }  




// Hien thi lenh Mua Ban
PlotShapes( IIf( BuyTurtle ,  shapeUpArrow ,   shapeNone ), colorBlue,   0, L,  Offset =-25 );
PlotShapes( IIf( SellTurtle , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset =-25 );


//Tin hieu thoat lenh
PlotShapes( abs( exitArray )*shapeHollowCircle  , colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 ); //Vong tron mau Vang
PlotShapes( IIf( exitArray , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );


}

//Bat tat Turtle Trading System

if (Turtle = ParamToggle( "7 - Kenh Turtle trading system",  "OFF|ON", 0 ))
{
//Ve cac duong Turtle
// Plots a 20 period Donchian channel (pdsTurtle)
//Duong tren
Plot( LastHigh_ema20Day,  "Donchian Uper",   ParamColor(  "Donchian Uper Color", colorBlue ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale );
//Duong duoi
Plot( LastLow_ema20Day,   "Donchian Lower",  ParamColor(  "Donchian Lower Color", colorRed ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale  );

//Ve kenh thoat lenh
Plot( stopArray, "Chand Stop", ParamColor( "Chand Color:", colorYellow ), ParamStyle( "Chand Style", styleDashed )  |styleNoLabel|styleNoRescale );

//plot color ribbon - Thanh xu huong duoi man hinh
//Plot(1, "", TurtleColor, styleArea | styleOwnScale | styleNoLabel, -0.1, 100 );

}





//**********************************************************************************************




//====================================================================================|
// 6. Tin hieu Mua Ban theo Chien luoc ATR                                 |
//====================================================================================|


 
if (ParamToggle("8 - Buy - Sell theo % (Dinh - Day) or ATR", "OFF|ON" , 0 ))
{
//Hien chu ATR
 for ( i = 0; i < BarCount; i++ )
{
//Buy
 if( Buyatr[i] == 1 )
    {
 PlotText( "Atr", i , L[ i ],  colorGreen, colorback=-1 , Offset=-105  ) ;
     }   
//Sell     
 if( Sellatr[i] == 1 )
    {
 PlotText( "Atr", i , H [ i ],  colorRed, colorback=-1 , Offset= 105  ) ;
     }        
 
 }
 
 // Vao lenh Mua Ban
PlotShapes( IIf( Buyatr , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );
PlotShapes( IIf( Sellatr , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );
  
}



/*
 
 
// Ve kenh thoat lenh theo ATR 
  
if (ParamToggle("8 - Kenh thoat lenh theo ATR", "OFF|ON" , 0 ))
{

//Kenh thoat lenh ATR
Plot( trailARRAY,"Trailing stop level", ParamColor( " - ATR Color", colorBlue ) , styleLine | ParamStyle(" - ATR Style" , styleThick) |styleNoLabel|styleNoRescale  );

}

*/


 

// END Diem MUA - Ban theo ATR



   

//***********************************************************************************************************




//====================================================================================
// 7. Canh bao Dinh - Day
//====================================================================================



if (BsTurtle = ParamToggle( "9 - Canh bao Dinh - Day",  "OFF|ON", 0 ))
{

//Hien canh bao Dinh Day
//Hien chu Text

 for ( i = 0; i < BarCount; i++ )
{ 

//Day
if( DayBottom[i] == 1 )
    {
 PlotText( "Bot", i , L[ i ], colorGold, colorback=-1 , Ofset = -15 ) ;
     }  

//Dinh
if( DinhTop[i] == 1 )
    {
 PlotText( "Top", i , H [ i ],  colorGold, colorback=-1 , Ofset = 5 ) ;
     }     
            
     
 }  

//*********************************************************************
// Dau hieu mui ten

//Mua Day
PlotShapes( IIf( DayBottom==1 , shapeUpArrow , shapeNone ), colorGold, 0, L, Offset =-25 );
PlotShapes( IIf(BuyDayBottom, shapeStar, shapeNone),colorYellow, 0, H, Offset = 0 );
PlotShapes( IIf(BuyDayBottom, shapeHollowCircle, shapeNone),colorGold, 0, H, Offset = 0 );

//Ban Dinh
PlotShapes( IIf( DinhTop==1 , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25);
PlotShapes( IIf(SellDinhTop, shapeStar, shapeNone),colorYellow, 0 ,L,  Offset = 0  );
PlotShapes( IIf(SellDinhTop, shapeHollowCircle, shapeNone),colorYellow, 0 ,L,  Offset = 0  );



}



//**********************************************************************************************



//***********************************************************************************************
  

//====================================================================================|
// 8. Tin hieu Mua Ban theo RSI Divergence                                |
//====================================================================================|


 
if (ParamToggle("10 - Buy - Sell theo RSI Divergence", "OFF|ON" , 0 ))
{
//Hien chu RSI
 for ( i = 0; i < BarCount; i++ )
{
//Buy
 if( BuyRSIDivergence[i] == 1 )
    {
 PlotText( "Rsi", i , L[ i ],  colorBlue, colorback=-1 , Offset=-40  ) ;
     }   
//Sell     
 if( SellRSIDivergence[i] == 1 )
    {
 PlotText( "Rsi", i , H [ i ],  colorRed, colorback=-1 , Offset= 40  ) ;
     }        
 
 }
 
 // Vao lenh Mua Ban
PlotShapes( IIf( BuyRSIDivergence , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );
PlotShapes( IIf( SellRSIDivergence , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );
  
}


  
//***********END RSI Divergence***************


//*********************************************************************************************

 
 
 
//                 Mua Ban theo Ichimoku                |
//==========================================================================|
//    Ve cac tin hieu Mua Ban Ichimoku
//************************************************



if(ParamToggle("11 - Buy - Sell Ichimoku","OFF|ON", 0 ))
{

//Tin hieu Mua so 0
PlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow + shapeDigit0 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so0
PlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 1
PlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so1
PlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 2
PlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so2
PlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 3
PlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so3
PlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 4
PlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so4
PlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua so 5
PlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so5
PlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh

//Tin hieu Mua Vuot May Sen
//PlotShapes( IIf( VuotMay , shapeUpArrow + shapeStar, shapeNone ), colorSeaGreen, 0, H, Offset =-25 ); // dau hieu Hoa xanh la phia tren Gia
PlotShapes( IIf( VuotMay , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu Sen

//Tin hieu Mua Vuot May Sen va May Kumo
//PlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 > Span2 , shapeUpArrow + shapeStar, shapeNone ), colorLime, 0, H, Offset =-35 ); // dau hieu Hoa xanh la phia tren Gia
PlotShapes( IIf( VuotMaySenKumo , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu SenKumo

//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han
//Tin hieu Mua gia tang them vi then
PlotShapes( IIf( HopBich , shapeStar, shapeNone ), colorGold, 0, H, Offset = -25 );  // dau hieu Hoa vang phia tren Gia

//Tin hieu Mua Bom no
PlotShapes( IIf( Bomno , shapeUpArrow + shapeStar, shapeNone ), colorViolet, 0, H, Offset =-25 ); // dau hieu Hoa xanh phia tren Gia
PlotShapes( IIf( Bomno , shapeUpArrow , shapeNone ), colorViolet, 0, L, Offset =-25 ); //Mui ten vang va chu Bom No

//Buy Ichimoku

for( i = 0; i < BarCount; i++ ) 
{ 
if ( VuotMay[i] ) 
	PlotText( "Sen", i , L [i], colorSeaGreen, Colorback=-1 , Offset =-75 ) ;  //Hien chu Sen
if ( VuotMaySenKumo[i] ) 
	PlotText( "SenKumo", i , L [i],  colorLime, Colorback=-1 , Offset =-90 ) ;  //Hien chu SenKumo	
if (Bomno[i] )
	PlotText( "Bom No", i , L [i],  colorViolet , Colorback=-1 , Offset =-105 ); //Hien chu Bom No
} 

//*****************************
//Sell Ichimoku
//*****************************




//Tin hieu Ban tren may Kumo

PlotShapes( IIf( Sellichimoku1 , shapeDownArrow + shapeDigit0, shapeNone ), colorRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia
PlotShapes( IIf( Sellichimoku1 , shapeDownArrow , shapeNone ), colorRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1

//Tin hieu Ban trong may Kumo

PlotShapes( IIf( Sellichimoku2 , shapeDownArrow + shapeDigit1, shapeNone ), colorBrown, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia
PlotShapes( IIf( Sellichimoku2 , shapeDownArrow , shapeNone ), colorBrown, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1

//Tin hieu Ban duoi may Kumo

PlotShapes( IIf( Sellichimoku3 , shapeDownArrow + shapeDigit2, shapeNone ), colorDarkRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia
PlotShapes( IIf( Sellichimoku3 , shapeDownArrow , shapeNone ), colorDarkRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1


/*

//Hien chu
for( i = 0; i < BarCount; i++ ) 
{ 
//Tin hieu Ban tren may Kumo
if ( Sellichimoku1[i] ) 
PlotText( "I1", i , H [i], colorBlack, colorRed, Offset = 50 ) ;  

//Tin hieu Ban trong may Kumo	
if ( Sellichimoku2[i] ) 
PlotText( "I2", i , H [i], colorBlack, colorGold, Offset = 50 ) ; 	

//Tin hieu Ban duoi may Kumo	
if (Sellichimoku3[i] )
PlotText( "I3", i , H [i], colorBlack, colorDarkRed, Offset = 50 ) ; 	
} 

*/

}
  

  
//*********************************************************************************************************************






//|============================================================================================|
//|              END Tong hop Tin hieu Buy Sell Luot song ngan han                   
//|============================================================================================|


_SECTION_END();





//****************************************************************************************************





//==========================================================================|
//                    Volume Buy and Sell                                                |
//==========================================================================|


_SECTION_BEGIN(" - Volume Buy and Sell ");

//Tinh toan Buy or Sell Volume 
BuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume
SellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume
BuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume
SellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume


//Chon mau Volume
VolumeUpcolor       = ParamColor(" - Volume Color Up",      colorGreen );
VolumeDown          = ParamColor(" - Volume Color Down",    colorDarkRed ) ;
VolumeSideway       = ParamColor(" - Volume Color Sideway", colorYellow );
Volumecolor         = IIf(C>Ref(C,-1), VolumeUpcolor,IIf(C<Ref(C,-1),VolumeDown,VolumeSideway));

//Chon MAVolume
Volumeperiod       = Param     (" - Volume MA Periods ", 30,  1, 500, 1); 
maVolume           = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon
PmaVolume          = V/maVolume*100;                                   //% Volume so voi Volume trung binh 


Volumeheight       = Param     (" - Volume Height", 4, 1, 100, 1.0) ; // Chieu cao Volume
PaneHghtMin        = LowestVisibleValue( V);
PaneHghtMax        = HighestVisibleValue(V) *Volumeheight;

maVolumecolor      = ParamColor(" - Volume MA Color", colorOrange);



//***************************************** 
//Ve duong Volume
//------------------------------------------------------------------------------------------

                                                                      
switch ( ParamList( "* - Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 2 ) )
{

//Volume OFF
//==============================================================
case "OFF":

break;





//==============================================================
//Volume Histogram
//==============================================================
case "Volume Histogram":

//Ve tong Volume dac ruot
PlotOHLC(V,0,V,0, "Volume" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel|styleNoRescale,  PaneHghtMin, PaneHghtMax, 0, 0, 1);

//Ve line MA Volume 
Plot(maVolume,"MA Volume", maVolumecolor, styleLine| styleThick|styleNoTitle | styleOwnScale | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);

break;






//==============================================================
//Volume Buy anh Sell
//==============================================================
case "Volume Buy and Sell":


TotalVolumeUp       = ParamColor(" - Total Volume Color Up",      colorBlue );
TotalVolumeDown     = ParamColor(" - Total Volume Color Down",    colorRed ) ;
TotalVolumeSideway  = ParamColor(" - Total Volume Color Sideway", colorYellow );

//Ve mau Total Volume theo dien bien Gia
TotalVolumeColor    = IIf(C>Ref(C,-1), TotalVolumeUp,IIf(C<Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));

//***************************************** 

// Ve duong Sell Volume dac ruot mau Do
PlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Volume Sell Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);

//***************************************** 
//Ve tong Volume rong ruot
PlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);

 
//***************************************** 
//Ve line MA Volume 
Plot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);

//Ve may MA Volume 
PlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);
 
break;


}

 _SECTION_END();

// END Volume tren duong gia




//***********************************************************************************************




//==========================================================================|
//                    Chay bo loc VSA                              |
//==========================================================================|

_SECTION_BEGIN(" - Exploration VSA");



Filter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond
         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) 
        
         
AND V>10000          
AND C*V >= 100000 AND C*V < 4000000000 AND MA(V,20) >= 100000 
AND Ref(C,-5)*Ref(V,-5) >= 1000000 AND Ref(C,-10)*Ref(V,-10) >= 1000000 
AND Ref(V,-5) >= 50000 AND Ref(V,-10) >= 50000 ;

tcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  
        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,
        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,
        IIf(trendChange,33,colorPaleBlue))))))))))))); 

AddTextColumn(
WriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",
WriteIf (upThrustCond1	, "Su xac nhan cua Diem Yeu. ",
WriteIf (upThrustCond2	 AND NOT upThrustCond1	, "Su xac nhan cua Diem Yeu.",
WriteIf (upThrustCond3	, "Su xac nhan cua Diem Yeu",
WriteIf (strengthDown1, "Suc manh dang tro lai. ",
WriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",
WriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",
WriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",
WriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",
WriteIf (buyCond, "Su thay doi tich cuc ",
WriteIf (Sellcond, "Su thay doi tieu cuc ",
WriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",
WriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",
WriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",
WriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",
WriteIf (strengthDown2, "Boc lo Suc Manh. ",
WriteIf (noSupplyBar, "Boc lo Suc Manh. ",
WriteIf (trendChange, "Boc lo Diem Yeu. ",
WriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",
WriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",
WriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",
WriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",
WriteIf (effortUp, "Dau hieu Tang gia ",
WriteIf (effortDown	, "Dau hieu Giam gia ",
WriteIf (effortDownfail	, "Dau hieu Tang gia ",
WriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);

AddTextColumn(
WriteIf (upThrustBar, " Thanh gia Upthrust. ",
WriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",
WriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",
WriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",
WriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",
WriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",
WriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",
WriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",
WriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",
WriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",
WriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",
WriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",
WriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",
WriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",
WriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",
WriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",
WriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",
WriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",
WriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",
WriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",
WriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",
WriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",
WriteIf (effortUp, "No luc day gia TANG. ",
WriteIf (effortDown	, "No luc day gia GIAM.  ",
WriteIf (effortUpfail, "No luc day gia GIAM that bai. ",
WriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);

 //END Chay bo loc VSA
 

 _SECTION_END ();
 

 
 
 
 
//*********************************************************************************







//******************************************************************************
// Japanese CandleStick Pattern Recognition - Nhan dang cac mo hinh Nen Nhat
//******************************************************************************



_SECTION_BEGIN(" - Japanese Candle - Nen Nhat");
/* 
Sao chep bai kho nay vao khu vuc binh luan "Cong thuc" cua "Binh luan Guru" cua Amibroker.
Mui ten mau xanh luc dac cho biet Nen tang gia "tang" voi do tin cay cao.
Mui ten mau xanh la cay trong cho biet Nen tang gia "tang" voi do tin cay trung binh va thap.
Mui ten mau do dac cho biet "giam gia" Nen giam voi do tin cay cao.
Cac mui ten mau do trong rong cho biet "giam gia" Nen giam voi do tin cay vua phai va thap.
Di chuyen con tro va nhap vao cay nen da chon de nhan nhan xet.
Nhan xet tu Steve Nison "Ky thuat bieu do hinh nen Nhat Ban" va tu trang web LitWick.
*/





// Candle Codes 

AvgRange = Sum( abs(O-C),20 )/20;
//Nen tang gia
WhiteBody = (C > O) OR (IIf((C>O) AND ((C-O)>=0.8*(H-L)),1,0) AND (C-O)>AvgRange); 
BigWhite = (Close - Open)/Open > 0.015 AND (Close - Open) * 2 > High - Low;
//Nen giam gia
BlackBody = (C < O) OR (IIf((C<O) AND ((O-C)>=0.8*(H-L)),1,0) AND (O-C)>AvgRange); 
BigBlack = (Open - Close)/Open > 0.015 AND (Open - Close) * 2 > High - Low;
Big = abs((Close - Open)/Open) > 0.014;
LongUpperShadow = H - Max(O,C) > (H - L)*0.67;
LongLowerShadow = Min(O,C) - L > (H - L)*0.67;
rng = abs((C-O)/O);
lowerShadow = Min(O,C) - L;
uppershadow = H - Max(O,C);
body = abs(O-C);
rngx = abs(H - L);
rngy = H-L;
shaven = lowerShadow < rngy*0.1;
ShavenBottom = L == Min(O,C);
ShavenHead = H == Max(O,C);
prevSize = abs(Ref(O,-1)-Ref(C,-1));
currentSize = abs(O-C);
fwh = Ref(H,-4);
fwl = Ref(L,-4); 
isPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);
SmallRealBody = rng < 0.003 AND rng >0;	
Diff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));
DownTrend = (H < Ref(H,-1) AND L < Ref(L,-1));
UpTrend = (H > Ref(H,-1) AND L > Ref(L,-1));
isPrevUpTrend = Ref(uptrend,-1);
RealBodyGapUp = Min(O,C) > Max(Ref(O,-1),Ref(C,-1));
RealBodyGapDown = Max(O,C) < Min(Ref(O,-1),Ref(C,-1));
FallingWindow = Ref(downtrend,-1) AND GapDown();
RisingWindow = Ref(uptrend,-1) AND GapUp();
isfalling = bigblack AND fallingwindow;
isrising = bigwhite AND risingwindow;
rwh = Ref(H,-4);
rwl = Ref(L,-4);
isFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);
horw = Ref(H,-2); 
windowOpen = C < horw;
opensInside = O < Ref(O,-1) AND O > Ref(C,-1);
similarSize = diff <= 0.25;
GapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;
isPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);
isPrevDownTrend = Ref(downtrend,-1);
GapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;
isRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);
lorw = Ref(L,-2);
windowOpenx = C > lorw;
//Nen Doji
Doji = (C == O AND V > 0) 
OR (abs(O-C)<=((H-L)*0.1))
OR abs(C-O) <= (C*0.0025)
OR CdDoji( threshold = 0.05 );

LongLeggedDoji = doji AND (H - L)/L > 0.01;
StarUp = smallRealBody AND gapUpFromWhite;
DojiStarUp = doji AND gapUpFromWhite;
DojiStarDown = doji AND gapDownFromBlack;
StarDown = smallRealBody AND gapDownFromBlack;
isPrevDownTrendx = Ref(downtrend,-3);
firstDoji = Ref(doji,-2); 
secDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);
isPrevUpTrendx = Ref(uptrend,-3);
secDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);
BeltHold = shavenbottom AND shavenhead AND big;
Engulfing = Max(O,C) > Ref(Max(O,C),-1) AND Min(O,C) < Ref(Min(O,C),-1);
UmbrellaLine = uppershadow < rngx*0.1 AND lowershadow > body*2; 

//====================================================================================================
//Nen Nhat 2
//====================================================================================================

/*Than Nen*/
smallBodyMaximum=0.0025;//meno di 0.25%
LargeBodyMinimum=0.01;//meno di 1.0%
smallBody=(O>=C*(1-smallBodyMaximum) AND whiteBody) 
         OR (C>=O*(1-smallBodyMaximum) AND blackBody);
largeBody=(C>=O*(1+largeBodyMinimum) AND whiteBody) 
         OR C<=O*(1-largeBodyMinimum) AND blackBody;
mediumBody=NOT LargeBody AND NOT smallBody;
identicalBodies=abs(abs(Ref(O,-1)-Ref(C,-1))-abs(O-C)) < 
          abs(O-C)*smallBodyMaximum;
realBodySize=abs(O-C);


/*Shadows - Bong Nen (Rau Nen)*/
smallUpperShadow=(whiteBody AND H<=C*(1+smallBodyMaximum))
               OR (blackBody AND H<=O*(1+smallBodyMaximum));
smallLowerShadow=(whiteBody AND L>=O*(1-smallBodyMaximum)) 
               OR (blackBody AND L>=C*(1-smallBodyMaximum));
largeUpperShadow=(whiteBody AND H>=C*(1+largeBodyMinimum)) 
               OR (blackBody AND H>=O*(1+largeBodyMinimum));
largeLowerShadow=(whiteBody AND L<=O*(1-largeBodyMinimum)) 
              OR (blackBody AND L<=C*(1-largeBodyMinimum));
              
              
  /*Gaps*/
upGap=  IIf(Ref(blackBody,-1)AND whiteBody AND O>Ref(O,-1),1,
        IIf(Ref(blackbody,-1) AND blackBody AND C>Ref(O,-1),1,
        IIf(Ref(whiteBody,-1) AND whiteBody AND O>Ref(C,-1),1,
        IIf(Ref(whiteBody,-1) AND blackBody AND C>Ref(C,-1),1,0))));

downGap=IIf(Ref(blackBody,-1)AND whiteBody AND C<Ref(C,-1),1,
        IIf(Ref(blackbody,-1) AND blackBody AND O<Ref(C,-1),1,
        IIf(Ref(whiteBody,-1) AND whiteBody AND C<Ref(O,-1),1,
        IIf(Ref(whiteBody,-1) AND blackBody AND O<Ref(O,-1),1,0))));


/*Definizione candele*/
spinningTop=mediumBody;


dojiStar=doji AND (upgap OR downgap)AND Ref(LargeBody,-1);
marabuzu=LargeBody AND smallUpperShadow AND smallLowerShadow;    

engulfing=
   IIf(blackBody AND Ref(blackbody,-1) AND C<Ref(C,-1) AND O>Ref(O,-1),1,
   IIf(blackBody AND Ref(whiteBody,-1) AND O>Ref(C,-1) AND C<Ref(O,-1),1,
   IIf(whitebody AND Ref(whitebody,-1) AND C>Ref(C,-1) AND O<Ref(O,-1),1,
   IIf(whiteBody AND Ref(blackBody,-1) AND C>Ref(O,-1)AND O<Ref(C,-1),1,0))));        
              
 Harami=
   IIf(blackbody AND Ref(blackBody,-1) AND O<Ref(O,-1) AND C>Ref(C,-1),1,
   IIf(blackBody AND Ref(whiteBody,-1) AND C>Ref(O,-1) AND O<Ref(C,-1),1,
   IIf(whiteBody AND Ref(whiteBody,-1) AND C<Ref(C,-1) AND O>Ref(O,-1),1,
   IIf(whiteBody AND Ref(blackBody,-1) AND O>Ref(C,-1) AND C<Ref(O,-1),1,0))));             
              

// Hammer
Hammer = (umbrellaline AND Ref(downtrend,-1))
OR (IIf( (H-L > 1.5*AvgRange) AND (C > (H+L)/2)  AND (O > C) , 1, 0))
OR CdHammer( rangefactor= 1.1 )
OR (smallUpperShadow AND NOT doji AND
   ((blackBody AND abs(C-L)>2*realBodySize) OR
   (whiteBody AND abs(L-O)>2*realBodySize)));


//The upper shadow is less than ten percent of the range
 //and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.  
 
 
 
/* Muc cao toi da hom nay - (MHT)
Hom nay la muc cao nhat trong 5 ngay qua */

MHT=  HHV(H,5)==H;


/* Muc cao toi da ngay hom qua - (MHY)
Hom qua la muc cao nhat trong 5 ngay qua */

MHY=   HHV(H,5)==Ref ( H, -1);


/* Thap toi thieu hom nay - (MLT)
Hom nay la muc thap nhat trong 5 ngay qua */

MLT=   LLV(L,5)==L;


/* Muc thap nhat hom qua - (MLY)
Hom qua la muc thap nhat trong 5 ngay qua */

MLY=   LLV(L,5)==Ref(L,-1);

/*Dinh nghia DOJI */

/*Doji Today - (DT)*/

DT = abs(C-O) <= (C*smallBodyMaximum) OR
(abs(O-C)<=((H-L)*0.1));

/* Doji Yesterday - (DY)*/
DY = abs(Ref ( C, -1)-Ref(O,-1)) <= Ref ( C, -1) *smallBodyMaximum OR
abs (Ref ( O, -1)-Ref(C,-1)) <= (Ref ( H, -1 ) - Ref ( L, -1 ) )*0.1;
            

//**************************************************************
//----------------------------------------
// CANDELE BULLISH  - TANG GIA
//----------------------------------------
//**************************************************************

// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. 
// See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf
//Mo hinh nen tang gia la mo hinh dao chieu hai ngay thuong duoc su dung de canh bao cac nha dau tu ve suc manh thi truong sap xay ra.

// Kicker Bullish
BullishKicker = (Ref(O,-1) > Ref(C,-1) AND O >= Ref(H,-1) AND C > O AND L > Ref(H,-1)) 
OR (Ref(O,-1) > Ref(C,-1) AND O > Ref(O,-1) AND C > O); 


/*BreakAway Bullish*/
breakAwayBullish=Ref(Largebody,-4) AND Ref(blackBody,-4)
              AND Ref(blackBody,-3) AND Ref(O,-3)<Ref(C,-4)
              AND Ref(smallbody,-2) AND Ref(C,-2)<Ref(C,-3)
              AND Ref(C,-1)<Ref(C,-2)
              AND LargeBody AND whiteBody AND C>Ref(O, -3) 
              AND C<Ref(C,-4);
              

/*Concealing Baby Swallow only one trade */
ConcealingBabySwallow=Ref(marabuzu,-3) AND Ref(blackbody,-3) AND
                      Ref(MArabuzu,-2) AND Ref(blackBody,-2) AND
                      Ref(blackBody,-1) AND Ref(downGap,-1) AND 
                      Ref(H,-1)>Ref(C,-2)AND Ref(blackbody,-1)AND 
                      blackBody AND engulfing;
                      

/*Doji Star Bullish*/
dojiStarBullish=(dojiStar AND (MLT OR MLY))OR 
   (doji AND (C<Ref(C,-1) OR O<Ref(C,-1))AND Ref(blackBody,-1)
    AND Ref(LargeBody,-1));
    
    
/* Homing Pigeon*/
homingPigeon =  Ref(largeBody,-1) AND Ref(blackBody,-1) AND
                H<= Ref ( O, -1 ) AND L>=Ref( C, -1) AND C<O AND MLY;
                    
 
 
 /* Stick Sandwich*/
stickSandwich=Ref(largeBody,-2) AND Ref(blackbody,-2) AND 
              Ref(largeBody,-1) AND Ref(whiteBody,-1) AND
              Ref(O,-1)>=Ref(C,-2) AND O>=Ref(C,-1) AND
              abs(C-Ref(C,-2))<=C*0.0025;
 




/* Three Stars in the South*///Rewrite???
threeStarsInTheSouth=
   Ref(LargeBody,-2) AND Ref(blackBody,-2) AND Ref(largelowerShadow,-2)
   AND Ref(blackBody,-1) AND Ref(largeLowerShadow,-1) AND 
   Ref(L,-1)>Ref(L,-2) AND blackBody AND smallUpperShadow AND
   smallLowerShadow AND L>Ref(L,-1) AND H<Ref(H,-1);
   
   

/* Three River Bottom Bad formula*/
threeriverBottom=Ref(largeBody,-2) AND Ref(blackBody,-2) AND
                 Ref(blackbody,-1) AND Ref(Largelowershadow,-1) AND
                 Ref(O,-1)<Ref(O,-2) AND Ref(C,-1)>Ref(C,-2) AND
                 whiteBody AND C<Ref(C,-1) AND MLY;  
                 
                 
/* Mat Hold Bullish*/
MAtHoldBullish=Ref(LargeBody,-4) AND Ref(whiteBody,-4)//1st day
   AND Ref(blackBody,-3) AND Ref(upGap,-3) AND NOT Ref(LargeBody,-3)
   AND NOT Ref(LargeBody,-2) AND Ref(C,-2)<Ref(C,-3) AND Ref (O,-2)<Ref(O,-3) AND 
   Ref(C,-2)>Ref(O,-4) AND NOT Ref(LargeBody,-1) AND Ref(C,-1)<Ref(C,-2)
   AND LargeBody AND whiteBody AND C>Ref(C,-4); 
                    
                    
   

/*RisingThreeMethods*/
risingThreeMethods=Ref(LargeBody,-4) AND Ref(whiteBody,-4) AND NOT
  Ref(LargeBody,-3) AND NOT Ref(LargeBody,-2)AND NOT Ref(LargeBody,-1) AND
  Ref(C,-3)<Ref(C,-4) AND Ref(C,-2)<Ref(C,-3) AND Ref(C,-1)<Ref(C,-2) AND
  LargeBody AND whitebody AND C>Ref(C,-4);
  
  
/*Side by Side White Lines*/
sideBySideWhiteLines=NOT Ref(smallBody,-2) AND Ref(whiteBody,-2) 
   AND Ref(upGap,-1) AND Ref(whitebody,-1)AND whiteBody AND
   identicalBodies AND abs(O-Ref(O,-1))<O*0.0025;
   

/*Upside Gap Three Methods not very good*/
upsideGapThreeMethods=Ref(Largebody,-2) AND Ref(whiteBody,-2) AND
   Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND Ref(upGap,-1) AND
   blackBody AND O>Ref(O,-1) AND C<Ref(C,-2)AND C>Ref(O,-2) AND 
  MHY;
   
   
/*Three Line Strike not good signals*/
threeLineStrike=NOT Ref(smallBody,-3) AND NOT Ref(smallBody,-2) AND 
   NOT Ref(smallBody,-1) AND Ref(whiteBody,-3) AND Ref(whiteBody,-2) AND
   Ref(whiteBody,-1) AND Ref(C,-1)>Ref(C,-2) AND Ref(C,-2)>Ref(C,-3) AND
   blackBody AND O>Ref(C,-1) AND C<Ref(O,-3);
   
   
   
   
   
   
   
   
   
//***************************************************************
// Morning Star
MorningStar = (Ref(starDown,-1) AND whitebody AND big AND C > Ref((O + C)/2,-2))
OR 

/* Morning Star*/
(Ref(largeBody,-2) AND Ref(blackBody,-2)//Large black candle 
AND Ref(downGap,-1)//Gap down yesterday
AND whiteBody AND LargeBody AND C>Ref(C,-2)//Large white candle today
AND MLY); //Yesterday was the low

//A large black candlestick followed by a small real body of either colour,
 //that gaps below the previous black candles real body, with a third white candlestick, that has a close 
// higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.



// Morning Doji Star
MorningDojiStar = (Ref(dojiStarDown,-1) AND whitebody AND big AND C > Ref((O + C)/2,-2))
OR (IIf(Ref(Blackbody, -2) AND Ref(Doji, -1) AND whitebody AND C>=Ref(((H+L)/2),-2), 1,0))
OR (Ref(LargeBody,-2) AND Ref(blackBody,-2) AND
                 Ref(doji,-1) AND Ref(O,-1)<Ref(C,-2) AND
                 whiteBody AND C>Ref(C,-2) AND MLY);






//A large black candlestick followed by a doji that gaps below its real body, with a third
// white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a
 //downtrend.


// Bull 3 Formation
Bull3Formation = bigwhite AND C > Ref(C,-4) AND Ref(H,-1) <= rwh AND Ref(L,-1) >= rwl AND Ref(H,-2) <= rwh AND Ref(L,-2) >= rwl AND  Ref(H,-3) <= rwh AND Ref(L,-3) >= rwl AND Ref(isrising, -4);

//A strong white candle in a rising window, followed by three 
// candles that fall within the high/low range of the strong white candle, followed
 //by another strong white candle that closes above the close of the first white candle. 
 //This is confirmation of the Bullish trend."


// Bullish Abandoned Baby
BullishAbandonedBaby = (morningdojistar AND Ref(GapDown(),-1) AND GapUp())
OR (Ref(largeBody,-2) AND Ref(blackBody,-2)//Large black candle
             AND Ref(GapDown(),-1)  
             AND whiteBody AND LargeBody AND GapUp());//Large white candle


             

//A morning doji star where there is a gap between the lower shadow of the doji and
//the prior and next candle.

// Bullish Belt Hold
BullishBeltHold = (belthold AND whitebody AND Ref(downtrend,-1))
OR (largeBody AND smallLowerShadow AND whiteBody AND MLT);



//A large white candle with no upper or lower shadow preceeded by a downtrend.


// Bullish Counter Attack
BullishCounterAttack = Ref(big AND blackbody,-1) AND O < Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);

//A large black candle followed by a white candle which opens sharply lower but closes at the 
//prior white candles close. Must be preceeded by a downtrend


// Bullish Harami Cross
BullishHaramiCross = (doji AND Ref(O,-1) > O AND Ref(C,-1) < O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1))
OR (harami AND Ref(LargeBody,-1) AND Ref(blackBody,-1) AND doji); 




//A doji preceded by and contained within the real body of a big 
//black candlestick in a downtrend.


// Bullish Harami
BullishHarami = (Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) > Ref(C,-1) AND Max(O,C) < Ref(O,-1) AND Ref(downtrend,-1))
OR (harami AND Ref (LargeBody,-1) AND Ref(blackBody,-1) AND
                NOT LargeBody AND whiteBody);



//A small candlestick, preceded by, and whose body is contained within a big black 
//candlestick in a downtrend


 /*Three Inside Up harami confirming*/
threeInsideUp =Ref(BullishHarami,-1) AND whiteBody AND 
    largeBody AND C>Ref(C,-1);
    
    
    
// Bullish Separating Line
BullishSeparatingLine = (Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1))

OR /* Seperating Lines Bullish - separatingLinesBullish*/
(Ref(blackBody,-1) AND whiteBody AND LargeBody AND
smallLowerShadow AND MHT AND abs(O-Ref(O,-1))<=O*0.0025);


/* Meeting LinesBullish -  */
meetingLinesbullish= (Ref(LargeBody,-1) AND Ref(blackBody,-1) AND
                     LargeBody AND whiteBody AND
                     C>Ref(C,-1)*0.9975 AND C< Ref(C,-1)*1.0025);
                     
                     





//A black candlestick followed by a white candlestick with the same opening price. Continues
 //the previous uptrend.


//Dragonfly Doji
DragonflyDoji = (longleggeddoji AND H==C AND Ref(downtrend,-1))
OR (smallBody AND LargeLowerShadow AND smallUpperShadow AND MLT);

//A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.




// Engulfing Bull
EngulfingBull = (Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1))
OR (IIf(Whitebody AND Ref(Blackbody, -1) AND (C > Ref(O,-1))  AND (O < Ref(C,-1)),1,0))
OR CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5)
OR (engulfing AND largeBody AND whiteBody AND 
    (Ref(blackbody,-1) OR Ref(Doji,-1)) AND MLT);
    
    
    
 /* Three Outside Up Engulfing confirmation*/
threeOutsideUp =Ref(EngulfingBull,-1) AND whiteBody AND C>Ref(C,-1);

    
    

//This bar is white and its real body engulfs the previous bars black real body. Must be
//preceeded by a downtrend.


/*Hammer Bullish*/
hammerBullish=Hammer AND (MLT OR MLY);






//An upside down Hammer that appears after a downtrend


//Piercing Line
PiercingLine = (Ref(bigblack,-1) AND whitebody AND O < Ref(L,-1) AND C >= Ref((O+C)/2,-1) AND C < Ref(O,-1) AND Ref(downtrend,-1))
OR (IIf(Ref(Blackbody, -1) AND Whitebody AND C>=Ref(((H+L)/2),-1) AND O<Ref(C,-1), 1,0))
OR 

 /* Piercing Line*/
(Ref(largeBody,-1) AND Ref(blackBody,-1)AND
O<Ref(L,-1) AND C>=(Ref(O,-1)+Ref(C,-1))/2 AND C<Ref(O,-1) AND MLT);


//A stong black candle followed by a white candle that opens below the low of
//the prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the
//white candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern


// SeperatingLines
SeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));

//a black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.


//Three White Soldiers
ThreeWhiteSoldiers = ((whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O > Ref(O,-1) AND Ref(O,-1) > Ref(O,-2))
or
/*Three White Soldiers-threeWhiteSoldiers*/
(NOT Ref(smallbody,-2) AND Ref(whiteBody,-2) AND NOT
   Ref(smallBody,-1) AND Ref(whiteBody,-1) AND NOT
   smallBody AND whiteBody AND C>Ref(C,-1) AND Ref(C,-1)>Ref(C,-2) AND
   Ref(O,-1)>Ref(O,-2) AND Ref(O,-1)<Ref(C,-2) AND O<Ref(C,-1) AND
   O>Ref(O,-1) AND Ref(smallUpperShadow,-2) AND
   Ref(smallUpperShadow,-1) AND smallUppershadow AND LLV(L,12)==Ref(L,-2));
   
   

//The last three candlesticks are large and white. Each opens within or higher than the 
 //previous candles real body.


// Tri-Star Bottom
TriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;




/* Tri-Star Bullish*/
triStarBullish=Ref(doji,-2) AND Ref(doji,-1) AND doji AND MLY AND   Ref(downgap,-1) AND upGap;
   


   
//A doji followed by a higher doji which is followed by another doji that is lower than the
//second doji. Must be preceeded by an uptrend.


// Tweezer Bottoms
TweezerBottoms = (L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2))
OR (abs(L-Ref(L,-1))<=L*0.0025)
OR 
/*Tweezer Bottom - tweezerBottom*/
( (abs(L-Ref(L,-1))/L<0.0025 OR
               abs(L-Ref(L,-2))/L<0.0025)
               AND (MLT OR MLY)); 


// A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. //





//**************************************************************
//----------------------------------------
// CANDELE BEARISH - GIAM GIA 
//----------------------------------------
//**************************************************************


/*Advance Block Bearish*/
AdvanceBlockBearish=Ref(LargeBody,-2) AND Ref(whiteBody,-2) 
    AND Ref(whiteBody,-1) AND
   whiteBody AND Ref(O,-1)>Ref(O,-2) AND Ref(O,-1)<Ref(C,-2) AND
   Ref(C,-1)>Ref(C,-2) AND C>Ref(C,-1) AND
   O<Ref(C,-1) AND O>Ref(O,-1) AND Ref(LargeUpperShadow,-1) AND LargeUpperShadow
   AND C-O<Ref(C,-1)-Ref(O,-1) AND Ref(C,-1)-Ref(O,-1) < Ref(C,-2)-Ref(O,-2);
   
   
  /*Deliberation Bearish: needs confirmation*/
deliberationBearish=Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND
   Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND Ref(C,-1)>Ref(C,-2) AND
   smallbody AND upGap; 
   
   


   
   
 /*Hammer Bearish*/
HammerBearish=Hammer AND HHV(H,8)==H;  
   
/*dragonfly Doji Bearish*/
dragonflyDojiBearish=doji AND smallUpperShadow AND LargeLowerShadow AND MHT;
   






//Doji Star Bearish needs confirmation
dojiStarBearish= (Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND doji AND upGap AND MHT)
 
/*Doji Star Bearish-dojiStarBearish*/
OR   (dojiStar AND (MHT OR MHY)) 
OR (doji AND (C>Ref(C,-1) OR O>Ref(C,-1))AND Ref(whiteBody,-1) AND Ref(LargeBody,-1));
   

/* Downside Gap Three Methods*/
downsideGapThreeMethods=
     Ref(LargeBody,-2) AND Ref(blackBody,-2) AND Ref(downGap,-2) //first day
     AND Ref(LargeBody,-1) AND Ref(blackBody,-1)//2nd day
     AND whitebody AND O<Ref(O,-1) AND C>Ref(C,-2)
     AND LLV(L,8)==Ref(L,-1);
 
 
   
 /*Falling Three Meothods*/
fallingThreeMethods=Ref(LargeBody,-4) AND Ref(blackBody,-4) AND
  /*Ref(doji,-3) AND Ref(doji,-2) AND Ref(doji,-1) AND*/ Ref(C,-1)>Ref(C,-2) 
  AND Ref(C,-2)>Ref(C,-3) AND LargeBody AND blackBody AND O>Ref(C,-4) AND
  O<Ref(O,-4) AND C<Ref(O,-4)AND C<Ref(C,-4);
  
  
  
/*In Neck Bearish not good*/
inNeckBearish=Ref(LargeBody,-1) AND Ref(blackBody,-1) AND
   whiteBody AND O<Ref(L,-1) AND C<Ref(C,-1)*1.0005 AND C>=Ref(C,-1);
   
/*On Neck Bearish not good*/
OnNeckBearish=Ref(LargeBody,-1) AND Ref(blackBody,-1) AND
   whiteBody AND O<Ref(L,-1) AND C<Ref(L,-1)*1.0025 AND C>=Ref(L,-1)*0.9975;
   
   
/*Side By Side White Lines Bearish*/
sideBySideWhiteLinesBearish=NOT Ref(smallBody,-2) AND Ref(blackBody,-2) AND  
   Ref(whiteBody,-1) AND whiteBody AND Ref(downGap,-1) AND identicalBodies
  AND abs(C-Ref(C,-1)<C*0.0025);
   


/*Thrusting Bearish*/
thrustingBearish=Ref(blackBody,-1) AND Ref(LargeBody,-1) AND LargeBody AND
   whitebody AND O<Ref(L,-1) AND C<(Ref(O,-1)+Ref(C,-1))/2 AND C>Ref(C,-1);
    
 //***************************************************************  
  

// Kicker Bearish
BearishKicker = (Ref(O,-1) < Ref(C,-1) AND O <= Ref(L,-1) AND C < O AND H < Ref(L,-1)) 
OR (Ref(O,-1) < Ref(C,-1) AND O < Ref(O,-1) AND C < O)
OR 

/*Kicking Bearish No trades-kickingBearish*/
(Ref(whiteBody,-1) AND Ref(MArabuzu,-1) AND blackBody AND MArabuzu    AND GapDown());

//Evening Doji Star
EveningDojiStar = (Ref(dojiStarUp,-1) AND blackbody AND big AND C < Ref((O + C)/2,-2))
OR (IIf(Ref(WhiteBody, -2) AND Ref(Doji, -1) AND BlackBody AND C<=Ref(((H+L)/2),-2), 1,0))
OR 


/*Evening Doji Star check formula???-eveningDojiStar*/
(Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND
   Ref(dojiStar,-1) AND Ref(GapUp(),-1) AND (MHY OR MHT));


//A large white candlestick followed by a doji that gaps up from the
//previous candles real body. This is followed by a third candlestick that is black and has a
//close lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.


// Evening Star
EveningStar = (Ref(starUp,-1) AND blackbody AND big AND C < Ref((O + C)/2,-2))
OR 
/*Evening Star-eveningStar*/
(Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND
   Ref(upGap,-1) AND NOT Ref(largeBody,-1) AND blackBody AND NOT smallBody AND
   (MHT OR MHY));




//A large white candlestick followed by a small real body of either colour that gaps up from the
//previous candles real body. This is followed by a third candlestick that is black and has a
//close lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.


// Grave Stone Doji
GraveStoneDoji = (longleggeddoji AND L == C AND Ref(uptrend,-1))

//A doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.
OR 

/*Gravestone Doji-gravestoneDoji*/
(doji AND largeUpperShadow AND smallLowerShadow AND GapUp() AND MHT);


//Bear 3 Formation
Bear3Formation = bigblack AND C < Ref(C,-4) AND Ref(H,-1) <= fwh AND Ref(L,-1) >= fwl AND Ref(H,-2) <= fwh AND Ref(L,-2) >= fwl AND Ref(H,-3) <= fwh AND Ref(L,-3) >= fwl AND Ref(isfalling, -4);
//A strong black candle in a falling window, followed by three
 //candles that fall within the high/low range of the strong black candle, followed
 //by another strong black candle that closes below the close of the first black candle. 
// This is a bearish confirmation.

//Bearish Abandoned Baby
BearishAbandonedBaby = (EveningDojiStar AND Ref(GapUp(),-1) AND GapDown())
OR 

/*Abandoned Baby Bearish-AbandonedBabyBearish*/
(Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND
   Ref(smallBody,-1) AND Ref(GapUp(),-1) AND GapDown() AND 
   NOT smallBody AND blackBody AND MHY);
   

// evening doji star where there is a gap between the lower shadow of the doji and
//the upper shadows of the prior and next candle.



//Bearish Belt Hold
BearishBeltHold = (belthold AND blackbody AND Ref(uptrend,-1))
OR 
/*Belt Hold Bearish-beltHoldBearish*/
(LargeBody AND BlackBody AND smalluppershadow AND MHT);




/*Breakaway Bearish*/
breakAwayBearish=Ref(LargeBody,-4) AND Ref(whiteBody,-4) AND
   Ref(GapUp(),-3) AND Ref(whiteBody,-3) AND 
   Ref(smallbody,-2) AND Ref(smallBody,-1) AND
   blackBody AND O>Ref(O,-3) AND C<Ref(C,-4);
   
   

//A large black candle with a shaven head and bottom preceeded by an uptrend.


//Bearish Counter Attack
BearishCounterAttack = (Ref(big AND whitebody,-1) AND O > Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1))
OR 
/*CounterAttackBearish-CounterAttackBearish*/
(MHT AND LargeBody AND blackbody AND
   Ref(largeBody,-1) AND Ref(whiteBody,-1) AND
   C<Ref(C,-1)*1.0025 AND C>Ref(C,-1)*0.9975);
   

//A large white candle followed by a black candle which opens sharply higher but closes
//at the prior black candles close. Must be preceeded by an uptrend.


// Bearish Harami Cross
BearishHaramiCross = (doji AND Ref(C,-1) > O AND Ref(O,-1) < O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1))
OR 

/*HaramiCross Bearish-HaramiCrossBearish*/
(harami AND doji AND Ref(whiteBody,-1) AND Ref(Largebody,-1));

//A doji preceded by and contained within the real body of a big white 
//candlestick in an uptrend



// Bearish Harami
BearishHarami = (Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) > Ref(O,-1) AND Max(O,C) < Ref(C,-1) AND Ref(uptrend,-1))
OR 
/*Harami Bearish-HaramiBearish*/
(harami AND Ref(Largebody,-1) AND Ref(whiteBody,-1)AND blackBody 
AND (MHY OR MHT));

//A small candlestick preceded by and whose real body is contained 
//within, the real body of a big white candlestick in an uptrend



/*Three Inside Down Bearish*/
threeInsideDownBearish=Ref(BearishHarami,-1) AND blackBody AND C<Ref(C,-1)AND    smallUpperShadow;


// Bearish Separating Line
BearishSeparatingLine = (Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1))
OR 
/*separating Lines Bearish-separatingLinesBearish*/
(Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND
   blackBody AND O>Ref(O,-1)*0.9975 AND O<=Ref(O,-1)*1.0025);


/*Meeting Lines Bearish*/
MeetingLinesBearish=Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND
  HHV(C,8)==Ref(C,-1) AND LargeBody AND blackBody AND 
  abs(C-Ref(C,-1))<C*0.0025;
  
  

//A white candlestick followed by a black candlestick with the same opening price. Continues
 //the previous downtrend.


// Dark Cloud Cover
DarkCloudCover = (Ref(bigwhite,-1) AND blackbody AND O > Ref(H,-1) AND C <= Ref((O+C)/2,-1) AND C > Ref(O,-1) AND Ref(uptrend,-1))
OR (IIf(Ref(whitebody, -1) AND BlackBody AND C<=Ref(((H+L)/2),-1) AND O>Ref(C,-1), 1,0))
OR 
/*Dark Cloud Cover-darkCloudCover*/
(Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND
   blackBody AND O>Ref(H,-1) AND C>Ref(O,-1) AND C<(Ref(O,-1)+Ref(C,-1))/2
   AND MHT);




//A strong white candle in an uptrend followed by a black candle that opens above the high of the 
//white candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely
//engulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.



// Engulfing Bear
EngulfingBear = (Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1))
OR (IIf(BlackBody AND Ref(whitebody, -1) AND (C < Ref(O, -1))  AND (O > Ref(C, -1)),1,0))
OR CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5)
OR 
/*Engulfing Bearish-engulfingBearish*/
(engulfing AND largeBody AND blackBody AND 
    (Ref(whitebody,-1) OR Ref(Doji,-1))AND (MHT OR MHY));



//This bar is black and its real body engulfs the previous bars white real body. Must be preceeded by
//an uptrend.




/*Three Outside Down Bearish*/
threeoutsideDownBearish=Ref(EngulfingBear,-1) AND blackBody AND C<Ref(C,-1)AND
   NOT LargeUpperShadow;





//Hamging Man
HangingMan = (umbrellaline AND uptrend AND Ref(uptrend,-1))
OR 
/*hangingMan-HangingMan*/
(NOT largeBody AND smallUpperShadow AND LargeLowerShadow AND MHT);

//The same as a hammer except must be preceeded by an uptrend.



   
   
     //Shooting Star
shootingStar=(NOT largeBody AND smallLowerShadow AND LargeUpperShadow) 
OR (   smallLowerShadow AND NOT doji AND    ((blackBody AND abs(O-H)>2*realBodySize) OR   (whiteBody AND abs(H-C)>2*realBodySize)))
OR (smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1));
   
   
   
   /*ShootingStarGap*/
shootingStarGap=shootingStar AND GapUp() AND MHT;




  //Inverted Hammer
InvertedHammer = (smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1))
OR (shootingStar AND (MLT OR MLY));

  
   
//A small body that closes near the bottom of its range and 
//has a long upper shadow. There must be a real body gap up from the previous sessions candle. This
//pattern occurs only after an uptrend.


//Three Black Crows
ThreeBlackCrows = ((big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O < Ref(O,-1) AND Ref(O,-1) < Ref(O,-2) AND Ref(uptrend,-4))

OR 
   /*Three Black Crows-threeBlackCrows*/
(Ref(blackBody,-2) AND Ref(blackBody,-1) AND blackBody  AND Ref(C,-1)<Ref(C,-2) AND C<Ref(C,-1) AND HHV(H,8)==Ref(H,-2) AND NOT Ref(doji,-2) AND NOT Ref(doji,-1) AND NOT doji);
   
   
   
 /*Three Line Strike no trades*/
threeLineStrike=threeBlackCrows AND whiteBody AND O<Ref(C,-1) AND C>Ref(O,-3);  


/*Identical three black crows-idendicalThreeBlackCrows*/
idendicalThreeBlackCrows = (Ref(blackBody,-2) AND Ref(blackBody,-1) AND blackBody AND
   abs(Ref(C,-2)-Ref(O,-1))<Ref(C,-1)*0.0025 AND abs(Ref(C,-1)-O)<O*0.0025 AND
   HHV(H,20)==Ref(H,-2) AND NOT Ref(doji,-2) AND NOT Ref(doji,-1) AND NOT doji AND
   Ref(smallLowerShadow,-2) AND Ref(smallLowerShadow,-1) AND smallLowerShadow);
   

   

//The last three candlesticks are large and black. Each opens within or lower than the 
 //previous candles real body.Must be preceeded by an uptrend.


// Tri-Star Top
TriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;

   
   
/*Tri Star Bearish*/
triStarBearish=Ref(doji,-2) AND Ref(doji,-1) AND doji AND MHY AND Ref(upGap,-1)AND    downGap;

//A doji followed by a lower doji which is followed by another doji that is higher than the
//second doji. Must be preceeded by a downtrend.


//Tweezer Tops
TweezerTops = (H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2))
OR (abs(H-Ref(H,-1))<=H*0.0025)

OR 
/*Tweezer Top-tweezerTop*/
((abs(H-Ref(H,-1))/H<0.0025 OR
               abs(H-Ref(H,-2))/H<0.0025)
               AND (MHT OR MHY)); 




// A large candle followed by a candle with the same high. Must be preceeded by an uptrend.

// Upside Gap Two Crows
UpsideGapTwoCrows = (Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C > Ref((O+C)/2,-2) AND Ref(uptrend,-2))
// A strong white candle followed by a small black candle which gaps above the previous 
//candles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. 

OR 
/*Upside Gap Two Crows-upsideGapTwoCrows*/
( Ref(whiteBody,-2) AND Ref(LargeBody,-2)// first day
   AND Ref(upGap,-1) AND Ref(blackBody,-1) // 2nd day
   AND blackbody AND O>Ref(O,-1) AND C<Ref(C,-1) AND C>Ref(C,-2));
   

/*Two Crows Bearish*/
twoCrows=Ref(whiteBody,-2) AND Ref(LargeBody,-2) //first day
   AND Ref(blackBody,-1) AND Ref(upGap,-1)//Second Day
   AND blackBody AND O<Ref(O,-1) AND O>Ref(C,-1)AND C<Ref(C,-2) AND 
   C>Ref(O,-2) AND MHY;//Third day






//*****************************************************************************
//----------------------------------------
// Continuation
//----------------------------------------

// Downward Gapping Tasuki
DownwardGappingTasuki = (isFallingBlack AND whitebody AND opensInside AND C > Ref(O,-1) AND windowOpen AND similarSize)
// A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. //

OR 
/*Downside Tasuki Gap-downsideTasukiGap*/
(Ref(blackBody,-2)//first day
   AND Ref(blackbody,-1) AND Ref(downgap,-1) //2nd day
   AND whiteBody AND O<Ref(O,-1) AND O>Ref(C,-1) AND C>Ref(O,-1) AND C<Ref(C,-2)
   AND Ref(identicalBodies,-1)                                                                                                                   
   AND LLV(L,15)==Ref(L,-1));
   
   

//Upward Gapping Tasuki
UpwardGappingTasuki = (isRisingWhite AND blackbody AND opensInside AND C < Ref(O,-1) AND  windowOpenx AND similarSize)
// A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; //

OR 
/*Upside Tasuki Gap-upsideTasukiGap*/
(Ref(largeBody,-2) AND Ref(largeBody,1) AND
   Ref(whiteBody,-2) AND Ref(whiteBody,-1) AND Ref(upGap,-1) AND
   blackBody AND O>Ref(O,-1) AND C<Ref(O,-1) AND C>Ref(C,-2) AND
   identicalBodies AND O<Ref(C,-1));
   //AND HHV(H,5)==Ref(H,-1); Do not use this line
   
   
   
//Inverted Black Hammer
InvertedBlackHammer = blackbody AND InvertedHammer;






//******************************************************
//Tong hop cac tin hieu Nen Nhat

//Phan loai theo Bull Bear Continuation

//----------------------------------------
// CANDELE BULLISH  - TANG GIA
//----------------------------------------
BullishJapaneseCandle =
BullishKicker
OR breakAwayBullish
OR ConcealingBabySwallow
OR dojiStarBullish
OR homingPigeon
OR stickSandwich
OR threeInsideUp
OR threeOutsideUp
OR threeStarsInTheSouth
OR threeriverBottom
OR MAtHoldBullish
OR risingThreeMethods
OR sideBySideWhiteLines
OR upsideGapThreeMethods
OR threeLineStrike
OR MorningStar
OR MorningDojiStar
OR Bull3Formation
OR BullishAbandonedBaby
OR BullishBeltHold
OR BullishCounterAttack
OR BullishHaramiCross
OR BullishHarami
OR BullishSeparatingLine
OR meetingLinesbullish
OR DragonflyDoji
OR EngulfingBull
OR hammerBullish
OR InvertedHammer
OR PiercingLine
OR SeperatingLines
OR ThreeWhiteSoldiers
OR TriStarBottom
OR triStarBullish
OR TweezerBottoms;


//----------------------------------------
// CANDELE BEARISH - GIAM GIA 
//----------------------------------------
BearishJapaneseCandle =
AdvanceBlockBearish
OR deliberationBearish
OR dojiStarBearish
OR HammerBearish
OR dragonflyDojiBearish
OR threeInsideDownBearish
OR threeoutsideDownBearish
OR downsideGapThreeMethods
OR fallingThreeMethods
OR inNeckBearish
OR OnNeckBearish
OR sideBySideWhiteLinesBearish
OR threeLineStrike
OR thrustingBearish
OR BearishKicker
OR EveningDojiStar
OR EveningStar
OR GraveStoneDoji
OR Bear3Formation
OR BearishAbandonedBaby
OR BearishBeltHold
OR breakAwayBearish
OR BearishCounterAttack
OR BearishHaramiCross
OR BearishHarami
OR BearishSeparatingLine
OR MeetingLinesBearish
OR DarkCloudCover
OR EngulfingBear
OR HangingMan
OR ShootingStar
OR shootingStarGap
OR ThreeBlackCrows
OR idendicalThreeBlackCrows
OR TriStarTop
OR triStarBearish
OR TweezerTops
OR UpsideGapTwoCrows
OR twoCrows;


//----------------------------------------
// Continuation
//----------------------------------------
ContinuationJapaneseCandle =
DownwardGappingTasuki
OR UpwardGappingTasuki
OR InvertedBlackHammer;

//****************************************************

//Phan loai theo Buy Sell Cover Short
//*************************************************
//Buy
//**************************************************
BuyJapaneseCandle=
BullishAbandonedBaby OR
ConcealingBabySwallow OR 
MorningDojiStar OR
MorningStar OR
threeInsideUp OR
threeOutsideUp OR
MAtHoldBullish OR
risingThreeMethods OR
sideBySideWhiteLines OR
ThreeWhiteSoldiers;

//************************************
//Sell
//*************************************
SellJapaneseCandle=
BearishAbandonedBaby OR
DarkCloudCover OR
EveningDojiStar OR
EveningStar OR
idendicalThreeBlackCrows OR
BearishKicker OR
threeInsideDownBearish OR
threeoutsideDownBearish OR
upsideGapTwoCrows OR
fallingThreeMethods OR
ThreeBlackCrows;

//***********************************************
//Cover
//*************************************************
CoverJapaneseCandle=
BullishKicker OR 
BullishBeltHold OR
breakAwayBullish OR
dojiStarBullish OR
EngulfingBull OR
hammerBullish OR
DragonflyDoji OR
BullishHarami OR
BullishHaramiCross OR
homingPigeon OR
invertedHammer OR
meetingLinesbullish OR
PiercingLine OR
stickSandwich OR
threeStarsInTheSouth OR   
triStarBullish OR
TriStarBottom OR 
threeriverBottom OR
BullishSeparatingLine OR
upsideGapThreeMethods OR
threeLineStrike OR
TweezerBottoms OR
UpwardGappingTasuki OR
Bull3Formation OR 
BullishCounterAttack OR
SeperatingLines ;

//************************************
//Short
//************************************
ShortJapaneseCandle=
advanceBlockBearish OR
BearishBeltHold OR
breakAwayBearish OR
HangingMan OR
deliberationBearish OR
BearishCounterAttack OR
EngulfingBear OR
HammerBearish OR
dragonflyDojiBearish OR
BearishHarami OR
BearishHaramiCross OR
MeetingLinesBearish OR
ShootingStar OR 
shootingStarGap OR
GraveStoneDoji OR
triStarBearish OR
twoCrows OR
dojiStarBearish OR
downsideGapThreeMethods OR
DownwardGappingTasuki OR
inNeckBearish OR
OnNeckBearish OR
BearishSeparatingLine OR
sideBySideWhiteLinesBearish OR
threeLineStrike OR
thrustingBearish OR
TweezerTops OR
Bear3Formation OR
TriStarTop OR 
InvertedBlackHammer;

//************************************************************






//***************************************************************
//END mo hinh Nen Nhat
//***************************************************************


_SECTION_END();




//************************************************************************************************************












//|============================================================================================|
//|                                       TITLE - TIEU DE                                      |
//|============================================================================================|

_SECTION_BEGIN(" - TITLE - TIEU DE");

Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"
        +("\n")+ 
        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() ;
        
       
        
 //************************************************************************************************************

if (ParamToggle( "* - Hien thi Cac thanh xu huong duoi man hinh",  "OFF|ON", 0 ))
{




//   Thanh xac dinh xu huong Ichimoku
//==========================================================================|

// Ve xu huong Ichimoku - Thanh xu huong cuoi man hinh

if (ParamToggle("* - Ichimoku Kinko Hyo Trend - Xu huong Ichimoku","OFF|ON" , 1 ))
{
// Hien thi xu huong Ichimoku - Thanh xu huong cuoi man hinh
Plot( 0.9,"Ichimoku Trend",XuhuongichimokuColor, styleArea | styleOwnScale | styleNoLabel |styleNoRescale, 0, 100, 0, 1, 2);
Plot( 1.1,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);

}

// Ve EMAStrength Band - Thanh xu huong cuoi man hinh
//=================================================


if (ParamToggle("* - Strength EMA Band - Thanh xu huong EMA","OFF|ON" , 1 ))
{
// Hien thi EMAStrength Band - Thanh xu huong cuoi man hinh
Plot( 2.2,"EMAStrength",EMAStrengthColor,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);
Plot( 2.4,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);

}


// Ve Strength Band - Thanh xu huong cuoi man hinh
//=================================================

if (ParamToggle("* - Strength RSI Band - Thanh Suc manh RSI","OFF|ON" , 1))
{
// Hien thi Strength Band - Thanh xu huong cuoi man hinh
Plot( 3.4,"RStrengthRSI",RSIStrengthColor,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);
Plot( 3.6,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);

}


// Ve Alexander Elder Impulse Band - Thanh xu huong cuoi man hinh
//===============================================================

if (ParamToggle("* - Alexander Elder Impulse Band - MACD","OFF|ON" , 1 ))
{
// Hien thi Alexander Elder Impulse Band - Thanh xu huong cuoi man hinh
Plot( 4.6,"MADC Trend",MACDStrengthColor,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);
}






}
       

//**********************************************
//Hien thi cac dau hieu cua Mo hinh Nen Nhat
//**********************************************




if (ParamToggle( "* - Hien thi Tin hieu Nen Nhat",  "OFF|ON", 0 ))
{


//Hien dau hieu
//**********************
//Doji
PlotShapes(Doji*shapeSmallCircle,colorYellow,0,H,Offset=25); 
//Nen Bua
PlotShapes(Hammer*shapeHollowSmallSquare,colorLime,0,L,Offset=-25); 
//Nen nhan chim Giam
PlotShapes(EngulfingBear*shapeSmallDownTriangle,colorRed,0,H,Offset=-25); 
//Nen nhan chim Tang
PlotShapes(EngulfingBull*shapeSmallUpTriangle,colorLime,0,L,Offset=-25); 
//Nen tang gia Manh
PlotShapes( IIf( BullishKicker , shapeHollowUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -25 );
//May den bao phu
PlotShapes( IIf( DarkCloudCover, shapeDownTriangle, shapeNone ), colorRed, 0, H, Offset = -25 );
//Nen xuyen thau
PlotShapes( IIf( PiercingLine, shapeUpArrow, shapeNone ), colorBrightGreen, 0, L, Offset = -25 );
//Ngoi sao ban chieu
PlotShapes( IIf( EveningDojiStar, shapeDownArrow, shapeNone ), colorRed, 0, H, Offset = -25 );
//Ngoi sao buoi sang
PlotShapes( IIf( MorningDojiStar, shapeUpArrow, shapeNone ), colorBlue, 0, L, Offset = -25 );

//Hien chu
//***********************
for(i=0;i<BarCount-1;i++) 
{
	if(Doji[i]==True)PlotText("Doji", i, H[i], colorYellow, bkcolor = colorDefault, Offset = 40); 
	if(Hammer[i]==True)PlotText("Hammer", i, L[i], colorLime, bkcolor = colorDefault, Offset = -45); 
	if(EngulfingBear[i]==True)PlotText("BearishEngulfing", i, H[i], colorRed, bkcolor = colorDefault, Offset = 80); 
	if(EngulfingBull[i]==True)PlotText("BullishEngulfing", i, L[i], colorLime, bkcolor = colorDefault, Offset = -80); 
	if(BullishKicker[i]==True)PlotText("BullishKicker", i, L[i], colorSeaGreen, bkcolor = colorDefault, Offset = -45); 
	if(DarkCloudCover[i]==True)PlotText("Dark Cloud Cover", i, H[i], colorRed, bkcolor = colorDefault, Offset = 45); 
	if(PiercingLine[i]==True)PlotText("Piercing Line", i, L[i], colorBrightGreen, bkcolor = colorDefault,  Offset = -45); 
	if(EveningDojiStar[i]==True)PlotText("Evening Doji Star", i, H[i], colorRed, bkcolor = colorDefault, Offset = 45); 
	if(MorningDojiStar[i]==True)PlotText("Morning Doji Star", i, L[i], colorBlue, bkcolor = colorDefault, Offset = -45); 
}



}


//************************************************************************************************************




//====================================================================================|
//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |
//====================================================================================|

 
if (vsasignal = ParamToggle( "* - Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))
{
//*********Phan nay khong quan trong********************
PlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );
PlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );
PlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );
PlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );
PlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );
PlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );
PlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );
PlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );
PlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );
PlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);
PlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);
PlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );
PlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);
PlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );
PlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );
PlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);
PlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );
PlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );
PlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );
PlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );
PlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );
PlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );
PlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );
PlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );
PlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );
PlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );
PlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );
PlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );
PlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );
PlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );
PlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );
PlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );
PlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );
PlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );
PlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );
PlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );
//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );
PlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );
PlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );
PlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );
PlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );
PlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );

}




//************************************************************************************************************


if (SelectedVSA = ParamToggle( "* - Hien thi TITLE - TIEU DE",  "OFF|ON", 0 ))
{




//|============================================================================================|
//|                                       TITLE - TIEU DE 1                                    |
//|============================================================================================|




_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"
        +("\n")+ 
        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() 
 
 


//                       Hien thi thong tin Gia va Khoi luong                            |
//====================================================================================|

//Volume

+("\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\n")+ // Xuong dong


//***************************************************
//Thay doi mau sac theo Volume
EncodeColor(colorBlue) + "   - Total Volume: "+ 

WriteIf(V>=maVolume*1.6,                     EncodeColor(colorViolet)+    WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,
WriteIf(V<maVolume*1.6 AND V>=maVolume*1.1 ,EncodeColor(colorLime)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",
WriteIf(V<maVolume*1.1 AND V>=maVolume*0.9,EncodeColor(colorGold)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",
WriteIf(V<maVolume*0.9 AND V>=maVolume*0.5, EncodeColor(colorRed)+       WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,
WriteIf(V<maVolume*0.5,                      EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ","")))))+

//MA30 Volume
EncodeColor(colorBlue)+ "MA30: " + EncodeColor(colorYellow) + WriteVal(maVolume,1.0)+

//Danh gia Volume
EncodeColor(colorBlue)+("   -   Danh gia: ")+
WriteIf(V>=maVolume*1.6,                        EncodeColor(colorViolet)+   " SIEU CAO",
WriteIf(V<maVolume*1.6  AND V>=maVolume*1.1,   EncodeColor(colorLime)+     " CAO",
WriteIf(V<maVolume*1.1 AND V>=maVolume*0.9,   EncodeColor(colorGold)+     " TRUNG BINH",
WriteIf(V<maVolume*0.9 AND V>=maVolume*0.5,    EncodeColor(colorRed)+      " THAP",
WriteIf(V<maVolume*0.5,                         EncodeColor(colorTurquoise)+" SIEU THAP","")))))+

//Buy or Sell Volume
"\n" +
EncodeColor(colorBlue)+   "   - Buy Vol: "+ EncodeColor(colorYellow)+WriteVal(BuyVolume,1.0)+ EncodeColor(colorSeaGreen)+ "   (= "+ WriteVal(BuyVolumep,1.0)+"%" +  " Total"
+")   "+
EncodeColor(colorRed)+   " -   Sell Vol: "+EncodeColor(colorYellow)+WriteVal(SellVolume,1.0)+ EncodeColor(colorSeaGreen)+"   (= "+ WriteVal(SellVolumep,1.0)+"%" +  " Total"
+")   "+
EncodeColor(colorLime)+  " -   Net Vol: "+EncodeColor(colorYellow)+WriteVal(BuyVolume-SellVolume,1.0)+





//***************************************************
// Open High Low Close

"\n"+
EncodeColor(colorBlue) + "   - Open:    " +  EncodeColor(colorYellow) +WriteVal(O,1.2)+ 
EncodeColor(colorLime) + "   -   High:  " +  EncodeColor(colorYellow) +WriteVal(H,1.2)+ 
EncodeColor(colorRed)  + "   -   Low:  " +   EncodeColor(colorYellow) +WriteVal(L,1.2)+ 

//***************************************************
//Thay doi mau theo gia Close
EncodeColor(colorSeaGreen) + "   -   Close:  " +

//Gia tran>6%
WriteIf(xx>=6,
EncodeColor(colorViolet)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Gia san<6%
WriteIf(xx<=-6,
EncodeColor(colorTurquoise) +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Tang gia
WriteIf(xx>0 AND xx<6,
EncodeColor(colorLime)   +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Giam gia
WriteIf(xx<0 AND xx>-6,
EncodeColor(colorRed)       +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Tham chieu
EncodeColor(colorGold)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)"))))+

//***************************************************

(EncodeColor(colorBlue)+"\n   - Spread: ")+

WriteIf(spread >=avgSpread*1.5,                             EncodeColor(colorViolet)+   " RONG",
WriteIf(spread <avgSpread*1.5 AND spread>=avgSpread*1.1 ,   EncodeColor(colorLime)+     " TREN TRUNG BINH",
WriteIf(spread < avgSpread*1.1 AND spread >= AvgSpread*0.9, EncodeColor(colorGold)+     " TRUNG BINH",
WriteIf(spread < AvgSpread*0.9 AND spread >= AvgSpread*0.4, EncodeColor(colorRed)+      " DUOI TRUNG BINH",
WriteIf(spread < AvgSpread*0.4,                             EncodeColor(colorTurquoise)+" HEP","")))))+


//***************************************************
(EncodeColor(colorBlue)+"   -   Vi tri Close: ")+
WriteIf(ClosePos==5,EncodeColor(colorViolet)+   " CAO NHAT",
WriteIf(ClosePos==4,EncodeColor(colorLime)+     " PHIA TREN",
WriteIf(ClosePos==3,EncodeColor(colorGold)+     " NGAY GIUA",
WriteIf(ClosePos==2,EncodeColor(colorRed)+      " PHIA DUOI",
WriteIf(ClosePos==1,EncodeColor(colorTurquoise)+" THAP NHAT",
                    EncodeColor(colorYellow)   +" KHONG DOI")))))+

                     
                    
                    
//***************************************************
//Danh gia xu huong

("\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" + // Xuong dong

//Suc manh MACD 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(MACDStrength==1,  EncodeColor(colorLime)     +  " MACD Strength:          TANG - UP",
WriteIf(MACDStrength==-1, EncodeColor(colorRed)      +  " MACD Strength:          GIAM - DOWN",
                         EncodeColor(colorGold)      +  " MACD Strength:          Khong ro rang"))+

//Suc manh RSI 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(RSIStrength==1,  EncodeColor(colorLime)     +  " RSI Strength:               TANG - UP",
WriteIf(RSIStrength==-1, EncodeColor(colorRed)      +  " RSI Strength:               GIAM - DOWN",
                         EncodeColor(colorGold)     +  " RSI Strength:               Khong ro rang"))+
                         
//Xu huong ngan han hien tai
EncodeColor(colorLime)+("\n   - ")+
WriteIf(upimd==1,EncodeColor(colorLime)         +  " Xu huong hien tai:      TANG - UP",
WriteIf(dnimd==1,EncodeColor(colorRed)          +  " Xu huong hien tai:      GIAM - DOWN",
                 EncodeColor(colorGold)         +  " Xu huong hien tai:      Khong ro rang"))+

//Xu huong trung gian thu cap                 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(upminor==1,EncodeColor(colorLime)       +  " Xu huong thu cap:      TANG - UP",
WriteIf(dnminor==1,EncodeColor(colorRed)        +  " Xu huong thu cap:      GIAM - DOWN",
                   EncodeColor(colorGold)       +  " Xu huong thu cap:      Khong ro rang"))+
WriteIf(upminoroff,  EncodeColor(colorOrange)   +  " (Xu huong TANG thu cap co the thay doi)",
WriteIf(dnminoroff,  EncodeColor(colorSeaGreen) +  " (Xu huong GIAM thu cap co the thay doi)","" ))+

//Xu huong chinh (trung han)
EncodeColor(colorLime)+("\n   - ")+
WriteIf(trenddaihan==1,  EncodeColor(colorLime) +  " Xu huong chinh:         TANG - UP",
WriteIf(trenddaihan==-1,EncodeColor(colorRed)   +  " Xu huong chinh:         GIAM - DOWN",
                     EncodeColor(colorGold)     +  " Xu huong chinh:         Khong ro rang"))+
WriteIf(upmajoroff,EncodeColor(colorOrange)     +  " (Xu huong TANG chinh co the thay doi)",
WriteIf(dnmajoroff,EncodeColor(colorSeaGreen)   +  " (Xu huong GIAM chinh co the thay doi)","" ))+



//Xu huong EMAs 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(EMAStrength==1,  EncodeColor(colorLime)     +  " Xu huong EMAs:         TANG - UP",
WriteIf(EMAStrength==-1, EncodeColor(colorRed)      +  " Xu huong EMAs:         GIAM - DOWN",
                      EncodeColor(colorGold)     +  " Xu huong EMAs:         Khong ro rang"))+
                      
//Xu huong Ichimoku
EncodeColor(colorLime)+("\n   - ")+
WriteIf(Xuhuongichimoku==1,  EncodeColor(colorLime) +" Xu huong Ichimoku:   TANG - UP",
WriteIf(Xuhuongichimoku==-1, EncodeColor(colorRed)  +" Xu huong Ichimoku:   GIAM - DOWN",
WriteIf(Xuhuongichimoku==0,EncodeColor(colorGold)   +" Xu huong Ichimoku:   Khong ro rang","" )))+
                                                               
WriteIf(XuhuongIchimokuTangoff,EncodeColor(colorOrange)     +"  (Xu huong TANG Ichimoku co the thay doi)",
WriteIf(XuhuongIchimokuGiamoff,EncodeColor(colorSeaGreen)   +"  (Xu huong GIAM Ichimoku co the thay doi)","" ))+






//====================================================================================================
//Luot song ngan han

//Buy

WriteIf(Buyluotsong,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorBlue) + "  - Buy Luot song:" ,"")+
     
//Canh bao Day - Bottom
EncodeColor(colorYellow) + WriteIf(DayBottom, "\n" + "   - Chu y: (!) ", "") + 
EncodeColor( colorLime ) +WriteIf ( BuyDayBottom , "Tinhieu: Mua bat 'Day'" +
EncodeColor( colorLime ) + "\n   - Gia Mua:        " + EncodeColor( colorGold ) +WriteVal( C, 1.1 ) + 
EncodeColor( colorLime ) +" - Gia muc tieu:     " +  EncodeColor( colorGold) +WriteVal( PivotSellPrice, 1.1 ) + " (" + WriteVal( ( PivotSellPrice - PivotBuyPrice), 1.1 ) + "="+ WriteVal( ( PivotSellPrice - PivotBuyPrice)*100/PivotBuyPrice, 1.0 )+"%" +")" + 
EncodeColor( colorRed ) +"\n   - Gia Cutloss: " + EncodeColor( colorGold ) + WriteVal( C * .95, 1.1 ) + 
EncodeColor( colorLime) + " - Ty le LN/Rui do: " + EncodeColor( colorGold) + WriteVal( ( PivotProfitTaker - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" , "" ) +

	
//Buy Luot song ngan han
EncodeColor(colorBlue) + WriteIf(BuyBreakout_SidewayDay, "\n" + "   - Buy Brekout (0): " + 
EncodeColor(colorLime) + "(+) Vuot Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(Buy5Day, "\n" + "   - Buy 4 Day (4):     " + 
EncodeColor(colorLime) + "(+) Vuot Dinh T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(Buy10Day, "\n" + "   - Buy 8 Day (8):     " + 
EncodeColor(colorLime) + "(+) Vuot Dinh T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyEMA5cross, "\n" + "   - Buy EMA5 Cross (5): " + 
EncodeColor(colorLime) + "(+) EMA5 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyEMA10cross, "\n" + "   - Buy EMA10 Cross (6): " + 
EncodeColor(colorLime) + "(+) EMA10 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyTurtle, "\n" + "   - Buy Turtle Trading System: " + 
EncodeColor(colorLime) + "(+) Vuot Dinh Turtle + EMAFast > EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Canh bao Bat Day theo RSI
EncodeColor(colorYellow) + WriteIf(BuyRSIDivergence, "\n" + "   - Bat day theo RSI: " + 
EncodeColor(colorLime) + "(!) Dau hieu RSI phan ky Tang: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Tin hieu ATR
EncodeColor(colorBlue) + WriteIf(Buyatr, "\n" + "   - Buy % & ATR: " + 
EncodeColor(colorLime) + "(+) Buy theo % Dinh Day hoac ATR: "  +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 


//Ket qua Mua Day
EncodeColor( colorLime ) +WriteIf( PivotLong AND NOT BuyDayBottom, EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
"  - Ket Qua:"  + 
EncodeColor( colorLime) +" Lenh (Mua bat 'Day')" + 
EncodeColor( colorGold )  +"\n   - Gia Mua:        " +  WriteVal( ( PivotBuyPrice ), 1.1 ) +
EncodeColor( colorLime ) + " - Loi nhuan: " + EncodeColor( colorBrightGreen) + WriteVal( ( C - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" +
EncodeColor( colorRed ) + "\n   - Gia Cutloss: " + EncodeColor( colorGold) + WriteVal( ( PivotBuyPrice * .95 ), 1.1 ) + 
EncodeColor( colorSeaGreen ) + " - Ty le LN/Rui do hien tai: " + 
EncodeColor( colorGold) + WriteVal( ( C - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" + " - " + 
EncodeColor( colorGold ) + " Cu de Lai chay tiep!", "" ) +  

//***********************************


//Sell

WriteIf(Sellluotsong,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorRed) + "  - Sell Luot song: " ,"")+	


//Canh bao Dinh - Top
EncodeColor(colorYellow) + WriteIf(DinhTop, "\n" + "   - Chu y: (!) " + 
EncodeColor(colorYellow) + "Dau hieu tao Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
EncodeColor( colorYellow ) +WriteIf ( SellDinhTop , "\n   - Tinhieu: (-) Ban chot lenh (Mua bat 'Day') truoc" + 
EncodeColor( colorRed ) +"\n   - Gia Ban: " + EncodeColor( colorGold )  +WriteVal( C, 1.1 ) + 
EncodeColor( colorLime )  +" - Loi nhuan: " +  EncodeColor( colorGold ) + WriteVal( ( PivotSellPrice - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( PivotSellPrice - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" , "" ) +

//Sell luot song ngan han
EncodeColor(colorRed) + WriteIf(SellBreakout_SidewayDay, "\n" + "   - Sell Breakdown (0): " + 
EncodeColor(colorDarkYellow) + "(-) Duoi EMA10: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
EncodeColor(colorRed) + WriteIf(Sell5Day, "\n" + "   - Sell 4 Day (4):           " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(Sell10Day, "\n" + "   - Sell 8 Day (8):           " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellEMA5cross, "\n" + "   - Sell EMA5 Cross (5): " + 
EncodeColor(colorDarkYellow) + "(-) EMA5 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellEMA10cross, "\n" + "   - Sell EMA10 Cross (6): " + 
EncodeColor(colorDarkYellow) + "(-) EMA10 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellTurtle, "\n" + "   - Sell Turtle Trading System: " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day Turtle, EMAFast < EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorYellow) + WriteIf(exitArray, "\n" + "   - Chu Y: " + 
EncodeColor(colorDarkYellow) + "(-) Thoat lenh Turtle truoc do (Chot loi, Cat lo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Canh bao Ban Dinh theo RSI
EncodeColor(colorYellow) + WriteIf(SellRSIDivergence, "\n" + "   - Ban Dinh theo RSI: " + 
EncodeColor(colorDarkYellow) + "(!) Dau hieu RSI phan ky Giam: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Tin hieu ATR
EncodeColor(colorRed) + WriteIf(Sellatr, "\n" + "   - Sell % & ATR: " + 
EncodeColor(colorDarkYellow) + "(-) Theo % Dinh Day hoac ATR: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Muc giam tu Dinh gan nhat
WriteIf( PivotShort AND NOT SellDinhTop, EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
EncodeColor( colorRed ) + "  - Muc Giam tu Dinh gan nhat: " 
+ EncodeColor( colorGold) +"("+WriteVal( ( PivotSellPrice ), 1.1 ) +"): "
+ EncodeColor( colorGold) +WriteVal( ( C - PivotSellPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotSellPrice ) * 100 / PivotSellPrice ), 1.1 ) + "%)" + 
EncodeColor( colorGold ) + "\n   - Cho tin hieu Mua bat 'Day'!", "" ) +


//====================================================================================================================


//*************************************************************************************
//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |
//====================================================================================|

//Buy Ichimoku

WriteIf(Buyichimoku,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorBlue) + "  - Buy Ichimoku Kinko Hyo:" ,"")+
    
    
    EncodeColor(colorBlue) + WriteIf(Buyichimoku2 OR Buyichimoku3, "\n" + "   - Buy (0): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan & Kijun & Trong hoac Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 

	EncodeColor(colorBlue) + WriteIf(TinHieu1, "\n" + "   - Buy (1): " + 
	EncodeColor(colorLime) + "(+) Vuot Kijun & Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu2, "\n" + "   - Buy (2): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan + Tenkan vuot Kijun + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu3, "\n" + "   - Buy (3): " + 
	EncodeColor(colorLime) + "(+) Tenkan vuot Kijun + Tren Sen & Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu4, "\n" + "   - Buy (4): " + 
	EncodeColor(colorLime) + "(+) SpanA vuot SpanB + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu5, "\n" + "   - Buy (5): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan + Chikou vuot Gia + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(VuotMay, "\n"  + "   - Vuot may Sen: " +
	EncodeColor(colorLime) + "(+) Mua Manh!: "+EncodeColor(colorYellow) + WriteVal(C,1.2) , "") + 
	
	EncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\n"  + "   - Vuot may Sen & Kumo: " + 
	EncodeColor(colorLime) + "(+) Mua rat Manh!!: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
	EncodeColor(colorViolet) + WriteIf(Bomno, "\n"  + "   - Bung no: " + 
	EncodeColor(colorLime) + "(+) Mua cuc Manh!!!: " + EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	
	
	EncodeColor(colorYellow) + WriteIf(HopBich, "\n"  + "   - Song kiem hop bich Tenkan & Kijun:" + 
	EncodeColor(colorLime) + "(+) Mua Gia tang: " +EncodeColor(colorYellow) + WriteVal(TL ,1.2) , "") +
	


//Sell Ichimoku



WriteIf(Sellichimoku,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorRed) + "  - Sell Ichimoku Kinko Hyo: " ,"")+	

	EncodeColor(colorRed) + WriteIf(Sellichimoku1, "\n" + "   - Sell (1): " + 
	EncodeColor(colorDarkYellow) + "(-) Duoi Tenkan & Kijun (Tren Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
	EncodeColor(colorRed) + WriteIf(Sellichimoku2, "\n" + "   - Sell (2): " + 
	EncodeColor(colorDarkYellow) + "(-) Ban Manh!: Duoi Tenkan & Kijun (Trong Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	                         

	EncodeColor(colorRed) + WriteIf(Sellichimoku3, "\n" + "   - Sell (3): " + 
	EncodeColor(colorDarkYellow) + "(-) Ban rat Manh!!!: Duoi Tenkan & Kijun (Duoi Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	 	
	
	
	
	
	
	
	
		

//*********************************************************************************************
//|                            Hien thi Tin hieu canh bao  VSA                                   |
//|============================================================================================|

  /*
strength	= sc OR tbc2a OR tbc2 or effortDownfail OR 	strengthDown OR strengthDown1 OR strengthDown2 OR 
              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;

weakness	= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   
             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;

vsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt 
           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;

*/ 


//1. Tin hieu canh bao xuat hien Diem Yeu

 WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+

EncodeColor(colorRed)+

WriteIf (bc,"\n +Buying Climax - Cao trao Mua tiem nang. ","")+
WriteIf (upThrustBartrue, "\n +Day la mot thanh Upthrust thuc su."+"\n + Dau hieu Diem Yeu kha chac chan. ","")+
WriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+
WriteIf (PseudoUpThrust, "\n +Psuedo UpThrust - Upthrust gia tao."+"\n +Co khoi luong thap hon 2 thanh truoc no. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\n +Mot thanh gia giam co gia dong cua o muc thap."+"\n +Theo sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+
WriteIf (effortUpfail, "\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+
WriteIf (Sellcond, "\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+
WriteIf (effortDown, "\n  +No luc day gia GIAM (Effort to Fall). "+"\n  +Dau hieu cua Diem Yeu.  ","")+
WriteIf (tbc4, "\n +Hai thanh gia dao chieu giam gia (Nhan chim giam)."+"\n +Voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+

//2. Tin hieu canh bao xuat hien Diem Manh


EncodeColor(colorCustom9)+

WriteIf (sc, "\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."
            +"\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+
WriteIf (tbc2a , "\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon."+"\n +Dau hieu cua Diem Manh. ", "")+
WriteIf (tbc2 AND NOT tbc2a, "\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. "+"\n +Dau hieu cua Diem Manh. ", "")+
WriteIf (effortDownfail, "\n +No luc day gia xuong that bai (Effort to Move Down has failed). "+"\n +Dau hieu cua Diem Manh.  ","")+
WriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\n +Diem Manh xuat hien tro lai sau mot xu huong giam. "+"\n +Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+
WriteIf (effortUp, "\n +Mot no luc day gia tang (Effort to Rise) . "+"\n +Dau hieu cua Diem Manh.  ","")+
WriteIf (revUpThrust, "\n +Thanh gia Upthrust dao nguoc. "+"\n +Dau hieu cua Diem Manh. ","")+


//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do 


EncodeColor(colorYellow)+

WriteIf (trendChange, "\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (topRevBar, "\n +Top Reversal - Dao chieu giam o dinh. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (noDemandBarDt OR  noDemandBarUt, "\n +No Demand - Khong co Cau. "+"\n +Xu huong tang co the thay doi.  ","")+
WriteIf (Fom1, "\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu."+"\n +Co the dang gap Vung Khang cu/Ho tro manh.","")+
WriteIf (tbc3 AND NOT Fom1 , "\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+
WriteIf (tbc5 AND NOT tbc3, "\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+
WriteIf (buyCond, "\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+
WriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\n +Test for supply - Kiem dinh nguon cung thanh cong. "+"\n +Dau hieu cua Diem Manh. ","")+
WriteIf (noSupplyBar, "\n +No Supply - Khong co nguon cung. "+"\n +Dau hieu cua Diem Manh. ","")+
WriteIf (stopVolume, "\n +Stopping volume - Khoi luong dung giam. "+"\n +Bao hieu xu huong giam sap ket thuc. ","") +


	
//******************************************



//Dien giai Nen Nhat


 WriteIf(BuyJapaneseCandle OR SellJapaneseCandle OR CoverJapaneseCandle OR ShortJapaneseCandle,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                                         +EncodeColor(colorBlue) +"   - Japanese Candle: \n","")+
                                         



 
      
//Buy Candles Bullish 
//Nen canh bao Mua Tang Gia Manh
//********************************
WriteIf(BuyJapaneseCandle,EncodeColor(colorBlue)+"    - Buy: \n" ,"") +
EncodeColor(colorLime)+
WriteIf(BullishAbandonedBaby,"(+) Abandoned Baby Bullish. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(ConcealingBabySwallow,"(+) Concealing Baby Swallow. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(MorningDojiStar,"(+) Morning Doji Star. Mau hinh dao chieu.\n Important sign of reversal.\n Do tin cay Cao. \n","") +
WriteIf(MorningStar,"(+) Morning Star. Mau hinh dao chieu.\n Nison: Tot hon nen theo kich thuoc tang cua nen trang (thu ba).\n Do tin cay Cao. \n","") +
WriteIf(threeInsideUp,"(+) 3 Inside Up. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeOutsideUp,"(+) 3 Outside Up. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(MAtHoldBullish,"(+) Mat Hold Bullish. Mau hinh tiep dien.\n Nison: Trong 2-4 ngay co cay nen Giam gia.\n Do tin cay Cao. \n","") +
WriteIf(risingThreeMethods,"(+) Rising Three Methods. Mau hinh tiep dien. \n Nison: No co y nghia lon hon neu khoi luong cua nen trang lon hon khoi luong cua nen den.\n Do tin cay Cao. \n","") +
WriteIf(sideBySideWhiteLines,"(+) Side by Side White Lines. Mau hinh tiep dien.\n Nison: Neu trong mot xu huong giam co the duoc gay ra boi ricoperture la Ngan. \n Do tin cay Cao. \n","") +
WriteIf(threeWhiteSoldiers,"(+) 3 White Soldiers. Mau hinh tiep dien.\n Nison: Tin hieu Tich cuc.\n Nhung hay chu y den Mau hinh giam Gia truoc do va mau hinh tiep theo.\n Do tin cay Cao. \n","") +


//Cover Candles Bullish 
//Nen canh bao Tang Gia nhe
//**************************


WriteIf(CoverJapaneseCandle,EncodeColor(colorGold)+"    - Cover: \n","") +
EncodeColor(colorLime)+
WriteIf(BullishKicker,"(+) BullishKicker. Mau hinh dao chieu.\n Than cay Nen cang Rong thi cang manh.\n Do tin cay Thap. \n","") +
WriteIf(EngulfingBull,"(+) Bullish Engulfing. Mau hinh dao chieu.\n Nison: Cac yeu to lam tang hieu ung cua mo hinh la: \n 1) Ngay dau tien (truoc do) cay nen co than nho, vao ngay thu hai co than nen rong.\n 2) Mo hinh xuat hien sau khi di chuyen rat nhanh hoac rat keo dai. \n 3) Khoi luong cao vao ngay thu hai (hien tai).\n 4) Nhieu ngay co Nen bao phu cay Nen truoc. \n Do tin cay Trung binh. \n","") +
WriteIf(BullishBeltHold,"(+) Belt Hold Bullish. Mau hinh dao chieu.\n Than cay Nen cang Rong thi cang manh.\n Do tin cay Thap. \n","") +
WriteIf(breakAwayBullish,"(+) Break Bar Away Bullish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dojiStarBullish,"(+) Bullish Doji Star. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. Tin hieu Manh neu o vung Dinh cao.\n Do tin cay Trung binh. \n","") +
WriteIf(hammerBullish,"(+) Bullish Hammer. Mau hinh dao chieu.\n Nison: Dau hieu Manh neu Than nen phia tren Hep va Duoi Nen phia duoi dai.\n  Nen tang Gia se tot hon Nen giam Gia \n Do tin cay Thap. \n","") +
WriteIf(dragonflyDoji,"(+) Dragonfly Doji. Do tin cay Trung binh. \n","") +
WriteIf(BullishHarami, "(+) Harami Bullish. Mau hinh dao chieu.\n Nison: Tin hieu Yeu. Nen cho su xac nhan. \n Do tin cay Thap. \n","") +
WriteIf(BullishHaramiCross,"(+) Harami Cross. Mau hinh dao chieu.\n Nison: Dau hieu Harami dang tin cay nhat.\n  Dau hieu lon nhat se manh hon dau hieu thap hon. \n Do tin cay Thap. \n","") +
WriteIf(homingPigeon,"(+) Homing Pigeon. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(invertedHammer,"(+) Inverted Hammer. Mau hinh dao chieu.\nNison: Nen cho su xac nhan Tang Gia phia sau.\n Do tin cay Thap. \n","") +
WriteIf(meetingLinesbullish,"(+) Meeting Lines bullish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(piercingLine,"(+) Piercing Line. Mau hinh dao chieu.\n Nison: Day la Mo hinh Dao chieu Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(stickSandwich,"(+) Stick Sandwich. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(threeStarsInTheSouth,"(+) 3 Stars in the South. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(TriStarBottom,"(+) 3 Stars Bottom. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(triStarBullish,"(+) Tri-Star Bullish. Mau hinh dao chieu.\n Nison: Mo hinh Dao chieu tuong doi Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(threeriverBottom,"(+) 3 River Bottom. Mau hinh dao chieu.\n Nison: Ap luc Ban dang Giam dan.\n Do tin cay Trung binh. \n","") +
WriteIf(BullishSeparatingLine,"(+) Separating Lines Bullish. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(upsideGapThreeMethods,"(+) Upside Gap 3 Methods. Mau hinh tiep dien.\n Do tin cay Trung binh. \n","") +
WriteIf(threeLineStrike,"(+) 3 Line Strike. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(TweezerBottoms,"(+) Tweezer Bottom. Mau hinh dao chieu.\n  Cung voi su dao chieu cua cac nen khac co the cho thay muc ho tro.\n Nison: Nen cho su xac nhan. \n","") +
WriteIf(UpwardGappingTasuki,"(+) Upside Tasuki Gap. Mau hinh tiep dien.\n Nison: Than cua hai ngon nen trong khoang trong phai co cung do lon.\n Do tin cay Trung binh. \n","") +
WriteIf(Bull3Formation,"(+) Bull3Formation. \n","") +
WriteIf(BullishCounterAttack,"(+) BullishCounterAttack. \n","") +
WriteIf(SeperatingLines,"(+) SeperatingLines. \n","") +


//Sell Candle Down - Bearish 
//Nen canh bao Sell Giam Gia Manh
//*********************************

WriteIf(SellJapaneseCandle,EncodeColor(colorRed)+"    - Sell: \n","") +
EncodeColor(colorBrown)+
WriteIf(BearishAbandonedBaby,"(-) Abandoned Baby Bearish. Mau hinh dao chieu.\n Nison: Hiem khi xuat hien.\n Do tin cay Cao. \n","") +
WriteIf(DarkCloudCover,"(-) Dark Cloud Cover. Mau hinh dao chieu.\n Nison: Cac yeu to cho thay tam quan trong cua tin hieu nay la: \n 1) Su tham nhap cua ngon nen dau tien trong ngon nen thu hai. \n 2) Neu ca hai nen deu la nen Marabozu. \n 3) Than cua cay nen thu hai o tren mot muc khang cu dang ke. \n 4) Xay ra trong nhung ngay co khoi luong cao.\n Do tin cay Cao. \n","") +
WriteIf(EveningDojiStar,"(-) Evening Doji Star. Mau hinh dao chieu.\n Nison: Phai duoc xac nhan boi mot cay nen den dai.\n Do tin cay Cao. \n","") +
WriteIf(EveningStar,"(-) Evening Star. Mau hinh dao chieu.\n Nison: Khoang cach giua than nen thu hai va thu ba khong phai luc nao cung xuat hien.\n Do tin cay Cao. \n","") +
WriteIf(idendicalThreeBlackCrows,"(-) Identical 3 Black Crows.\n  Mo hinh dao chieu cua xu huong tang truoc do.\n Nison: Dau hieu Giam rat ro rang.\n Do tin cay Cao. \n","") +
WriteIf(BearishKicker,"(-) Kicking Bearish. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeInsideDownBearish,"(-) 3 Inside Down. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeoutsideDownBearish,"(-) 3 Outside Down. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(upsideGapTwoCrows,"(-) Upside Gap 2 Crows. Mau hinh dao chieu.\n Nison: Yeu cau xac nhan voi su dao nguoc tiep tuc vao ngay thu ba.\n Do tin cay Cao. \n","") +
WriteIf(fallingThreeMethods,"(-) Falling 3 Methods. Mau hinh tiep dien.\n Do tin cay Cao. \n","") +
WriteIf(threeBlackCrows,"(-) 3 Black Crows. Mau hinh dao chieu.\n Nison: Nen chu y neu trong xu  the tang. \n Do tin cay Cao. \n","") +


//Short sell Candle Down - Bearish 
//Nen canh bao Sell Giam Gia nhe
//**************************************

WriteIf(ShortJapaneseCandle,EncodeColor(colorGold)+"    - Short: \n" ,"") +
EncodeColor(colorBrown)+
WriteIf(advanceBlockBearish,"(-) advanceBlockBearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishBeltHold,"(-) Belt Hold Bearish. Mau hinh dao chieu.\n Nison: Chieu cao cua nen cang dai thi cang Manh. \n Do tin cay Thap. \n","") +
WriteIf(breakAwayBearish,"(-) breakvar Away Bearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(HangingMan,"(-) Hanging Man. Mau hinh dao chieu.\n Nison: Nhu mot 'cay Nen bua giam gia' voi mot khoang trong dang ke vao ngay hom sau. \n Do tin cay Thap. \n","") +
WriteIf(deliberationBearish,"(-) Deliberation Bearish. Mau hinh dao chieu.\n Nison: Day khong phai la mot mo hinh dao chieu thuc su.\n  Nhung la mot dau hieu cho thay su phuc hoi dang suy yeu. \n Do tin cay Trung binh. \n","") +
WriteIf(BearishCounterAttack,"(-) Counter Attack Bearish.\n Nison: Dau hieu tiem nang cua su Giam gia. \n","") +
WriteIf(EngulfingBear,"(-) Engulfing Bearish. Mau hinh dao chieu.\n Nison: Dau hieu dao chieu quan trong.\n  Cac yeu to lam tang tam quan trong cua cac mau la: \n 1) Phia tren cay nen co than rat nho VA cay nen thu hai co than rat lon. \n 2) Mau hinh xuat hien sau mot xu huong tang gia nhanh truoc do. \n 3) Khoi luong cao trong Ngay thu Hai. \n 4) Vao Ngay thu hai bao phu than nen nhieu hon so voi than nen truoc day.\n Do tin cay Trung binh. \n","") +
WriteIf(HammerBearish,"(-) HammerBearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dragonflyDojiBearish,"(-) Dragonfly Doji Bearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishHarami,"(-) Bearish Harami. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishHaramiCross,"(-) Harami Cross Bearish. Mau hinh dao chieu.\n Nison: Mau hinh bao xu huong giam dang ke hon so voi Nen 'Harami'. \n Ngay thu hai, cay nen co the co mau trang hoac den.\n Do tin cay Trung binh. \n","") +
WriteIf(MeetingLinesBearish,"(-) Meeting Lines Bearish. Mau hinh dao chieu.\n Nhung khong qua manh nhu Nen 'Dark Cloud Cover'. \n Do tin cay Trung binh. ","") +
WriteIf(ShootingStar,"(-) Shooting Star. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(shootingStarGap,"(-) Shooting Star. Mau hinh dao chieu.\n Nison: Khong quan trong nhu Nen 'evening star'. \n Tot nhat, than nen phai nam trong mot khoang trong so voi than nen truoc do.\n No se xuat hien sau mot xu huong tang truoc do.\n Do tin cay Thap. \n","") +
WriteIf(GraveStoneDoji,"(-) Gravestone Doji. Mau hinh dao chieu.\n Nison: Tin hieu quan trong hon khi cham muc cao nhat lich su.\n Do tin cay Trung binh. \n","") +
WriteIf(triStarBearish,"(-) Tri-Star Bearish. Mau hinh dao chieu.\n Nison: Mau hinh dao chieu rat Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(twoCrows,"(-) 2 Crows. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dojiStarBearish,"(-) Doji Star Bearish. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. \n Do tin cay Trung binh. \n","") +
WriteIf(downsideGapThreeMethods,"(-) Downside Gap 3 Methods. Mau hinh tiep dien. \n Do tin cay Trung binh. \n","") +
WriteIf(DownwardGappingTasuki,"(-) Downside Tasuki Gap. Dau hieu tiep dien xu the.\n Nison: Neu ngay cuoi cung Gap bi dong lai.\n No hinh tiep tuc se bi tu choi.\n Do tin cay Trung binh. \n","") +
WriteIf(inNeckBearish,"(-) In Neck Bearish. Mau hinh tiep dien.\n Nison: Giong nhu Nen 'piercing pattern' .\n Nhung giam nhieu hon vao ngay thu hai vi khong co su xam nhap.\n Do tin cay Trung binh. \n","") +
WriteIf(OnNeckBearish,"(-) On Neck Bearish. Mau hinh tiep dien.\n Nison: Giong nhu Nen 'piercing' - Nen xuyen thau.\n Nhung giam gia hon vi khong co su xam nhap nao vao ngay thu hai.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishSeparatingLine,"(-) Separating Lines Bearish. \n","") +
WriteIf(sideBySideWhiteLinesBearish,"(-) Side by Side White Lines Bearish. Mau hinh tiep dien.\n Nison: Hiem khi xay ra.\n Do tin cay Trung binh. \n","") +
WriteIf(threeLineStrike,"(-) 3 Line Strike. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(thrustingBearish,"(-) Thrusting - Luc day Manh. Mau hinh tiep dien.\n Nison: Khong phai la ngay dao chieu.\n Boi vi ngay thu hai khong tham gia vao diem giua cua ngay dau tien.\n Do tin cay Thap. \n","") +
WriteIf(TweezerTops,"(-) Tweezer Top. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. \n","")+
WriteIf(Bear3Formation,"(-) Bear3Formation. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(TriStarTop,"(-) TriStarTop. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(InvertedBlackHammer,"(-) InvertedBlackHammer. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") 


	

);

}

//*********************************************************************************************
//|                  END TITLE - TIEU DE 1                                 |
//|============================================================================================|



//************************************************************************************************************************





//**********************************************************************************************
//|                  TITLE - TIEU DE 2 (Co dien giai VSA)                   |
//|============================================================================================|




if (SelectedVSA = ParamToggle( "* - Hien thi TITLE - TIEU DE (Co dien giai VSA)",  "OFF|ON", 0 ))
{



//|============================================================================================|
//|                                       TITLE - TIEU DE 2                                   |
//|============================================================================================|




_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"
        +("\n")+ 
        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() 
 
 


//                       Hien thi thong tin Gia va Khoi luong                            |
//====================================================================================|

//Volume

+("\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\n")+ // Xuong dong


//***************************************************
//Thay doi mau sac theo Volume
EncodeColor(colorBlue) + "   - Total Volume: "+ 

WriteIf(V>=maVolume*1.6,                     EncodeColor(colorViolet)+    WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,
WriteIf(V<maVolume*1.6 AND V>=maVolume*1.1 ,EncodeColor(colorLime)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",
WriteIf(V<maVolume*1.1 AND V>=maVolume*0.9,EncodeColor(colorGold)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",
WriteIf(V<maVolume*0.9 AND V>=maVolume*0.5, EncodeColor(colorRed)+       WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,
WriteIf(V<maVolume*0.5,                      EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ","")))))+

//MA30 Volume
EncodeColor(colorBlue)+ "MA30: " + EncodeColor(colorYellow) + WriteVal(maVolume,1.0)+

//Danh gia Volume
EncodeColor(colorBlue)+("   -   Danh gia: ")+
WriteIf(V>=maVolume*1.6,                        EncodeColor(colorViolet)+   " SIEU CAO",
WriteIf(V<maVolume*1.6  AND V>=maVolume*1.1,   EncodeColor(colorLime)+     " CAO",
WriteIf(V<maVolume*1.1 AND V>=maVolume*0.9,   EncodeColor(colorGold)+     " TRUNG BINH",
WriteIf(V<maVolume*0.9 AND V>=maVolume*0.5,    EncodeColor(colorRed)+      " THAP",
WriteIf(V<maVolume*0.5,                         EncodeColor(colorTurquoise)+" SIEU THAP","")))))+

//Buy or Sell Volume
"\n" +
EncodeColor(colorBlue)+   "   - Buy Vol: "+ EncodeColor(colorYellow)+WriteVal(BuyVolume,1.0)+ EncodeColor(colorSeaGreen)+ "   (= "+ WriteVal(BuyVolumep,1.0)+"%" +  " Total"
+")   "+
EncodeColor(colorRed)+   " -   Sell Vol: "+EncodeColor(colorYellow)+WriteVal(SellVolume,1.0)+ EncodeColor(colorSeaGreen)+"   (= "+ WriteVal(SellVolumep,1.0)+"%" +  " Total"
+")   "+
EncodeColor(colorLime)+  " -   Net Vol: "+EncodeColor(colorYellow)+WriteVal(BuyVolume-SellVolume,1.0)+





//***************************************************
// Open High Low Close

"\n"+
EncodeColor(colorBlue) + "   - Open:    " +  EncodeColor(colorYellow) +WriteVal(O,1.2)+ 
EncodeColor(colorLime) + "   -   High:  " +  EncodeColor(colorYellow) +WriteVal(H,1.2)+ 
EncodeColor(colorRed)  + "   -   Low:  " +   EncodeColor(colorYellow) +WriteVal(L,1.2)+ 

//***************************************************
//Thay doi mau theo gia Close
EncodeColor(colorSeaGreen) + "   -   Close:  " +

//Gia tran>6%
WriteIf(xx>=6,
EncodeColor(colorViolet)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Gia san<6%
WriteIf(xx<=-6,
EncodeColor(colorTurquoise) +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Tang gia
WriteIf(xx>0 AND xx<6,
EncodeColor(colorLime)   +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Giam gia
WriteIf(xx<0 AND xx>-6,
EncodeColor(colorRed)       +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Tham chieu
EncodeColor(colorGold)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)"))))+

//***************************************************

(EncodeColor(colorBlue)+"\n   - Spread: ")+

WriteIf(spread >=avgSpread*1.5,                             EncodeColor(colorViolet)+   " RONG",
WriteIf(spread <avgSpread*1.5 AND spread>=avgSpread*1.1 ,   EncodeColor(colorLime)+     " TREN TRUNG BINH",
WriteIf(spread < avgSpread*1.1 AND spread >= AvgSpread*0.9, EncodeColor(colorGold)+     " TRUNG BINH",
WriteIf(spread < AvgSpread*0.9 AND spread >= AvgSpread*0.4, EncodeColor(colorRed)+      " DUOI TRUNG BINH",
WriteIf(spread < AvgSpread*0.4,                             EncodeColor(colorTurquoise)+" HEP","")))))+


//***************************************************
(EncodeColor(colorBlue)+"   -   Vi tri Close: ")+
WriteIf(ClosePos==5,EncodeColor(colorViolet)+   " CAO NHAT",
WriteIf(ClosePos==4,EncodeColor(colorLime)+     " PHIA TREN",
WriteIf(ClosePos==3,EncodeColor(colorGold)+     " NGAY GIUA",
WriteIf(ClosePos==2,EncodeColor(colorRed)+      " PHIA DUOI",
WriteIf(ClosePos==1,EncodeColor(colorTurquoise)+" THAP NHAT",
                    EncodeColor(colorYellow)   +" KHONG DOI")))))+

                     
                    
                    
//***************************************************
//Danh gia xu huong

("\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" + // Xuong dong

//Suc manh MACD 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(MACDStrength==1,  EncodeColor(colorLime)     +  " MACD Strength:          TANG - UP",
WriteIf(MACDStrength==-1, EncodeColor(colorRed)      +  " MACD Strength:          GIAM - DOWN",
                         EncodeColor(colorGold)      +  " MACD Strength:          Khong ro rang"))+

//Suc manh RSI 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(RSIStrength==1,  EncodeColor(colorLime)     +  " RSI Strength:               TANG - UP",
WriteIf(RSIStrength==-1, EncodeColor(colorRed)      +  " RSI Strength:               GIAM - DOWN",
                         EncodeColor(colorGold)     +  " RSI Strength:               Khong ro rang"))+
                         
//Xu huong ngan han hien tai
EncodeColor(colorLime)+("\n   - ")+
WriteIf(upimd==1,EncodeColor(colorLime)         +  " Xu huong hien tai:      TANG - UP",
WriteIf(dnimd==1,EncodeColor(colorRed)          +  " Xu huong hien tai:      GIAM - DOWN",
                 EncodeColor(colorGold)         +  " Xu huong hien tai:      Khong ro rang"))+

//Xu huong trung gian thu cap                 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(upminor==1,EncodeColor(colorLime)       +  " Xu huong thu cap:      TANG - UP",
WriteIf(dnminor==1,EncodeColor(colorRed)        +  " Xu huong thu cap:      GIAM - DOWN",
                   EncodeColor(colorGold)       +  " Xu huong thu cap:      Khong ro rang"))+
WriteIf(upminoroff,  EncodeColor(colorOrange)   +  " (Xu huong TANG thu cap co the thay doi)",
WriteIf(dnminoroff,  EncodeColor(colorSeaGreen) +  " (Xu huong GIAM thu cap co the thay doi)","" ))+

//Xu huong chinh (trung han)
EncodeColor(colorLime)+("\n   - ")+
WriteIf(trenddaihan==1,  EncodeColor(colorLime) +  " Xu huong chinh:         TANG - UP",
WriteIf(trenddaihan==-1,EncodeColor(colorRed)   +  " Xu huong chinh:         GIAM - DOWN",
                     EncodeColor(colorGold)     +  " Xu huong chinh:         Khong ro rang"))+
WriteIf(upmajoroff,EncodeColor(colorOrange)     +  " (Xu huong TANG chinh co the thay doi)",
WriteIf(dnmajoroff,EncodeColor(colorSeaGreen)   +  " (Xu huong GIAM chinh co the thay doi)","" ))+



//Xu huong EMAs 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(EMAStrength==1,  EncodeColor(colorLime)     +  " Xu huong EMAs:         TANG - UP",
WriteIf(EMAStrength==-1, EncodeColor(colorRed)      +  " Xu huong EMAs:         GIAM - DOWN",
                      EncodeColor(colorGold)     +  " Xu huong EMAs:         Khong ro rang"))+
                      
//Xu huong Ichimoku
EncodeColor(colorLime)+("\n   - ")+
WriteIf(Xuhuongichimoku==1,  EncodeColor(colorLime) +" Xu huong Ichimoku:   TANG - UP",
WriteIf(Xuhuongichimoku==-1, EncodeColor(colorRed)  +" Xu huong Ichimoku:   GIAM - DOWN",
WriteIf(Xuhuongichimoku==0,EncodeColor(colorGold)   +" Xu huong Ichimoku:   Khong ro rang","" )))+
                                                               
WriteIf(XuhuongIchimokuTangoff,EncodeColor(colorOrange)     +"  (Xu huong TANG Ichimoku co the thay doi)",
WriteIf(XuhuongIchimokuGiamoff,EncodeColor(colorSeaGreen)   +"  (Xu huong GIAM Ichimoku co the thay doi)","" ))+






//====================================================================================================
//Luot song ngan han

//Buy

WriteIf(Buyluotsong,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorBlue) + "  - Buy Luot song:" ,"")+
     
//Canh bao Day - Bottom
EncodeColor(colorYellow) + WriteIf(DayBottom, "\n" + "   - Chu y: (!) ", "") + 
EncodeColor( colorLime ) +WriteIf ( BuyDayBottom , "Tinhieu: Mua bat 'Day'" +
EncodeColor( colorLime ) + "\n   - Gia Mua:        " + EncodeColor( colorGold ) +WriteVal( C, 1.1 ) + 
EncodeColor( colorLime ) +" - Gia muc tieu:     " +  EncodeColor( colorGold) +WriteVal( PivotSellPrice, 1.1 ) + " (" + WriteVal( ( PivotSellPrice - PivotBuyPrice), 1.1 ) + "="+ WriteVal( ( PivotSellPrice - PivotBuyPrice)*100/PivotBuyPrice, 1.0 )+"%" +")" + 
EncodeColor( colorRed ) +"\n   - Gia Cutloss: " + EncodeColor( colorGold ) + WriteVal( C * .95, 1.1 ) + 
EncodeColor( colorLime) + " - Ty le LN/Rui do: " + EncodeColor( colorGold) + WriteVal( ( PivotProfitTaker - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" , "" ) +

	
//Buy Luot song ngan han
EncodeColor(colorBlue) + WriteIf(BuyBreakout_SidewayDay, "\n" + "   - Buy Brekout (0): " + 
EncodeColor(colorLime) + "(+) Vuot Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(Buy5Day, "\n" + "   - Buy 4 Day (4):     " + 
EncodeColor(colorLime) + "(+) Vuot Dinh T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(Buy10Day, "\n" + "   - Buy 8 Day (8):     " + 
EncodeColor(colorLime) + "(+) Vuot Dinh T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyEMA5cross, "\n" + "   - Buy EMA5 Cross (5): " + 
EncodeColor(colorLime) + "(+) EMA5 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyEMA10cross, "\n" + "   - Buy EMA10 Cross (6): " + 
EncodeColor(colorLime) + "(+) EMA10 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyTurtle, "\n" + "   - Buy Turtle Trading System: " + 
EncodeColor(colorLime) + "(+) Vuot Dinh Turtle + EMAFast > EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Canh bao Bat Day theo RSI
EncodeColor(colorYellow) + WriteIf(BuyRSIDivergence, "\n" + "   - Bat day theo RSI: " + 
EncodeColor(colorLime) + "(!) Dau hieu RSI phan ky Tang: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Tin hieu ATR
EncodeColor(colorBlue) + WriteIf(Buyatr, "\n" + "   - Buy % & ATR: " + 
EncodeColor(colorLime) + "(+) Buy theo % Dinh Day hoac ATR: "  +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 


//Ket qua Mua Day
EncodeColor( colorLime ) +WriteIf( PivotLong AND NOT BuyDayBottom, EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
"  - Ket Qua:"  + 
EncodeColor( colorLime) +" Lenh (Mua bat 'Day')" + 
EncodeColor( colorGold )  +"\n   - Gia Mua:        " +  WriteVal( ( PivotBuyPrice ), 1.1 ) +
EncodeColor( colorLime ) + " - Loi nhuan: " + EncodeColor( colorBrightGreen) + WriteVal( ( C - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" +
EncodeColor( colorRed ) + "\n   - Gia Cutloss: " + EncodeColor( colorGold) + WriteVal( ( PivotBuyPrice * .95 ), 1.1 ) + 
EncodeColor( colorSeaGreen ) + " - Ty le LN/Rui do hien tai: " + 
EncodeColor( colorGold) + WriteVal( ( C - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" + " - " + 
EncodeColor( colorGold ) + " Cu de Lai chay tiep!", "" ) +  

//***********************************


//Sell

WriteIf(Sellluotsong,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorRed) + "  - Sell Luot song: " ,"")+	


//Canh bao Dinh - Top
EncodeColor(colorYellow) + WriteIf(DinhTop, "\n" + "   - Chu y: (!) " + 
EncodeColor(colorYellow) + "Dau hieu tao Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
EncodeColor( colorYellow ) +WriteIf ( SellDinhTop , "\n   - Tinhieu: (-) Ban chot lenh (Mua bat 'Day') truoc" + 
EncodeColor( colorRed ) +"\n   - Gia Ban: " + EncodeColor( colorGold )  +WriteVal( C, 1.1 ) + 
EncodeColor( colorLime )  +" - Loi nhuan: " +  EncodeColor( colorGold ) + WriteVal( ( PivotSellPrice - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( PivotSellPrice - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" , "" ) +

//Sell luot song ngan han
EncodeColor(colorRed) + WriteIf(SellBreakout_SidewayDay, "\n" + "   - Sell Breakdown (0): " + 
EncodeColor(colorDarkYellow) + "(-) Duoi EMA10: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
EncodeColor(colorRed) + WriteIf(Sell5Day, "\n" + "   - Sell 4 Day (4):           " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(Sell10Day, "\n" + "   - Sell 8 Day (8):           " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellEMA5cross, "\n" + "   - Sell EMA5 Cross (5): " + 
EncodeColor(colorDarkYellow) + "(-) EMA5 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellEMA10cross, "\n" + "   - Sell EMA10 Cross (6): " + 
EncodeColor(colorDarkYellow) + "(-) EMA10 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellTurtle, "\n" + "   - Sell Turtle Trading System: " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day Turtle, EMAFast < EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorYellow) + WriteIf(exitArray, "\n" + "   - Chu Y: " + 
EncodeColor(colorDarkYellow) + "(-) Thoat lenh Turtle truoc do (Chot loi, Cat lo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Canh bao Ban Dinh theo RSI
EncodeColor(colorYellow) + WriteIf(SellRSIDivergence, "\n" + "   - Ban Dinh theo RSI: " + 
EncodeColor(colorDarkYellow) + "(!) Dau hieu RSI phan ky Giam: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Tin hieu ATR
EncodeColor(colorRed) + WriteIf(Sellatr, "\n" + "   - Sell % & ATR: " + 
EncodeColor(colorDarkYellow) + "(-) Theo % Dinh Day hoac ATR: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Muc giam tu Dinh gan nhat
WriteIf( PivotShort AND NOT SellDinhTop, EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
EncodeColor( colorRed ) + "  - Muc Giam tu Dinh gan nhat: " 
+ EncodeColor( colorGold) +"("+WriteVal( ( PivotSellPrice ), 1.1 ) +"): "
+ EncodeColor( colorGold) +WriteVal( ( C - PivotSellPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotSellPrice ) * 100 / PivotSellPrice ), 1.1 ) + "%)" + 
EncodeColor( colorGold ) + "\n   - Cho tin hieu Mua bat 'Day'!", "" ) +


//====================================================================================================================


//*************************************************************************************
//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |
//====================================================================================|

//Buy Ichimoku

WriteIf(Buyichimoku,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorBlue) + "  - Buy Ichimoku Kinko Hyo:" ,"")+
    
    
    EncodeColor(colorBlue) + WriteIf(Buyichimoku2 OR Buyichimoku3, "\n" + "   - Buy (0): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan & Kijun & Trong hoac Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 

	EncodeColor(colorBlue) + WriteIf(TinHieu1, "\n" + "   - Buy (1): " + 
	EncodeColor(colorLime) + "(+) Vuot Kijun & Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu2, "\n" + "   - Buy (2): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan + Tenkan vuot Kijun + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu3, "\n" + "   - Buy (3): " + 
	EncodeColor(colorLime) + "(+) Tenkan vuot Kijun + Tren Sen & Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu4, "\n" + "   - Buy (4): " + 
	EncodeColor(colorLime) + "(+) SpanA vuot SpanB + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu5, "\n" + "   - Buy (5): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan + Chikou vuot Gia + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(VuotMay, "\n"  + "   - Vuot may Sen: " +
	EncodeColor(colorLime) + "(+) Mua Manh!: "+EncodeColor(colorYellow) + WriteVal(C,1.2) , "") + 
	
	EncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\n"  + "   - Vuot may Sen & Kumo: " + 
	EncodeColor(colorLime) + "(+) Mua rat Manh!!: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
	EncodeColor(colorViolet) + WriteIf(Bomno, "\n"  + "   - Bung no: " + 
	EncodeColor(colorLime) + "(+) Mua cuc Manh!!!: " + EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	
	
	EncodeColor(colorYellow) + WriteIf(HopBich, "\n"  + "   - Song kiem hop bich Tenkan & Kijun:" + 
	EncodeColor(colorLime) + "(+) Mua Gia tang: " +EncodeColor(colorYellow) + WriteVal(TL ,1.2) , "") +
	


//Sell Ichimoku



WriteIf(Sellichimoku,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorRed) + "  - Sell Ichimoku Kinko Hyo: " ,"")+	

	EncodeColor(colorRed) + WriteIf(Sellichimoku1, "\n" + "   - Sell (1): " + 
	EncodeColor(colorDarkYellow) + "(-) Duoi Tenkan & Kijun (Tren Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
	EncodeColor(colorRed) + WriteIf(Sellichimoku2, "\n" + "   - Sell (2): " + 
	EncodeColor(colorDarkYellow) + "(-) Ban Manh!: Duoi Tenkan & Kijun (Trong Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	                         

	EncodeColor(colorRed) + WriteIf(Sellichimoku3, "\n" + "   - Sell (3): " + 
	EncodeColor(colorDarkYellow) + "(-) Ban rat Manh!!!: Duoi Tenkan & Kijun (Duoi Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	 	
	
	
	
	
	
	
	
		

//*********************************************************************************************
//|                            Hien thi Tin hieu canh bao  VSA                                   |
//|============================================================================================|

  /*
strength	= sc OR tbc2a OR tbc2 or effortDownfail OR 	strengthDown OR strengthDown1 OR strengthDown2 OR 
              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;

weakness	= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   
             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;

vsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt 
           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;

*/ 


//1. Tin hieu canh bao xuat hien Diem Yeu

 WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+

EncodeColor(colorRed)+

WriteIf (bc,"\n +Buying Climax - Cao trao Mua tiem nang. ","")+
WriteIf (upThrustBartrue, "\n +Day la mot thanh Upthrust thuc su."+"\n + Dau hieu Diem Yeu kha chac chan. ","")+
WriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+
WriteIf (PseudoUpThrust, "\n +Psuedo UpThrust - Upthrust gia tao."+"\n +Co khoi luong thap hon 2 thanh truoc no. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\n +Mot thanh gia giam co gia dong cua o muc thap."+"\n +Theo sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+
WriteIf (effortUpfail, "\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+
WriteIf (Sellcond, "\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+
WriteIf (effortDown, "\n  +No luc day gia GIAM (Effort to Fall). "+"\n  +Dau hieu cua Diem Yeu.  ","")+
WriteIf (tbc4, "\n +Hai thanh gia dao chieu giam gia (Nhan chim giam)."+"\n +Voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+

//2. Tin hieu canh bao xuat hien Diem Manh


EncodeColor(colorCustom9)+

WriteIf (sc, "\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."
            +"\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+
WriteIf (tbc2a , "\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon."+"\n +Dau hieu cua Diem Manh. ", "")+
WriteIf (tbc2 AND NOT tbc2a, "\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. "+"\n +Dau hieu cua Diem Manh. ", "")+
WriteIf (effortDownfail, "\n +No luc day gia xuong that bai (Effort to Move Down has failed). "+"\n +Dau hieu cua Diem Manh.  ","")+
WriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\n +Diem Manh xuat hien tro lai sau mot xu huong giam. "+"\n +Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+
WriteIf (effortUp, "\n +Mot no luc day gia tang (Effort to Rise) . "+"\n +Dau hieu cua Diem Manh.  ","")+
WriteIf (revUpThrust, "\n +Thanh gia Upthrust dao nguoc. "+"\n +Dau hieu cua Diem Manh. ","")+


//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do 


EncodeColor(colorYellow)+

WriteIf (trendChange, "\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (topRevBar, "\n +Top Reversal - Dao chieu giam o dinh. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (noDemandBarDt OR  noDemandBarUt, "\n +No Demand - Khong co Cau. "+"\n +Xu huong tang co the thay doi.  ","")+
WriteIf (Fom1, "\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu."+"\n +Co the dang gap Vung Khang cu/Ho tro manh.","")+
WriteIf (tbc3 AND NOT Fom1 , "\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+
WriteIf (tbc5 AND NOT tbc3, "\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+
WriteIf (buyCond, "\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+
WriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\n +Test for supply - Kiem dinh nguon cung thanh cong. "+"\n +Dau hieu cua Diem Manh. ","")+
WriteIf (noSupplyBar, "\n +No Supply - Khong co nguon cung. "+"\n +Dau hieu cua Diem Manh. ","")+
WriteIf (stopVolume, "\n +Stopping volume - Khoi luong dung giam. "+"\n +Bao hieu xu huong giam sap ket thuc. ","") +


	
//******************************************



//Dien giai Nen Nhat


 WriteIf(BuyJapaneseCandle OR SellJapaneseCandle OR CoverJapaneseCandle OR ShortJapaneseCandle,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                                         +EncodeColor(colorBlue) +"   - Japanese Candle: \n","")+
                                         



 
      
//Buy Candles Bullish 
//Nen canh bao Mua Tang Gia Manh
//********************************
WriteIf(BuyJapaneseCandle,EncodeColor(colorBlue)+"    - Buy: \n" ,"") +
EncodeColor(colorLime)+
WriteIf(BullishAbandonedBaby,"(+) Abandoned Baby Bullish. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(ConcealingBabySwallow,"(+) Concealing Baby Swallow. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(MorningDojiStar,"(+) Morning Doji Star. Mau hinh dao chieu.\n Important sign of reversal.\n Do tin cay Cao. \n","") +
WriteIf(MorningStar,"(+) Morning Star. Mau hinh dao chieu.\n Nison: Tot hon nen theo kich thuoc tang cua nen trang (thu ba).\n Do tin cay Cao. \n","") +
WriteIf(threeInsideUp,"(+) 3 Inside Up. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeOutsideUp,"(+) 3 Outside Up. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(MAtHoldBullish,"(+) Mat Hold Bullish. Mau hinh tiep dien.\n Nison: Trong 2-4 ngay co cay nen Giam gia.\n Do tin cay Cao. \n","") +
WriteIf(risingThreeMethods,"(+) Rising Three Methods. Mau hinh tiep dien. \n Nison: No co y nghia lon hon neu khoi luong cua nen trang lon hon khoi luong cua nen den.\n Do tin cay Cao. \n","") +
WriteIf(sideBySideWhiteLines,"(+) Side by Side White Lines. Mau hinh tiep dien.\n Nison: Neu trong mot xu huong giam co the duoc gay ra boi ricoperture la Ngan. \n Do tin cay Cao. \n","") +
WriteIf(threeWhiteSoldiers,"(+) 3 White Soldiers. Mau hinh tiep dien.\n Nison: Tin hieu Tich cuc.\n Nhung hay chu y den Mau hinh giam Gia truoc do va mau hinh tiep theo.\n Do tin cay Cao. \n","") +


//Cover Candles Bullish 
//Nen canh bao Tang Gia nhe
//**************************


WriteIf(CoverJapaneseCandle,EncodeColor(colorGold)+"    - Cover: \n","") +
EncodeColor(colorLime)+
WriteIf(BullishKicker,"(+) BullishKicker. Mau hinh dao chieu.\n Than cay Nen cang Rong thi cang manh.\n Do tin cay Thap. \n","") +
WriteIf(EngulfingBull,"(+) Bullish Engulfing. Mau hinh dao chieu.\n Nison: Cac yeu to lam tang hieu ung cua mo hinh la: \n 1) Ngay dau tien (truoc do) cay nen co than nho, vao ngay thu hai co than nen rong.\n 2) Mo hinh xuat hien sau khi di chuyen rat nhanh hoac rat keo dai. \n 3) Khoi luong cao vao ngay thu hai (hien tai).\n 4) Nhieu ngay co Nen bao phu cay Nen truoc. \n Do tin cay Trung binh. \n","") +
WriteIf(BullishBeltHold,"(+) Belt Hold Bullish. Mau hinh dao chieu.\n Than cay Nen cang Rong thi cang manh.\n Do tin cay Thap. \n","") +
WriteIf(breakAwayBullish,"(+) Break Bar Away Bullish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dojiStarBullish,"(+) Bullish Doji Star. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. Tin hieu Manh neu o vung Dinh cao.\n Do tin cay Trung binh. \n","") +
WriteIf(hammerBullish,"(+) Bullish Hammer. Mau hinh dao chieu.\n Nison: Dau hieu Manh neu Than nen phia tren Hep va Duoi Nen phia duoi dai.\n  Nen tang Gia se tot hon Nen giam Gia \n Do tin cay Thap. \n","") +
WriteIf(dragonflyDoji,"(+) Dragonfly Doji. Do tin cay Trung binh. \n","") +
WriteIf(BullishHarami, "(+) Harami Bullish. Mau hinh dao chieu.\n Nison: Tin hieu Yeu. Nen cho su xac nhan. \n Do tin cay Thap. \n","") +
WriteIf(BullishHaramiCross,"(+) Harami Cross. Mau hinh dao chieu.\n Nison: Dau hieu Harami dang tin cay nhat.\n  Dau hieu lon nhat se manh hon dau hieu thap hon. \n Do tin cay Thap. \n","") +
WriteIf(homingPigeon,"(+) Homing Pigeon. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(invertedHammer,"(+) Inverted Hammer. Mau hinh dao chieu.\nNison: Nen cho su xac nhan Tang Gia phia sau.\n Do tin cay Thap. \n","") +
WriteIf(meetingLinesbullish,"(+) Meeting Lines bullish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(piercingLine,"(+) Piercing Line. Mau hinh dao chieu.\n Nison: Day la Mo hinh Dao chieu Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(stickSandwich,"(+) Stick Sandwich. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(threeStarsInTheSouth,"(+) 3 Stars in the South. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(TriStarBottom,"(+) 3 Stars Bottom. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(triStarBullish,"(+) Tri-Star Bullish. Mau hinh dao chieu.\n Nison: Mo hinh Dao chieu tuong doi Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(threeriverBottom,"(+) 3 River Bottom. Mau hinh dao chieu.\n Nison: Ap luc Ban dang Giam dan.\n Do tin cay Trung binh. \n","") +
WriteIf(BullishSeparatingLine,"(+) Separating Lines Bullish. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(upsideGapThreeMethods,"(+) Upside Gap 3 Methods. Mau hinh tiep dien.\n Do tin cay Trung binh. \n","") +
WriteIf(threeLineStrike,"(+) 3 Line Strike. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(TweezerBottoms,"(+) Tweezer Bottom. Mau hinh dao chieu.\n  Cung voi su dao chieu cua cac nen khac co the cho thay muc ho tro.\n Nison: Nen cho su xac nhan. \n","") +
WriteIf(UpwardGappingTasuki,"(+) Upside Tasuki Gap. Mau hinh tiep dien.\n Nison: Than cua hai ngon nen trong khoang trong phai co cung do lon.\n Do tin cay Trung binh. \n","") +
WriteIf(Bull3Formation,"(+) Bull3Formation. \n","") +
WriteIf(BullishCounterAttack,"(+) BullishCounterAttack. \n","") +
WriteIf(SeperatingLines,"(+) SeperatingLines. \n","") +


//Sell Candle Down - Bearish 
//Nen canh bao Sell Giam Gia Manh
//*********************************

WriteIf(SellJapaneseCandle,EncodeColor(colorRed)+"    - Sell: \n","") +
EncodeColor(colorBrown)+
WriteIf(BearishAbandonedBaby,"(-) Abandoned Baby Bearish. Mau hinh dao chieu.\n Nison: Hiem khi xuat hien.\n Do tin cay Cao. \n","") +
WriteIf(DarkCloudCover,"(-) Dark Cloud Cover. Mau hinh dao chieu.\n Nison: Cac yeu to cho thay tam quan trong cua tin hieu nay la: \n 1) Su tham nhap cua ngon nen dau tien trong ngon nen thu hai. \n 2) Neu ca hai nen deu la nen Marabozu. \n 3) Than cua cay nen thu hai o tren mot muc khang cu dang ke. \n 4) Xay ra trong nhung ngay co khoi luong cao.\n Do tin cay Cao. \n","") +
WriteIf(EveningDojiStar,"(-) Evening Doji Star. Mau hinh dao chieu.\n Nison: Phai duoc xac nhan boi mot cay nen den dai.\n Do tin cay Cao. \n","") +
WriteIf(EveningStar,"(-) Evening Star. Mau hinh dao chieu.\n Nison: Khoang cach giua than nen thu hai va thu ba khong phai luc nao cung xuat hien.\n Do tin cay Cao. \n","") +
WriteIf(idendicalThreeBlackCrows,"(-) Identical 3 Black Crows.\n  Mo hinh dao chieu cua xu huong tang truoc do.\n Nison: Dau hieu Giam rat ro rang.\n Do tin cay Cao. \n","") +
WriteIf(BearishKicker,"(-) Kicking Bearish. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeInsideDownBearish,"(-) 3 Inside Down. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeoutsideDownBearish,"(-) 3 Outside Down. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(upsideGapTwoCrows,"(-) Upside Gap 2 Crows. Mau hinh dao chieu.\n Nison: Yeu cau xac nhan voi su dao nguoc tiep tuc vao ngay thu ba.\n Do tin cay Cao. \n","") +
WriteIf(fallingThreeMethods,"(-) Falling 3 Methods. Mau hinh tiep dien.\n Do tin cay Cao. \n","") +
WriteIf(threeBlackCrows,"(-) 3 Black Crows. Mau hinh dao chieu.\n Nison: Nen chu y neu trong xu  the tang. \n Do tin cay Cao. \n","") +


//Short sell Candle Down - Bearish 
//Nen canh bao Sell Giam Gia nhe
//**************************************

WriteIf(ShortJapaneseCandle,EncodeColor(colorGold)+"    - Short: \n" ,"") +
EncodeColor(colorBrown)+
WriteIf(advanceBlockBearish,"(-) advanceBlockBearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishBeltHold,"(-) Belt Hold Bearish. Mau hinh dao chieu.\n Nison: Chieu cao cua nen cang dai thi cang Manh. \n Do tin cay Thap. \n","") +
WriteIf(breakAwayBearish,"(-) breakvar Away Bearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(HangingMan,"(-) Hanging Man. Mau hinh dao chieu.\n Nison: Nhu mot 'cay Nen bua giam gia' voi mot khoang trong dang ke vao ngay hom sau. \n Do tin cay Thap. \n","") +
WriteIf(deliberationBearish,"(-) Deliberation Bearish. Mau hinh dao chieu.\n Nison: Day khong phai la mot mo hinh dao chieu thuc su.\n  Nhung la mot dau hieu cho thay su phuc hoi dang suy yeu. \n Do tin cay Trung binh. \n","") +
WriteIf(BearishCounterAttack,"(-) Counter Attack Bearish.\n Nison: Dau hieu tiem nang cua su Giam gia. \n","") +
WriteIf(EngulfingBear,"(-) Engulfing Bearish. Mau hinh dao chieu.\n Nison: Dau hieu dao chieu quan trong.\n  Cac yeu to lam tang tam quan trong cua cac mau la: \n 1) Phia tren cay nen co than rat nho VA cay nen thu hai co than rat lon. \n 2) Mau hinh xuat hien sau mot xu huong tang gia nhanh truoc do. \n 3) Khoi luong cao trong Ngay thu Hai. \n 4) Vao Ngay thu hai bao phu than nen nhieu hon so voi than nen truoc day.\n Do tin cay Trung binh. \n","") +
WriteIf(HammerBearish,"(-) HammerBearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dragonflyDojiBearish,"(-) Dragonfly Doji Bearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishHarami,"(-) Bearish Harami. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishHaramiCross,"(-) Harami Cross Bearish. Mau hinh dao chieu.\n Nison: Mau hinh bao xu huong giam dang ke hon so voi Nen 'Harami'. \n Ngay thu hai, cay nen co the co mau trang hoac den.\n Do tin cay Trung binh. \n","") +
WriteIf(MeetingLinesBearish,"(-) Meeting Lines Bearish. Mau hinh dao chieu.\n Nhung khong qua manh nhu Nen 'Dark Cloud Cover'. \n Do tin cay Trung binh. ","") +
WriteIf(ShootingStar,"(-) Shooting Star. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(shootingStarGap,"(-) Shooting Star. Mau hinh dao chieu.\n Nison: Khong quan trong nhu Nen 'evening star'. \n Tot nhat, than nen phai nam trong mot khoang trong so voi than nen truoc do.\n No se xuat hien sau mot xu huong tang truoc do.\n Do tin cay Thap. \n","") +
WriteIf(GraveStoneDoji,"(-) Gravestone Doji. Mau hinh dao chieu.\n Nison: Tin hieu quan trong hon khi cham muc cao nhat lich su.\n Do tin cay Trung binh. \n","") +
WriteIf(triStarBearish,"(-) Tri-Star Bearish. Mau hinh dao chieu.\n Nison: Mau hinh dao chieu rat Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(twoCrows,"(-) 2 Crows. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dojiStarBearish,"(-) Doji Star Bearish. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. \n Do tin cay Trung binh. \n","") +
WriteIf(downsideGapThreeMethods,"(-) Downside Gap 3 Methods. Mau hinh tiep dien. \n Do tin cay Trung binh. \n","") +
WriteIf(DownwardGappingTasuki,"(-) Downside Tasuki Gap. Dau hieu tiep dien xu the.\n Nison: Neu ngay cuoi cung Gap bi dong lai.\n No hinh tiep tuc se bi tu choi.\n Do tin cay Trung binh. \n","") +
WriteIf(inNeckBearish,"(-) In Neck Bearish. Mau hinh tiep dien.\n Nison: Giong nhu Nen 'piercing pattern' .\n Nhung giam nhieu hon vao ngay thu hai vi khong co su xam nhap.\n Do tin cay Trung binh. \n","") +
WriteIf(OnNeckBearish,"(-) On Neck Bearish. Mau hinh tiep dien.\n Nison: Giong nhu Nen 'piercing' - Nen xuyen thau.\n Nhung giam gia hon vi khong co su xam nhap nao vao ngay thu hai.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishSeparatingLine,"(-) Separating Lines Bearish. \n","") +
WriteIf(sideBySideWhiteLinesBearish,"(-) Side by Side White Lines Bearish. Mau hinh tiep dien.\n Nison: Hiem khi xay ra.\n Do tin cay Trung binh. \n","") +
WriteIf(threeLineStrike,"(-) 3 Line Strike. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(thrustingBearish,"(-) Thrusting - Luc day Manh. Mau hinh tiep dien.\n Nison: Khong phai la ngay dao chieu.\n Boi vi ngay thu hai khong tham gia vao diem giua cua ngay dau tien.\n Do tin cay Thap. \n","") +
WriteIf(TweezerTops,"(-) Tweezer Top. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. \n","")+
WriteIf(Bear3Formation,"(-) Bear3Formation. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(TriStarTop,"(-) TriStarTop. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(InvertedBlackHammer,"(-) InvertedBlackHammer. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") 



	
	

//*************************************************************************************
//                       Hien thi Phan dien giai VSA                                       
//====================================================================================|
//*************************************************************************************


 +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+

//1. Dien giai VSA Canh bao Xu huong giam
EncodeColor(colorRed) +

WriteIf(upThrustBartrue , "\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+
    "\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  
	"\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+
	"\n +Smart money biet rang thi truong dang yeu di (giam gia). " +
	"\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +
	"\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +
	"\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+
	"\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ 

WriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+
     "\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +
	"\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+
	"\n +Dau hieu cua Diem Yeu."+ 
	"\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+
	"\n +Voi su xuat hien cua thanh Upthrust." +
	"\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ 
	"\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ 	

WriteIf(PseudoUpThrust,"\n +PseudoUpThrust - Day la Upthrust gia tao. "+
    "\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +
	"\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+
	"\n +Nhung khoi luong thuong thap hon muc trung binh. "+
	"\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + 
	"\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+	

WriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+
    "\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+	
	
WriteIf(tbc4, "\n +Dau hieu cua Diem Yeu","")+
 
WriteIf(bc, "\n +Buying Climax - Cao trao Mua tiem nang."+
            "\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+
            "\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +
      
WriteIf(effortUpfail, "\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + 
    
WriteIf(Sellcond, "\n +Tin hieu Ban. ","") + 
  
WriteIf(effortDown, "\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "
                    + "\n +Mot thanh gia cho thay su no luc day gia giam. "
                    + "\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + 
                  

//2. Dien giai VSA Canh bao Xu huong tang

	
EncodeColor(colorCustom9) +

WriteIf(sc,"\n +Selling Climax - Cao trao BAN tiem nang. "
                   +"\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"
                   +"\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"
                   +"\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+

WriteIf(tbc2a OR tbc2 ,"\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+
                            
            
WriteIf(effortDownfail,"\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ 
                                      
WriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " 
	+"\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."
	+"\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "
	+"\n +Xu huong giam co the som dung lai va dao chieu tang. "
	+"\n +La dau hieu cho thay thi truong dang manh hon. ","")+

                   
WriteIf(effortUp ,"\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "
                   + "\n +Mot thanh gia cho thay su no luc day gia tang."
                   +"\n +Day la dau hieu bat dau cua thi truong con Bo. " 
	               + "\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."
	               + "\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + 
	                                      
WriteIf(revUpThrust ,"\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+
            
                   
                   
//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong

                 
EncodeColor(colorYellow) +

WriteIf(trendChange,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                                              + "\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."
                                              +"\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+

WriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\n +Test of supply - Tin hieu test Cung thanh cong."
                                                 + "\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "
                                                 + "\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+


WriteIf(buyCond,"\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."
               + "\n +Day la thanh gia xac nhan cho Diem Manh. ","")+

WriteIf(noSupplyBar,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                    + "\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."
                    + "\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+


WriteIf(stopVolume,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                   + "\n +Stopping Volume - Khoi luong dung."
                   +"\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " 
	               + "\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "
	               +"\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " 
	               + "\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+



WriteIf(noDemandBarUt OR  noDemandBarDt,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                     + "\n +No Demand - Khong co nhu cau. "
                     +"\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"
                     +"\n +Day la dau hieu cua Diem Yeu tiem nang. " 
	                 + "\n   - Luu y:  \n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."
	                 +"\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"
	                 +"\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+


WriteIf(topRevBar,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                     + "\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+
              	 

WriteIf(Fom1 OR tbc3 OR tbc5 ,"\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")
                 


);


}




//**********************************************************************************************
//|                  END TITLE - TIEU DE 2  (Co dien giai VSA)                                   
//|============================================================================================|
//**********************************************************************************************


//==============================================================================================================




//**********************************************************************************************
//|                  TITLE - TIEU DE 3 (Tin hieu Bat Dinh + Day)                   |
//|============================================================================================|



if (SelectedVSA = ParamToggle( "* - Hien thi TITLE - TIEU DE (Bat Dinh - Day)",  "OFF|ON", 0 ))
{



//|============================================================================================|
//|                                       TITLE - TIEU DE 3                                  |
//|============================================================================================|



_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"
        +("\n")+ 
        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() 
 
 


//                       Hien thi thong tin Gia va Khoi luong                            |
//====================================================================================|

//Volume

+("\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\n")+ // Xuong dong


//***************************************************
//Thay doi mau sac theo Volume
EncodeColor(colorBlue) + "   - Total Volume: "+ 

WriteIf(V>=maVolume*1.6,                     EncodeColor(colorViolet)+    WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,
WriteIf(V<maVolume*1.6 AND V>=maVolume*1.1 ,EncodeColor(colorLime)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",
WriteIf(V<maVolume*1.1 AND V>=maVolume*0.9,EncodeColor(colorGold)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",
WriteIf(V<maVolume*0.9 AND V>=maVolume*0.5, EncodeColor(colorRed)+       WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,
WriteIf(V<maVolume*0.5,                      EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ","")))))+

//MA30 Volume
EncodeColor(colorBlue)+ "MA30: " + EncodeColor(colorYellow) + WriteVal(maVolume,1.0)+

//Danh gia Volume
EncodeColor(colorBlue)+("   -   Danh gia: ")+
WriteIf(V>=maVolume*1.6,                        EncodeColor(colorViolet)+   " SIEU CAO",
WriteIf(V<maVolume*1.6  AND V>=maVolume*1.1,   EncodeColor(colorLime)+     " CAO",
WriteIf(V<maVolume*1.1 AND V>=maVolume*0.9,   EncodeColor(colorGold)+     " TRUNG BINH",
WriteIf(V<maVolume*0.9 AND V>=maVolume*0.5,    EncodeColor(colorRed)+      " THAP",
WriteIf(V<maVolume*0.5,                         EncodeColor(colorTurquoise)+" SIEU THAP","")))))+

//Buy or Sell Volume
"\n" +
EncodeColor(colorBlue)+   "   - Buy Vol: "+ EncodeColor(colorYellow)+WriteVal(BuyVolume,1.0)+ EncodeColor(colorSeaGreen)+ "   (= "+ WriteVal(BuyVolumep,1.0)+"%" +  " Total"
+")   "+
EncodeColor(colorRed)+   " -   Sell Vol: "+EncodeColor(colorYellow)+WriteVal(SellVolume,1.0)+ EncodeColor(colorSeaGreen)+"   (= "+ WriteVal(SellVolumep,1.0)+"%" +  " Total"
+")   "+
EncodeColor(colorLime)+  " -   Net Vol: "+EncodeColor(colorYellow)+WriteVal(BuyVolume-SellVolume,1.0)+





//***************************************************
// Open High Low Close

"\n"+
EncodeColor(colorBlue) + "   - Open:    " +  EncodeColor(colorYellow) +WriteVal(O,1.2)+ 
EncodeColor(colorLime) + "   -   High:  " +  EncodeColor(colorYellow) +WriteVal(H,1.2)+ 
EncodeColor(colorRed)  + "   -   Low:  " +   EncodeColor(colorYellow) +WriteVal(L,1.2)+ 

//***************************************************
//Thay doi mau theo gia Close
EncodeColor(colorSeaGreen) + "   -   Close:  " +

//Gia tran>6%
WriteIf(xx>=6,
EncodeColor(colorViolet)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Gia san<6%
WriteIf(xx<=-6,
EncodeColor(colorTurquoise) +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Tang gia
WriteIf(xx>0 AND xx<6,
EncodeColor(colorLime)   +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Giam gia
WriteIf(xx<0 AND xx>-6,
EncodeColor(colorRed)       +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",
//Tham chieu
EncodeColor(colorGold)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)"))))+

//***************************************************

(EncodeColor(colorBlue)+"\n   - Spread: ")+

WriteIf(spread >=avgSpread*1.5,                             EncodeColor(colorViolet)+   " RONG",
WriteIf(spread <avgSpread*1.5 AND spread>=avgSpread*1.1 ,   EncodeColor(colorLime)+     " TREN TRUNG BINH",
WriteIf(spread < avgSpread*1.1 AND spread >= AvgSpread*0.9, EncodeColor(colorGold)+     " TRUNG BINH",
WriteIf(spread < AvgSpread*0.9 AND spread >= AvgSpread*0.4, EncodeColor(colorRed)+      " DUOI TRUNG BINH",
WriteIf(spread < AvgSpread*0.4,                             EncodeColor(colorTurquoise)+" HEP","")))))+


//***************************************************
(EncodeColor(colorBlue)+"   -   Vi tri Close: ")+
WriteIf(ClosePos==5,EncodeColor(colorViolet)+   " CAO NHAT",
WriteIf(ClosePos==4,EncodeColor(colorLime)+     " PHIA TREN",
WriteIf(ClosePos==3,EncodeColor(colorGold)+     " NGAY GIUA",
WriteIf(ClosePos==2,EncodeColor(colorRed)+      " PHIA DUOI",
WriteIf(ClosePos==1,EncodeColor(colorTurquoise)+" THAP NHAT",
                    EncodeColor(colorYellow)   +" KHONG DOI")))))+

                     
                    
                    
//***************************************************
//Danh gia xu huong

("\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" + // Xuong dong

//Suc manh MACD 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(MACDStrength==1,  EncodeColor(colorLime)     +  " MACD Strength:          TANG - UP",
WriteIf(MACDStrength==-1, EncodeColor(colorRed)      +  " MACD Strength:          GIAM - DOWN",
                         EncodeColor(colorGold)      +  " MACD Strength:          Khong ro rang"))+

//Suc manh RSI 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(RSIStrength==1,  EncodeColor(colorLime)     +  " RSI Strength:               TANG - UP",
WriteIf(RSIStrength==-1, EncodeColor(colorRed)      +  " RSI Strength:               GIAM - DOWN",
                         EncodeColor(colorGold)     +  " RSI Strength:               Khong ro rang"))+
                         
//Xu huong ngan han hien tai
EncodeColor(colorLime)+("\n   - ")+
WriteIf(upimd==1,EncodeColor(colorLime)         +  " Xu huong hien tai:      TANG - UP",
WriteIf(dnimd==1,EncodeColor(colorRed)          +  " Xu huong hien tai:      GIAM - DOWN",
                 EncodeColor(colorGold)         +  " Xu huong hien tai:      Khong ro rang"))+

//Xu huong trung gian thu cap                 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(upminor==1,EncodeColor(colorLime)       +  " Xu huong thu cap:      TANG - UP",
WriteIf(dnminor==1,EncodeColor(colorRed)        +  " Xu huong thu cap:      GIAM - DOWN",
                   EncodeColor(colorGold)       +  " Xu huong thu cap:      Khong ro rang"))+
WriteIf(upminoroff,  EncodeColor(colorOrange)   +  " (Xu huong TANG thu cap co the thay doi)",
WriteIf(dnminoroff,  EncodeColor(colorSeaGreen) +  " (Xu huong GIAM thu cap co the thay doi)","" ))+

//Xu huong chinh (trung han)
EncodeColor(colorLime)+("\n   - ")+
WriteIf(trenddaihan==1,  EncodeColor(colorLime) +  " Xu huong chinh:         TANG - UP",
WriteIf(trenddaihan==-1,EncodeColor(colorRed)   +  " Xu huong chinh:         GIAM - DOWN",
                     EncodeColor(colorGold)     +  " Xu huong chinh:         Khong ro rang"))+
WriteIf(upmajoroff,EncodeColor(colorOrange)     +  " (Xu huong TANG chinh co the thay doi)",
WriteIf(dnmajoroff,EncodeColor(colorSeaGreen)   +  " (Xu huong GIAM chinh co the thay doi)","" ))+



//Xu huong EMAs 
EncodeColor(colorLime)+("\n   - ")+
WriteIf(EMAStrength==1,  EncodeColor(colorLime)     +  " Xu huong EMAs:         TANG - UP",
WriteIf(EMAStrength==-1, EncodeColor(colorRed)      +  " Xu huong EMAs:         GIAM - DOWN",
                      EncodeColor(colorGold)     +  " Xu huong EMAs:         Khong ro rang"))+
                      
//Xu huong Ichimoku
EncodeColor(colorLime)+("\n   - ")+
WriteIf(Xuhuongichimoku==1,  EncodeColor(colorLime) +" Xu huong Ichimoku:   TANG - UP",
WriteIf(Xuhuongichimoku==-1, EncodeColor(colorRed)  +" Xu huong Ichimoku:   GIAM - DOWN",
WriteIf(Xuhuongichimoku==0,EncodeColor(colorGold)   +" Xu huong Ichimoku:   Khong ro rang","" )))+
                                                               
WriteIf(XuhuongIchimokuTangoff,EncodeColor(colorOrange)     +"  (Xu huong TANG Ichimoku co the thay doi)",
WriteIf(XuhuongIchimokuGiamoff,EncodeColor(colorSeaGreen)   +"  (Xu huong GIAM Ichimoku co the thay doi)","" ))+




//====================================================================================================
//Luot song ngan han

//Buy

WriteIf(Buyluotsong,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorBlue) + "  - Buy Luot song:" ,"")+
     
//Canh bao Day - Bottom
EncodeColor(colorYellow) + WriteIf(DayBottom, "\n" + "   - Chu y: (!) ", "") + 
EncodeColor( colorLime ) +WriteIf ( BuyDayBottom , "Tinhieu: Mua bat 'Day'" +
EncodeColor( colorLime ) + "\n   - Gia Mua:        " + EncodeColor( colorGold ) +WriteVal( C, 1.1 ) + 
EncodeColor( colorLime ) +" - Gia muc tieu:     " +  EncodeColor( colorGold) +WriteVal( PivotSellPrice, 1.1 ) + " (" + WriteVal( ( PivotSellPrice - PivotBuyPrice), 1.1 ) + "="+ WriteVal( ( PivotSellPrice - PivotBuyPrice)*100/PivotBuyPrice, 1.0 )+"%" +")" + 
EncodeColor( colorRed ) +"\n   - Gia Cutloss: " + EncodeColor( colorGold ) + WriteVal( C * .95, 1.1 ) + 
EncodeColor( colorLime) + " - Ty le LN/Rui do: " + EncodeColor( colorGold) + WriteVal( ( PivotProfitTaker - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" , "" ) +

	
//Buy Luot song ngan han
EncodeColor(colorBlue) + WriteIf(BuyBreakout_SidewayDay, "\n" + "   - Buy Brekout (0): " + 
EncodeColor(colorLime) + "(+) Vuot Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(Buy5Day, "\n" + "   - Buy 4 Day (4):     " + 
EncodeColor(colorLime) + "(+) Vuot Dinh T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(Buy10Day, "\n" + "   - Buy 8 Day (8):     " + 
EncodeColor(colorLime) + "(+) Vuot Dinh T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyEMA5cross, "\n" + "   - Buy EMA5 Cross (5): " + 
EncodeColor(colorLime) + "(+) EMA5 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyEMA10cross, "\n" + "   - Buy EMA10 Cross (6): " + 
EncodeColor(colorLime) + "(+) EMA10 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorBlue) + WriteIf(BuyTurtle, "\n" + "   - Buy Turtle Trading System: " + 
EncodeColor(colorLime) + "(+) Vuot Dinh Turtle + EMAFast > EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Canh bao Bat Day theo RSI
EncodeColor(colorYellow) + WriteIf(BuyRSIDivergence, "\n" + "   - Bat day theo RSI: " + 
EncodeColor(colorLime) + "(!) Dau hieu RSI phan ky Tang: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Tin hieu ATR
EncodeColor(colorBlue) + WriteIf(Buyatr, "\n" + "   - Buy % & ATR: " + 
EncodeColor(colorLime) + "(+) Buy theo % Dinh Day hoac ATR: "  +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 


//Ket qua Mua Day
EncodeColor( colorLime ) +WriteIf( PivotLong AND NOT BuyDayBottom, EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
"  - Ket Qua:"  + 
EncodeColor( colorLime) +" Lenh (Mua bat 'Day')" + 
EncodeColor( colorGold )  +"\n   - Gia Mua:        " +  WriteVal( ( PivotBuyPrice ), 1.1 ) +
EncodeColor( colorLime ) + " - Loi nhuan: " + EncodeColor( colorBrightGreen) + WriteVal( ( C - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" +
EncodeColor( colorRed ) + "\n   - Gia Cutloss: " + EncodeColor( colorGold) + WriteVal( ( PivotBuyPrice * .95 ), 1.1 ) + 
EncodeColor( colorSeaGreen ) + " - Ty le LN/Rui do hien tai: " + 
EncodeColor( colorGold) + WriteVal( ( C - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" + " - " + 
EncodeColor( colorGold ) + " Cu de Lai chay tiep!", "" ) +  

//***********************************


//Sell

WriteIf(Sellluotsong,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorRed) + "  - Sell Luot song: " ,"")+	


//Canh bao Dinh - Top
EncodeColor(colorYellow) + WriteIf(DinhTop, "\n" + "   - Chu y: (!) " + 
EncodeColor(colorYellow) + "Dau hieu tao Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
EncodeColor( colorYellow ) +WriteIf ( SellDinhTop , "\n   - Tinhieu: (-) Ban chot lenh (Mua bat 'Day') truoc" + 
EncodeColor( colorRed ) +"\n   - Gia Ban: " + EncodeColor( colorGold )  +WriteVal( C, 1.1 ) + 
EncodeColor( colorLime )  +" - Loi nhuan: " +  EncodeColor( colorGold ) + WriteVal( ( PivotSellPrice - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( PivotSellPrice - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" , "" ) +

//Sell luot song ngan han
EncodeColor(colorRed) + WriteIf(SellBreakout_SidewayDay, "\n" + "   - Sell Breakdown (0): " + 
EncodeColor(colorDarkYellow) + "(-) Duoi EMA10: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
EncodeColor(colorRed) + WriteIf(Sell5Day, "\n" + "   - Sell 4 Day (4):           " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(Sell10Day, "\n" + "   - Sell 8 Day (8):           " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellEMA5cross, "\n" + "   - Sell EMA5 Cross (5): " + 
EncodeColor(colorDarkYellow) + "(-) EMA5 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellEMA10cross, "\n" + "   - Sell EMA10 Cross (6): " + 
EncodeColor(colorDarkYellow) + "(-) EMA10 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorRed) + WriteIf(SellTurtle, "\n" + "   - Sell Turtle Trading System: " + 
EncodeColor(colorDarkYellow) + "(-) Pha Day Turtle, EMAFast < EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

EncodeColor(colorYellow) + WriteIf(exitArray, "\n" + "   - Chu Y: " + 
EncodeColor(colorDarkYellow) + "(-) Thoat lenh Turtle truoc do (Chot loi, Cat lo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Canh bao Ban Dinh theo RSI
EncodeColor(colorYellow) + WriteIf(SellRSIDivergence, "\n" + "   - Ban Dinh theo RSI: " + 
EncodeColor(colorDarkYellow) + "(!) Dau hieu RSI phan ky Giam: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Tin hieu ATR
EncodeColor(colorRed) + WriteIf(Sellatr, "\n" + "   - Sell % & ATR: " + 
EncodeColor(colorDarkYellow) + "(-) Theo % Dinh Day hoac ATR: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 

//Muc giam tu Dinh gan nhat
WriteIf( PivotShort AND NOT SellDinhTop, EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
EncodeColor( colorRed ) + "  - Muc Giam tu Dinh gan nhat: " 
+ EncodeColor( colorGold) +"("+WriteVal( ( PivotSellPrice ), 1.1 ) +"): "
+ EncodeColor( colorGold) +WriteVal( ( C - PivotSellPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotSellPrice ) * 100 / PivotSellPrice ), 1.1 ) + "%)" + 
EncodeColor( colorGold ) + "\n   - Cho tin hieu Mua bat 'Day'!", "" ) +


//====================================================================================================================


//*************************************************************************************
//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |
//====================================================================================|

//Buy Ichimoku

WriteIf(Buyichimoku,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorBlue) + "  - Buy Ichimoku Kinko Hyo:" ,"")+
    
    
    EncodeColor(colorBlue) + WriteIf(Buyichimoku2 OR Buyichimoku3, "\n" + "   - Buy (0): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan & Kijun & Trong hoac Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 

	EncodeColor(colorBlue) + WriteIf(TinHieu1, "\n" + "   - Buy (1): " + 
	EncodeColor(colorLime) + "(+) Vuot Kijun & Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu2, "\n" + "   - Buy (2): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan + Tenkan vuot Kijun + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu3, "\n" + "   - Buy (3): " + 
	EncodeColor(colorLime) + "(+) Tenkan vuot Kijun + Tren Sen & Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu4, "\n" + "   - Buy (4): " + 
	EncodeColor(colorLime) + "(+) SpanA vuot SpanB + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(TinHieu5, "\n" + "   - Buy (5): " + 
	EncodeColor(colorLime) + "(+) Vuot Tenkan + Chikou vuot Gia + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + 
	
	EncodeColor(colorBlue) + WriteIf(VuotMay, "\n"  + "   - Vuot may Sen: " +
	EncodeColor(colorLime) + "(+) Mua Manh!: "+EncodeColor(colorYellow) + WriteVal(C,1.2) , "") + 
	
	EncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\n"  + "   - Vuot may Sen & Kumo: " + 
	EncodeColor(colorLime) + "(+) Mua rat Manh!!: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
	EncodeColor(colorViolet) + WriteIf(Bomno, "\n"  + "   - Bung no: " + 
	EncodeColor(colorLime) + "(+) Mua cuc Manh!!!: " + EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	
	
	EncodeColor(colorYellow) + WriteIf(HopBich, "\n"  + "   - Song kiem hop bich Tenkan & Kijun:" + 
	EncodeColor(colorLime) + "(+) Mua Gia tang: " +EncodeColor(colorYellow) + WriteVal(TL ,1.2) , "") +
	


//Sell Ichimoku



WriteIf(Sellichimoku,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " +
    
    EncodeColor(colorRed) + "  - Sell Ichimoku Kinko Hyo: " ,"")+	

	EncodeColor(colorRed) + WriteIf(Sellichimoku1, "\n" + "   - Sell (1): " + 
	EncodeColor(colorDarkYellow) + "(-) Duoi Tenkan & Kijun (Tren Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 
	
	EncodeColor(colorRed) + WriteIf(Sellichimoku2, "\n" + "   - Sell (2): " + 
	EncodeColor(colorDarkYellow) + "(-) Ban Manh!: Duoi Tenkan & Kijun (Trong Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	                         

	EncodeColor(colorRed) + WriteIf(Sellichimoku3, "\n" + "   - Sell (3): " + 
	EncodeColor(colorDarkYellow) + "(-) Ban rat Manh!!!: Duoi Tenkan & Kijun (Duoi Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + 	 	
	
	
	
	


//====================================================================================================================



 "\n" +  EncodeColor( colorLightGrey ) +":::::::::::::::::::::::::::::::::::::::::::::::::::::::::"

//Cac chi bao ky thuat

//AccDist
+ "\n" + EncodeColor( colorLime ) + "   - AccDist ():        " 
+ WriteIf( wuWilliamR, EncodeColor( colorLime ) + "Tich luy", 
  WriteIf( wdWilliamR, EncodeColor( colorRed ) + "Phan phoi", EncodeColor( colorGold ) +"Khong ro" ) )
  
//RSI
+ "\n" + EncodeColor( colorLime ) + "   - RSI (14):         " 
+ WriteIf( RSI( 14 ) >= 70 ,                   EncodeColor( colorViolet )+" OverBought: "  , 
  WriteIf( RSI( 14 ) >= 50 AND RSI( 14 ) < 70, EncodeColor( colorLime )+" Up: " ,
  WriteIf( RSI( 14 )  < 50 AND RSI( 14 ) > 30, EncodeColor( colorRed )+" Down: " ,
                                               EncodeColor( colorBrown )+" OverSold: ")))
+ WriteVal( RSI( 14 ), format = 1.1 )

//CCI
+ "\n" + EncodeColor( colorLime ) + "   - CCI (14):         " 
+ WriteIf( CCI( 14 ) >= 100 ,                   EncodeColor( colorViolet )+" OverBought: "  , 
  WriteIf( CCI( 14 ) >= 0 AND CCI( 14 ) < 100,  EncodeColor( colorLime )+" Up: " ,
  WriteIf( CCI( 14 )  < 0 AND CCI( 14 ) > -100, EncodeColor( colorRed )+" Down: " ,
                                                EncodeColor( colorBrown )+" OverSold: " )))
+ WriteVal( CCI( 14 ), format = 1.1 )

//ROC
+ "\n" + EncodeColor( colorLime ) + "   - ROC (C,14):   " 
+ WriteIf( ROC( C, 14 ) >= 10 ,                   EncodeColor( colorViolet )+" OverBought: "  , 
  WriteIf( ROC( C, 14 ) >= 0 AND ROC( C, 14 ) < 10,  EncodeColor( colorLime )+" Up: " ,
  WriteIf( ROC( C, 14 )  < 0 AND ROC( C, 14 ) > -10, EncodeColor( colorRed )+" Down: " ,
                                                EncodeColor( colorBrown )+" OverSold: " )))
+ WriteVal( ROC( C, 14 ), format = 1.1 )

//Wm%R
+ "\n" + EncodeColor( colorLime ) + "   - Wm%R (14):  " 
+ WriteIf( WilliamR >= -20 ,                   EncodeColor( colorViolet )+" OverBought: "  , 
  WriteIf( WilliamR >= -50 AND WilliamR < -20,  EncodeColor( colorLime )+" Up: " ,
  WriteIf( WilliamR  < -50 AND WilliamR > -80, EncodeColor( colorRed )+" Down: " ,
                                                EncodeColor( colorBrown )+" OverSold: " )))
+ WriteVal( WilliamR, format = 1.1 )


+ "\n" +  EncodeColor( colorLightGrey ) +":::::::::::::::::::::::::::::::::::::::::::::::::::::::::"


//Tin hieu Buy Sell theo chi bao ky thuat

+ "\n" + EncodeColor( colorLime ) + "   - Signal (RSI):       " 
+ WriteIf( RSIbuy, EncodeColor( colorLime)    + "Buy", 
WriteIf( RSIsell, EncodeColor( colorRed )     + "Sell", 
WriteIf( RSIBullish, EncodeColor( colorLime ) + "Bullish", 
WriteIf( RSIBearish, EncodeColor( colorRed )  + "Bearish", "Neutral" ) ) ) )


+ "\n" + EncodeColor( colorLime ) + "   - Signal (MACD):  " 
+ WriteIf( MACDbuy, EncodeColor( colorLime )  + "Buy", 
WriteIf( MACDsell, EncodeColor( colorRed )    + "Sell", 
WriteIf( MACDBulish, EncodeColor( colorLime ) + "Bullish", 
WriteIf( MACDBearish, EncodeColor( colorRed ) + "Bearish", "Neutral" ) ) ) )

+ "\n" + EncodeColor( colorLime ) + "   - Signal (Stoch):   " 
+ WriteIf( StochBuy, EncodeColor( colorLime )   + "Buy", 
WriteIf( StochSell, EncodeColor( colorRed )     + "Sell", 
WriteIf( StochBullish, EncodeColor( colorLime ) + "Bullish", 
WriteIf( StochBearish, EncodeColor( colorRed )  + "Bearish", "Neutral" ) ) ) )

+ "\n" + EncodeColor( colorLime ) + "   - Signal (ADX):      " 
+ WriteIf( ADXBuy, EncodeColor( colorLime )   + "Buy", 
WriteIf( ADXSell, EncodeColor( colorRed )     + "Sell", 
WriteIf( ADXBullish, EncodeColor( colorLime ) + "Bullish", 
WriteIf( ADXBearish, EncodeColor( colorRed )  + "Bearish", "Neutral" ) ) ) )

+ "\n" + EncodeColor( colorLime ) + "   - Signal (ZeroLagTMA):   " 
+ WriteIf( TMBuy, EncodeColor(colorLime ) + "Buy", 
WriteIf( TMSell, EncodeColor( colorRed )  + "Sell", 
WriteIf( TMBuy1, EncodeColor( colorLime ) + "Bullish", 
WriteIf( TMSell1, EncodeColor( colorRed ) + "Bearish", "Neutral" ) ) ) )

+ "\n" + EncodeColor( colorLime ) + "   - Signal (ZeroLagEMA):   " 
+ WriteIf( ZeroLagBuy, EncodeColor(colorLime ) + "Buy", 
WriteIf( ZeroLagSell, EncodeColor( colorRed )  + "Sell", 
WriteIf( ZeroLagBuy1, EncodeColor( colorLime ) + "Bullish", 
WriteIf( ZeroLagSell1, EncodeColor( colorRed ) + "Bearish", "Neutral" ) ) ) )






+  "\n" +  EncodeColor( colorLightGrey ) +":::::::::::::::::::::::::::::::::::::::::::::::::::::::::"

//Ho tro khang cu

+ "\n" + EncodeColor( colorLime ) + "   - Diem thoat lenh : " + EncodeColor( colorLime ) + WriteVal( PivotTrailStop, format = 1.0 )
+ "\n" + EncodeColor( colorLime ) + "   - Diem chot Lai : " + EncodeColor( colorLime ) + WriteVal( PivotProfitTaker, format = 1.0 )
+ "\n" +EncodeColor( colorRed ) + "   - R1: " + EncodeColor( colorGold ) + WriteVal( r1RS, format = 1.0 )
+ EncodeColor( colorRed ) + " R2: " + EncodeColor( colorGold ) + WriteVal( r2RS, format = 1.0 )
+ EncodeColor( colorRed ) + " R3: " + EncodeColor( colorGold ) + WriteVal( r3RS, format = 1.0 )
+ "\n" +EncodeColor( colorBlue ) + "   - S1: " + EncodeColor( colorGold ) + WriteVal( s1RS, format = 1.0 )
+ EncodeColor( colorBlue ) + " S2: " + EncodeColor( colorGold ) + WriteVal( s2RS, format = 1.0 )
+EncodeColor( colorBlue ) + " S3: " + EncodeColor( colorGold ) + WriteVal( s3RS, format = 1.0 ) +

  

	
	
		

//*********************************************************************************************
//|                            Hien thi Tin hieu canh bao  VSA                                   |
//|============================================================================================|

  /*
strength	= sc OR tbc2a OR tbc2 or effortDownfail OR 	strengthDown OR strengthDown1 OR strengthDown2 OR 
              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;

weakness	= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   
             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;

vsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt 
           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;

*/ 


//1. Tin hieu canh bao xuat hien Diem Yeu

 WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+

EncodeColor(colorRed)+

WriteIf (bc,"\n +Buying Climax - Cao trao Mua tiem nang. ","")+
WriteIf (upThrustBartrue, "\n +Day la mot thanh Upthrust thuc su."+"\n + Dau hieu Diem Yeu kha chac chan. ","")+
WriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+
WriteIf (PseudoUpThrust, "\n +Psuedo UpThrust - Upthrust gia tao."+"\n +Co khoi luong thap hon 2 thanh truoc no. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\n +Mot thanh gia giam co gia dong cua o muc thap."+"\n +Theo sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+
WriteIf (effortUpfail, "\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+
WriteIf (Sellcond, "\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+
WriteIf (effortDown, "\n  +No luc day gia GIAM (Effort to Fall). "+"\n  +Dau hieu cua Diem Yeu.  ","")+
WriteIf (tbc4, "\n +Hai thanh gia dao chieu giam gia (Nhan chim giam)."+"\n +Voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+

//2. Tin hieu canh bao xuat hien Diem Manh


EncodeColor(colorCustom9)+

WriteIf (sc, "\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."
            +"\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+
WriteIf (tbc2a , "\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon."+"\n +Dau hieu cua Diem Manh. ", "")+
WriteIf (tbc2 AND NOT tbc2a, "\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. "+"\n +Dau hieu cua Diem Manh. ", "")+
WriteIf (effortDownfail, "\n +No luc day gia xuong that bai (Effort to Move Down has failed). "+"\n +Dau hieu cua Diem Manh.  ","")+
WriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\n +Diem Manh xuat hien tro lai sau mot xu huong giam. "+"\n +Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+
WriteIf (effortUp, "\n +Mot no luc day gia tang (Effort to Rise) . "+"\n +Dau hieu cua Diem Manh.  ","")+
WriteIf (revUpThrust, "\n +Thanh gia Upthrust dao nguoc. "+"\n +Dau hieu cua Diem Manh. ","")+


//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do 


EncodeColor(colorYellow)+

WriteIf (trendChange, "\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (topRevBar, "\n +Top Reversal - Dao chieu giam o dinh. "+"\n +Dau hieu cua Diem Yeu. ","")+
WriteIf (noDemandBarDt OR  noDemandBarUt, "\n +No Demand - Khong co Cau. "+"\n +Xu huong tang co the thay doi.  ","")+
WriteIf (Fom1, "\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu."+"\n +Co the dang gap Vung Khang cu/Ho tro manh.","")+
WriteIf (tbc3 AND NOT Fom1 , "\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+
WriteIf (tbc5 AND NOT tbc3, "\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+
WriteIf (buyCond, "\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+
WriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\n +Test for supply - Kiem dinh nguon cung thanh cong. "+"\n +Dau hieu cua Diem Manh. ","")+
WriteIf (noSupplyBar, "\n +No Supply - Khong co nguon cung. "+"\n +Dau hieu cua Diem Manh. ","")+
WriteIf (stopVolume, "\n +Stopping volume - Khoi luong dung giam. "+"\n +Bao hieu xu huong giam sap ket thuc. ","") +


	
//******************************************



//Dien giai Nen Nhat


 WriteIf(BuyJapaneseCandle OR SellJapaneseCandle OR CoverJapaneseCandle OR ShortJapaneseCandle,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                                         +EncodeColor(colorBlue) +"   - Japanese Candle: \n","")+
                                         



 
      
//Buy Candles Bullish 
//Nen canh bao Mua Tang Gia Manh
//********************************
WriteIf(BuyJapaneseCandle,EncodeColor(colorBlue)+"    - Buy: \n" ,"") +
EncodeColor(colorLime)+
WriteIf(BullishAbandonedBaby,"(+) Abandoned Baby Bullish. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(ConcealingBabySwallow,"(+) Concealing Baby Swallow. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(MorningDojiStar,"(+) Morning Doji Star. Mau hinh dao chieu.\n Important sign of reversal.\n Do tin cay Cao. \n","") +
WriteIf(MorningStar,"(+) Morning Star. Mau hinh dao chieu.\n Nison: Tot hon nen theo kich thuoc tang cua nen trang (thu ba).\n Do tin cay Cao. \n","") +
WriteIf(threeInsideUp,"(+) 3 Inside Up. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeOutsideUp,"(+) 3 Outside Up. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(MAtHoldBullish,"(+) Mat Hold Bullish. Mau hinh tiep dien.\n Nison: Trong 2-4 ngay co cay nen Giam gia.\n Do tin cay Cao. \n","") +
WriteIf(risingThreeMethods,"(+) Rising Three Methods. Mau hinh tiep dien. \n Nison: No co y nghia lon hon neu khoi luong cua nen trang lon hon khoi luong cua nen den.\n Do tin cay Cao. \n","") +
WriteIf(sideBySideWhiteLines,"(+) Side by Side White Lines. Mau hinh tiep dien.\n Nison: Neu trong mot xu huong giam co the duoc gay ra boi ricoperture la Ngan. \n Do tin cay Cao. \n","") +
WriteIf(threeWhiteSoldiers,"(+) 3 White Soldiers. Mau hinh tiep dien.\n Nison: Tin hieu Tich cuc.\n Nhung hay chu y den Mau hinh giam Gia truoc do va mau hinh tiep theo.\n Do tin cay Cao. \n","") +


//Cover Candles Bullish 
//Nen canh bao Tang Gia nhe
//**************************


WriteIf(CoverJapaneseCandle,EncodeColor(colorGold)+"    - Cover: \n","") +
EncodeColor(colorLime)+
WriteIf(BullishKicker,"(+) BullishKicker. Mau hinh dao chieu.\n Than cay Nen cang Rong thi cang manh.\n Do tin cay Thap. \n","") +
WriteIf(EngulfingBull,"(+) Bullish Engulfing. Mau hinh dao chieu.\n Nison: Cac yeu to lam tang hieu ung cua mo hinh la: \n 1) Ngay dau tien (truoc do) cay nen co than nho, vao ngay thu hai co than nen rong.\n 2) Mo hinh xuat hien sau khi di chuyen rat nhanh hoac rat keo dai. \n 3) Khoi luong cao vao ngay thu hai (hien tai).\n 4) Nhieu ngay co Nen bao phu cay Nen truoc. \n Do tin cay Trung binh. \n","") +
WriteIf(BullishBeltHold,"(+) Belt Hold Bullish. Mau hinh dao chieu.\n Than cay Nen cang Rong thi cang manh.\n Do tin cay Thap. \n","") +
WriteIf(breakAwayBullish,"(+) Break Bar Away Bullish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dojiStarBullish,"(+) Bullish Doji Star. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. Tin hieu Manh neu o vung Dinh cao.\n Do tin cay Trung binh. \n","") +
WriteIf(hammerBullish,"(+) Bullish Hammer. Mau hinh dao chieu.\n Nison: Dau hieu Manh neu Than nen phia tren Hep va Duoi Nen phia duoi dai.\n  Nen tang Gia se tot hon Nen giam Gia \n Do tin cay Thap. \n","") +
WriteIf(dragonflyDoji,"(+) Dragonfly Doji. Do tin cay Trung binh. \n","") +
WriteIf(BullishHarami, "(+) Harami Bullish. Mau hinh dao chieu.\n Nison: Tin hieu Yeu. Nen cho su xac nhan. \n Do tin cay Thap. \n","") +
WriteIf(BullishHaramiCross,"(+) Harami Cross. Mau hinh dao chieu.\n Nison: Dau hieu Harami dang tin cay nhat.\n  Dau hieu lon nhat se manh hon dau hieu thap hon. \n Do tin cay Thap. \n","") +
WriteIf(homingPigeon,"(+) Homing Pigeon. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(invertedHammer,"(+) Inverted Hammer. Mau hinh dao chieu.\nNison: Nen cho su xac nhan Tang Gia phia sau.\n Do tin cay Thap. \n","") +
WriteIf(meetingLinesbullish,"(+) Meeting Lines bullish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(piercingLine,"(+) Piercing Line. Mau hinh dao chieu.\n Nison: Day la Mo hinh Dao chieu Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(stickSandwich,"(+) Stick Sandwich. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(threeStarsInTheSouth,"(+) 3 Stars in the South. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(TriStarBottom,"(+) 3 Stars Bottom. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(triStarBullish,"(+) Tri-Star Bullish. Mau hinh dao chieu.\n Nison: Mo hinh Dao chieu tuong doi Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(threeriverBottom,"(+) 3 River Bottom. Mau hinh dao chieu.\n Nison: Ap luc Ban dang Giam dan.\n Do tin cay Trung binh. \n","") +
WriteIf(BullishSeparatingLine,"(+) Separating Lines Bullish. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(upsideGapThreeMethods,"(+) Upside Gap 3 Methods. Mau hinh tiep dien.\n Do tin cay Trung binh. \n","") +
WriteIf(threeLineStrike,"(+) 3 Line Strike. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(TweezerBottoms,"(+) Tweezer Bottom. Mau hinh dao chieu.\n  Cung voi su dao chieu cua cac nen khac co the cho thay muc ho tro.\n Nison: Nen cho su xac nhan. \n","") +
WriteIf(UpwardGappingTasuki,"(+) Upside Tasuki Gap. Mau hinh tiep dien.\n Nison: Than cua hai ngon nen trong khoang trong phai co cung do lon.\n Do tin cay Trung binh. \n","") +
WriteIf(Bull3Formation,"(+) Bull3Formation. \n","") +
WriteIf(BullishCounterAttack,"(+) BullishCounterAttack. \n","") +
WriteIf(SeperatingLines,"(+) SeperatingLines. \n","") +


//Sell Candle Down - Bearish 
//Nen canh bao Sell Giam Gia Manh
//*********************************

WriteIf(SellJapaneseCandle,EncodeColor(colorRed)+"    - Sell: \n","") +
EncodeColor(colorBrown)+
WriteIf(BearishAbandonedBaby,"(-) Abandoned Baby Bearish. Mau hinh dao chieu.\n Nison: Hiem khi xuat hien.\n Do tin cay Cao. \n","") +
WriteIf(DarkCloudCover,"(-) Dark Cloud Cover. Mau hinh dao chieu.\n Nison: Cac yeu to cho thay tam quan trong cua tin hieu nay la: \n 1) Su tham nhap cua ngon nen dau tien trong ngon nen thu hai. \n 2) Neu ca hai nen deu la nen Marabozu. \n 3) Than cua cay nen thu hai o tren mot muc khang cu dang ke. \n 4) Xay ra trong nhung ngay co khoi luong cao.\n Do tin cay Cao. \n","") +
WriteIf(EveningDojiStar,"(-) Evening Doji Star. Mau hinh dao chieu.\n Nison: Phai duoc xac nhan boi mot cay nen den dai.\n Do tin cay Cao. \n","") +
WriteIf(EveningStar,"(-) Evening Star. Mau hinh dao chieu.\n Nison: Khoang cach giua than nen thu hai va thu ba khong phai luc nao cung xuat hien.\n Do tin cay Cao. \n","") +
WriteIf(idendicalThreeBlackCrows,"(-) Identical 3 Black Crows.\n  Mo hinh dao chieu cua xu huong tang truoc do.\n Nison: Dau hieu Giam rat ro rang.\n Do tin cay Cao. \n","") +
WriteIf(BearishKicker,"(-) Kicking Bearish. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeInsideDownBearish,"(-) 3 Inside Down. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(threeoutsideDownBearish,"(-) 3 Outside Down. Mau hinh dao chieu.\n Do tin cay Cao. \n","") +
WriteIf(upsideGapTwoCrows,"(-) Upside Gap 2 Crows. Mau hinh dao chieu.\n Nison: Yeu cau xac nhan voi su dao nguoc tiep tuc vao ngay thu ba.\n Do tin cay Cao. \n","") +
WriteIf(fallingThreeMethods,"(-) Falling 3 Methods. Mau hinh tiep dien.\n Do tin cay Cao. \n","") +
WriteIf(threeBlackCrows,"(-) 3 Black Crows. Mau hinh dao chieu.\n Nison: Nen chu y neu trong xu  the tang. \n Do tin cay Cao. \n","") +


//Short sell Candle Down - Bearish 
//Nen canh bao Sell Giam Gia nhe
//**************************************

WriteIf(ShortJapaneseCandle,EncodeColor(colorGold)+"    - Short: \n" ,"") +
EncodeColor(colorBrown)+
WriteIf(advanceBlockBearish,"(-) advanceBlockBearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishBeltHold,"(-) Belt Hold Bearish. Mau hinh dao chieu.\n Nison: Chieu cao cua nen cang dai thi cang Manh. \n Do tin cay Thap. \n","") +
WriteIf(breakAwayBearish,"(-) breakvar Away Bearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(HangingMan,"(-) Hanging Man. Mau hinh dao chieu.\n Nison: Nhu mot 'cay Nen bua giam gia' voi mot khoang trong dang ke vao ngay hom sau. \n Do tin cay Thap. \n","") +
WriteIf(deliberationBearish,"(-) Deliberation Bearish. Mau hinh dao chieu.\n Nison: Day khong phai la mot mo hinh dao chieu thuc su.\n  Nhung la mot dau hieu cho thay su phuc hoi dang suy yeu. \n Do tin cay Trung binh. \n","") +
WriteIf(BearishCounterAttack,"(-) Counter Attack Bearish.\n Nison: Dau hieu tiem nang cua su Giam gia. \n","") +
WriteIf(EngulfingBear,"(-) Engulfing Bearish. Mau hinh dao chieu.\n Nison: Dau hieu dao chieu quan trong.\n  Cac yeu to lam tang tam quan trong cua cac mau la: \n 1) Phia tren cay nen co than rat nho VA cay nen thu hai co than rat lon. \n 2) Mau hinh xuat hien sau mot xu huong tang gia nhanh truoc do. \n 3) Khoi luong cao trong Ngay thu Hai. \n 4) Vao Ngay thu hai bao phu than nen nhieu hon so voi than nen truoc day.\n Do tin cay Trung binh. \n","") +
WriteIf(HammerBearish,"(-) HammerBearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dragonflyDojiBearish,"(-) Dragonfly Doji Bearish. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishHarami,"(-) Bearish Harami. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishHaramiCross,"(-) Harami Cross Bearish. Mau hinh dao chieu.\n Nison: Mau hinh bao xu huong giam dang ke hon so voi Nen 'Harami'. \n Ngay thu hai, cay nen co the co mau trang hoac den.\n Do tin cay Trung binh. \n","") +
WriteIf(MeetingLinesBearish,"(-) Meeting Lines Bearish. Mau hinh dao chieu.\n Nhung khong qua manh nhu Nen 'Dark Cloud Cover'. \n Do tin cay Trung binh. ","") +
WriteIf(ShootingStar,"(-) Shooting Star. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(shootingStarGap,"(-) Shooting Star. Mau hinh dao chieu.\n Nison: Khong quan trong nhu Nen 'evening star'. \n Tot nhat, than nen phai nam trong mot khoang trong so voi than nen truoc do.\n No se xuat hien sau mot xu huong tang truoc do.\n Do tin cay Thap. \n","") +
WriteIf(GraveStoneDoji,"(-) Gravestone Doji. Mau hinh dao chieu.\n Nison: Tin hieu quan trong hon khi cham muc cao nhat lich su.\n Do tin cay Trung binh. \n","") +
WriteIf(triStarBearish,"(-) Tri-Star Bearish. Mau hinh dao chieu.\n Nison: Mau hinh dao chieu rat Manh.\n Do tin cay Trung binh. \n","") +
WriteIf(twoCrows,"(-) 2 Crows. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(dojiStarBearish,"(-) Doji Star Bearish. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. \n Do tin cay Trung binh. \n","") +
WriteIf(downsideGapThreeMethods,"(-) Downside Gap 3 Methods. Mau hinh tiep dien. \n Do tin cay Trung binh. \n","") +
WriteIf(DownwardGappingTasuki,"(-) Downside Tasuki Gap. Dau hieu tiep dien xu the.\n Nison: Neu ngay cuoi cung Gap bi dong lai.\n No hinh tiep tuc se bi tu choi.\n Do tin cay Trung binh. \n","") +
WriteIf(inNeckBearish,"(-) In Neck Bearish. Mau hinh tiep dien.\n Nison: Giong nhu Nen 'piercing pattern' .\n Nhung giam nhieu hon vao ngay thu hai vi khong co su xam nhap.\n Do tin cay Trung binh. \n","") +
WriteIf(OnNeckBearish,"(-) On Neck Bearish. Mau hinh tiep dien.\n Nison: Giong nhu Nen 'piercing' - Nen xuyen thau.\n Nhung giam gia hon vi khong co su xam nhap nao vao ngay thu hai.\n Do tin cay Trung binh. \n","") +
WriteIf(BearishSeparatingLine,"(-) Separating Lines Bearish. \n","") +
WriteIf(sideBySideWhiteLinesBearish,"(-) Side by Side White Lines Bearish. Mau hinh tiep dien.\n Nison: Hiem khi xay ra.\n Do tin cay Trung binh. \n","") +
WriteIf(threeLineStrike,"(-) 3 Line Strike. Mau hinh tiep dien.\n Do tin cay Thap. \n","") +
WriteIf(thrustingBearish,"(-) Thrusting - Luc day Manh. Mau hinh tiep dien.\n Nison: Khong phai la ngay dao chieu.\n Boi vi ngay thu hai khong tham gia vao diem giua cua ngay dau tien.\n Do tin cay Thap. \n","") +
WriteIf(TweezerTops,"(-) Tweezer Top. Mau hinh dao chieu.\n Nison: Nen cho su xac nhan. \n","")+
WriteIf(Bear3Formation,"(-) Bear3Formation. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(TriStarTop,"(-) TriStarTop. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") +
WriteIf(InvertedBlackHammer,"(-) InvertedBlackHammer. Mau hinh dao chieu.\n Do tin cay Trung binh. \n","") 


	

	
	

//*************************************************************************************
//                       Hien thi Phan dien giai VSA                                       
//====================================================================================|
//*************************************************************************************


 +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\n ------------------------------------------------------------------- \n " 
                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+

//1. Dien giai VSA Canh bao Xu huong giam
EncodeColor(colorRed) +

WriteIf(upThrustBartrue , "\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+
    "\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  
	"\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+
	"\n +Smart money biet rang thi truong dang yeu di (giam gia). " +
	"\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +
	"\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +
	"\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+
	"\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ 

WriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+
     "\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +
	"\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+
	"\n +Dau hieu cua Diem Yeu."+ 
	"\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+
	"\n +Voi su xuat hien cua thanh Upthrust." +
	"\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ 
	"\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ 	

WriteIf(PseudoUpThrust,"\n +PseudoUpThrust - Day la Upthrust gia tao. "+
    "\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +
	"\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+
	"\n +Nhung khoi luong thuong thap hon muc trung binh. "+
	"\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + 
	"\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+	

WriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+
    "\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+	
	
WriteIf(tbc4, "\n +Dau hieu cua Diem Yeu","")+
 
WriteIf(bc, "\n +Buying Climax - Cao trao Mua tiem nang."+
            "\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+
            "\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +
      
WriteIf(effortUpfail, "\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + 
    
WriteIf(Sellcond, "\n +Tin hieu Ban. ","") + 
  
WriteIf(effortDown, "\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "
                    + "\n +Mot thanh gia cho thay su no luc day gia giam. "
                    + "\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + 
                  

//2. Dien giai VSA Canh bao Xu huong tang

	
EncodeColor(colorCustom9) +

WriteIf(sc,"\n +Selling Climax - Cao trao BAN tiem nang. "
                   +"\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"
                   +"\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"
                   +"\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+

WriteIf(tbc2a OR tbc2 ,"\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+
                            
            
WriteIf(effortDownfail,"\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ 
                                      
WriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " 
	+"\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."
	+"\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "
	+"\n +Xu huong giam co the som dung lai va dao chieu tang. "
	+"\n +La dau hieu cho thay thi truong dang manh hon. ","")+

                   
WriteIf(effortUp ,"\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "
                   + "\n +Mot thanh gia cho thay su no luc day gia tang."
                   +"\n +Day la dau hieu bat dau cua thi truong con Bo. " 
	               + "\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."
	               + "\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + 
	                                      
WriteIf(revUpThrust ,"\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+
            
                   
                   
//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong

                 
EncodeColor(colorYellow) +

WriteIf(trendChange,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                                              + "\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."
                                              +"\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+

WriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\n +Test of supply - Tin hieu test Cung thanh cong."
                                                 + "\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "
                                                 + "\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+


WriteIf(buyCond,"\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."
               + "\n +Day la thanh gia xac nhan cho Diem Manh. ","")+

WriteIf(noSupplyBar,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                    + "\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."
                    + "\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+


WriteIf(stopVolume,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                   + "\n +Stopping Volume - Khoi luong dung."
                   +"\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " 
	               + "\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "
	               +"\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " 
	               + "\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+



WriteIf(noDemandBarUt OR  noDemandBarDt,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                     + "\n +No Demand - Khong co nhu cau. "
                     +"\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"
                     +"\n +Day la dau hieu cua Diem Yeu tiem nang. " 
	                 + "\n   - Luu y:  \n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."
	                 +"\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"
	                 +"\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+


WriteIf(topRevBar,"\n   - Chu y: Co tin hieu Dao chieu xu huong." 
                     + "\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+
              	 

WriteIf(Fom1 OR tbc3 OR tbc5 ,"\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")
                 


);


}



//**********************************************************************************************
//|                  END TITLE - TIEU DE Bat Dinh + Day                                     
//|============================================================================================|
//**********************************************************************************************





//|============================================================================================|
//|                  END TITLE - TIEU DE                                      |
//|============================================================================================|


_SECTION_END();








 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
