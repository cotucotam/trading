<?xml version="1.0" encoding="UTF-8"?>
<Window>
	<Sheet>
		<Name>Sheet 1</Name>
		<Pane>
			<ChartID>1054</ChartID>
			<PercentHeight>75</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (Ðang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (Ðang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATR’s ", 3, 0.5, 10, 0.1 ); // How many ATR’s to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1610612747</MoreFlags>
			<Min>2.05871</Min>
			<Max>55.5709</Max>
		</Pane>
		<Pane>
			<ChartID>1056</ChartID>
			<PercentHeight>25</PercentHeight>
			<Formula>_SECTION_BEGIN("Volume");\r\nPlot( Volume, _DEFAULT_NAME(), IIf( C &gt; O, ParamColor("Up Color", colorGreen ), ParamColor("Down Color", colorRed ) ), ParamStyle( "Style", styleHistogram | styleThick, maskHistogram  ) );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Volume (color) 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1879048193</MoreFlags>
			<Min>4.68752e+006</Min>
			<Max>1.04426e+008</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 2</Name>
		<Pane>
			<ChartID>1057</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (Ðang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (Ðang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATR’s ", 3, 0.5, 10, 0.1 ); // How many ATR’s to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1610612747</MoreFlags>
			<Min>6.52</Min>
			<Max>35.5248</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 3</Name>
		<Pane>
			<ChartID>1059</ChartID>
			<PercentHeight>63.5676</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (Ðang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (Ðang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATR’s ", 3, 0.5, 10, 0.1 ); // How many ATR’s to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 3.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1610612747</MoreFlags>
			<Min>2.05871</Min>
			<Max>55.5709</Max>
		</Pane>
		<Pane>
			<ChartID>1060</ChartID>
			<PercentHeight>11.4595</PercentHeight>
			<Formula>_SECTION_BEGIN("Stochastic %D");\r\nperiods = Param( "Periods", 15, 1, 200, 1 );\r\nKsmooth = Param( "%K avg", 3, 1, 200, 1 );\r\nDsmooth = Param( "%D avg", 3, 1, 200, 1 );\r\nPlot( StochD( periods , Ksmooth, DSmooth ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style") );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Stochastic %D 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1879048193</MoreFlags>
			<Min>-0.554813</Min>
			<Max>102.638</Max>
		</Pane>
		<Pane>
			<ChartID>1058</ChartID>
			<PercentHeight>14.1622</PercentHeight>
			<Formula>_SECTION_BEGIN("RSI");\r\nSetChartOptions(0,0,chartGrid30|chartGrid70);\r\nperiods = Param( "Periods", 15, 1, 200, 1 );\r\nPlot( RSI( periods), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style")  );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\RSI - Relative Strength Index 1.afl</FilePath>
			<Flags>3072</Flags>
			<MoreFlags>1610612737</MoreFlags>
			<Min>17.178</Min>
			<Max>92.3847</Max>
		</Pane>
		<Pane>
			<ChartID>1061</ChartID>
			<PercentHeight>10.8108</PercentHeight>
			<Formula>_SECTION_BEGIN("MACD");\r\nr1 = Param( "Fast avg", 12, 2, 200, 1 );\r\nr2 = Param( "Slow avg", 26, 2, 200, 1 );\r\nr3 = Param( "Signal avg", 9, 2, 200, 1 );\r\nPlot( ml = MACD(r1, r2), StrFormat(_SECTION_NAME()+"(%g,%g)", r1, r2), ParamColor("MACD color", colorRed ), ParamStyle("MACD style") );\r\nPlot( sl = Signal(r1,r2,r3), "Signal" + _PARAM_VALUES(), ParamColor("Signal color", colorBlue ), ParamStyle("Signal style") );\r\nPlot( ml-sl, "MACD Histogram", ParamColor("Histogram color", colorDefault ), styleNoTitle | ParamStyle("Histogram style", styleHistogram | styleNoLabel, maskHistogram ) );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\MACD - Moving Average Convergence Divergence 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1879048193</MoreFlags>
			<Min>-2.00917</Min>
			<Max>2.70121</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 4</Name>
		<Pane>
			<ChartID>1062</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (Ðang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (Ðang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATR’s ", 3, 0.5, 10, 0.1 ); // How many ATR’s to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 4.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1610612747</MoreFlags>
			<Min>2.05871</Min>
			<Max>55.5709</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 5</Name>
		<Pane>
			<ChartID>1063</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (Ðang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (Ðang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATR’s ", 3, 0.5, 10, 0.1 ); // How many ATR’s to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 5.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>536870923</MoreFlags>
			<Min>2.05871</Min>
			<Max>55.5709</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 6</Name>
		<Pane>
			<ChartID>0</ChartID>
			<PercentHeight>50</PercentHeight>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 7</Name>
		<Pane>
			<ChartID>0</ChartID>
			<PercentHeight>50</PercentHeight>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 8</Name>
		<Pane>
			<ChartID>0</ChartID>
			<PercentHeight>50</PercentHeight>
		</Pane>
	</Sheet>
</Window>
