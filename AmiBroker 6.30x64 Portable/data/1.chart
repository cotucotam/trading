<?xml version="1.0" encoding="UTF-8"?>
<Window>
	<Sheet>
		<Name>pivot poket</Name>
		<Pane>
			<ChartID>1127</ChartID>
			<PercentHeight>60</PercentHeight>
			<Formula>//Bo Code xac dinh diem dinh day bang Pivot sau do ve cac duong Fibo theo dinh day Pivot\r\n//Tai khoan ung ho : Nguyen Xuan Lam - Tel 0911.222537\r\n// Ngan hang Nong nghiep va phat trien nong thon : 2000206083140\r\n\r\n_SECTION_BEGIN("Price");\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\n_N(Title = StrFormat("{{NAME}} - {{INTERVAL}} {{DATE}} Open %g, Hi %g, Lo %g, Close %g (%.1f%%) Vol " +WriteVal( V, 1.0 ) +" {{VALUES}}", O, H, L, C, SelectedValue( ROC( C, 1 )) ));\r\nPlot( C, "Close", ParamColor("Color", colorDefault ), styleNoTitle | ParamStyle("Style") | GetPriceStyle() ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 15, 2, 200, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Mid MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 45, 2, 300, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Long MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 100, 2, 400, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("BBands");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 15, 2, 100, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorLightGrey );\r\nColor = ColorBlend( Color,  GetChartBkColor(), 0.5 );\r\nStyle = ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale;;\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style ); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style ); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, GetChartBkColor(), 0.7 ), styleNoLabel | styleCloud | styleNoRescale, Null, Null, Null, -1 );\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Volume");\r\nColor = ParamColor("Color", ColorRGB( 128, 128, 192 ) );\r\nPlot( Volume, _DEFAULT_NAME(), ColorBlend( Color, GetChartBkColor(), 0.5  ), styleNoTitle | ParamStyle( "Style", styleHistogram | styleOwnScale | styleThick | styleNoLabel, maskHistogram  ), 2 );\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Price Interpretation");\r\nmovshort = ParamField("Short Time MA", 8 );\r\nmovmed = ParamField("Mid Time MA", 9 );\r\nmovlong = ParamField("Long Time MA", 10 );\r\nbtop = ParamField("BBTop", 11 );\r\nbbot = ParamField("BBBottom", 12 );\r\nif( Status("action") == actionCommentary )\r\n{\r\nwidth = btop - bbot;\r\nlslop = LinRegSlope( C, 30 ) + 100;\r\nlslo = LLV( lslop, 90 );\r\nlshi = HHV( lslop, 90 );\r\nlswidth = lshi - lslo;\r\ntrend = 100*( lslop - lslo )/lswidth;\r\n\r\nmawidth = MA( width, 100 );\r\nrelwidth = 100*(width - mawidth)/mawidth;\r\n\r\n_N( tname = Name()+"("+FullName()+")" );\r\n\r\nprintf("Price and moving averages:\\n");\r\nprintf( "%s", tname + " has closed " + WriteIf( C &gt; movshort, "above" , "below" ) + " its Short time moving average. ");\r\n\r\nprintf( "%s", "\\nShort time moving average is currently " + WriteIf( movshort &gt; movmed, "above", "below") + " mid-time, AND " + WriteIf( movshort &gt; movlong, "above", "below" ) + " long time moving averages.");\r\n\r\nprintf( "%s", "\\nThe relationship between price and moving averages is: "+\r\nWriteIf( C &gt; movshort AND movshort &gt; movmed, "bullish",\r\nWriteIf( C &lt; movshort AND movshort &lt; movmed, "bearish", "neutral" ) ) + " in short-term, and "+\r\nWriteIf( movshort &gt; movmed AND movmed &gt; movlong , "bullish",\r\nWriteIf( movshort &lt; movmed AND movmed &lt; movlong, "bearish", "neutral" ) ) + " in mid-long term. ");\r\n\r\nprintf("\\n\\nBollinger Bands:\\n");\r\nprintf("%s", tname+ " has closed " + \r\nWriteIf( C &lt; bbot, "below the lower band by " +\r\nWriteVal( 100 *( bbot-C )/ width, 1.1 ) + "%. " +\r\nWriteIf( trend &lt; 30, " This combined with the steep downtrend can suggest that the downward trend in prices has a good chance of continuing.  However, a short-term pull-back inside the bands is likely.",\r\nWriteIf( trend &gt; 30 AND trend &lt; 70, "Although prices have broken the lower band and a downside breakout is possible, the most likely scenario for "+tname+" is to continue within current trading range.", "" ) ), "" ) +\r\n\r\nWriteIf( C &gt; btop, "above the upper band by " +\r\nWriteVal( 100 *( C- btop )/ width, 1.1 ) + "%. " +\r\nWriteIf( trend &gt; 70, " This combined with the steep uptrend suggests that the upward trend in prices has a good chance of continuing.  However, a short-term pull-back inside the bands is likely.",\r\nWriteIf( trend &gt; 30 AND trend &lt; 70, "Although prices have broken the upper band and a upside breakout is possible, the most likely scenario for "+tname+" is to continue within current trading range.", "" ) ), "" ) +\r\n\r\nWriteIf( C &lt; btop AND ( ( btop - C ) / width ) &lt; 0.5, \r\n"below upper band by " +\r\nWriteVal( 100 *( btop - C )/ width, 1.1 ) + "%. ", \r\nWriteIf( C &lt; btop AND C &gt; bbot , "above bottom band by " +\r\nWriteVal( 100 *( C - bbot )/ width, 1.1 ) + "%. ", "" ) ));\r\n\r\nprintf("%s", "\\n"+\r\nWriteIf( ( trend &gt; 30 AND trend &lt; 70 AND ( C &gt; btop OR C &lt; bbot ) ) AND abs(relwidth) &gt; 40,\r\n\t\t "This picture becomes somewhat unclear due to the fact that Bollinger Bands are  currently",\r\n\t\t "Bollinger Bands are " )+\t  \r\nWriteVal( abs( relwidth ), 1.1 ) + "% " +\r\nWriteIf( relwidth &gt; 0, "wider" , "narrower" ) +\r\n" than normal.");\r\n\r\nprintf("\\n");\r\n\r\nprintf("%s",\r\nWriteIf( abs( relwidth ) &lt; 40, "The current width of the bands (alone) does not suggest anything conclusive about the future volatility or movement of prices.","")+\r\nWriteIf( relwidth &lt; -40, "The narrow width of the bands suggests low volatility as compared to " + tname + "'s normal range.  Therefore, the probability of volatility increasing with a sharp price move has increased for the near-term. "+\r\n"The bands have been in this narrow range for " + WriteVal(BarsSince(Cross(-40,relwidth)),1.0) + " bars. The probability of a significant price move increases the longer the bands remain in this narrow range." ,"")+\r\nWriteIf( relwidth &gt; 40, "The large width of the bands suggest high volatility as compared to " + tname + "'s normal range.  Therefore, the probability of volatility decreasing and prices entering (or remaining in) a trading range has increased for the near-term. "+\r\n"The bands have been in this wide range for  " + WriteVal(BarsSince(Cross(relwidth,40)),1.0) + " bars.The probability of prices consolidating into a less volatile trading range increases the longer the bands remain in this wide range." ,""));\r\n\r\nprintf("\\n\\nThis commentary is not a recommendation to buy or sell. Use at your own risk.");\r\n}\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Realtime"); //Tach gio phut giay hien tai\r\nRealtimeClock = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(4)));\r\nGioHientai = ValueWhen(LastValue(V)&gt;0 , LastValue( int(RealtimeClock/10000)));\r\nPhutHienTai = ValueWhen(LastValue(V)&gt;0 , LastValue( int((RealtimeClock - GioHientai*10000)/100)));\r\nGiayHienTai = ValueWhen(LastValue(V)&gt;0 , LastValue( RealtimeClock - (GioHientai*10000 + PhutHienTai*100)));\r\nRealtime  = LastValue( GioHientai*60 + PhutHienTai);//So phut da dien ra trong ngay\r\nNgayhientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(6)));\r\nThanghientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(7)));\r\nNamhientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(8)));\r\n_SECTION_END();\r\nSetForeign("VNINDEX");//Ham Lam viec truc tiep voi 1 ma nhat dinh, o day la Vnindex\r\ntestTimeVningay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeVnithang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeVninam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichVni = (testTimeVninam*100 + testTimeVnithang)*100 + testTimeVningay;\r\nDieukienThoiGian = IIf(testTimeVningay == Ngayhientai AND testTimeVnithang == Thanghientai AND testTimeVninam == Namhientai,2,-2);\r\nstartTimeVni1 = 9*60; // Th?i gian b?t d?u giao d?ch (9:00 AM)\r\nendTimeVni1 = 11*60 +30; // Th?i gian k?t thúc giao d?ch (11:30 PM)\r\nstartTimeVni2 = 13*60; // Th?i gian b?t d?u giao d?ch (13:00 PM)\r\nendTimeVni2 = 14*60+45; // Th?i gian k?t thúc giao d?ch (14:45 PM)\r\nPhienSangVni = (endTimeVni1 - startTimeVni1);\r\nPhienChieuVni = (endTimeVni2 - startTimeVni2);\r\nFulltimeVni = (endTimeVni1 - startTimeVni1) + (endTimeVni2 - startTimeVni2);\r\nInTimeVni  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeVni1 AND Realtime &lt;= endTimeVni1,Realtime -startTimeVni1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeVni1 AND Realtime &lt; startTimeVni2,PhienSangVni,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeVni2 AND Realtime&lt;= endTimeVni2,PhienSangVni + (Realtime - startTimeVni2),FulltimeVni)));\t\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\nSetForeign("HNXINDEX");\r\ntestTimeHNXngay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeHNXthang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeHNXnam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichHNX = (testTimeHNXnam*100 + testTimeHNXthang)*100 + testTimeHNXngay;\r\nstartTimeHNX1 = 9*60; \r\nendTimeHNX1 = 11*60 +30;\r\nstartTimeHNX2 = 13*60; \r\nendTimeHNX2 = 15*60;\r\nPhienSangHNX = (endTimeHNX1 - startTimeHNX1);\r\nPhienChieuHNX = (endTimeHNX2 - startTimeHNX2);\r\nFulltimeHNX = (endTimeHNX1 - startTimeHNX1) + (endTimeHNX2 - startTimeHNX2);\r\nInTimeHNX  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeHNX1 AND Realtime &lt;= endTimeHNX1,Realtime -startTimeHNX1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeHNX1 AND Realtime &lt; startTimeHNX2,PhienSangHNX,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeHNX2 AND Realtime&lt;= endTimeHNX2,PhienSangHNX + (Realtime - startTimeHNX2),FulltimeHNX)));\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\nSetForeign("UPINDEX");\r\ntestTimeUpcomngay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeUpcomthang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeUpcomnam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichUpcom = (testTimeUpcomnam*100 + testTimeUpcomthang)*100 + testTimeUpcomngay;\r\nstartTimeUpcom1 = 9*60; \r\nendTimeUpcom1 = 11*60 +30;\r\nstartTimeUpcom2 = 13*60; \r\nendTimeUpcom2 = 15*60;\r\nPhienSangUpcom = (endTimeUpcom1 - startTimeUpcom1);\r\nPhienChieuUpcom = (endTimeUpcom2 - startTimeUpcom2);\r\nFulltimeUpcom = (endTimeUpcom1 - startTimeUpcom1) + (endTimeUpcom2 - startTimeUpcom2);\r\nInTimeUpcom  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeUpcom1 AND Realtime &lt;= endTimeUpcom1,Realtime -startTimeUpcom1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeUpcom1 AND Realtime &lt; startTimeUpcom2,PhienSangUpcom,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeUpcom2 AND Realtime&lt;= endTimeUpcom2,PhienSangUpcom + (Realtime - startTimeUpcom2),FulltimeUpcom)));\t\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\n////////////Lay time cua ma tren san GD hien tai \r\nLaySGD = MarketID( 1 );\r\nSanHNX = "HNXINDEX";\r\nSanUpcom = "UPINDEX";\r\nSanHSX = "VNINDEX";\r\ntestSan1 = WriteIf(LaySGD == "HSX","VNINDEX","");\r\ntestSan2 = WriteIf(LaySGD == "HNX","HNXINDEX","");\r\ntestSan3 = WriteIf(LaySGD == "UPCOM","UPINDEX","");\r\ntestSan = testSan1 + testSan2 + testSan3;\r\nInTime =  IIf(LaySGD == "HSX",InTimeVni, IIf(LaySGD == "HNX",InTimeHNX,InTimeUpcom));\r\nOutTime = IIf(LaySGD == "HSX",FulltimeVni, IIf(LaySGD == "HNX",FulltimeHNX,FulltimeUpcom));\r\nMorningTime = IIf(LaySGD == "HSX",PhienSangVni, IIf(LaySGD == "HNX",PhienSangHNX,PhienSangUpcom));\r\nTongthoigianGiaodich3San =  IIf(LaySGD == "HSX",TongthoigianGiaodichVni, IIf(LaySGD == "HNX",TongthoigianGiaodichHNX,TongthoigianGiaodichUpcom));\r\n////////////////////////////////////////////////////////////////////////\r\n///////////////////////////DanhGiaVol\r\n_SECTION_BEGIN("Danh Gia Vol");\r\nVolcuaPhut = IIf(InTime &lt; OutTime ,Volume/InTime,Volume/OutTime);\r\n_SECTION_END();\r\n_SECTION_BEGIN("Danh Gia OBV");\r\nOBVcuaPhut = IIf(InTime &lt; OutTime ,OBV()/InTime,OBV()/OutTime);\r\n_SECTION_END();\r\nHesoRank = 14;\r\nSetOption( "Nodefaultcolumns", True ); \r\nAddTextColumn( Name(), "Ma CK",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault))); // Ten\r\nAddTextColumn( FullName(), "Ten Cty"); //Ful ten\r\nAddTextColumn( MarketID( 1 ), "San GD");\r\nAddTextColumn( IndustryID( 1 ), "Nganh nghe" );// Nganh nghe\r\nchuyenngay1 = NumToStr( Datetime(), formatDateTime );// chuyen ngay qua chuoi\r\ncutngay1 = StrTrim( chuyenngay1, " 00:00:00" ); // cut gio phut giay\r\nAddTextColumn(cutngay1 , "Date",  colorDefault, colorDefault);\r\nRankingCl = RSIa(C,HesoRank) ;\r\nWarnaText = colorBlack ;\r\nWarnaBackGround = ColorHSB(RankingCl, 255, 255);\r\nRankingTD = PercentRank (( ( C - Ref ( C ,-1 )) / Ref ( C ,-1 ) ) * 100, HesoRank) ;\r\nAddColumn (Close, "Gia", 1.2, IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)), WarnaBackGround, -1, RankingCL) ;\r\n//AddColumn(Close,"Gia",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)));\r\nAddColumn( ( ( C - Ref ( C ,-1 )) / Ref ( C ,-1 ) ) * 100 , " % Change " , 1.2 ,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)));\r\nRankingVol = RSIa( VolcuaPhut,HesoRank);\r\nWarnaBackGroundVol = ColorHSB(RankingVol , 255, 255);\r\nVolCo = IIf(VolcuaPhut &gt; Ref(VolcuaPhut,-1), colorGreen, IIf(VolcuaPhut &lt; Ref(VolcuaPhut,-1),colorRed,colorDefault));\r\nAddColumn (Volume, "Volume", 1, VolCo, WarnaBackGroundVol, -1, RankingVol) ;\r\nRankingGTGD = RSIa(VolcuaPhut*Avg, HesoRank) ;\r\nWarnaBackGroundGTGD = ColorHSB(RankingGTGD, 255, 255);\r\nGTGDCo = IIf(VolcuaPhut*Avg &gt; Ref(VolcuaPhut*Avg,-1), colorGreen, IIf(VolcuaPhut*Avg &lt; Ref(VolcuaPhut*Avg,-1),colorRed,colorDefault));\r\nAddColumn (Volume*Avg, "GTGD", 1, GTGDCo, WarnaBackGroundGTGD, -1, RankingGTGD) ;\r\nRSICo = IIf(RankingCl &gt; Ref(RankingCl,-1), colorGreen, IIf(RankingCl &lt; Ref(RankingCl,-1),colorRed,colorDefault));\r\nAddColumn (RankingCl, "RSI14", 1.2, RSICo, WarnaBackGround, -1,RankingCl) ;\r\n//RSIVolCo = IIf(RankingVol &gt; Ref(RankingVol,-1), colorGreen, IIf(RankingVol &lt; Ref(RankingVol,-1),colorRed,colorDefault));\r\n//AddColumn (RankingVol, "RSIVol", 1.2, RSIVolCo, WarnaBackGroundVol, -1,RankingVol) ;\r\n//RSIGTGDCo = IIf(RankingGTGD &gt; Ref(RankingGTGD,-1), colorGreen, IIf(RankingGTGD &lt; Ref(RankingGTGD,-1),colorRed,colorDefault));\r\n//AddColumn (RankingGTGD, "RSIGTGD", 1.2, RSIGTGDCo, WarnaBackGroundGTGD, -1,RankingGTGD) ;\r\n//Tonghop =  (RankingCl + RankingVol + RankingGTGD )/3;\r\n//WarnaBackGroundTH = ColorHSB(Tonghop , 255, 255);\r\n//TangGiam = Tonghop - Ref(Tonghop,-1);\r\n//Rankingtangiam = PercentRank (TangGiam, HesoRank) ;\r\n//WarnaBackGroundTG = ColorHSB(Rankingtangiam * 64/100, 255, 255);\r\n//TangGiamRSI = RankingCl - Ref(RankingCl,-1);\r\n//AddColumn(TangGiamRSI,"RSI+/-",1.2,IIf(TangGiamRSI &gt; 0, colorGreen, IIf(TangGiamRSI &lt; 0, colorRed, colorDefault)));\r\n//TangGiamVol = RankingVol - Ref(RankingVol,-1);\r\n//AddColumn(TangGiamVol,"Vol+/-",1.2,IIf(TangGiamVol &gt; 0, colorGreen, IIf(TangGiamVol &lt; 0, colorRed, colorDefault)));\r\n//tanggiamGTGD = \tRankingGTGD - Ref(\tRankingGTGD,-1);\t\r\n//AddColumn(tanggiamGTGD,"GTGD+/-",1.2,IIf(tanggiamGTGD &gt; 0, colorGreen, IIf(tanggiamGTGD &lt; 0, colorRed, colorDefault)));\r\n//diemTH = \t (TangGiamRSI +  TangGiamVol + tanggiamGTGD)/3;\r\n//AddColumn(diemTH,"TH Tang giam",1.2,IIf(diemTH &gt; 0, colorGreen, IIf(diemTH &lt; 0, colorRed, colorDefault)));\r\nSetSortColumns(-8);\r\n//AddRankColumn(); \r\ndieukienbb = IIf(Ref(MA(V,20),-1)&gt;=200000  ,2,-2);// Dieu kien de loai bien cac ma xau, thanh khoan kem, ma mat thanh khoan, thanh khoan khong on dinh\r\ntestTime2023ngay =ValueWhen(V&gt;0 , LastValue(Day()));\r\ntestTime2023thang =ValueWhen(V&gt;0 , LastValue(Month()));\r\ntestTime2023nam =ValueWhen(V&gt;0 , LastValue(Year()));\r\nTongthoigianHienTai = (Namhientai*100+Thanghientai)*100+Ngayhientai;\r\nTongthoigianGiaodich = (testTime2023nam*100 + testTime2023thang)*100 + testTime2023ngay;\r\nDoiCHieuVni = TongthoigianHienTai - TongthoigianGiaodich3San;\r\nDoichieuTructiep = TongthoigianHienTai - TongthoigianGiaodich;\r\nDieukienthoigianvanhanh = IIf( DoiCHieuVni == DoichieuTructiep AND DoichieuTructiep&lt;= 75,2,-2);\r\n//Filter = MA(C,20) &gt;=3  AND dieukienbb&gt;=2  AND Dieukienthoigianvanhanh&gt;=2 ;\r\n/////////////Xac dinh pivots\r\n\r\n_SECTION_BEGIN("Pivot Finder");\r\nfarback=Param("How Far back to go",100,50,5000,10);\r\nnBars = Param("Number of bars", 12, 5, 40);\r\n"BIdxJJJ = " + BarIndex() + \r\n"\\n" + "OGGGGGGGGGGG = " + O + "\\n"+"H = "+ H + "\\n"+"L = " + L \r\n+ "\\n"+"C " ; \r\nGraphXSpace=7;\r\n// -- Create 0-initialized arrays the size of barcount\r\naHPivs = H - H;\r\naLPivs = L - L;\r\n// -- More for future use, not necessary for basic plotting\r\naHPivHighs = H - H;\r\naLPivLows = L - L;\r\naHPivIdxs = H - H;\r\naLPivIdxs = L - L;\r\nnHPivs = 0;\r\nnLPivs = 0;\r\nlastHPIdx = 0;\r\nlastLPIdx = 0;\r\nlastHPH = 0;\r\nlastLPL = 0;\r\ncurPivBarIdx = 0;\r\naHHVBars = HHVBars(H, nBars);\r\naLLVBars = LLVBars(L, nBars);\r\naHHV = HHV(H, nBars);\r\naLLV = LLV(L, nBars);\r\naVisBars = Status("barvisible");\r\nnLastVisBar = LastValue(Highest(IIf(aVisBars, BarIndex(), 0)));\r\n_TRACE("Last visible bar: " + nLastVisBar);\r\ncurBar = (BarCount-1);\r\ncurTrend = "";\r\nif (aLLVBars[curBar] &lt; \r\naHHVBars[curBar]) {\r\ncurTrend = "D";\r\n}\r\nelse {\r\ncurTrend = "U";\r\n}\r\nif (BarCount &gt; farback)\r\n{\r\nfor (i=0; i&lt;farback; i++) {\r\ncurBar = (BarCount - 1) - i;\r\nif (aLLVBars[curBar] &lt; aHHVBars[curBar]) {\r\nif (curTrend == "U") {\r\ncurTrend = "D";\r\ncurPivBarIdx = curBar - aLLVBars[curBar];\r\naLPivs[curPivBarIdx] = 1;\r\naLPivLows[nLPivs] = L[curPivBarIdx];\r\naLPivIdxs[nLPivs] = curPivBarIdx;\r\nnLPivs++;\r\n}\r\n} else {\r\nif (curTrend == "D") {\r\ncurTrend = "U";\r\ncurPivBarIdx = curBar - aHHVBars[curBar];\r\naHPivs[curPivBarIdx] = 1;\r\naHPivHighs[nHPivs] = H[curPivBarIdx];\r\naHPivIdxs[nHPivs] = curPivBarIdx;\r\nnHPivs++;\r\n}\r\n} \r\n} \r\n}\r\ncurBar = (BarCount-1);\r\ncandIdx = 0;\r\ncandPrc = 0;\r\nlastLPIdx = aLPivIdxs[0];\r\nlastLPL = aLPivLows[0];\r\nlastHPIdx = aHPivIdxs[0];\r\nlastHPH = aHPivHighs[0];\r\nif (lastLPIdx &gt; lastHPIdx) {\r\ncandIdx = curBar - aHHVBars[curBar];\r\ncandPrc = aHHV[curBar]; \r\nif (\r\nlastHPH &lt; candPrc AND\r\ncandIdx &gt; lastLPIdx AND\r\ncandIdx &lt; curBar) {\r\naHPivs[candIdx] = 1;\r\nfor (j=0; j&lt;nHPivs; j++) {\r\naHPivHighs[nHPivs-j] = aHPivHighs[nHPivs-\r\n(j+1)];\r\naHPivIdxs[nHPivs-j] = aHPivIdxs[nHPivs-(j+1)];\r\n}\r\naHPivHighs[0] = candPrc ;\r\naHPivIdxs[0] = candIdx;\r\nnHPivs++;\r\n} \r\n} else {\r\ncandIdx = curBar - aLLVBars[curBar];\r\ncandPrc = aLLV[curBar]; \r\nif (\r\nlastLPL &gt; candPrc AND\r\ncandIdx &gt; lastHPIdx AND\r\ncandIdx &lt; curBar) {\r\naLPivs[candIdx] = 1;\r\nfor (j=0; j&lt;nLPivs; j++) {\r\naLPivLows[nLPivs-j] = aLPivLows[nLPivs-(j+1)];\r\naLPivIdxs[nLPivs-j] = aLPivIdxs[nLPivs-(j+1)];\r\n}\r\naLPivLows[0] = candPrc;\r\naLPivIdxs[0] = candIdx;\r\nnLPivs++;\r\n}\r\n}\r\nBuyPivot = aLPivs==1;\r\nSellPivot = aHPivs==1;\r\nLowPivot = ValueWhen(BuyPivot , L);\r\nHighPivot =ValueWhen(SellPivot,H);\r\n\r\nTangPivot= Prec( ( ( HighPivot - LowPivot) / LowPivot ) * 100,2);//lam tron so \r\nGiamPivot= Prec( ( ( LowPivot - HighPivot) / HighPivot ) * 100,2);//lam tron so \r\n\r\ndemTUpPivot = BarsSince(BuyPivot)+1;\r\ndemTDowPivot = BarsSince(SellPivot)+1;\r\nTrendPivot = IIf(demTUpPivot &lt; demTDowPivot,demTUpPivot,demTDowPivot*-1);\r\nAddColumn(TrendPivot,"Trend Pivot",1,IIf(TrendPivot&gt;=1,colorGreen,colorRed) );\r\nSogiatang = Prec( ( ( C - LowPivot) / LowPivot ) * 100,2);\r\nSogiagiam = Prec( ( ( C - HighPivot) / HighPivot ) * 100,2);\r\nTanggiamPivot = IIf(TrendPivot &gt;=1,Sogiatang,Sogiagiam);\r\nAddColumn( TanggiamPivot , "% / Pivot" , 1.2 ,IIf(TanggiamPivot&gt; Ref(TanggiamPivot,-1), colorGreen, IIf(TanggiamPivot&lt;Ref(TanggiamPivot,-1), colorRed, colorDefault)));\r\nHsPivot = TanggiamPivot - Ref(TanggiamPivot,-1);\r\nAddColumn( HsPivot , "+/-% Pivot" , 1.2 ,IIf(HsPivot&gt;0, colorGreen, IIf(HsPivot&lt;0, colorRed, colorDefault)));\r\n\r\nPlotShapes(IIf(aHPivs==1,shapeDownArrow, shapeNone), colorRed, 0,High, Offset=-15);\r\nPlotShapes(IIf(aLPivs==1,shapeUpArrow , shapeNone), ColorRGB(168,255,0), 0, Low, Offset=-15);\r\ndist = 0.5 * ATR( 15 );\r\nfor ( i=BarCount-1; i &gt; 0; i-- )\r\n{\r\n     if ( BuyPivot[i] )\r\n        PlotText( "LowPivot: " + LowPivot[ i ]+"\\n"+ ""+GiamPivot[ i ]+"%", i, L[ i ] - dist[i],colorRose);\r\n     if ( SellPivot[i] )\r\n        PlotText( "HighPivot: " + HighPivot[ i ]+"\\n"+ ""+TangPivot[ i ]+"%", i, H[ i ] + dist[i],colorBrightGreen);    \r\n}\r\n\r\n_SECTION_END();\r\n//Xac dinh cac 3 diem Fibo (2 day 1 dinh hoac 2 dinh 1 day)\r\nDiem2 = IIf(TrendPivot &gt; 0 ,LowPivot,HighPivot); //diem gan nhat 0% fibo\r\nDiem1 = IIf(TrendPivot &gt; 0 ,HighPivot,LowPivot); //diem xa nhat 100% fibo\r\nNguongPivot =  abs(( ( Diem2 - Diem1) / Diem2 ) * 100);\r\ndonviFibo = (Diem1 - Diem2)/100;\r\nNguongPivotFibo = NguongPivot / 100;\r\nFiboCl = IIf(TrendPivot &gt; 0 ,(C  - Diem2)/donviFibo,(C  - Diem2)/donviFibo*-1) ; \r\nFiboHi = IIf(TrendPivot &gt; 0 ,(H  - Diem2)/donviFibo,(H  - Diem2)/donviFibo*-1) ; \r\nFiboLo = IIf(TrendPivot &gt; 0 ,(L  - Diem2)/donviFibo,(L  - Diem2)/donviFibo*-1) ; \r\nFiboAVG = IIf(TrendPivot &gt; 0 ,((H+L+C)/3  - Diem2)/donviFibo,((H+L+C)/3  - Diem2)/donviFibo*-1) ; \r\nFiboOp = IIf(TrendPivot &gt; 0 ,(O  - Diem2)/donviFibo,(O  - Diem2)/donviFibo*-1) ; \r\n\r\nAddColumn( FiboCl , "% / Fibo" , 1 , IIf(FiboCl&gt; Ref(FiboCl,-1), colorGreen, IIf(FiboCl &lt; Ref(FiboCl,-1), colorRed, colorDefault)));\r\nHSFibo = FiboCl - Ref(FiboCl,-1);\r\nAddColumn( HSFibo , "+/-% Fibo" , 1 , IIf(HSFibo&gt; 0, colorGreen, IIf(HSFibo &lt; 0, colorRed, colorDefault)));\r\n//AddColumn( NguongPivotFibo , "%Pivot/1Fibo" , 1.2 ,colorDefault);\r\n//AddColumn( ValueWhen(BuyPivot , -2) , "Diem 3" , 1.2 , colorDefault);\r\n//Cac muc Fibo am : -161.8 -127.2 -100 -78.6 -61.8 -50 -38.2 -23.6 0\r\n//Cac muc Fibo duong : 0 23.6 38.2 50 61.8 78.6 100 127.2 161.8\r\n// canh bao tang 2 nen \r\nKCfibo = (FiboCl -  Ref(FiboCl,-1)) + (FiboAVG - Ref(FiboAVG,-1));\r\nCanhbao1bs = WriteIf((FiboCl &gt;  -200 AND Ref( FiboCl,-1) &lt;= -200) OR  (FiboCl &gt;  -200 AND FiboAVG &gt; -200 AND FiboLo &lt;= -200 AND KCfibo &gt;0),"-200% ","");  \r\nCanhbao1 = WriteIf((FiboCl &gt;  -161.8 AND Ref( FiboCl,-1) &lt;= -161.8) OR  (FiboCl &gt;  -161.8 AND FiboAVG &gt; -161.8 AND FiboLo &lt;= -161.8 AND KCfibo &gt;0),"-161.8% ","");\r\nCanhbao2 = WriteIf((FiboCl &gt;  -127.2 AND Ref( FiboCl,-1) &lt;= -127.2) OR (FiboCl &gt;  -127.2 AND FiboAVG &gt; -127.2  AND FiboLo &lt;= -127.2 AND KCfibo &gt;0),"-127.2% ","");\r\nCanhbao3 = WriteIf((FiboCl &gt;  -100 AND Ref( FiboCl,-1) &lt;= -100) OR (FiboCl &gt;  -100 AND FiboAVG &gt; -100  AND FiboLo &lt;= -100 AND KCfibo &gt;0),"-100% ","");\r\nCanhbao4 = WriteIf((FiboCl &gt;  -78.6 AND Ref( FiboCl,-1) &lt;= -78.6) OR (FiboCl &gt;  -78.6 AND FiboAVG &gt; -78.6  AND FiboLo &lt;= -78.6 AND KCfibo &gt;0) ,"-78.6% ","");\r\nCanhbao5 = WriteIf((FiboCl &gt;  -61.8 AND Ref( FiboCl,-1) &lt;= -61.8) OR (FiboCl &gt;  -61.8 AND FiboAVG &gt; -61.8  AND FiboLo &lt;= -61.8 AND KCfibo &gt;0),"-61.8% ","");\r\nCanhbao6 = WriteIf((FiboCl &gt;  -50 AND Ref( FiboCl,-1) &lt;= -50) OR (FiboCl &gt;  -50 AND FiboAVG &gt; -50  AND FiboLo &lt;= -50 AND KCfibo &gt;0),"-50% ","");\r\nCanhbao7 = WriteIf((FiboCl &gt;  -38.2 AND Ref( FiboCl,-1) &lt;= -38.2) OR (FiboCl &gt;  -38.2 AND FiboAVG &gt; -38.2  AND FiboLo &lt;= -38.2 AND KCfibo &gt;0),"-38.2% ","");\r\nCanhbao8 = WriteIf((FiboCl &gt;  -23.6 AND Ref( FiboCl,-1) &lt;= -23.6) OR (FiboCl &gt;  -23.6 AND FiboAVG &gt; -23.6  AND FiboLo &lt;= -23.6 AND KCfibo &gt;0),"-23.6% ","");\r\nCanhbao9 = WriteIf((FiboCl &gt;  0 AND Ref( FiboCl,-1) &lt;= 0) OR (FiboCl &gt;  0 AND FiboAVG &gt; 0  AND FiboLo &lt;= 0 AND KCfibo &gt;0),"0% ","");\r\nCanhbao10 = WriteIf((FiboCl &gt;  23.6 AND Ref( FiboCl,-1) &lt;= 23.6) OR (FiboCl &gt;  23.6 AND FiboAVG &gt; 23.6  AND FiboLo &lt;= 23.6 AND KCfibo &gt;0),"23.6% ","");\r\nCanhbao11 = WriteIf((FiboCl &gt;  38.2 AND Ref( FiboCl,-1) &lt;= 38.2) OR (FiboCl &gt;  38.2 AND FiboAVG &gt; 38.2  AND FiboLo &lt;= 38.2 AND KCfibo &gt;0),"38.2% ","");\r\nCanhbao12 = WriteIf((FiboCl &gt;  50 AND Ref( FiboCl,-1) &lt;= 50) OR (FiboCl &gt;  50 AND FiboAVG &gt; 50  AND FiboLo &lt;= 50 AND KCfibo &gt;0),"50% ","");\r\nCanhbao13 = WriteIf((FiboCl &gt;  61.8 AND Ref( FiboCl,-1) &lt;= 61.8) OR (FiboCl &gt;  61.8 AND FiboAVG &gt; 61.8  AND FiboLo &lt;= 61.8 AND KCfibo &gt;0),"61.8% ","");\r\nCanhbao14 = WriteIf((FiboCl &gt;  78.6 AND Ref( FiboCl,-1) &lt;= 78.6) OR (FiboCl &gt;  78.6 AND FiboAVG &gt; 78.6  AND FiboLo &lt;= 78.6 AND KCfibo &gt;0),"78.6% ","");\r\nCanhbao15 = WriteIf((FiboCl &gt;  100 AND Ref( FiboCl,-1) &lt;= 100) OR (FiboCl &gt;  100 AND FiboAVG &gt; 100  AND FiboLo &lt;= 100 AND KCfibo &gt;0),"100% ","");\r\nCanhbao16 = WriteIf((FiboCl &gt;  127.2 AND Ref( FiboCl,-1) &lt;= 127.2) OR (FiboCl &gt;  127.2 AND FiboAVG &gt; 127.2  AND FiboLo &lt;= 127.2 AND KCfibo &gt;0),"127.2% ","");\r\nCanhbao17 = WriteIf((FiboCl &gt;  161.8 AND Ref( FiboCl,-1) &lt;= 161.8) OR (FiboCl &gt;  161.8 AND FiboAVG &gt; 161.8  AND FiboLo &lt;= 161.8 AND KCfibo &gt;0),"161.8% ","");\r\nCanhbao17bs = WriteIf((FiboCl &gt;  200 AND Ref( FiboCl,-1) &lt;= 200) OR (FiboCl &gt;  200 AND FiboAVG &gt; 200  AND FiboLo &lt;= 200 AND KCfibo &gt;0),"200% ","");\r\n// canh bao giam 2 nen\r\nCanhbao1abs = WriteIf((FiboCl &lt;=  -200 AND Ref( FiboCl,-1) &gt; -200) OR (FiboCl &lt;=  -200 AND FiboAVG &lt;= -200 AND FiboHi &gt; -200 AND KCfibo &lt;=0),"-200% ","");\r\nCanhbao1a = WriteIf((FiboCl &lt;=  -161.8 AND Ref( FiboCl,-1) &gt; -161.8) OR (FiboCl &lt;=  -161.8 AND FiboAVG &lt;= -161.8 AND FiboHi &gt; -161.8 AND KCfibo &lt;=0),"-161.8% ","");\r\nCanhbao2a = WriteIf((FiboCl &lt;=  -127.2 AND Ref( FiboCl,-1) &gt; -127.2) OR (FiboCl &lt;=  -127.2 AND FiboAVG &lt;= -127.2  AND FiboHi &gt; -127.2 AND KCfibo &lt;=0),"-127.2% ","");\r\nCanhbao3a = WriteIf((FiboCl &lt;=  -100 AND Ref( FiboCl,-1) &gt; -100) OR (FiboCl &lt;=  -100 AND FiboAVG &lt;= -100  AND FiboHi &gt; -100 AND KCfibo &lt;=0),"-100% ","");\r\nCanhbao4a = WriteIf((FiboCl &lt;=  -78.6 AND Ref( FiboCl,-1) &gt; -78.6) OR (FiboCl &lt;=  -78.6 AND FiboAVG &lt;= -78.6  AND FiboHi &gt; -78.6 AND KCfibo &lt;=0),"-78.6% ","");\r\nCanhbao5a = WriteIf((FiboCl &lt;=  -61.8 AND Ref( FiboCl,-1) &gt; -61.8) OR (FiboCl &lt;=  -61.8 AND FiboAVG &lt;= -61.8  AND FiboHi &gt; -61.8 AND KCfibo &lt;=0),"-61.8% ","");\r\nCanhbao6a = WriteIf((FiboCl &lt;=  -50 AND Ref( FiboCl,-1) &gt; -50) OR (FiboCl &lt;=  -50 AND FiboAVG &lt;= -50  AND FiboHi &gt; -50 AND KCfibo &lt;=0),"-50% ","");\r\nCanhbao7a = WriteIf((FiboCl &lt;=  -38.2 AND Ref( FiboCl,-1) &gt; -38.2) OR (FiboCl &lt;=  -38.2 AND FiboAVG &lt;= -38.2  AND FiboHi &gt; -38.2 AND KCfibo &lt;=0),"-38.2% ","");\r\nCanhbao8a = WriteIf((FiboCl &lt;=  -23.6 AND Ref( FiboCl,-1) &gt; -23.6) OR (FiboCl &lt;=  -23.6 AND FiboAVG &lt;= -23.6  AND FiboHi &gt; -23.6 AND KCfibo &lt;=0),"-23.6% ","");\r\nCanhbao9a = WriteIf((FiboCl &lt;=  0 AND Ref( FiboCl,-1) &gt; 0) OR (FiboCl &lt;=  0 AND FiboAVG &lt;= 0  AND FiboHi &gt; 0 AND KCfibo &lt;=0),"0% ","");\r\nCanhbao10a = WriteIf((FiboCl &lt;=  23.6 AND Ref( FiboCl,-1) &gt; 23.6) OR (FiboCl &lt;=  23.6 AND FiboAVG &lt;= 23.6  AND FiboHi &gt; 23.6 AND KCfibo &lt;=0),"23.6% ","");\r\nCanhbao11a = WriteIf((FiboCl &lt;=  38.2 AND Ref( FiboCl,-1) &gt; 38.2) OR (FiboCl &lt;=  38.2 AND FiboAVG &lt;= 38.2  AND FiboHi &gt; 38.2 AND KCfibo &lt;=0),"38.2% ","");\r\nCanhbao12a = WriteIf((FiboCl &lt;=  50 AND Ref( FiboCl,-1) &gt; 50) OR (FiboCl &lt;=  50 AND FiboAVG &lt;= 50  AND FiboHi &gt; 50 AND KCfibo &lt;=0),"50% ","");\r\nCanhbao13a = WriteIf((FiboCl &lt;=  61.8 AND Ref( FiboCl,-1) &gt; 61.8) OR (FiboCl &lt;=  61.8 AND FiboAVG &lt;= 61.8  AND FiboHi &gt; 61.8 AND KCfibo &lt;=0),"61.8% ","");\r\nCanhbao14a = WriteIf((FiboCl &lt;=  78.6 AND Ref( FiboCl,-1) &gt; 78.6) OR (FiboCl &lt;=  78.6 AND FiboAVG &lt;= 78.6  AND FiboHi &gt; 78.6 AND KCfibo &lt;=0),"78.6% ","");\r\nCanhbao15a = WriteIf((FiboCl &lt;=  100 AND Ref( FiboCl,-1) &gt; 100) OR (FiboCl &lt;=  100 AND FiboAVG &lt;= 100  AND FiboHi &gt; 100 AND KCfibo &lt;=0),"100% ","");\r\nCanhbao16a = WriteIf((FiboCl &lt;=  127.2 AND Ref( FiboCl,-1) &gt; 127.2) OR (FiboCl &lt;=  127.2 AND FiboAVG &lt;= 127.2  AND FiboHi &gt; 127.2 AND KCfibo &lt;=0),"127.2% ","");\r\nCanhbao17a = WriteIf((FiboCl &lt;=  161.8 AND Ref( FiboCl,-1) &gt; 161.8) OR (FiboCl &lt;=  161.8 AND FiboAVG &lt;= 161.8  AND FiboHi &gt; 161.8 AND KCfibo &lt;=0),"161.8% ","");\r\nCanhbao17abs = WriteIf((FiboCl &lt;=  200 AND Ref( FiboCl,-1) &gt; 200) OR (FiboCl &lt;=  200 AND FiboAVG &lt;= 200  AND FiboHi &gt; 200 AND KCfibo &lt;=0),"200% ","");\r\nTinhieu2nenGiam = IIf(\t\t(FiboCl &lt;=  -200 AND Ref( FiboCl,-1) &gt; -200) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -161.8 AND Ref( FiboCl,-1) &gt; -161.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -127.2 AND Ref( FiboCl,-1) &gt; -127.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -100 AND Ref( FiboCl,-1) &gt; -100) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -78.6 AND Ref( FiboCl,-1) &gt; -78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -61.8 AND Ref( FiboCl,-1) &gt; -61.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -50 AND Ref( FiboCl,-1) &gt; -50) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -38.2 AND Ref( FiboCl,-1) &gt; -38.2) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -23.6 AND Ref( FiboCl,-1) &gt; -23.6) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  0 AND Ref( FiboCl,-1) &gt; 0) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  23.6 AND Ref( FiboCl,-1) &gt; 23.6) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  38.2 AND Ref( FiboCl,-1) &gt; 38.2) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  50 AND Ref( FiboCl,-1) &gt; 50) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  61.8 AND Ref( FiboCl,-1) &gt; 61.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  78.6 AND Ref( FiboCl,-1) &gt; 78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  100 AND Ref( FiboCl,-1) &gt; 100) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  127.2 AND Ref( FiboCl,-1) &gt; 127.2) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  161.8 AND Ref( FiboCl,-1) &gt; 161.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  200 AND Ref( FiboCl,-1) &gt; 200) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -200 AND FiboAVG &lt;= -200 AND FiboHi &gt; -200 AND KCfibo &lt;=0) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -161.8 AND FiboAVG &lt;= -161.8 AND FiboHi &gt; -161.8 AND KCfibo &lt;=0 ) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -127.2 AND FiboAVG &lt;= -127.2  AND FiboHi &gt; -127.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -100 AND FiboAVG &lt;= -100  AND FiboHi &gt; -100 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -78.6 AND FiboAVG &lt;= -78.6  AND FiboHi &gt; -78.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -61.8 AND FiboAVG &lt;= -61.8  AND FiboHi &gt; -61.8 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -50 AND FiboAVG &lt;= -50  AND FiboHi &gt; -50 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -38.2 AND FiboAVG &lt;= -38.2  AND FiboHi &gt; -38.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -23.6 AND FiboAVG &lt;= -23.6  AND FiboHi &gt; -23.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  0 AND FiboAVG &lt;= 0  AND FiboHi &gt; 0 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  23.6 AND FiboAVG &lt;= 23.6  AND FiboHi &gt; 23.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  38.2 AND FiboAVG &lt;= 38.2  AND FiboHi &gt; 38.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  50 AND FiboAVG &lt;= 50  AND FiboHi &gt; 50 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  61.8 AND FiboAVG &lt;= 61.8  AND FiboHi &gt; 61.8 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  78.6 AND FiboAVG &lt;= 78.6  AND FiboHi &gt; 78.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  100 AND FiboAVG &lt;= 100  AND FiboHi &gt; 100 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  127.2 AND FiboAVG &lt;= 127.2  AND FiboHi &gt; 127.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  161.8 AND FiboAVG &lt;= 161.8  AND FiboHi &gt; 161.8 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  200 AND FiboAVG &lt;= 200  AND FiboHi &gt; 200 AND KCfibo &lt;=0),-2,0);\r\n\t\t\t\t\t\t\t\r\nTinhieu2nenTang =IIf ( \t\t(FiboCl &gt;  -200 AND Ref( FiboCl,-1) &lt;= -200) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -161.8 AND Ref( FiboCl,-1) &lt;= -161.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -127.2 AND Ref( FiboCl,-1) &lt;= -127.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -100 AND Ref( FiboCl,-1) &lt;= -100) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -78.6 AND Ref( FiboCl,-1) &lt;= -78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -61.8 AND Ref( FiboCl,-1) &lt;= -61.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -50 AND Ref( FiboCl,-1) &lt;= -50) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -38.2 AND Ref( FiboCl,-1) &lt;= -38.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -23.6 AND Ref( FiboCl,-1) &lt;= -23.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  0 AND Ref( FiboCl,-1) &lt;= 0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  23.6 AND Ref( FiboCl,-1) &lt;= 23.6) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  38.2 AND Ref( FiboCl,-1) &lt;= 38.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  50 AND Ref( FiboCl,-1) &lt;= 50) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  61.8 AND Ref( FiboCl,-1) &lt;= 61.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  78.6 AND Ref( FiboCl,-1) &lt;= 78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  100 AND Ref( FiboCl,-1) &lt;= 100) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  127.2 AND Ref( FiboCl,-1) &lt;= 127.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  161.8 AND Ref( FiboCl,-1) &lt;= 161.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  200 AND Ref( FiboCl,-1) &lt;= 200) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -200 AND FiboAVG &gt; -200 AND FiboLo &lt;= -200 AND KCfibo &gt;0) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -161.8 AND FiboAVG &gt; -161.8 AND FiboLo &lt;= -161.8 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -127.2 AND FiboAVG &gt; -127.2  AND FiboLo &lt;= -127.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -100 AND FiboAVG &gt; -100  AND FiboLo &lt;= -100 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -78.6 AND FiboAVG &gt; -78.6  AND FiboLo &lt;= -78.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -61.8 AND FiboAVG &gt; -61.8  AND FiboLo &lt;= -61.8 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -50 AND FiboAVG &gt; -50  AND FiboLo &lt;= -50 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -38.2 AND FiboAVG &gt; -38.2  AND FiboLo &lt;= -38.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -23.6 AND FiboAVG &gt; -23.6  AND FiboLo &lt;= -23.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  0 AND FiboAVG &gt; 0  AND FiboLo &lt;= 0 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  23.6 AND FiboAVG &gt; 23.6  AND FiboLo &lt;= 23.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  38.2 AND FiboAVG &gt; 38.2  AND FiboLo &lt;= 38.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  50 AND FiboAVG &gt; 50  AND FiboLo &lt;= 50 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  61.8 AND FiboAVG &gt; 61.8  AND FiboLo &lt;= 61.8 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  78.6 AND FiboAVG &gt; 78.6  AND FiboLo &lt;= 78.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  100 AND FiboAVG &gt; 100  AND FiboLo &lt;= 100 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  127.2 AND FiboAVG &lt;= 127.2  AND FiboHi &gt; 127.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  161.8 AND FiboAVG &gt; 161.8  AND FiboLo &lt;= 161.8 AND KCfibo &gt;0) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  200 AND FiboAVG &gt; 200  AND FiboLo &lt;= 200 AND KCfibo &gt;0),2,0);\r\nCanhbaoTang = Canhbao1bs + Canhbao1 + Canhbao2 + Canhbao3 + Canhbao4 + Canhbao5 + Canhbao6 + Canhbao7 + Canhbao8 + Canhbao9 + Canhbao10 + Canhbao11 + Canhbao12 + Canhbao13 + Canhbao14 + Canhbao15 + Canhbao16 + Canhbao17 + Canhbao17bs;\r\nNoiChuoi2nentang = WriteIf(Tinhieu2nenTang ==2,"Cat len: " +CanhbaoTang ,"");\r\nCanhbaogiam = Canhbao17abs + Canhbao17a + Canhbao16a + Canhbao15a + Canhbao14a + Canhbao13a + Canhbao12a + Canhbao11a + Canhbao10a + Canhbao9a + Canhbao8a + Canhbao7a + Canhbao6a + Canhbao5a + Canhbao4a + Canhbao3a + Canhbao2a + Canhbao1a + Canhbao1abs; \r\nNoiChuoi2nengiam = WriteIf(Tinhieu2nenGiam ==-2,"Cat xuong: " +Canhbaogiam ,"");\r\nCanhbaoTh1 = NoiChuoi2nentang + NoiChuoi2nengiam;\t\t\t\t\t\t\t\r\nMau2nen = IIf(Tinhieu2nenTang ==2,colorGreen,IIf( Tinhieu2nenGiam ==-2,\tcolorRed, colorDefault));\t\t\t\t\t\r\n\r\n/////Fibo Time\r\n//Diem2 = IIf(TrendPivot &gt; 0 ,LowPivot,HighPivot);\r\nKCFibotime = \tabs(LastValue( BarsSince(BuyPivot)) - LastValue(BarsSince(SellPivot)));\r\nKCGiatime  =  IIf(TrendPivot &gt; 0 ,LastValue( BarsSince(BuyPivot)),LastValue(BarsSince(SellPivot))) -BarsSince(C);\r\n//AddColumn( KCFibotime , "KC Fibo Time" , 1 , colorDefault);\t\t\r\n//AddColumn( KCGiatime , "Gia Time" , 1 , colorDefault);\t\t\r\nDvFiboTime = KCFibotime/100;\r\nFibotimeGia =IIf(TrendPivot &gt; 0, KCGiatime/ DvFiboTime,KCGiatime/ DvFiboTime*-1);\r\nAddColumn( FibotimeGia , "FiboTime" , 1 ,  IIf(FibotimeGia&gt; 0, colorGreen, IIf(FibotimeGia &lt; 0, colorRed, colorDefault)));\t\t\r\nAddTextColumn(CanhbaoTh1 , "Tin hieu Fibo", 1.2, Mau2nen , colorDefault);\t\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////\r\nTrenhienthi = IIf(TrendPivot &gt;0,TrendPivot -1, TrendPivot +1);\r\nlaytexthienthi ="Pivot: "+LastValue(TrendPivot)+" // " +LastValue(TanggiamPivot)+"%" + "\\n   "+"                   Fibo: " + prec(LastValue(FiboCl),0)+"%" + "\\n   "+"                   Fibo Time:" +prec(LastValue(FibotimeGia),0)+"%"  ;\r\ncline=ParamToggle("Gia Nen", "Show|Hide",0);\r\nPriceLineColor=ParamColor("PriceLineColor",colorRed|styleNoLabel);\r\nPriceLevel = LastValue( Prec(Close,2));\r\nDaysback    = Param("Bars Back",100,10,500,1); \r\nFirstBar    = BarCount - DaysBack; \r\nYY          = IIf(BarIndex() &gt;= Firstbar,EndValue(PriceLevel),Null); \r\nside = Param("side",1,0,1000,1);\r\ndist = 0; \r\nif(cline==0)\r\n{\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{\r\n if(i+side== BarCount) PlotText( "........."+"      =&gt;   " + PriceLevel[ i ]+" // " +WriteVal(LastValue((C/Ref(C,-1)-1)*100),1.2)+"% ", i, YY[ i ]-dist[i], colorYellow );\r\n if(i+side== BarCount) PlotText( "\\n                      "+laytexthienthi+"", i, YY[ i ]-dist[i], colorWhite ); \r\n}\r\n}\r\n\r\n//Tu ve Fibo theo Pivot\r\nLevel0 \t\t=IIf(TrendPivot &gt;0,LowPivot,HighPivot); \r\nLevel6 \t= IIf(TrendPivot &gt; 0 ,HighPivot,LowPivot);\r\ndonviFibo = (Level6 - Level0)/100;\r\nLevel1 = Level0 + 23.6*donviFibo;\r\nLevel2 = Level0 + 38.2*donviFibo;\r\nLevel3 = Level0 + 50*donviFibo;\r\nLevel4 = Level0 + 61.8*donviFibo;\r\nLevel5 = Level0 + 78.6*donviFibo;\r\nLevel7 = Level0 + 127.2*donviFibo;\r\nLevel8 = Level0 + 161.8*donviFibo;\r\nLevel9 = Level0 + 200*donviFibo;\r\nLevel0name = "0%";\r\nLevel1name = WriteIf(LastValue(TrendPivot) &gt;0,"23.6%","-23.6%");\r\nLevel2name = WriteIf(LastValue(TrendPivot) &gt;0,"38.2%","-38.2%");\r\nLevel3name = WriteIf(LastValue(TrendPivot) &gt;0,"50%","-50%");\r\nLevel4name = WriteIf(LastValue(TrendPivot) &gt;0,"61.8%","-61.8%");\r\nLevel5name = WriteIf(LastValue(TrendPivot) &gt;0,"78.6%","-78.6%");\r\nLevel6name = WriteIf(LastValue(TrendPivot) &gt;0,"100%","-100%");\r\nLevel7name = WriteIf(LastValue(TrendPivot) &gt;0,"127.2%","-127.2%");\r\nLevel8name = WriteIf(LastValue(TrendPivot) &gt;0,"161.8%","-161.8%");\r\nLevel9name = WriteIf(LastValue(TrendPivot) &gt;0,"200%","-200%");\r\nChieudaibentrai = -1;\r\nNenmua = LastValue(ValueWhen(BuyPivot, Ref(BarIndex(),Chieudaibentrai)));\r\nNenban = LastValue(ValueWhen(SellPivot, Ref(BarIndex(),Chieudaibentrai)));\r\naaaa =Min(Nenmua,Nenban);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level0),Null),Level0name,colorWhite ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level1),Null),Level1name,colorLightBlue ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level2),Null),Level2name,colorRed ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level3),Null),Level3name,colorBrightGreen ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level4),Null),Level4name,colorBlue ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level5),Null),Level5name,colorYellow ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level6),Null),Level6name,colorBrightGreen ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level7),Null),Level7name,colorWhite ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level8),Null),Level8name,colorLightBlue ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level9),Null),Level9name,colorRed ,styleThick);\r\n\r\nKCbenphai = 1;\r\nPlotText(""+Prec(LastValue(Level0),2), BarCount + KCbenphai, LastValue(Level0), colorWhite); //Ben phai\r\nPlotText(""+Prec(LastValue(Level1),2), BarCount + KCbenphai, LastValue(Level1), colorLightBlue); //Ben phai\r\nPlotText(""+Prec(LastValue(Level2),2), BarCount + KCbenphai, LastValue(Level2), colorRed); //Ben phai\r\nPlotText(""+Prec(LastValue(Level3),2), BarCount + KCbenphai, LastValue(Level3), colorBrightGreen); //Ben phai\r\nPlotText(""+Prec(LastValue(Level4),2), BarCount + KCbenphai, LastValue(Level4), colorBlue); //Ben phai\r\nPlotText(""+Prec(LastValue(Level5),2), BarCount + KCbenphai, LastValue(Level5), colorYellow); //Ben phai\r\nPlotText(""+Prec(LastValue(Level6),2), BarCount + KCbenphai, LastValue(Level6), colorBrightGreen); //Ben phai\r\nPlotText(""+Prec(LastValue(Level7),2), BarCount + KCbenphai, LastValue(Level7), colorWhite); //Ben phai\r\nPlotText(""+Prec(LastValue(Level8),2), BarCount + KCbenphai, LastValue(Level8), colorLightBlue); //Ben phai\r\nPlotText(""+Prec(LastValue(Level9),2), BarCount + KCbenphai, LastValue(Level9), colorRed); //Ben phai\r\n\r\nKCbentrai = -2;\r\nPlotText(Level0name, aaaa + KCbentrai, LastValue(Level0),  colorWhite); // Ben trai\r\nPlotText(Level1name, aaaa + KCbentrai, LastValue(Level1),  colorLightBlue); // Ben trai\r\nPlotText(Level2name, aaaa + KCbentrai, LastValue(Level2),  colorRed); // Ben trai\r\nPlotText(Level3name, aaaa + KCbentrai, LastValue(Level3),  colorBrightGreen); // Ben trai\r\nPlotText(Level4name, aaaa + KCbentrai, LastValue(Level4),  colorBlue); // Ben trai\r\nPlotText(Level5name, aaaa + KCbentrai, LastValue(Level5),  colorYellow); // Ben trai\r\nPlotText(Level6name, aaaa + KCbentrai, LastValue(Level6),  colorBrightGreen); // Ben trai\r\nPlotText(Level7name, aaaa + KCbentrai, LastValue(Level7),  colorWhite); // Ben trai\r\nPlotText(Level8name, aaaa + KCbentrai, LastValue(Level8),  colorLightBlue); // Ben trai\r\nPlotText(Level9name, aaaa + KCbentrai, LastValue(Level9),  colorRed); // Ben trai\r\n\r\nFilter = MA(C,20) &gt;=3  AND dieukienbb&gt;=2  AND Dieukienthoigianvanhanh&gt;=2 AND FibotimeGia&gt;=23.6 AND FiboCl &gt;=23.6 AND FiboCl &lt;=38.2;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Pivots and Fibonacci vung mua 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>536870923</MoreFlags>
			<Min>8.885</Min>
			<Max>25.9109</Max>
		</Pane>
		<Pane>
			<ChartID>1128</ChartID>
			<PercentHeight>20</PercentHeight>
			<Formula>_SECTION_BEGIN( "Impulse MACD" );\r\n/// @link https://www.tradingview.com/script/qt6xLfLi-Impulse-MACD-LazyBear/\r\n/// Impulse MACD is a modified MACD, formed by filtering out the values in a MA range\r\n/// (region between MAs of high and low), thereby reducing whipsaw typical in a sideways\r\n/// market. \r\n///\r\n\r\n/// SMMA - SMoothed moving average i.e. wilders\r\nfunction calc_smma( src, length )\r\n{\r\n    return Wilders( src, length );\r\n}\r\n\r\nfunction calc_zlema( src, length )\r\n{\r\n    ema1 = EMA( src, length );\r\n    ema2 = EMA( ema1, length );\r\n    diff = ema1 - ema2;\r\n    result = ema1 + diff;\r\n    return result;\r\n}\r\n\r\nsrc = ParamField("Price", 4);\r\nlengthMA = Param( "length MA", 34, 1, 50, 1 );\r\nlengthSignal = Param( "length Signal", 9, 1, 50, 1 );\r\nparamvalues = _PARAM_VALUES();\r\nlinewidth = Param( "Line width", 3, 1, 5, 1 );\r\n\r\n// change indicator Impulse MACD default display to line instead of histogram\r\n// select histogram to display like LazyBear's\r\nisMACDhistogram = ParamToggle( "Plot Impulse MACD as", "Line|Histogram", 0 );\r\nshow_plot = ParamList( "Show Plot", "Impulse MACD|Impulse w/o histo|Price Chart", 0 );\r\nPriceChartStyle = ParamStyle( "Price Chart Style" );\r\n\r\nhi = calc_smma( high, lengthMA );\r\nlo = calc_smma( low, lengthMA );\r\nmi = calc_zlema( src, lengthMA );\r\n\r\nmd = IIf( mi &gt; hi, ( mi - hi ), IIf( ( mi &lt; lo ), ( mi - lo ),  0 ) );\r\nsb = ma( md, lengthSignal );\r\nsh = md - sb;\r\nmdc = IIf( src &gt; mi, IIf( src &gt; hi, colorLime, colorGreen ), IIf( src &lt; lo, colorRed, colorOrange ) );\r\n\r\nif( show_plot == "Price Chart" )\r\n{\r\n    SetChartOptions( 1, chartShowArrows | chartShowDates );\r\n    mode_candle = ( GetPriceStyle() &amp; styleCandle ) == styleCandle;\r\n    pricestyle = PriceChartStyle | GetPriceStyle();\r\n    Color_outline = mdc;\r\n    Color_fill = IIf( mode_candle, IIf( C &gt; O, GetChartBkColor(), Color_outline ), Color_outline );\r\n\r\n    SetBarFillColor( Color_fill );\r\n    Plot( C, "Close", Color_outline, pricestyle, Null, Null, 0, 0, linewidth );\r\n    Plot( hi, "Hi", colorAqua, styleLine, Null, Null, 0, 1, linewidth );\r\n    Plot( lo, "Lo", colorAqua, styleLine, Null, Null, 0, 1, linewidth );\r\n    Plot( mi, "Mi", colorBlue, styleLine, Null, Null, 0, 1, linewidth );\r\n}\r\nelse\r\n{\r\n    SetChartOptions( 1, !chartShowDates );\r\n    PlotGrid( 0, colorGrey40, 9, 2, True );\r\n\r\nplot( IIf( isMACDhistogram, md, Null ), "", mdc, styleHistogram | stylenolabel, Null, Null, 0, -2, linewidth );\r\nplot( md, "ImpulseMACD" + paramvalues, mdc, styleLine, Null, Null, 0,  0, linewidth );\r\nplot( sb, "ImpulseMACDSignal", colorBrown, styleLine, Null, Null, 0, 0, linewidth );\r\n\r\nif( show_plot != "Impulse w/o histo" )\r\n    plot( sh, "ImpulseHisto", colorBlue, stylehistogram, Null, Null, 0, -1, linewidth );\r\n\r\n}\r\n_SECTION_END();\r\n\r\nPlot(0.7, "20", colorRed, styleThick|styleNoLabel);  // Qua mua\r\nPlot(-0.7, "70", colorGreen, styleThick|styleNoLabel); // Qua ban\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\ImPulse MACD RIM  1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>536870913</MoreFlags>
			<Min>-1.86246</Min>
			<Max>2.23351</Max>
		</Pane>
		<Pane>
			<ChartID>1129</ChartID>
			<PercentHeight>20</PercentHeight>
			<Formula>func1 =rsi() ;\r\nPlot(func1, _DEFAULT_NAME(),colorRED,\r\nParamStyle( "Style", styleline )\r\n);\r\nbi=BarIndex();\r\n_SECTION_BEGIN(" ");\r\nH= O;\r\nL=ValueWhen(HHV(H,14),H,2);\r\nSetBarsRequired(sbrAll,sbrAll);\r\nxx = Cum(1);\r\nnbar = PARAM("nbar",30,1,50,2); \r\npk=phigh=H&gt;Ref(HHV(H,nbar),-1) AND Ref(HHV(H,nbar),nbar)&lt;=H;\r\ntr=plow=L&lt;Ref(LLV(L,nbar),-1) AND Ref(LLV(L,nbar),nbar)&gt;=L;\r\n\r\n    px0=ValueWhen(pk,bi,0); tx0=ValueWhen(tr,bi,0);\r\npx1=ValueWhen(pk,bi,1); tx1=ValueWhen(tr,bi,1);\r\npx2=ValueWhen(pk,bi,2); tx2=ValueWhen(tr,bi,2);\r\nph0=ValueWhen(pk,H,0); tl0=ValueWhen(tr,L,0);\r\nph1=ValueWhen(pk,H,1); tl1=ValueWhen(tr,L,1);\r\nph2=ValueWhen(pk,H,2); tl2=ValueWhen(tr,L,2);\r\n\r\nll=tr AND tl1&lt;tl2;\r\nhl=tr AND tl1&gt;tl2;\r\nhh=pk AND ph1&gt;ph2;\r\nlh=pk AND ph1&lt;ph2;\r\ndt=pk AND ph1==ph2;\r\ndb=tr AND tl1==tl2;\r\n\r\n// lower trendline, segment 1: between fractal points\r\nstartval_L = ValueWhen(PLow,L,1); \r\nendval_L = ValueWhen(PLow,L,0); \r\nstartbar_L = ValueWhen(PLow,xx,1); \r\nendbar_L = ValueWhen(PLow,xx,0); \r\naa_L = (endval_L-startval_L)/(endbar_L-startbar_L);\r\nbb_L = startval_L;\r\ntrendline_L = aa_L * (xx - startbar_L) + bb_L;\r\n// slope calculations for display purpose only\r\ndtrendline_L = trendline_L - Ref(trendline_L,-1);\r\n\r\n\r\n// upper trendline, segment 1: between fractal points\r\nstartval_H = ValueWhen(PHigh,H,1); \r\nendval_H = ValueWhen(PHigh,H,0); \r\nstartbar_H = ValueWhen(PHigh,xx,1); \r\nendbar_H = ValueWhen(PHigh,xx,0); \r\naa_H = (endval_H-startval_H)/(endbar_H-startbar_H);\r\nbb_H = startval_H;\r\ntrendline_H = aa_H * (xx - startbar_H) + bb_H; \r\n// slope calculations for display purpose only\r\ndtrendline_H = trendline_H - Ref(trendline_H,-1);\r\n\r\n_SECTION_END();\r\n\r\n\r\n_SECTION_BEGIN("rsidiv");\r\nH= rsi();\r\nL=ValueWhen(HHV(H,14),H,2);\r\nSetBarsRequired(sbrAll,sbrAll);\r\nxx = Cum(1);\r\n\r\n// define fractals\r\npkm=PHighM = H &gt; Ref(HHV(H,nbar),-1) AND Ref(HHV(H,nbar),nbar) &lt;= H;\r\nPHighPrice = ValueWhen(PHighM,H);\r\ntrm=PLowM = L &lt; Ref(LLV(L,nbar),-1) AND Ref(LLV(L,nbar),nbar) &gt;= L;\r\nPLowPrice = ValueWhen(PLowM,L); \r\n    px0=ValueWhen(pkm,bi,0); txm0=ValueWhen(trm,bi,0);\r\npxm1=ValueWhen(pkm,bi,1); txm1=ValueWhen(trm,bi,1);\r\npxm2=ValueWhen(pkm,bi,2); txm2=ValueWhen(trm,bi,2);\r\nphm0=ValueWhen(pkm,H,0); tlm0=ValueWhen(trm,L,0);\r\nphm1=ValueWhen(pkm,H,1); tlm1=ValueWhen(trm,L,1);\r\nphm2=ValueWhen(pkm,H,2); tlm2=ValueWhen(trm,L,2);\r\n// lower trendline, segment 1: between fractal points\r\nstartval_L1 = ValueWhen(PLowM,L,1); \r\nendval_L1 = ValueWhen(PLowM,L,0); \r\nstartbar_L1 = ValueWhen(PLowM,xx,1); \r\nendbar_L1 = ValueWhen(PLowM,xx,0); \r\naa_L1 = (endval_L1-startval_L1)/(endbar_L1-startbar_L1);\r\nbb_L1 = startval_L1;\r\ntrendline_L1 = aa_L1 * (xx - startbar_L1) + bb_L1;\r\n// slope calculations for display purpose only\r\ndtrendline_L1 = trendline_L1 - Ref(trendline_L1,-1);\r\n// lower extended trendline, segment 2: extend segment 1 to next fractals pivot \r\nstartval_L_extend = ValueWhen(PLowm,L,2); \r\nendval_L_extend = ValueWhen(PLowm,L,1); \r\nstartbar_L_extend = ValueWhen(PLowm,xx,2); \r\nendbar_L_extend = ValueWhen(PLowm,xx,1); \r\naa_L_extend = (endval_L_extend-startval_L_extend)/(endbar_L_extend-startbar_L_extend);\r\nbb_L_extend = startval_L1;\r\ntrendline_L_extend = aa_L_extend * (xx - startbar_L1) + endval_L_extend; \r\n// slope calculations for display purpose only\r\ndtrendline_L_extend = trendline_L_extend - Ref(trendline_L_extend,-1);\r\ndtrendline_L_extend = IIf(PLowm,Ref(dtrendline_L1,-1),dtrendline_L_extend);\r\n\r\n// lower extended trendline, segment 3: extend segment 2 nbars past the fractal pivot\r\nstartval_L_extend2 = ValueWhen(PLowm,L,3); \r\nendval_L_extend2 = ValueWhen(PLowm,L,2); \r\nstartbar_L_extend2 = ValueWhen(PLowm,xx,3); \r\nendbar_L_extend2 = ValueWhen(PLowm,xx,2); \r\naa_L_extend2 = (endval_L_extend2-startval_L_extend2)/(endbar_L_extend2-startbar_L_extend2);\r\nbb_L_extend2 = endval_L_extend2;\r\ntrendline_L_extend2 = aa_L_extend2 * (xx - endbar_L_extend2) + endval_L_extend2; \r\n// slope calculations for display purpose only\r\ndtrendline_L_extend2 = trendline_L_extend2 - Ref(trendline_L_extend2,-1);\r\ndtrendline_L_extend2 = IIf(PLowm,Ref(dtrendline_L_extend,-1),dtrendline_L_extend2);\r\n// upper trendline, segment 1: between fractal points\r\nstartval_H1 = ValueWhen(PHighM,H,1); \r\nendval_H1 = ValueWhen(PHighM,H,0); \r\nstartbar_H1 = ValueWhen(PHighM,xx,1); \r\nendbar_H1 = ValueWhen(PHighM,xx,0); \r\naa_H1 = (endval_H1-startval_H1)/(endbar_H1-startbar_H1);\r\nbb_H1 = startval_H1;\r\ntrendline_H1 = aa_H1 * (xx - startbar_H1) + bb_H1; \r\n// slope calculations for display purpose only\r\ndtrendline_H1 = trendline_H1 - Ref(trendline_H1,-1);\r\n// upper extended trendline, segment 2: extend segment 1 to next fractals pivot \r\nstartval_H_extend = ValueWhen(PHighm,H,2); \r\nendval_H_extend = ValueWhen(PHighm,H,1); \r\nstartbar_H_extend = ValueWhen(PHighm,xx,2); \r\nendbar_H_extend = ValueWhen(PHighm,xx,1); \r\naa_H_extend = (endval_H_extend-startval_H_extend)/(endbar_H_extend-startbar_H_extend);\r\nbb_H_extend = startval_H1;\r\ntrendline_H_extend = aa_H_extend * (xx - startbar_H1) + endval_H_extend; \r\n// slope calculations for display purpose only\r\ndtrendline_H_extend = trendline_H_extend - Ref(trendline_H_extend,-1);\r\ndtrendline_H_extend = IIf(PHighm,Ref(dtrendline_H1,-1),dtrendline_H_extend);\r\n\r\n// upper extended trendline, segment 3: extend segment 2 nbars past the fractal pivot\r\nstartval_H_extend2 = ValueWhen(PHighm,H,3); \r\nendval_H_extend2 = ValueWhen(PHighm,H,2); \r\nstartbar_H_extend2 = ValueWhen(PHighm,xx,3); \r\nendbar_H_extend2 = ValueWhen(PHighm,xx,2); \r\naa_H_extend2 = (endval_H_extend2-startval_H_extend2)/(endbar_H_extend2-startbar_H_extend2);\r\nbb_H_extend2 = endval_H_extend2;\r\ntrendline_H_extend2 = aa_H_extend2 * (xx - endbar_H_extend2) + endval_H_extend2; \r\n// slope calculations for display purpose only\r\ndtrendline_H_extend2 = trendline_H_extend2 - Ref(trendline_H_extend2,-1);\r\ndtrendline_H_extend2 = IIf(PHighm,Ref(dtrendline_H_extend,-1),dtrendline_H_extend2);\r\n//Plot(trendline_L, "\\nLower Trendline", colorBrightGreen,styleLine);\r\n// segment 2, grey dots unconfirmed trend, green confirmed trend\r\ntrendline_L_extend0=IIf(BarsSince(Plowm) &lt;= nbar,trendline_L_extend,Null);\r\ntrendline_L_extend1=IIf(BarsSince(Plowm) &gt; nbar,trendline_L_extend,Null);\r\ntrendline_L_extend2=IIf(BarsSince(Plowm) &lt;= nbar,trendline_L_extend2,Null);\r\nl_extend=trendline_L_extend0+trendline_L_extend1+trendline_L_extend2;\r\nPlot(IIf(BarsSince(Plowm) &lt;= nbar,trendline_L_extend,Null), "", colorLightGrey,styleLine | styleDashed);///ho tro\r\nPlot(IIf(BarsSince(Plowm) &gt; nbar,trendline_L_extend,Null), "",colorDarkGreen, styleLine | styleDASHED );\r\n// segment 3\r\nPlot(IIf(BarsSince(Plowm) &lt;= nbar,trendline_L_extend2,Null), "",colorDarkGreen,styleLine | styledashed| styleThick);\r\n// segment 1\r\n//Plot(trendline_H, "\\nUpper Trendline", colorRed,styleLine);\r\n// segment 2, grey dots unconfirmed trend, green confirmed trend\r\ntrendline_H_extend0=IIf(BarsSince(PHighm) &lt;= nbar,trendline_H_extend,Null);\r\ntrendline_H_extend1=IIf(BarsSince(PHighm) &gt; nbar,trendline_H_extend,Null);\r\ntrendline_H_extend2=IIf(BarsSince(PHighm) &lt;= nbar,trendline_H_extend2,Null);\r\nH_extend=trendline_H_extend0+trendline_H_extend1+trendline_H_extend2;\r\nPlot(IIf(BarsSince(PHighm) &lt;= nbar,trendline_H_extend,Null), "", colorLightGrey, styleLine | styleDASHED );\r\nPlot(IIf(BarsSince(PHighm) &gt; nbar,trendline_H_extend,Null), "",colorOrange, styleLine | styleDASHED);\r\n// segment 3\r\nPlot(IIf(BarsSince(PHighm) &lt;= nbar,trendline_H_extend2,Null), "",colorOrange, styleLine | styleDashed | styleThick);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\nFHPDIV=IIf(dtrendline_L&lt;0 AND dtrendline_L1&lt;0 ,1,0); \r\nHTHB=IIf(dtrendline_L&gt;0 AND dtrendline_L1&gt;0 ,1,0); \r\n\r\nHPDIV=IIf(dtrendline_L&gt;0 AND dtrendline_L1&lt;0 ,1,0); \r\nFHNDIV=iif(dtrendline_H&gt;0 AND dtrendline_h1&gt;0 ,1, 0);\r\nLTLB=iif(dtrendline_H&lt;0 AND dtrendline_h1&lt;0 ,1, 0);\r\n\r\nHNDIV=iif(dtrendline_H&lt;0 AND dtrendline_h1&gt;0 ,1, 0);\r\nSPDIV=IIf(dtrendline_L&lt;0 AND dtrendline_L1&gt;0 ,1, 0)   ; \r\n\r\nSNDIV=iif(dtrendline_H&gt;0 AND dtrendline_h1&lt;0 ,1, 0) ;\r\nNDIV=LTLB OR  sndiv OR  hndiv OR   fhndiv;\r\nPDIV=HTHB  OR  spdiv OR  hpdiv OR  fhpdiv;\r\ncolor=IIf(SPDIV ,colorBRIGHTGreen,IIf(FHPDIV ,colorBLUE , IIf(HPDIV ,colorYELLOW, IIf(HTHB ,colorWHITE,NULL)))); \r\ncolor1=iif(SNDIV ,colorRED,IIf(FHNDIV ,colorBLUE , IIf(HNDIV ,colorYELLOW,IIf(LTLB ,colorWHITE,NULL)))); \r\n\r\n\r\n\r\n// segment 1\r\nPlot(trendline_L1, "\\nLower Trendline", color,styleLine|styleThick|styleNoRescale);\r\n// segment 1\r\nPlot(trendline_H1, "\\nUpper Trendline", color1,styleLine|styleTHICK|styleNoRescale);\r\ntit="";\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\RSI Phan ky 2 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>805306369</MoreFlags>
			<Min>-11.3801</Min>
			<Max>86.2779</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 2</Name>
		<Pane>
			<ChartID>1120</ChartID>
			<PercentHeight>32</PercentHeight>
			<Formula>_SECTION_BEGIN("Price");\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\n_N(Title = StrFormat("{{NAME}} - {{INTERVAL}} {{DATE}} Open %g, Hi %g, Lo %g, Close %g (%.1f%%) {{VALUES}}", O, H, L, C, SelectedValue( ROC( C, 1 ) ) ));\r\nPlot( C, "Close", ParamColor("Color", colorDefault ), styleNoTitle | ParamStyle("Style") | GetPriceStyle() ); \r\n_SECTION_END();\r\n\r\nRequestTimedRefresh (1);\r\nGraphXSpace=15;\r\n_SECTION_BEGIN("Haiken"); Candle=ParamList("Candle","Heikin Ashi,Normal Candlestick",0);\r\n\r\nif(Candle=="Heikin Ashi")\r\n{\r\nHaClose = (O + H + L + C)/4; \r\nHaOpen = AMA( Ref( HaClose, -1 ), 0.5 ); \r\nHaHigh = Max( H, Max( HaClose, HaOpen ) ); \r\nHaLow = Min( L, Min( HaClose, HaOpen ) ); \r\n//xDiff = (HaHigh - Halow) * 10000;\r\nbarcolor = IIf(HaClose &gt;= HaOpen,colorBrightGreen,colorRed);\r\nbarcolor1 = IIf(HaClose &gt;= HaOpen,colorGreen,colorDarkRed);\r\nSetBarFillColor(barcolor1 );\r\nPlotOHLC( HaOpen, HaHigh, HaLow, HaClose, "", barcolor, styleCandle );\r\n}\r\nif(Candle=="Normal Candlestick")\r\n{\r\nbarcolor1 = IIf(Close &gt;= Open,colorLime,colorDarkRed);\r\nSetBarFillColor(barcolor1 );\r\nPlot( C, "",IIf( C &lt; O, colorRed, colorBrightGreen ), styleCandle );\r\n}\r\n_SECTION_END();\r\nTitle = GetFnData( "Alias" ) + StrFormat( " Open %g, Hi %g, Lo %g, Close %g (%.1f%%), Vol= %.2f (%.0f%%) {{VALUES}}", O, H, L, C, SelectedValue( ROC( C, 1 ) ),  V/1000, SelectedValue( ROC( V, 1 ) ) ); \r\nyDayH = \tTimeFrameGetPrice("H", inDaily, -1);\t   \t\tyDayHI = LastValue (yDayH,1); \t\t// yesterdays high\r\nyDayL = \tTimeFrameGetPrice("L", inDaily, -1);\t \t\tyDayLI = LastValue (yDayL,1);\t\t\t// yesterdays low\r\nyDayC = \tTimeFrameGetPrice("C", inDaily, -1);\t \t\tyDayCI = LastValue (yDayC,1);\t\t\t// yesterdays close\r\nShow_Day=ParamToggle("Day","No|Yes",1);\r\nif(Show_Day){ \r\nPlot(yDayH  ,"\\nHi", colorRed, styleLine | styleNoRescale );\r\nPlot(yDayL  ,"Lo", colorGreen, styleLine | styleNoRescale );\r\nPlot((yDayL+yDayH+yDayC)/3  ,"Av", colorYellow, styleLine | styleNoRescale);\r\n}\r\nPlot(HMA(C,150),"H1",colorYellow,styleThick|styleDots|styleNoRescale,0,0,0,0,1);\r\n_SECTION_BEGIN("NMA3");\r\n\r\nk3 = 2.2;//Optimize("K",Param("K3",1.85,1,5,0.05),1,5,0.05);//1.85/5\r\n\r\nPer3= 17;//Optimize("atr",Param("atr3",5,3,30,1),3,30,1);\r\n\r\nj=(O+H+L+C)/4;\r\n\r\nnm= (H-L);\r\n\r\nrfsctor = WMA(nm, PER3);\r\n\r\nrevers = K3 * rfsctor;\r\n\r\nTrend3 = 1;\r\n\r\nNW3[0] = 0;\r\n\r\nfor(i = 1; i &lt; BarCount; i++)\r\n\r\n{\r\n\r\nif(Trend3[i-1] == 1)\r\n\r\n{\r\n\r\nif(j[i] &lt; NW3[i-1])\r\n\r\n{\r\n\r\nTrend3[i] = -1;\r\n\r\nNW3[i] = j[i] + Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nTrend3[i] = 1;\r\n\r\nif((j[i] - Revers[i]) &gt; NW3[i-1])\r\n\r\n{\r\n\r\nNW3[i] = j[i] - Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nNW3[i] = NW3[i-1];\r\n\r\n}\r\n\r\n}\r\n\r\n}\r\n\r\nif(Trend3[i-1] == -1)\r\n\r\n{\r\n\r\nif(j[i] &gt; NW3[i-1])\r\n\r\n{\r\n\r\nTrend3[i] = 1;\r\n\r\nNW3[i] = j[i] - Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nTrend3[i] = -1;\r\n\r\nif((j[i] + Revers[i]) &lt; NW3[i-1])\r\n\r\n{\r\n\r\nNW3[i] = j[i] + Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nNW3[i] = NW3[i-1];\r\n\r\n}\r\n\r\n}\r\n\r\n}\r\n\r\n}\r\n\r\nPlot(NW3, "Blue", IIf(Trend3 == 1, colorBlue, colorBlue), 1,0,0,0,0,2);\r\n_SECTION_END();\r\n_SECTION_BEGIN("NMA2");\r\n\r\nk2 = 2.6;//Optimize("K",2.5,2,4,0.05);\r\n\r\nPer2=10;//Optimize("atr",10,5,15,1);\r\n\r\nj=(O+H+L+C)/4;\r\n\r\nnm= (H-L);\r\n\r\nrfsctor = WMA(nm, PER2);\r\n\r\nrevers = K2 * rfsctor;\r\n\r\nTrend2 = 1;\r\n\r\nNW2[0] = 0;\r\n\r\nfor(i = 1; i &lt; BarCount; i++)\r\n\r\n{\r\n\r\nif(Trend2[i-1] == 1)\r\n\r\n{\r\n\r\nif(j[i] &lt; NW2[i-1])\r\n\r\n{\r\n\r\nTrend2[i] = -1;\r\n\r\nNW2[i] = j[i] + Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nTrend2[i] = 1;\r\n\r\nif((j[i] - Revers[i]) &gt; NW2[i-1])\r\n\r\n{\r\n\r\nNW2[i] = j[i] - Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nNW2[i] = NW2[i-1];\r\n\r\n}\r\n\r\n}\r\n\r\n}\r\n\r\nif(Trend2[i-1] == -1)\r\n\r\n{\r\n\r\nif(j[i] &gt; NW2[i-1])\r\n\r\n{\r\n\r\nTrend2[i] = 1;\r\n\r\nNW2[i] = j[i] - Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nTrend2[i] = -1;\r\n\r\nif((j[i] + Revers[i]) &lt; NW2[i-1])\r\n\r\n{\r\n\r\nNW2[i] = j[i] + Revers[i];\r\n\r\n}\r\n\r\nelse\r\n\r\n{\r\n\r\nNW2[i] = NW2[i-1];\r\n\r\n}\r\n\r\n}\r\n\r\n}\r\n\r\n}\r\n\r\n\r\nPlot(NW2, "Pink", IIf(Trend2 == 1, colorCustom12, colorCustom12), 1|styleNoRescale,0,0,0,0,2);\r\nShow_Song=ParamToggle("SongHMA","No|Yes",1);\r\nif(Show_Song){ \r\nPlotOHLC(NW3,NW3,nw2,nw2, "",IIf(nw3&gt;nw2,  colorLime,(IIf(nw3&lt; nw2,  colorLightOrange, colorBlack))), styleCloud | styleClipMinMax |styleNoLabel);\r\n}\r\n_SECTION_END();\r\n_SECTION_BEGIN("Sup");\r\nvar3=(C-LLV(L,17))/(HHV(H,17)-LLV(L,17))*100;\r\nvar4=WMA(var3,10);var5=WMA(var4,3);j=3*var4-2*var5;\r\nsub=LLV(j,17);\r\n_SECTION_END();\r\n_SECTION_BEGIN("RSI");\r\nRP = 12;//Param("RSI",12,7,20,1);\r\nR= RSIa(C, RP);\r\nPeriod1=12;//Param("Period 1", 14, 5, 50, 1); \r\nPeriod2=12;//Param("Period 2", 12, 5, 50, 1);\r\nEMA1= EMA(R,Period1);EMA2= EMA(EMA1,Period2);Difference= EMA1 - EMA2;ZeroLagEMA= EMA1 + Difference;\r\nPRSI=abs(ZeroLagEMA);\r\nExL = Cross(Sub,PRSI) ;//AND Sub&gt;=65; \r\nPlotShapes(shapeCircle *ExL, colorYellow,0,H,12);\r\nSound= ExL;\r\nAlertIf( Sound, "SOUND C:\\\\Windows\\\\Media\\\\Windows Logon", "Sell " + C, 2, 1 + 2, 1 );\r\n\r\n_SECTION_BEGIN("DTM Fibonacci Retracement");\r\n//Plot(C,"", colorWhite,styleCandle); \r\nfibs = ParamToggle("Plot Fibs","Off|On",0);\r\ntext = ParamToggle("Plot Text","Off|On",1);\r\nnbar    = Param("Bars Back",60,10,262,1); \r\nEndBar \t\t= EndValue(BarIndex()); \r\nStartBar\t= EndBar-nbar; // To plot Fibonnaci lines from last 60 bars, this can be customised based on your requirement\r\nStartBar_C \t= Close[StartBar];\r\n\r\ni \t= StartBar; \r\nPrd = EndBar - StartBar; \r\n\r\nLo = LLV(L,Prd); \r\nHi = HHV(H,Prd); \r\nLine0 = Line1 = Line2 = Line3 = Line4 = Line5 = Line100 = 0; \r\n\r\nfor( i = StartBar; i &lt; EndBar; i++ ) \r\n{ \r\nif(EndValue(C)&lt;StartBar_C) \r\n{ \r\nLine0 \t= EndValue(Lo); \r\nLine100 = EndValue(Hi); \r\nLine1 \t= Line0 + abs(Line100-Line0)*0.236; \r\nLine2 \t= Line0 + abs(Line100-Line0)*0.382; \r\nLine3 \t= Line0 + abs(Line100-Line0)*0.5; \r\nLine4 \t= Line0 + abs(Line100-Line0)*0.618; \r\nLine5 \t= Line0 + abs(Line100-Line0)*0.786; \r\n\r\n} \r\nelse \r\n{ \r\nLine100 = EndValue(Lo); \r\nLine0 \t= EndValue(Hi); \r\nLine1 \t= Line0 - abs(Line100-Line0)*0.236; \r\nLine2 \t= Line0 - abs(Line100-Line0)*0.382; \r\nLine3 \t= Line0 - abs(Line100-Line0)*0.5; \r\nLine4 \t= Line0 - abs(Line100-Line0)*0.618; \r\nLine5 \t= Line0 - abs(Line100-Line0)*0.786; \r\n\r\n} \r\n} \r\n\r\n//////////////////////// CONDITIONS /////////////////////////////////\r\n\r\nfib0\t= LineArray(StartBar, Line0, EndBar, Line0, 0, 1); \r\nfib100 \t= LineArray(StartBar, Line100, EndBar, Line100, 0, 1); \r\n\r\n// depth of middle lines \r\nn = round((EndBar-StartBar)/2); \r\n\r\n// middle lines \r\nfib1= LineArray((EndBar-n), Line1, EndBar, Line1, 0, 1);  \r\nfib2= LineArray((EndBar-n), Line2, EndBar, Line2, 0, 1); \r\nfib3= LineArray((EndBar-n), Line3, EndBar, Line3, 0, 1); \r\nfib4= LineArray((EndBar-n), Line4, EndBar, Line4, 0, 1); \r\nfib5= LineArray((EndBar-n), Line5, EndBar, Line5, 0, 1);\r\n\r\nif(fibs==1)\r\n{\r\nPlot(fib0,"", colorWhite,styleNoLabel); \r\nPlot(fib1,"", colorGreen,styleNoLabel); \r\nPlot(fib2,"", colorBlue,styleNoLabel); \r\nPlot(fib3,"", colorGold,styleNoLabel);  \r\nPlot(fib4,"", colorAqua,styleNoLabel); \r\nPlot(fib5,"", colorYellow,styleNoLabel); \r\nPlot(fib100,"", colorRed,styleNoLabel);    \r\n}\r\nif(text==1)\r\n{ \r\nPlotText(" 0.00%= "+ WriteVal(fib0%10000,1.1),EndBar+2, Line0,colorWhite);\r\nPlotText(" 23.6%= "+ WriteVal(fib1%10000,1.1),EndBar+2, Line1,colorGreen);\r\nPlotText(" 38.6%= "+ WriteVal(fib2%10000,1.1),EndBar+2, Line2,colorBlue);\r\nPlotText(" 50%= "+ WriteVal(fib3%10000,1.1),EndBar+2, Line3,colorGold);\r\nPlotText(" 61.8%= "+ WriteVal(fib4%10000,1.1),EndBar+2, Line4,colorAqua);\r\nPlotText(" 78.6%= "+ WriteVal(fib5%10000,1.1),EndBar+2, Line5,colorYellow);\r\nPlotText(" 100%= "+ WriteVal(fib100%10000,1.1),EndBar+2, Line100,colorRed);\r\n}\r\n_SECTION_END();\r\n\r\nGraphXSpace=5;\r\nSetBarsRequired(sbrAll,sbrAll);\r\n \r\n// BUYING VOLUME AND SELLING VOLUME //\r\n_SECTION_BEGIN("B_S Volume");\r\nBV = IIf( (H==L), 0, V*(C-L)/(H-L) );\r\nSV = IIf( (H==L), 0, V*(H-C)/(H-L) );\r\nDV = BV - SV; // Effort Volume\r\ny=-1;\r\nx=Param("x",11,5,20,1);\r\ny1 = y+x;\r\ny2=y1+x;\r\nPlotText( "BS." + "Vol: " +WriteVal(DV,1.0), BarCount+2 , y2,colorGold);\r\nPlotText( "back" + "V: " +WriteVal(Ref(DV,-1),1.0), BarCount+2 , y1,colorGold);\r\nPlotText( "back" + "V: " +WriteVal(Ref(DV,-2),1.0), BarCount+2 , y,colorGold);\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Divergence");\r\nn=6;\r\nBuy=Sell=0;\r\nVar = Zig(RSI(14), n);\r\nt= Trough(RSI(14), n, 1);\r\np= Peak(RSI(14), n, 1);\r\nx[0] =Var[0];\r\nprice[0] = C[0];\r\nj=0;\r\n\r\n// bearish divergence\r\nfor ( i=0; i&lt;BarCount; i++)\r\n{\r\nif(Var[i] == p[i])\r\n{\r\n\r\nj++;\r\nx[j] =Var[i];\r\nprice[j] =C[i];\r\nif(x[j] &lt;x[j-1] &amp;&amp; price[j-1]&lt; price[j])\r\nSell[i] =1;\r\n}\r\n}\r\n\r\n// bullish divergence\r\nfor ( i=0; i&lt;BarCount; i++)\r\n{\r\nif(Var[i] == t[i])\r\n{\r\nj++;\r\nx[j] =Var[i];\r\nprice[j] =C[i];\r\nif(x[j] &gt;x[j-1] &amp;&amp; price[j]&lt;price[j-1])\r\nBuy[i] =1;\r\n}\r\n}\r\n\r\n//Plot(Var, "", 39);\r\nPlotShapes ( IIf(Sell, shapeDigit2, shapeNone), colorYellow);\r\nPlotShapes( IIf(Buy, shapeDigit2, shapeNone), colorBrightGreen,0,0,10);\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Price 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>13.27</Min>
			<Max>25.2798</Max>
		</Pane>
		<Pane>
			<ChartID>1121</ChartID>
			<PercentHeight>68</PercentHeight>
			<Formula>GraphXSpace=5;\r\nSetBarsRequired(sbrAll,sbrAll);\r\n \r\n// BUYING VOLUME AND SELLING VOLUME //\r\n_SECTION_BEGIN("B_S Volume");\r\nBV = IIf( (H==L), 0, V*(C-L)/(H-L) );\r\nSV = IIf( (H==L), 0, V*(H-C)/(H-L) );\r\nDV = BV - SV; // Effort Volume\r\ny=-1;\r\nx=Param("x",11,5,20,1);\r\ny1 = y+x;\r\ny2=y1+x;\r\nPlotText( "BS." + "Vol: " +WriteVal(DV,1.0), BarCount+2 , y2,colorGold);\r\nPlotText( "back" + "V: " +WriteVal(Ref(DV,-1),1.0), BarCount+2 , y1,colorGold);\r\nPlotText( "back" + "V: " +WriteVal(Ref(DV,-2),1.0), BarCount+2 , y,colorGold);\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Divergence");\r\nn=6;\r\nBuy=Sell=0;\r\nVar = Zig(RSI(14), n);\r\nt= Trough(RSI(14), n, 1);\r\np= Peak(RSI(14), n, 1);\r\nx[0] =Var[0];\r\nprice[0] = C[0];\r\nj=0;\r\n\r\n// bearish divergence\r\nfor ( i=0; i&lt;BarCount; i++)\r\n{\r\nif(Var[i] == p[i])\r\n{\r\n\r\nj++;\r\nx[j] =Var[i];\r\nprice[j] =C[i];\r\nif(x[j] &lt;x[j-1] &amp;&amp; price[j-1]&lt; price[j])\r\nSell[i] =1;\r\n}\r\n}\r\n\r\n// bullish divergence\r\nfor ( i=0; i&lt;BarCount; i++)\r\n{\r\nif(Var[i] == t[i])\r\n{\r\nj++;\r\nx[j] =Var[i];\r\nprice[j] =C[i];\r\nif(x[j] &gt;x[j-1] &amp;&amp; price[j]&lt;price[j-1])\r\nBuy[i] =1;\r\n}\r\n}\r\n\r\n//Plot(Var, "", 39);\r\nPlotShapes ( IIf(Sell, shapeDigit2, shapeNone), colorYellow);\r\nPlotShapes( IIf(Buy, shapeDigit2, shapeNone), colorBrightGreen,0,0,10);\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("ADX");\r\nrange = Optimize("DI", 17, 8, 26, 1 );\r\nrangeADX = Optimize("ADX", 14, 14, 26, 1 );\r\nColor = IIf(ROC(ADX(rangeADX),1) &gt;= 0 AND PDI(RANGE)&gt;=MDI(RANGE), colorBlue, IIf(ROC(ADX(rangeADX),1) &gt;= 0 AND PDI(RANGE)&lt;=MDI(RANGE),colorRed, colorWhite));\r\nPlot( PDI(range), "+DI", ParamColor( "+DI color", colorBrightGreen), styleDots );\r\nPlot( MDI(range), "-DI", ParamColor( "-DI color", colorCustom12 ), styleDots );\r\nPlot( ADX(rangeADX), _DEFAULT_NAME(), Color , ParamStyle("ADX style", styleThick ) );\r\nPlotOHLC( 0, ADX(rangeADX),0, ADX(rangeADX), "", IIf(PDI(range)&lt;MDI(range) , colorBrown, IIf(PDI(range)&gt;MDI(range), colorGreen, colorDarkGrey)), styleCloud|styleNoLabel);\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\F1-ADX_M5 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>-1.84435</Min>
			<Max>39.9485</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 3</Name>
		<Pane>
			<ChartID>1122</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>_SECTION_BEGIN("So Sanh Vni");\r\nchuky=50;//thay doi chu ky theo so ngay giam gia VNI\r\nFc=Foreign("VNINDEX","Close");\r\nrocvni=ROC(Fc,chuky);\r\nrocstock=ROC(C,chuky);\r\ndkroc=WriteIf(rocstock&gt;rocvni,"Tang Toc","Giam Toc");\r\nFilter =1;\r\nAddColumn(C,"GIA",1.2,colorBlack,colorDefault,60);\r\n AddColumn(V,"VOLUME",1,colorBlack,colorDefault,90);\r\n AddColumn(C*V,"GIA TRI GD ",1,colorBlack,colorDefault,90);\r\n AddColumn(ROC(C,1),"%TG ",1.2,colorBlack,colorDefault,60);\r\nAddtextColumn(dkroc,"So Sanh Vni",1.0,colorBlack,IIf(rocstock&gt;rocvni,colorLime,colorDefault),60);\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\So Sanh Vni 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1879048193</MoreFlags>
			<Min>0</Min>
			<Max>0</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 4</Name>
		<Pane>
			<ChartID>1123</ChartID>
			<PercentHeight>100</PercentHeight>
			<Formula>//Color = ParamColor("Color", ColorRGB(52,52,52) );\r\n//setChartBkColor(Color);\r\nGraphXSpace = Param("Zoom",2,1);\r\n/////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n// 06. mark minervini – trend template (use EMA&gt;MA) p.79\r\n{\r\nMA10=EMA(C,10);\r\nMA20 = EMA(C,20);\r\nMA50 = EMA(C,50);\r\nMA150 = EMA(C,150);\r\nMA200 = EMA(C,200);\r\nYrLo = LLV(L,240);\r\nYrHi = HHV(H,240);\r\nCon1 = C&gt;MA150 AND C&gt;MA200;\r\nCon2 = MA150&gt;MA200;\r\nCon3 = MA200&gt;Ref(MA200,-20);\r\nCon4 = MA50&gt;MA150 AND MA50&gt;MA200;\r\nCon5 = C&gt;MA50;\r\nCon6 = C&gt;1.3*YrLo;\r\nCon7 = C&gt;0.75*YrHi;\r\ntr3m = 0.4*(((C-Ref(C,-60))/Ref(C,-60))*100);\r\ntr6m = 0.2*(((C-Ref(C,-120))/Ref(C,-130))*100);\r\ntr9m = 0.2*(((C-Ref(C,-180))/Ref(C,-180))*100);\r\ntr12m = 0.2*(((C-Ref(C,-240))/Ref(C,-240))*100);\r\nIBDrs = tr3m + tr6m + tr9m + tr12m;\r\nBull = Con1 AND Con2 AND Con3 AND Con4 AND Con5 AND Con6 AND Con7;\r\nbigwhite = C&gt;Ref(C,-1) AND C&gt;O AND C&gt;L+(0.75*(H-L)) AND (H-L)&gt;ATR(10);\r\nset = Foreign("set","c",True);\r\nrs = C/set;\r\nrsma = EMA(rs,5);\r\ndiff = rs-rsma;\r\ndiffpct = (diff/rsma)*100;\r\n//plots\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nbullcolor=colorGreen;\r\nnotbullcolor=colorRed;\r\n//SetBarFillColor( IIf(C&gt;O,ColorRGB(81,100,230), ColorRGB(255,74,74)) ); \r\nPlot(C,"Mark Minervini’s Trading System",IIf(Bull,ColorRGB(81,100,230), ColorRGB(255,74,74)),styleCandle);\r\nPlot(MA10,"",colorOrange);\r\nPlot(MA20,"",colorGreen);\r\nPlot(MA50,"",colorBrown);\r\nPlot(MA150,"",colorDarkYellow,styleLine,Null,Null,0,0,2);\r\nPlot(MA200,"",colorGrey40,styleLine,Null,Null,0,0,2);\r\n//Plot(MA150,"",colorBlue);\r\n//Plot(MA200,"",colorDarkBlue);\r\nPlot(YrHi,"1 Year High",colorGreen,styleDashed,Null,Null,0,0,2);\r\nPlot(0.75*YrHi,"",colorBlue,styleDashed);\r\nPlot(YrLo,"1 Year Low",colorRed,styleDashed,Null,Null,0,0,2);\r\nPlot(1.3*YrLo,"",colorRed,styleDashed);\r\n//Plot(IBDrs,"IBD RS" ,colorGrey50,styleLine|styleOwnScale) ;\r\n//PlotShapes(Buy*shapeUpArrow,colorGreen,0,L,-20);\r\n//PlotShapes(Sell*shapeDownArrow,colorRed,0,H,-20);\r\n// Explorer = 1 month stronger than SET + Value that than more than 5M\r\nBullstarus=WriteIf(Bull,"Bull","");\r\nHiVal = V*C&gt;5000000;\r\nFilter = Bull AND HiVal AND StrLen(Name())&lt;=6 AND StrRight(Name(),2)!="-F" AND StrRight(Name(),2)!="-P";\r\nAddColumn(Close,"Close");\r\nAddColumn(Volume,"Volume");\r\nAddColumn(V*C,"Trading Value");\r\nAddColumn(IBDrs,"IBD RS (higher = better)",1.0);\r\nAddColumn(diffpct,"% RS EMA",1.2);\r\nAddColumn(bigwhite,"big white",1.0);\r\nSetSortColumns(-6);\r\n}\r\n\r\n//10. Title\r\n{\r\nChg=Ref(C,-1);\r\nTitle =WriteIf(Bull,EncodeColor(ColorRGB(81,100,230)),EncodeColor(ColorRGB(255,74,74)))+"Mark Minervini’s Trading System"+"("+Title =Name()+") - " + " " + EncodeColor\r\n(colorOrange) + "Date :: "  + Date() +WriteIf(C&gt;O,EncodeColor(colorGreen),WriteIf(C&lt;O,EncodeColor(colorRed),EncodeColor(colorBlack))) +  "  {{INTERVAL}}  " +\r\n   EncodeColor(colorBlue)+ "   Open:  "+ EncodeColor(colorBlack)+ WriteVal(O,format=1.2) + \r\n   EncodeColor(colorBlue)+ "   High:  "+ EncodeColor(colorBlack) + WriteVal(H,format=1.2) +\r\n   EncodeColor(colorBlue)+ "   Low:  "+ EncodeColor(colorBlack)+ WriteVal(L,format=1.2) + \r\n   EncodeColor(colorBlue)+ "   Close:  "+ WriteIf(C&gt; Chg,EncodeColor(colorGreen),EncodeColor\r\n\r\n(colorRed))+ WriteVal(C,format=1.2)+  \r\n   EncodeColor(colorBlue)+ "   Change:  "+ WriteIf(C&gt; Chg,EncodeColor(colorGreen),EncodeColor(colorRed))+ WriteVal(ROC(C,1),format=1.2)+ "%"+\r\n   EncodeColor(colorBlue)+ "   Volume: "+ EncodeColor(colorBlack)+ WriteVal(V,1)+\r\n   EncodeColor(colorBlue)+ "   GTGD: "+ EncodeColor(colorBlack)+ WriteVal(V*C,1)\r\n ;\r\n}\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////\r\n\r\n//10. NAME AND FULL NAME//CLICK DAU CONG DE MO RONG CODE\r\n  {\r\n_SECTION_BEGIN("NAME AND FULL NAME");\r\n  GfxSetOverlayMode(0);\r\nGfxSelectFont("Arial",30, 500);\r\nGfxSetBkMode(0); // transparent\r\nGfxSetTextColor( colorCustom3 );\r\nGfxTextOut("" +Name(), 5, 15);\r\n  //////////////////\r\n GfxSelectFont("Arial",12, 500);\r\nGfxSetBkMode(0); // transparent\r\nGfxSetTextColor( colorPaleBlue );\r\nGfxTextOut("" +FullName(), 130, 30);\r\n}\r\n\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Chart- Mark Minervini 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1610612747</MoreFlags>
			<Min>7.60182</Min>
			<Max>21.8103</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 5</Name>
		<Pane>
			<ChartID>1124</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>_SECTION_BEGIN("Code test");\r\npxwidth = Status( "pxwidth" );\r\npxheight = Status( "pxheight" );\r\npxb = Status( "pxchartbottom" );\r\npxr = Status( "pxchartright" );\r\nfixx=1/1880*pxwidth;\r\nfixy=1/870*pxheight;\r\nfixpg=(pxheight/pxwidth)*(1880/870);\r\nmaunenboad=ParamColor("colorkhung", ColorBlend( colorLavender, colorWhite,0.8 ));\r\nGfxGradientRect( 1, 1, pxwidth, pxheight, maunenboad, maunenboad );\r\n\r\nGfxSetOverlayMode(0);\r\nGfxSelectFont("Verdana",10*fixx*fixy, 600);\r\nGfxSetBkMode(0); // transparent\r\nEnableScript("JScript");\r\n &lt;%\r\nfunction SetChartTicker(newTicker)\r\n{\r\n AB = new ActiveXObject("Broker.Application");\r\n AB.ActiveDocument.Name = newTicker;\r\n return 1;\r\n}\r\n %&gt;\r\nprocedure SetOrigin(x0, y0) {\r\n\tglobal _x0, _y0;\r\n\t_x0 = x0; _y0 = y0;\r\n}\r\n_cursorMouseButtons = GetCursorMouseButtons();\r\nDT_CENTER = 1; DT_VCENTER = 4 | 32; \r\nfunction GfxGetState(id) {\r\n\treturn Nz(StaticVarGet("GfxState"+id+GetChartID()), 0);\r\n}\r\nfunction PointInside(x0, y0, x, y, width, height) {\r\n    global _x0, _y0;\r\n\tx = x+_x0; y = y+_y0;\r\n    x0 = x0+_x0; y0 = y0+_y0;\r\n\treturn ((x0 &gt;= x) &amp;&amp; (y0 &gt;= y) &amp;&amp; (x0 &lt;= (x+width)) &amp;&amp; (y0 &lt;= (y+height)));\r\n}\r\nfunction LeftClickInside(x, y, width, height) {\r\n\tglobal _cursorMouseButtons, _x0, _y0;\r\n\tlocal px, py, res;\r\n\t\t//x = x+_x0; y = y+_y0;\r\n\tres = False;\r\n\tif (_cursorMouseButtons &amp; 8) { // click\r\n\t\tpx = GetCursorXPosition(1); \r\n\t\tpy = GetCursorYPosition(1); \r\n\t\tres = PointInside(px, py, x, y, width, height);\r\n\t}\r\n\treturn res;\r\n}\r\nprocedure GfxSetState(id, val) {\r\n\tStaticVarSet("GfxState"+id+GetChartID(), val);\r\n}\r\n\r\nfunction GfxHTabs1(id, headers, headheight, x, y, width, height, colorfg, colorbg) {\r\n\tglobal _x0, _y0;\r\n\tlocal py,choice,na,i,n,header,w, wi, prevwi;\t\r\n\tx = x+_x0; y = y+_y0; choice = GfxGetState(id);\r\n\tfor(n = 0; (header = StrExtract(headers,n)) != ""; ++n) {};\r\n\tw = width/n; wi = y; prevwi = y;\r\n\tif (LeftClickInside(x,y,width,height)) {\r\n\t\tpy = GetCursorYPosition( 1 );\r\n\t\tfor(i = 0; (header = StrExtract(headers,i)) != ""; ++i) {\r\n\t\t\twi =wi+headheight;\t\t\t\r\n\t\t\tif ((py &gt; prevwi) &amp;&amp; (py &lt; wi))  { choice = i; break; }\r\n\t\t}\r\n\t\tGfxSetState(id, choice); // StaticVarSet(na, choice);\r\n\t}\r\n\tGfxSetBkMode(1);\r\n\t// Draw Zone &amp; Tabs\r\n\twi = y; prevwi = y;\r\n\tfor(i = 0; (header = StrExtract(headers,i)) != ""; ++i) {\r\n\t\twi = wi + headheight;\t\t\r\n\t\t GfxSelectSolidBrush(ColorBlend( colorBrightGreen, colorWhite, 0.7 )); \r\n\t\t GfxSelectPen( colorLightGrey, 0 ); // data tooltip round border color\r\n\t\tGfxRoundRect(x,prevwi-1,x+width,wi,5,5); \r\n\t\tGfxSelectSolidBrush( colorbg );\r\n\t\tif (i != choice) {\r\n\t\t\tGfxSelectHatchBrush(colorbg,7); \r\n\t\t\tGfxRoundRect(x,prevwi-1,x+width,wi,5,5);\r\n\t\t\tGfxSelectSolidBrush( colorbg );\r\n\t\t} else {\r\n\t\t\twic = wi; prevwic = prevwi;\r\n\t\t}\t\t\r\n\t\tGfxSetTextColor( colorDarkGrey );\r\n\t\tGfxSelectFont("Verdana",8*fixpg, 500);//Tahoma\r\n\t\tGfxDrawText(header, x-50*fixx, prevwi, x+160*fixx, wi, 1|4|32);\r\n\tprevwi = wi;\r\n\t}\r\n\treturn choice;\r\n}\r\nfunction DrawPiePercent( x, y, radius, startpct, endpct ) \r\n { \r\n PI = 3.1415926; \r\n sa =2 * PI * startpct / 100; \r\n ea = 2 * PI * endpct / 100; \r\n xsa = x + radius * sin( sa ); \r\n ysa = y + radius * cos( sa ); \r\n xea = x + radius * sin( ea ); \r\n yea = y + radius * cos( ea ); \r\n\r\nGfxPie( x - radius, y - radius, x + radius, y + radius, xsa, ysa, xea, yea ); \r\n } \r\n/////////PopupWindow\r\nglobal SVKey;\r\nSVKey = NumToStr(GetChartID(),1.0,False);\r\nprocedure xStaticVarSet( SName, SValue )\r\n{\r\n global SVKey;\r\n InIndicator = Status("Action") == 1;\r\n if( InIndicator ) StaticVarSet(Sname+SVKey, Svalue);\r\n}\r\nfunction xStaticVarGet( SName )\r\n{\r\n global SVKey;\r\n if( IsNull( Var = StaticVarGet(Sname+SVKey) ) ) Var = 0;;\r\n return Var;\r\n}\r\nif( Status("Action") == 1 )\r\n{\r\nif(xStaticVarGet("DoRefresh"))\r\n{\r\nif(200 &lt; BarCount)\r\n{\r\n xStaticVarSet("DoRefresh", False);\r\n}\r\nelse\r\n    PopupWindow( "Edited by Huy Tuan-0937798534    (https://t.me/amibrokercodevn)", "Test code!", 5, -1, -1 );\r\n}\r\n     xStaticVarSet("Trigger", True);\r\nif(xStaticVarGet("Trigger"))\r\n{\r\nxStaticVarSet("DoRefresh",True); // this queues the refresh operation for the next pass through the code\r\n}\r\n}\r\n/////////////////\r\nprocedure GfxTSI1(x,y) {\r\n\tSetOrigin(x,y);\t\r\nVN30=ParamStr("VN30","ACB,BMC,BID,BVH,CTG,FPT,GAS,GVR,HDB,HPG,MBB,MSN,MWG,PLX,POW,SAB,SHB,SSB,SSI,STB,TCB,TPB,VCB,VHM,VIB,VIC,VJC,VNM,VPB,VRE");\r\nNGANHANG=ParamStr("NGAN HANG","ABB,ACB,BID,BVB,CTG,HDB,LPB,MBB,MSB,NAB,OCB,SHB,STB,TCB,TPB,VCB,VIB,VPB,VAB");\r\nCHUNGKHOAN=ParamStr("CHUNG KHOAN","AAS,AGR,APG,BSI,BVS,CTS,EVF,EVS,FTS,HCM,MBS,SBS,SHS,SSI,VCI,VDS,VIX,VND,APS,HBS,IVS,ORS,TVB,TVS,VIG,BMS,TCI,VFS");\r\nTHEP=ParamStr("THEP","HPG,HSG,NKG,SMC,TLH,TVN,VGS,NSH");\r\nDAUKHI=ParamStr("DAU KHI","BSR,CNG,GAS,OIL,PET,PLX,POW,PSH,PVB,PVC,PVD,PVS,PVT,PXS,PLC");\r\nBAOHIEM=ParamStr("BAO HIEM","BVH,BMI,MIG");\r\nBATDONGSAN=ParamStr("BAT DONG SAN","CCL,CEO,DIG,DLG,DPG,DRH,DTD,DXG,HAR,HBC,HDC,HDG,HLD,HQC,HUT,IJC,KDH,NBB,NDN,NTL,NVL,PDR,SCR,TCH,TDH,VHM,VIC,VPH,VRE,HTN,CRE,HAG,IDJ,ITC,NHA,OGC,SGR,AAV,API,DXS,HPX,KHG,NRC,TEG");\r\nBDSKCN=ParamStr("BDS-KCN","D2D,GVR,IDC,ITA,KBC,LDG,LHG,NLG,PHR,QCG,REE,SIP,SZC,TDC,TIG,TIP");\r\nXD_VLXD=ParamStr("XD_VLXD","VCG,VC7,HU4,MST,VC3,ACC,QNC,SCL,VGC,BCE,CSC,TTB,C69,CRC,HID,HVH,LIG,PAS,S99,SCG,SCI,TLD,EVG,CTD,PHC,CKG");\r\nDAUTUCONG=ParamStr("DAU TU CONG","BCC,BTS,C47,C4G,CII,CTI,DHA,FCN,G36,HOM,HT1,KSB,LCG,SD5,SD6,TCD,THG,TV2");\r\nCAOSU=ParamStr("CAO SU","DPR,DRC,DRI,GVR,PHR,VHG,HNG");\r\nDETMAY=ParamStr("DET MAY","ADS,EVE,GIL,KMR,MSH,STK,TCM,TNG,VGT");\r\nTHANKHOANGSAN=ParamStr("THAN - KHOANG SAN","CLX,KSB,MDC,NBC,NNC,TDN,THT,TVD,VEF,CST,BMC,DHM,KHB,KSQ,MSR,TC6,TNT");\r\nTHUYSAN=ParamStr("THUYSAN","ACL,ANV,ASM,CMX,FMC,IDI,MPC,VHC");\r\nTHUCPHAMXK=ParamStr("THUC PHAM-XK","DBC,DHC,LTG,MHC,MSN,NAF,PTB,TNA,VCS,VLC,VNM,VOC,BNA,TAR,VHE");\r\nHOACHATPHANBON=ParamStr("HOA CHAT - PHAN BON","BFC,CSV,DCM,DDV,DGC,DPM,LAS,QBS,TSC,SBV,HCD,ABS");\r\nBLECONGNGHE=ParamStr("CONG NGHE - BAN LE","DGW,ELC,FPT,FRT,ITD,MWG,PET,PNJ,SAM,SRA,TTN,CTR,VGI");\r\nCANGVANTAI=ParamStr("CANG - VAN TAI","DXP,GMD,HAH,PVP,PVT,SGP,SKG,TCL,VIP,VOS,VSC,VTO,GSP,HHG,TCO,TMS");\r\nDICHVU=ParamStr("DICH VU","HAX,PAN,TCT,VNG,VTP");\r\nDIEN_NANGLUONG=ParamStr("DIEN_NANGLUONG","KHP,PPC,PVG,QTP,VSH,TTA,GEG,SJD,NT2,REE,PC1,GEX,VNE");\r\nDTPT=ParamStr("DTPT","FID,FIT,HHS,SJF");\r\nDUONGGO=ParamStr("DUONG - GO","GDT,LSS,QNS,SBT,TTF");\r\nHANGKHONGDULICH=ParamStr("HANG KHONG-DU LICH","HVN,VJC,VTD,DAH,RIC");\r\nNUOCNHUA=ParamStr("NUOC NHUA","AAA,APH,BMP,BWE,DAG,NTP,TDM,HII,NHH,PLP");\r\nSXKD=ParamStr("SXKD","DQC,HAP,NAG,RAL,SAV,TLG");\r\nYTEDUOC=ParamStr("YTEDUOC","AMV,DCL,DHG,DMC,JVC,TNH");\r\n\r\n//////\r\nm = GfxHTabs1("HTab2", "NG\\u00C2N H\\u00C0NG,CH\\u1EE8NG KHO\\u00C1N,TH\\u00C9P,D\\u1EA6U KH\\u00CD,B\\u1EA2O HI\\u1EC2M,B\\u1EA4T \\u0110\\u1ED8NG S\\u1EA2N,BDS - KCN,XD - VLXD,\\u0110\\u1EA6U T\\u01AF C\\u00D4NG,CAO SU, D\\u1EC6T MAY,THAN-KS,TH\\u1EE6Y S\\u1EA2N,TH\\u1EF0C PH\\u1EA8M-XK,H/CH\\u1EA4T-P/B\\u00D3N,B/L\\u1EBA-C/NGH\\u1EC6,C\\u1EA2NG-V\\u1EACN T\\u1EA2I,D\\u1ECACH V\\u1EE4,\\u0110I\\u1EC6N-N/L\\u01AF\\u1EE2NG,DTPT,\\u0110\\u01AF\\u1EDCNG G\\u1ED6,H/KH\\u00D4NG - DL,N\\u01AF\\u1EDA\\u0043 NH\\u1EF0A,SXKD,YT\\u1EBE-D\\u01AF\\u1EE2\\u0043,VN30,THEO D\\u00D5I NG\\u00C0Y", 22.3*fixy, 0, 00, 110*fixx, 1200, colorBlack, ColorBlend( colorLavender, colorWhite, 0.9 )); \r\nswitch(m) {\r\n\r\ncase 0: \r\ntickerlist =NGANHANG;\r\nbreak;\r\ncase 1: \r\ntickerlist =CHUNGKHOAN;\r\nbreak;\r\ncase 2: \r\ntickerlist =THEP;\r\nbreak;\r\ncase 3: \r\ntickerlist =DAUKHI;\r\nbreak;\r\ncase 4: \r\ntickerlist =BAOHIEM;\r\nbreak;\r\ncase 5: \r\ntickerlist =BATDONGSAN;\r\nbreak;\r\ncase 6: \r\ntickerlist =BDSKCN;\r\nbreak;\r\ncase 7: \r\ntickerlist =XD_VLXD;\r\nbreak;\r\ncase 8: \r\ntickerlist =DAUTUCONG;\r\nbreak;\r\ncase 9: \r\ntickerlist =CAOSU;\r\nbreak;\r\ncase 10: \r\ntickerlist =DETMAY;\r\nbreak;\r\ncase 11: \r\ntickerlist =THANKHOANGSAN;\r\nbreak;\r\ncase 12: \r\ntickerlist =THUYSAN;\r\nbreak;\r\ncase 13: \r\ntickerlist =THUCPHAMXK;\r\nbreak;\r\ncase 14: \r\ntickerlist =HOACHATPHANBON;\r\nbreak;\r\ncase 15: \r\ntickerlist =BLECONGNGHE;\r\nbreak;\r\ncase 16: \r\ntickerlist =CANGVANTAI;\r\nbreak;\r\ncase 17: \r\ntickerlist =DICHVU;\r\nbreak;\r\ncase 18: \r\ntickerlist =DIEN_NANGLUONG;\r\nbreak;\r\ncase 19: \r\ntickerlist =DTPT;\r\nbreak;\r\ncase 20: \r\ntickerlist =DUONGGO;\r\nbreak;\r\ncase 21: \r\ntickerlist =HANGKHONGDULICH;\r\nbreak;\r\ncase 22: \r\ntickerlist =NUOCNHUA;\r\nbreak;\r\ncase 23: \r\ntickerlist =SXKD;\r\nbreak;\r\ncase 24: \r\ntickerlist =YTEDUOC;\r\nbreak;\r\ncase 25: \r\ntickerlist =VN30;\r\nbreak;\r\ncase 26: \r\nWatchlistName = ParamStr("WL2", "TD New");\r\nwlnumber = CategoryFind(WatchlistName, cat = categoryWatchlist); \r\ntickerlist =CategoryGetSymbols(cat, wlnumber);\r\nbreak;\r\n}\r\nGfxSelectPen( ColorBlend( colorDarkGrey, colorWhite, 0.9 ), 0 ); // data tooltip round border color\r\nGfxSelectSolidBrush( ColorBlend( colorPaleBlue, colorWhite, 0.1 ) );\r\n//GfxRoundRect(0*fixx,840*fixy, 1051*fixx, 870*fixy, 10, 10 );\r\nbtnHeight=15*fixy;\r\nbtnWidth=35*fixx;\r\nX=120*fixx;\r\nY=pxb-20*fixy;\r\nbi = BarIndex();\r\nfbr = Status("firstbarinrange");\r\nexplore = Status("action") == actionExplore;\r\nfvb = IIf(explore, LastValue(ValueWhen(fbr,bi)), Status("firstvisiblebar"));\r\nsym_num = StrCount(tickerlist, ",")+1;\r\nmat = Matrix(sym_num, 2);\r\nrownum = MxGetSize(mat, 0);\r\nlast_bar = BarCount-1;\r\n\tfor ( i = 0; ( symbol = StrExtract(tickerlist, i ) ) != ""; i++ ) {\r\n\t\tfc = Foreign( symbol, "C" ); \r\n\t\tfv = Foreign( symbol, "V" );\r\n\t\tidx = Max(Min(NullCount(fc),last_bar), fvb);\r\n\t\tif (! IsNull(fc[ idx ]) OR ! IsNull(fc[ idx ])) {\r\n\t\t\trelP = ROC(fc,1);\t\t\r\n\t\t\tmat[i][0] = LastValue( relP ); \r\n\t\t\tmat[i][1] = i; \t\t\r\n\t\t}}\r\n\tmat = MxSortRows(mat, False, 0);\r\n\tfor ( i = 0; i &lt; rownum; i++ ) {\r\n\t\t\tval = mat[i][0];\tn = mat[i][1];\r\n\t\tif (! IsNull(val)) {\t\r\n\t\t\tsymbol = StrExtract(tickerlist, n);\r\n\t\t\tfc1 = LastValue(Foreign( symbol, "C" ));\r\n\t\t\tfv1 = LastValue(Foreign( symbol, "V" )/MA(Foreign( symbol, "V" ),20));\r\n\t\t\tfv = LastValue(Foreign( symbol, "V" ));\r\n\t\t\tchg=LastValue(ROC(Foreign( symbol, "C" ),1));\r\n\t\t\ttextname=symbol;\r\n\t\t\tGTGD=LastValue(Foreign( symbol, "C" )*Foreign( symbol, "V" ))/1000000;\r\n\t\t\tGfxSetOverlayMode(0);\r\n\t\t\tGfxSetBkMode(0);\r\n\t\t\tGfxSelectFont( "Arial", 7*fixpg, 700 );\r\n\t\t\t/////////\r\n\t\t\tgiatrichg=IIf(chg&gt;0,chg,-chg);\r\n\t\t\tGfxSelectPen( ColorBlend( colorDarkGrey, colorWhite, 0.7 ), 0 ); // data tooltip round border color\r\n\t\t\tGfxSelectSolidBrush( ColorBlend( IIf(chg&gt;0,colorLime,IIf(chg&lt;0,colorRed,colorYellow)), colorWhite, 0.3 ) );\r\n\t\t\tGfxRoundRect(x+i*btnWidth+btnWidth/4,y+5,x+btnWidth*(i+1)+1-btnWidth/4,y-500/15*giatrichg*fixy, 5, 5 );\r\n\t\t\t///////////\r\n\t\t\tGfxSelectPen( ColorBlend( colorDarkGrey, colorWhite, 0.5 ), 0 ); // data tooltip round border color\r\n\t\t\tGfxSelectSolidBrush( ColorBlend( colorDarkGrey, colorWhite, 0.4 ) );\r\n\t\t\tGfxRoundRect(x+i*btnWidth,y,x+btnWidth*(i+1)+1,y+btnHeight, 5, 5 );\t\r\n\t\t\tGfxSetTextColor( colorWhite );\r\n\t\t\tGfxDrawText(textname,x+i*btnWidth,y+btnHeight/5, x+btnWidth*(i+1),y+btnHeight, 1);\r\n\t\t\tGfxSelectFont( "Arial", 7*fixpg, 500 );\r\n\t\t\tGfxSetTextColor( colorGrey40 );\r\n\t\t\tGfxDrawText(WriteVal(chg,1.2),x+i*btnWidth,y-500/15*giatrichg*fixy-15*fixy, x+btnWidth*(i+1),y-500/15*giatrichg*fixy, 1);\r\n\tif (LeftClickInside(x+i*btnWidth,y-10,btnWidth,btnHeight+20)) \r\n\t{\r\n\t\tpy = GetCursorYPosition( 1 );\r\n\t\tpx = GetCursorXPosition(1); \r\n\t\t//choice = floor((px - x)/w);\r\n\t\t //wi = y; prevwi = y;\r\n\t\t script = GetScriptObject();\r\n\t\tscript.SetChartTicker(Symbol);\r\n\t}\r\n}}\r\n\r\nListht =tickerlist;// CategoryGetSymbols(cat, wlnumber);//Di chuot va Watchlist se hien thi so watchlist lay so do nhap vao. Thong thuong Watchlist dau tien la so 0.\r\nif( Status( "stocknum" ) == 0 )\r\n{\r\n    // cleanup variables created in previous runs (if any)\r\n    StaticVarRemove( "~SymbolCount*" );\r\n    StaticVarRemove( "~above20*" );\r\n    StaticVarRemove( "~above50*" );\r\n    StaticVarRemove( "~above200*" );\r\n\tStaticVarRemove( "~cptang*" );\r\n\tStaticVarRemove( "~cpgiam*" );\r\n\tStaticVarRemove( "~cpthamchieu*" );\r\n    for( n = 0; ( Symbolht = StrExtract( Listht, n ) )  != "";  n++ )\r\n    {\r\n        SetForeign( symbolht );\r\n\t\tcptang =LastValue(C &gt; Ref(C,-1) );\r\n\t\tcpgiam=LastValue(C &lt; Ref(C,-1) );\r\n\t\tcpthamchieu=LastValue(C == Ref(C,-1) );\r\n\t\tabove20 =LastValue(C &gt;= MA( C, 20 ));\r\n        above50 =LastValue(C &gt;= MA( C, 50 ));\r\n        above200 = LastValue(C &gt;= MA( C, 200 ));      \r\n        StaticVarAdd( "~SymbolCount", 1 );\r\n        StaticVarAdd( "~above20", above20 );\r\n        StaticVarAdd( "~above50", above50 );\r\n        StaticVarAdd( "~above200", above200 );\r\n        StaticVarAdd( "~cptang", cptang );\r\n        StaticVarAdd( "~cpgiam", cpgiam );\r\n        StaticVarAdd( "~cpthamchieu", cpthamchieu );\r\n\r\n        RestorePriceArrays();\r\n    }\r\n}\r\n\r\nABOVE20comp = StaticVarGet( "~above20" );//so ma cp tren ma20\r\nABOVE50comp = StaticVarGet( "~above50" );//so ma cp tren ma50\r\nABOVE200comp = StaticVarGet( "~above200" );//so ma cp tren ma200\r\ncptangcomp = StaticVarGet( "~cptang" );//so ma cp tang\r\ncpgiamcomp = StaticVarGet( "~cpgiam" );//so ma cp tang\r\ncpthamchieucomp = StaticVarGet( "~cpthamchieu" );//so ma cp tang\r\nsvSymbolCount = StaticVarGet( "~SymbolCount" );//tong so cp trong list\r\npxwidth = Status( "pxwidth" );\r\npxheight = Status( "pxheight" );\r\nVTX=Param("Vi Tri_X",1300,0,2000,1);\r\nVTY=Param("Vi Tri_Y",5,0,1500,1);\r\n\r\nGfxSelectFont("Verdana",10*fixpg, 600);\r\nGfxSetBkMode(0); // transparent\r\nGfxSetTextColor( colorBlue );\r\nGfxTextOut("["+svSymbolCount+"]", VTX/1880*pxwidth, VTY/870*pxheight);\r\nGfxSelectFont("Verdana",10, 500);\r\nGfxSetTextColor( colorBlack );\r\nGfxTextOut("| "+ABOVE50comp, (VTX+120)/1880*pxwidth, VTY/870*pxheight);\r\nGfxSetTextColor( colorViolet );\r\nGfxTextOut(" "+ABOVE200comp, (VTX+150)/1880*pxwidth, VTY/870*pxheight);\r\nGfxSetTextColor( colorGreen );\r\nGfxTextOut(""+cptangcomp, (VTX+50)/1880*pxwidth, VTY/870*pxheight);\r\nGfxSetTextColor( colorRed );\r\nGfxTextOut(""+cpgiamcomp, (VTX+70)/1880*pxwidth, VTY/870*pxheight);\r\nGfxSetTextColor( colorOrange );\r\nGfxTextOut(""+cpthamchieucomp, (VTX+100)/1880*pxwidth, VTY/870*pxheight);\r\n_SECTION_END(); \r\ncptang=cptangcomp/svSymbolCount*100;\r\ncpgiam=cpgiamcomp/svSymbolCount*100;\r\ncptc=cpthamchieucomp/svSymbolCount*100;\r\ncptren20=ABOVE20comp/svSymbolCount;\r\ncptren50=ABOVE50comp/svSymbolCount;\r\ncptren200=ABOVE200comp/svSymbolCount;\r\n\r\n radius = 0.09 * Status("pxheight"); // get pixel height of the chart and use 45% for pie chart radius \r\n textoffset = 4.3 * radius;\r\n  GfxSelectSolidBrush( maunenboad);\r\n GfxRoundRect(1.5*radius, 0.9*radius, 6.5*radius, 3.1*radius,15,15);\r\n GfxRoundRect(6.6*radius, 0.9*radius, 11.6*radius, 3.1*radius,15,15);\r\n GfxRoundRect(11.7*radius, 0.9*radius, 16.7*radius, 3.1*radius,15,15);\r\n\r\n /////\r\n GfxRoundRect(6.8*radius, 1.3*radius, 11.4*radius, 1.6*radius,15,15);\r\n GfxRoundRect(6.8*radius, 1.95*radius, 11.4*radius, 2.25*radius,15,15);\r\n GfxRoundRect(6.8*radius, 2.6*radius, 11.4*radius, 2.9*radius,15,15);\r\n GfxSelectSolidBrush( colorSeaGreen);\r\n GfxRoundRect(6.8*radius, 1.3*radius,6.8*radius+ (11.4*radius-6.8*radius)*cptren20, 1.6*radius,15,15);\r\n GfxRoundRect(6.8*radius, 1.95*radius,6.8*radius+ (11.4*radius-6.8*radius)*cptren50, 2.25*radius,15,15);\r\n GfxRoundRect(6.8*radius, 2.6*radius,6.8*radius+ (11.4*radius-6.8*radius)*cptren200, 2.9*radius,15,15);\r\n GfxSelectSolidBrush( colorYellow ); \r\n DrawPiePercent(3*radius, 2*radius, radius,cptang + cpgiam,cptc+cptang + cpgiam );\r\n GfxRectangle( textoffset-20*fixx , 122*fixy, textoffset -5*fixx, 137*fixy );\r\n GfxSelectSolidBrush( colorLime );\r\n DrawPiePercent( 3*radius, 2*radius, radius, 0, cptang );\r\nGfxRectangle( textoffset-20*fixx , 82*fixy, textoffset -5*fixx, 97*fixy );\r\nGfxSelectSolidBrush( colorRed ); \r\n DrawPiePercent( 3*radius, 2*radius,radius, cptang,cptang + cpgiam );\r\n GfxRectangle( textoffset-20*fixx , 102*fixy, textoffset -5*fixx, 117*fixy ); \r\n GfxSelectSolidBrush( colorWhite); \r\n GfxCircle(3*radius, 2*radius,radius/2);\r\n GfxSelectFont("Tahoma", 9*fixy  ); \r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut( "CP Tang = " +WriteVal( cptang,1.2) + "%", textoffset, 80*fixy ); \r\nGfxSetTextColor( colorRed ); \r\nGfxTextOut( "CP Giam = " + WriteVal(cpgiam,1.2) + "%", textoffset, 100*fixy ); \r\nGfxSetTextColor( colorDarkYellow ); \r\nGfxTextOut( "Tham Chieu = " + WriteVal(( 100 - (cpgiam+cptang) ),1.2) + "%", textoffset, 120*fixy ); \r\nGfxSetTextColor( colorPaleBlue ); \r\nGfxSetTextAlign( 6 );\r\n GfxSelectFont("Tahoma", 15*fixy ); \r\nGfxTextOut(""+svSymbolCount, textoffset/1.43, 1.8*radius );\r\nGfxSetTextAlign( 0 );\r\nGfxSelectFont("Tahoma", 9*fixy  ); \r\nGfxSetTextColor( colorGreen ); \r\nGfxTextOut( "So CP Tren MA20", textoffset*1.6, 80*fixy );\r\nGfxSetTextColor( colorBlue ); \r\nGfxTextOut( "So CP Tren MA50", textoffset*1.6, 130*fixy );\r\nGfxSetTextColor( colorGrey40 ); \r\nGfxTextOut( "So CP Tren MA200", textoffset*1.6, 180*fixy );\r\n}\r\n\r\nx = Param("x_origin1", 0, 0, 1980, 20);\r\ny = Param("y_origin1", 70, 0, 1980, 20);\r\nGfxSelectPen( colorLightGrey, 0 );\r\nGfxTSI1(x*fixx,y*fixy);\r\n\r\n\r\n//##KHUNG THI TRUONG CHUNG\r\n{\r\nListthitruongchung = "VNINDEX,VN30INDEX,HNXINDEX,UPCOMINDEX,VN30F1M";\r\nfor ( e = 0; e &lt;= 4; e++ ) \r\n{\r\nthitruong=StrExtract(Listthitruongchung, e);\r\nthitruong1=WriteIf(thitruong=="VN30INDEX","VN30",WriteIf(thitruong=="HNXINDEX","HNX",WriteIf(thitruong=="UPCOMINDEX","UPCOM",thitruong)));\r\nXX=IIf(thitruong=="VN30INDEX",15,IIf(thitruong=="HNXINDEX",10,0));\r\nCl_thitruong=Foreign(thitruong,"Close");\r\nROC_thitruong=ROC(Cl_thitruong,1);\r\nCHG_thitruong=LastValue(Cl_thitruong-Ref(Cl_thitruong,-1));\r\nthitruong_statusc1=WriteIf(LastValue(ROC_thitruong)&gt;0,WriteVal(LastValue(Cl_thitruong),1.2),"");\r\nthitruong_statusc2=WriteIf(LastValue(ROC_thitruong)&lt;0,WriteVal(LastValue(Cl_thitruong),1.2),"");\r\nthitruong_statusc3=WriteIf(LastValue(ROC_thitruong)==0,WriteVal(LastValue(Cl_thitruong),1.2),"");\r\nthitruong_statust1=WriteIf(LastValue(ROC_thitruong)&gt;0,WriteVal(LastValue(ROC_thitruong),1.2)+" %","");\r\nthitruong_statust2=WriteIf(LastValue(ROC_thitruong)&lt;0,WriteVal(LastValue(ROC_thitruong),1.2)+" %","");\r\nthitruong_statust3=WriteIf(LastValue(ROC_thitruong)==0,WriteVal(LastValue(ROC_thitruong),1.2)+" %","");\r\nGfxSetOverlayMode( 2 );\r\nGfxSetBkMode( 0 ); // transparent\r\nGfxSelectPen( colorLightGrey, 1 );\r\nGfxSelectSolidBrush( ColorBlend( colorLightGrey, colorWhite, 0.9 ) );\r\nGfxRoundRect(((303*e)+1)/1880*pxwidth, 0, (303*(e+1))/1880*pxwidth, 65/870*pxheight, 15, 15 );\r\nGfxSelectFont( "Verdana", 14*fixpg, 700 );\r\nGfxSetTextColor( colorGrey40 );\r\nGfxTextOut(thitruong1,(20+303*e+XX)/1880*pxwidth, 10/870*pxheight);\r\nGfxSelectFont( "Verdana", 12*fixpg, 500 );\r\nGfxTextOut(WriteVal(CHG_thitruong,1.2),(35+303*e)/1880*pxwidth, 35/870*pxheight);\r\n\tGfxSelectFont( "Verdana", 12/870*pxheight, 600 );\r\n    GfxSetTextColor( colorGreen);\r\n    GfxTextOut( thitruong_statusc1, (190+303*e)/1880*pxwidth, 10/870*pxheight );\r\n    GfxSelectFont( "Verdana", 10/870*pxheight, 600 );\r\n    GfxTextOut( thitruong_statust1, (190+303*e)/1880*pxwidth, 40/870*pxheight );\r\n    GfxSelectFont( "Verdana", 12*fixpg, 600 );\r\n    GfxSetTextColor( colorRed);\r\n    GfxTextOut( thitruong_statusc2, (190+303*e)/1880*pxwidth, 10/870*pxheight );\r\n    GfxSelectFont( "Verdana", 10*fixpg, 600 );\r\n    GfxTextOut( thitruong_statust2, (190+303*e)/1880*pxwidth, 40/870*pxheight );\r\n    GfxSelectFont( "Verdana", 12*fixpg, 600 );\r\n    GfxSetTextColor( colorDarkYellow);\r\n    GfxTextOut( thitruong_statusc3, (190+303*e)/1880*pxwidth, 10/870*pxheight );\r\n    GfxSelectFont( "Verdana", 10*fixpg, 600 );\r\n    GfxTextOut( thitruong_statust3, (190+303*e)/1880*pxwidth, 40/870*pxheight );\r\n}\r\n}\r\n\r\nGfxSelectSolidBrush( ColorBlend( colorLightGrey, colorWhite, 0.9 ) );\r\nGfxRoundRect( 1517/1880*pxwidth, 0, 1880/1880*pxwidth, 65/870*pxheight, 15, 15 );\r\n\t\tGfxSetOverlayMode( 2 );\r\n\t\tGfxSetBkMode( 0 );\r\n\t\tGfxSetTextAlign( 6 );\r\nGfxSelectFont("Verdana",10/870*pxheight, 700);\r\nGfxSetTextColor( colorBlue );\r\nGfxTextOut("TEST CODE", 1790/1880*pxwidth, 5/870*pxheight);\r\nGfxSelectFont("Verdana",8.5*fixpg, 500);\r\nGfxSetTextColor( colorDarkGrey );\r\nGfxTextOut("Date: "+Date(), 1790/1880*pxwidth, 25/870*pxheight);\r\nGfxTextOut("Time: " + Now( 2 ), 1790/1880*pxwidth, 45/870*pxheight);\r\nGfxSelectFont("Verdana",9*fixpg, 700);\r\nGfxSetTextColor( colorRed );\r\nGfxTextOut("EDIT BY HUY TUAN", 1620/1880*pxwidth, 15/870*pxheight);\r\nGfxTextOut("0 9 3 7 7 9 8 5 3 4", 1620/1880*pxwidth, 35/870*pxheight);\r\n\r\n////////////////////////////////\r\n\r\nSM1=LastValue( C&gt;MA(C,10));\r\nSM2=LastValue( C&gt;MA(C,20));\r\nSM3=LastValue( C&gt;MA(C,50));\r\nSM4=LastValue( C&gt;MA(C,100));\r\nSM5=LastValue( C&gt;MA(C,200));\r\nSM=SM1+SM2+SM3+SM4+SM5;//TONG SUC MANH =5\r\nSMCHG=SM/5;\r\n\r\nradius = 0.15 * Status("pxheight"); // get pixel height of the chart and use 45% for pie chart radius \r\ntextoffset = 8.5 * radius;\r\nGfxSelectPen( ColorBlend( colorDarkGrey, colorWhite, 0.5 ), 0 ); // data tooltip round border color\r\nGfxSelectSolidBrush( colorLime ); \r\nDrawPiePercent( 8.5*radius, 1.7*radius, radius, 25, 75.1 );\r\nGfxSelectPen( ColorBlend( colorDarkGrey, colorWhite, 0.5 ), 0 ); // data tooltip round border color\r\nGfxSelectSolidBrush( maunenboad ); \r\nDrawPiePercent( 8.5*radius, 1.7*radius, radius, 24.9, 75-50*SMCHG );\r\nGfxSelectPen( ColorBlend( colorDarkGrey, colorWhite, 0.5 ), 0 ); // data tooltip round border color\r\nGfxSelectSolidBrush( maunenboad ); \r\nDrawPiePercent( 8.5*radius, 1.7*radius, radius/1.3, 25, 75 );\r\nGfxSetTextAlign( 6 );\r\n GfxSelectFont("Tahoma", 20*fixy,700 ); \r\nGfxTextOut(Name(), textoffset, 1.3*radius );\r\nGfxSelectFont("Tahoma", 9*fixy  ); \r\nGfxSetTextColor( colorGreen ); \r\nGfxTextOut( "SUC MANH CP:  "+ SM, textoffset/1.12, 80*fixy );\r\nGfxSetTextColor( colorGreen ); \r\nGfxTextOut( "0", textoffset/1.15, 1.6*radius );\r\nGfxTextOut( "5", textoffset/0.884, 1.6*radius );\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Code test 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1879048193</MoreFlags>
			<Min>49</Min>
			<Max>102.56</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 6</Name>
		<Pane>
			<ChartID>0</ChartID>
			<PercentHeight>50</PercentHeight>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 7</Name>
		<Pane>
			<ChartID>0</ChartID>
			<PercentHeight>50</PercentHeight>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 8</Name>
		<Pane>
			<ChartID>0</ChartID>
			<PercentHeight>50</PercentHeight>
		</Pane>
	</Sheet>
</Window>
