<?xml version="1.0" encoding="UTF-8"?>
<Window>
	<Sheet>
		<Name>tongquat</Name>
		<Pane>
			<ChartID>1096</ChartID>
			<PercentHeight>100</PercentHeight>
			<Formula>_SECTION_BEGIN("DANH MUC");\r\n//MaCP,Gia mua,Stoploss,Target|MaCP,Gia mua,Stoploss,Target|...\r\nMyasset = ParamStr("My Asset","ANV,37,35.8,44.7|ABS,8.55,7.41,10.44|TCB,34,34.85,40.86|PSH,11.45,12.7,15");\r\n//MaCP, pivot|MaCP, pivot|...\r\nMywl = ParamStr("My watchlist","ANV,37.2|ABS,8.55|TCB,34|PSH,11.45");\r\n\r\nasset_count = StrCount(Myasset, "|")+1;\r\nwl_count = StrCount(Mywl, "|")+1;\r\nfor ( i = 0; i&lt; asset_count; i++ )\r\n{\r\n\tlist = StrExtract( Myasset, i, '|' );\r\n\r\n\tsymbol = StrExtract( list, 0, ',' ) ;\r\n\tGiamua = StrExtract( list, 1, ',' ) ;\r\n\tStoploss = StrExtract( list, 2, ',' ) ;\r\n\tTarget = StrExtract( list, 3, ',' ) ;\r\n\t\r\n\tSetForeign(symbol);\r\n\tfC = close;\r\n\trfc = ROC(fc,1);\r\n\tRestorePriceArrays();\r\n\tfC1 = LastValue(fC);\r\n\trfc1 = LastValue(rfc);\r\n\tPnL = (fC1 - StrToNum(giamua))/StrToNum(giamua)*100;\r\n\t\r\n\tCutloss = fC1 &lt; StrToNum(Stoploss);\r\n\ttakeprofit = fC1 &gt; StrToNum(Target);\r\n\tif(Name()== symbol)\r\n\t{\r\n\t\tline_sl = LineArray(BarCount-10,StrToNum(stoploss),BarCount,StrToNum(stoploss),1);\r\n\t\tline_target = LineArray(BarCount-10,StrToNum(Target),BarCount,StrToNum(Target),1);\r\n\t\tPlot(line_sl,"stoploss",colorRed,styleThick+styleDashed,Null,Null,5);\r\n\t\tPlot(line_target,"Target",colorgreen,styleThick+styleDashed,Null,Null,5);\r\n\t\r\n\t\r\n\t\tif  (Status("action") == actionExplore )\r\n\t{\t\r\n\t\t// Clear the static vars from last run\r\n\t//StaticVarRemove( "luotsong*" );\r\n\t\t\t\r\n\tDate_time =  DateTime();\r\n\tMessage1 = "Exit "+symbol +" "+ WriteVal(PnL,4.2)+"%" +"| Gia hien tai: "+fC1+ "| Stoploss: "+ Stoploss;\r\n\tMessage2 = "Take profit "+symbol +" "+ WriteVal(PnL,4.2)+"%" +"| Gia hien tai: "+fC1+ "| Target: "+target ;\r\n\r\n\tTelegramAPI_ID2 = "xxxxxxxxxx"; //Get the Bot API key via BotFather in Telgram\r\n\tTelgramCHAT_ID2 = "@xxxxxxxx"; //Channel ID example : @marketcalls_in\r\n\r\n\tLuotsong = StaticVarGetText ("luotsong" +  symbol);\r\n\tif(Luotsong != DateTimeToStr(Date_time[BarCount-1],1) AND Cutloss  )\r\n\t{\r\n\t\tTelegramAlertsBuy = InternetOpenURL("https://api.telegram.org/bot"+TelegramAPI_ID2+"/sendMessage?chat_id="+TelgramCHAT_ID2+"&amp;text= "+Message1 );\r\n\t\tInternetClose(TelegramAlertsBUY);\r\n\t\tStaticVarSetText("luotsong" + symbol, DateTimeToStr(Date_time[BarCount-1],1), True);\r\n\t}\r\n\telse if(Luotsong != DateTimeToStr(Date_time[BarCount-1],1) AND takeprofit  )\r\n\t{\r\n\t\tTelegramAlertsBuy = InternetOpenURL("https://api.telegram.org/bot"+TelegramAPI_ID2+"/sendMessage?chat_id="+TelgramCHAT_ID2+"&amp;text= "+Message2 );\r\n\t\tInternetClose(TelegramAlertsBUY);\r\n\t\tStaticVarSetText("luotsong" + symbol, DateTimeToStr(Date_time[BarCount-1],1), True);\r\n\t}\r\n}\t\r\n\t}\r\n\t\r\n\t\t\t\t\t\t\r\n}\r\n\r\n\r\nfor ( i = 0; i&lt; wl_count; i++ )\r\n{\r\n\tlist = StrExtract( Mywl, i, '|' );\r\n\r\n\tsymbol = StrExtract( list, 0, ',' ) ;\r\n\tpivot = StrExtract( list, 1, ',' ) ;\r\n\t\r\n\tSetForeign(symbol);\r\n\tfC = close;\r\n\trfc = ROC(fc,1);\r\n\tRestorePriceArrays();\r\n\tfC1 = LastValue(fC);\r\n\trfc1 = LastValue(rfc);\r\n\tbreakout = fC1 &gt; StrToNum(pivot);\r\n\tif(Name()== symbol)\r\n\t{\r\n\t\tline_pivot = LineArray(BarCount-10,StrToNum(pivot),BarCount,StrToNum(pivot),1);\r\n\t\tPlot(line_pivot,"pivot",colorGold,styleThick+styleDashed,Null,Null,5);\r\n\t\r\n\t\tif  (Status("action") == actionExplore )\r\n\t{\t\r\n\t\t// Clear the static vars from last run\r\n\t//StaticVarRemove( "luotsong*" );\r\n\t\t\t\r\n\tDate_time =  DateTime();\r\n\tMessage1 = "Buy "+symbol +" | Gia hien tai: "+fC1+" ("+  WriteVal(rfc1,4.2)+"%)"+" | Pivot: "+ pivot;\r\n\r\n\tTelegramAPI_ID2 = "xxxxxxxxxxxx"; //Get the Bot API key via BotFather in Telgram\r\n\tTelgramCHAT_ID2 = "@xxxxxx"; //Channel ID example : @marketcalls_in\r\n\t\r\n\tLuotsong = StaticVarGetText ("luotsong" +  symbol);\r\n\tif(Luotsong != DateTimeToStr(Date_time[BarCount-1],1) AND breakout  )\r\n\t{\r\n\t\tTelegramAlertsBuy = InternetOpenURL("https://api.telegram.org/bot"+TelegramAPI_ID2+"/sendMessage?chat_id="+TelgramCHAT_ID2+"&amp;text= "+Message1 );\r\n\t\tInternetClose(TelegramAlertsBUY);\r\n\t\tStaticVarSetText("luotsong" + symbol, DateTimeToStr(Date_time[BarCount-1],1), True);\r\n\t}\r\n\t\r\n\t}\t\r\n\t}\r\n\t\r\n\t\t\t\t\t\t\r\n}\r\n_SECTION_END();\r\n\r\nbi = BarIndex();\r\nfbr = Status("firstbarinrange");\r\nexplore = Status("action") == actionExplore;\r\nfvb = IIf(explore, LastValue(ValueWhen(fbr,bi)), Status("firstvisiblebar"));\r\n\r\nEV=V;\r\nGfxSetOverlayMode( 0 ); \r\n\r\n// formatted text output sample via low-level gfxfunctions  \r\n_SECTION_BEGIN("BANG GIA");\r\nCellHeight = Param("Cell Height",28,0,100,1); \r\nCellWidth = Param("Cell Width",128,0,200,1);\r\nstart_x = Param("Vi tri Table X",0,0,3000,1); \r\nstart_y = Param("Vi tri Table Y",30,0,500,1); \r\nBtnOffsetXY = 1;\r\nx1= start_x;\r\ny1= start_y;\r\ny2=y1 + CellHeight;\r\nx2 = x1 + CellWidth;\r\ncol = Param("col",4,1,10,1);\r\nfontsize = Param("font size", CellHeight,1,100,0.1);\r\n\r\n\r\nchooselist = ParamList("Pick list","listnum,list default",1);\r\n\r\nswitch (chooselist)\r\n{\r\n\tcase "listnum":\r\n\t\t//chon watchlist number\r\n\t\tNGANHANG= CategoryGetSymbols( categoryWatchlist, 1 );\r\n\t\tCHUNGKHOAN= CategoryGetSymbols( categoryWatchlist, 2 );\r\n\t\tBATDONGSAN= CategoryGetSymbols( categoryWatchlist, 3 );\r\n\t\tXD_VLXD = CategoryGetSymbols( categoryWatchlist, 4 );\r\n\t\tHANGHOA = CategoryGetSymbols( categoryWatchlist, 5);\r\n\t\tBLECONGNGHE = CategoryGetSymbols( categoryWatchlist, 6);\r\n\t\tDIEN_DK = CategoryGetSymbols( categoryWatchlist, 7);\r\n\t\tTIEUDUNG = CategoryGetSymbols( categoryWatchlist, 8);\r\n\t\tVANTAI = CategoryGetSymbols( categoryWatchlist, 9);\r\n\t\tKHAC= CategoryGetSymbols( categoryWatchlist, 10);\r\n\t\tTickerList =  CategoryGetSymbols( categoryWatchlist, 0);\r\n\tbreak;\r\n\t\t\r\n\tcase "list default":\r\n\t\t //default symbol\r\n\t\tNGANHANG=ParamStr("NGAN HANG","OCB,HDB,VPB,SSB,VCB,EIB,LPB,SHB,VIB,ACB,BID,MBB,ABB,CTG,TCB,TPB,STB,MSB");\r\n\r\n\t\tCHUNGKHOAN= ParamStr("CHUNG KHOAN","AAS,HCM,SBS,FTS,MBS,VCI,SSI,VDS,CTS,VIX,SHS,AGR,VND,BSI,APS,ORS");\r\n\r\n\t\tBATDONGSAN= ParamStr("BAT DONG SAN","AGG,GEX,SZC,KBC,ITA,NVL,IDC,HPX,SCR,VGC,PHR,HDC,VPI,HQC,DIG,PDR,FIT,DRH,TCH,NTL,KDH,CEO,DXS,NLG,IJC,DXG,L14,IDJ,KHG,LDG,CRE,VHM,VRE,VIC,QCG");\r\n\t\t\r\n\t\tXD_VLXD = ParamStr("XD-VLXD","VCG,HT1,CII,EVG,HUT,CTD,PTB,DPG,DTD,HTN,HHV,HBC,FCN,LCG,BCG,C4G,TCD,AAA");\r\n\t\t\r\n\t\tHANGHOA = ParamStr("HANG HOA","DDV,DCM,DPM,NKG,DGC,TSC,HSG,BMP,GVR,KSB,HPG,VPG");\r\n\t\t\r\n\t\tBLECONGNGHE = ParamStr("BAN LE - CN","FRT,PET,DGW,MWG,PNJ,FPT");\r\n\t\t\r\n\t\tDIEN_DK = ParamStr("NANG LUONG","PC1,BSR,NT2,HDG,PVC,PLX,PVD,POW,GAS,PSH,PVS");\r\n\t\t\r\n\t\tTIEUDUNG = ParamStr("TIEU DUNG","TAR,TNG,SBT,GIL,ANV,PAN,IDI,QNS,HNG,VNM,DBC,HHS,BAF,KDC,TCM,VHC,HAX,MSN,HAG,ASM,TTF");\r\n\t\t\r\n\t\tVANTAI = ParamStr("CANG - VAN TAI","HAH,VOS,VSC,PVT,GMD,VTP,SKG");\r\n\t\t\r\n\t\tKHAC= ParamStr("NGANH KHAC","CTR,VEA,REE,VJC,SAB,BVH,E1VFVN30,FUEVFVND");\r\n\t\tTickerList\t= NGANHANG +","+  CHUNGKHOAN + ","+ BATDONGSAN + ","+ XD_VLXD +","+  HANGHOA + ","+ BLECONGNGHE + ","+ DIEN_DK + ","+ TIEUDUNG+","+  VANTAI +","+  KHAC;\r\n\t\t\r\n\t\t\r\n\tbreak;\r\n}\r\n\r\n_SECTION_END();\r\n\r\nfunction PointInside(x0, y0, x, y, width, height) {\r\n    global _x0, _y0;\r\n\tx = x+_x0; y = y+_y0;\r\n    x0 = x0+_x0; y0 = y0+_y0;\r\n\treturn ((x0 &gt;= x) &amp;&amp; (y0 &gt;= y) &amp;&amp; (x0 &lt;= (x+width)) &amp;&amp; (y0 &lt;= (y+height)));\r\n}\r\n_cursorMouseButtons = GetCursorMouseButtons();\r\nDT_CENTER = 1; DT_VCENTER = 4 | 32; \r\n\r\nfunction LeftClickInside(x, y, width, height) {\r\n\tglobal _cursorMouseButtons, _x0, _y0;\r\n\tlocal px, py, res;\r\n\t\r\n\t// x = x+_x0; y = y+_y0;\r\n\tres = False;\r\n\tif (_cursorMouseButtons &amp; 8) { // click\r\n\t\tpx = GetCursorXPosition(1); \r\n\t\tpy = GetCursorYPosition(1); \r\n\t\tres = PointInside(px, py, x, y, width, height);\r\n\t}\r\n\treturn res;\r\n}\r\n\r\nglobal IDset;\r\nif( typeof( IDset ) == "undefined" ) IDset = 0; \r\n\r\nfunction GuiButtonTrigger( ButtonName, x, y, width, Height ) {\r\n\t/// @link http://forum.amibroker.com/t/guibuttons-for-everyone/1716/4\r\n\t/// by beaver &amp; fxshrat\r\n\t/// version 1.1\r\n\t\r\n\t//_TRACEF( "IDset before: %g", IDset );\t\r\n\tGuiButton( ButtonName, ++IDset, x, y, width, height, 1 ); \r\n\t//_TRACEF( "IDset after: %g", IDset );\r\n\t\r\n\tid = GuiGetEvent( 0, 0 );// receiving button id\r\n\tevent = GuiGetEvent( 0, 1 );// receiving notifyflag\r\n\tclickevent = event == 1;\r\n\tButtonClicked = id == IDset &amp;&amp; clickevent;\r\n\t\r\n\treturn ButtonClicked;\r\n}\r\n\r\n\r\nclick = GetCursorMouseButtons() == 9;\r\nPx = GetCursorXPosition( 1 );\r\nPy = GetCursorYPosition( 1 );\r\n\r\nGfxSetBkMode( 1 ); \r\n\r\n\r\n\r\nprocedure SetOrigin(x0, y0) {\r\n\tglobal _x0, _y0;\r\n\t_x0 = x0; _y0 = y0;\r\n}\r\nprocedure GfxSetColors(fgColor, bgColor) {\r\n\tGfxSetTextColor(fgColor); GfxSetBkColor(bgColor); \r\n\tGfxSelectPen(fgColor); GfxSelectSolidBrush(bgColor);\r\n}\r\n\r\nfunction GfxGetState(id) {\r\n\treturn Nz(StaticVarGet("GfxState"+id+GetChartID()), 0);\r\n}\r\nprocedure GfxSetState(id, val) {\r\n\tStaticVarSet("GfxState"+id+GetChartID(), val);\r\n}\r\nprocedure GfxLabel(text, x, y, width, height, format) {\r\n\tGfxSelectFont( "Arial", fontsize/3.2, 600 );\r\n\tGfxSetTextColor(colorYellow);\r\n\tGfxDrawText( text , x, y, x+width, y+height, format | DT_VCENTER ); \r\n\t\r\n}\r\n\r\nfunction GfxHTabs(id, headers, headheight, x, y, width, height, colorfg, colorbg) {\r\n\tlocal px,choice,na,i,G,header,w, wi, prevwi;\r\n\t\r\n\tchoice = GfxGetState(id);\r\n\tGfxSetColors(colorfg, colorbg);\r\n\t\r\n\tfor(G = 0; (header = StrExtract(headers,G)) != ""; ++G) {};\r\n\tw = width/G; wi = x; prevwi = x;\r\n\tif (LeftClickInside(x,y,width,headheight)) {\r\n\t\tpx = GetCursorXPosition( 1 );\r\n\t\t// choice = floor((px - x)/w);\r\n\t\t// wi = x; prevwi = x;\r\n\t\tfor(i = 0; (header = StrExtract(headers,i)) != ""; ++i) {\r\n\t\t\twi = wi + (width+5)/(StrCount(headers, ",")+1);\r\n\t\t\tif ((px &gt; prevwi) &amp;&amp; (px &lt; wi))  { choice = i; break; }\r\n\t\t}\r\n\t\tGfxSetState(id, choice); // StaticVarSet(na, choice);\r\n\t}\r\n\r\n\tGfxSetBkMode(1);\r\n\t// Draw Zone &amp; Tabs\r\n\twi = x; prevwi = x;\r\n\tfor(i = 0; (header = StrExtract(headers,i)) != ""; ++i) {\r\n\t\twi = wi + (width+5)/(StrCount(headers, ",")+1);;\r\n\t\t//GfxSelectPen(colorLightYellow,2);\r\n\t\t// GfxSelectSolidBrush(colorbg); \r\n\t\tGfxRoundRect(prevwi,y,wi,y+headheight+5,5,5); \r\n\t\tif (i != choice) {\r\n\t\t\t \r\n\t\t\tGfxRoundRect(prevwi,y,wi,y+headheight+5,5,5); \r\n\t\t\tGfxSelectSolidBrush( colorbg );\r\n\t\t} else {\r\n\t\t\twic = wi; prevwic = prevwi;\r\n\t\t}\r\n\t\tGfxSelectFont( "Arial", fontsize/2.9, 600 );\r\n\t\tGfxDrawText(header, prevwi, y, wi, y+headheight+5, 1|4|32);\r\n\t\tprevwi = wi;\r\n\t}\r\n\r\n\treturn choice;\r\n}\r\n\r\n\r\n\r\n//////////////////////////////////////////////////// \r\n// HEADER \r\n////////////////////////////////////////////////// \r\n//Datetime\r\n\r\nGfxSetZOrder(2);\t\r\nGfxSelectFont( "Arial",fontsize/3 ); \r\nGfxSelectSolidBrush(  colorDarkGreen);\r\nGfxRoundRect(x1, y1-3, x1 + CellWidth*col+3, y1 + CellHeight*2+3,15,15);\r\nGfxSetTextColor(colorYellow);\r\nGfxSetBkMode(1);//set transparent mode \r\ndt = SelectedValue(DateTime());\r\n\r\nGfxDrawText( "Created by Nguyen Joe\\nContact: 0979019012" ,x1+BtnOffsetXY, y1, x1 + CellWidth*2+10,y1 + CellHeight*2, 1 );\r\n\r\nindex_fc = Foreign("Vnindex","close");\r\nindex_rfc = ROC(index_fc,1);\r\nindex_chg = index_fc - Ref(index_fc,-1);\r\ncolorindex = IIf(index_fc&gt;Ref(index_fc,-1),colorbrightGreen,IIf(index_fc == Ref(index_fc,-1),colorGold,colorRed));\r\n\r\nGfxSetTextColor(colorindex[BarCount-1]);\r\nGfxSelectFont("arial",fontsize/3,500);\r\nGfxDrawText( " VNINDEX " +LastValue(index_fc)+"\\n"+ DateTimeToStr( dt[BarCount-1],1 )+" "+WriteVal(LastValue(index_rfc),5.2)+"%"  ,x1+CellWidth*2+10, y1, x1 + CellWidth*col-50,y1 + CellHeight*2, 1 );\r\n\r\n\tif ( px &gt; x1+CellWidth*2+10 AND px&lt;x1 + CellWidth*3 AND py&gt; y1+5 AND py &lt;y1 + CellHeight*2 AND Click )\t{\r\n        AB = CreateObject( "Broker.Application" );\r\n\t\tdoc = AB.ActiveDocument;\r\n\t\tdoc.Name = "Vnindex" ;\r\n\t}\r\n\r\n// ON OFF BUTTON\r\n\r\nid = GuiGetEvent( 0, 0 ); event = GuiGetEvent( 0, 1 );\r\nMyChartID = GetChartID();\r\nToggleButton = Nz( StaticVarGet( "ToggleButton" + MyChartID ));\r\n\r\nGuiButtonTrigger( "Off", x1+CellWidth*col-45, y1+CellHeight/2, 40, 30 );\r\nGuiSetColors(IDset,IDset,2,colorWhite, colorGreen, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n\r\n//////////////////////////////////////////////////// \r\n//DRAWING TABLE OF BUTTONS \r\n////////////////////////////////////////////////// \r\nGfxSelectFont( "Arial",fontsize/3.2 ); \r\n\r\n\r\n//===================== * SECTOR NGAN HANG * ==============================\r\n\r\n_SECTION_BEGIN("NGAN HANG");\r\n\r\n\r\nSymCount1 = StrCount( NGANHANG, "," ) + 1;\r\nrow1 = ceil(SymCount1/col);\r\npy1 = y1+CellHeight*4+5;\r\n\r\n\r\niclose1=0;\r\nichange1=0;\r\nivol1 = 0;\r\nfor( i = 0; ( sym1 = StrExtract(NGANHANG,i ) ) != ""; i++ )\r\n{\r\niclose1+=Foreign(sym1,"Close");\r\nnum1=1+StrCount(NGANHANG,",");\r\ntb1=iclose1/num1;\r\nichange1+=ROC(Foreign(sym1,"Close"),1)/num1;\r\nivol1 +=Foreign(sym1,"volume")/num1;\r\nmavol1 = MA(ivol1,50);\r\nvchange1 = ivol1/mavol1*100;\r\n}\r\n_SECTION_END();\r\n\r\n//===================== * SECTOR CHUNG KHOAN * ==============================\r\n\r\n_SECTION_BEGIN("CHUNG KHOAN");\r\n\r\n\r\nSymCount2 = StrCount( CHUNGKHOAN, "," ) + 1;\r\nrow2 = ceil(SymCount2/col);\r\npy2 = py1 + CellHeight+ CellHeight*row1;\r\n\r\nivol2 = 0;\r\niclose2=0;\r\nichange2=0;\r\nfor( i = 0; ( sym2 = StrExtract(CHUNGKHOAN,i ) ) != ""; i++ )\r\n{\r\niclose2+=Foreign(sym2,"Close");\r\nnum2=1+StrCount(CHUNGKHOAN,",");\r\ntb2=iclose2/num2;\r\nichange2+=ROC(Foreign(sym2,"Close"),1)/num2;\r\nivol2 +=Foreign(sym2,"volume")/num2;\r\nmavol2 = MA(ivol2,50);\r\nvchange2 = ivol2/mavol2*100;\r\n}\r\n_SECTION_END();\r\n\r\n//===================== * SECTOR BATDONGSAN * ==============================\r\n_SECTION_BEGIN("BATDONGSAN");\r\n\r\n\r\nSymCount3 = StrCount( BATDONGSAN, "," ) + 1;\r\nrow3 = ceil(SymCount3/col);\r\npy3 = py2 + CellHeight+ CellHeight*row2;\r\nivol3 = 0;\r\niclose3=0;\r\nichange3=0;\r\nfor( i = 0; ( sym3 = StrExtract(BATDONGSAN,i ) ) != ""; i++ )\r\n{\r\niclose3+=Foreign(sym3,"Close");\r\nnum3=1+StrCount(BATDONGSAN,",");\r\ntb3=iclose3/num3;\r\nichange3+=ROC(Foreign(sym3,"Close"),1)/num3;\r\nivol3 +=Foreign(sym3,"volume")/num3;\r\nma5vol3 = MA(ivol3,5);\r\nma50vol3 = MA(ivol3,50);\r\nvchange3 = ivol3/ma50vol3*100;\r\nv5change3 = ma5vol3/ma50vol3*100;\r\n}\r\n_SECTION_END();\r\n\r\n//===================== * SECTOR XD_VLXD * ==============================\r\n\r\n_SECTION_BEGIN("XD_VLXD");\r\n\r\nSymCount4 = StrCount( XD_VLXD, "," ) + 1;\r\nrow4 = ceil(SymCount4/col);\r\npy4 = py3 + CellHeight+ CellHeight*row3;\r\nivol4 = 0;\r\niclose4=0;\r\nichange4=0;\r\nfor( i = 0; ( sym4 = StrExtract(XD_VLXD,i ) ) != ""; i++ )\r\n{\r\niclose4+=Foreign(sym4,"Close");\r\nnum4=1+StrCount(XD_VLXD,",");\r\ntb4=iclose4/num4;\r\nichange4+=ROC(Foreign(sym4,"Close"),1)/num4;\r\nivol4 +=Foreign(sym4,"volume")/num4;\r\nmavol4 = MA(ivol4,50);\r\nvchange4 = ivol4/mavol4*100;\r\n}\r\n_SECTION_END();\r\n\r\n//===================== * SECTOR HANGHOA * ==============================\r\n\r\n_SECTION_BEGIN("HANGHOA");\r\n\r\n\r\nSymCount5 = StrCount( HANGHOA, "," ) + 1;\r\nrow5 = ceil(SymCount5/col);\r\npy5 = py4 + CellHeight+ CellHeight*row4;\r\nivol5 = 0;\r\niclose5=0;\r\nichange5=0;\r\nfor( i = 0; ( sym5 = StrExtract(HANGHOA,i ) ) != ""; i++ )\r\n{\r\niclose5+=Foreign(sym5,"Close");\r\nnum5=1+StrCount(HANGHOA,",");\r\ntb5=iclose5/num5;\r\nichange5+=ROC(Foreign(sym5,"Close"),1)/num5;\r\nivol5 +=Foreign(sym5,"volume")/num5;\r\nmavol5 = MA(ivol5,50);\r\nvchange5 = ivol5/mavol5*100;\r\n}\r\n_SECTION_END();\r\n\r\n\r\n//===================== * SECTOR BLECONGNGHE * ==============================\r\n\r\n_SECTION_BEGIN("BLECONGNGHE");\r\n\r\n\r\nSymCount6 = StrCount( BLECONGNGHE, "," ) + 1;\r\nrow6 = ceil(SymCount6/col);\r\npy6 = py5 + CellHeight+ CellHeight*row5;\r\nivol6 = 0;\r\niclose6=0;\r\nichange6=0;\r\nfor( i = 0; ( sym6 = StrExtract(BLECONGNGHE,i ) ) != ""; i++ )\r\n{\r\niclose6+=Foreign(sym6,"Close");\r\nnum6=1+StrCount(BLECONGNGHE,",");\r\ntb6=iclose6/num6;\r\nichange6+=ROC(Foreign(sym6,"Close"),1)/num6;\r\nivol6 +=Foreign(sym6,"volume")/num6;\r\nmavol6 = MA(ivol6,50);\r\nvchange6 = ivol6/mavol6*100;\r\n}\r\n_SECTION_END();\r\n\r\n//===================== * SECTOR DIEN_DK * ==============================\r\n_SECTION_BEGIN("DIEN_DK");\r\n\r\nSymCount7 = StrCount( DIEN_DK, "," ) + 1;\r\nrow7 = ceil(SymCount7/col);\r\npy7 = py6 + CellHeight+ CellHeight*row6;\r\nivol7 = 0;\r\niclose7=0;\r\nichange7=0;\r\nfor( i = 0; ( sym7 = StrExtract(DIEN_DK,i ) ) != ""; i++ )\r\n{\r\niclose7+=Foreign(sym7,"Close");\r\nnum7=1+StrCount(DIEN_DK,",");\r\ntb7=iclose7/num7;\r\nichange7+=ROC(Foreign(sym7,"Close"),1)/num7;\r\nivol7 +=Foreign(sym7,"volume")/num7;\r\nmavol7 = MA(ivol7,50);\r\nvchange7 = ivol7/mavol7*100;\r\n}\r\n_SECTION_END();\r\n//===================== * SECTOR TIEUDUNG * ==============================\r\n_SECTION_BEGIN("TIEUDUNG");\r\n\r\n\r\nSymCount8 = StrCount( TIEUDUNG, "," ) + 1;\r\nrow8 = ceil(SymCount8/col);\r\npy8= py7 + CellHeight+ CellHeight*row7;\r\nivol8 = 0;\r\niclose8=0;\r\nichange8=0;\r\nfor( i = 0; ( sym8 = StrExtract(TIEUDUNG,i ) ) != ""; i++ )\r\n{\r\niclose8+=Foreign(sym8,"Close");\r\nnum8=1+StrCount(TIEUDUNG,",");\r\ntb8=iclose8/num8;\r\nichange8+=ROC(Foreign(sym8,"Close"),1)/num8;\r\nivol8 +=Foreign(sym8,"volume")/num8;\r\nmavol8 = MA(ivol8,50);\r\nvchange8 = ivol8/mavol8*100;\r\n}\r\n_SECTION_END();\r\n//===================== * SECTOR VANTAI * ==============================\r\n_SECTION_BEGIN("VANTAI");\r\n\r\n\r\nSymCount9 = StrCount( VANTAI, "," ) + 1;\r\nrow9 = ceil(SymCount9/col);\r\npy9 = py8 + CellHeight+ CellHeight*row8;\r\nivol9 = 0;\r\niclose9=0;\r\nichange9=0;\r\nfor( i = 0; ( sym9 = StrExtract(VANTAI,i ) ) != ""; i++ )\r\n{\r\niclose9+=Foreign(sym9,"Close");\r\nnum9=1+StrCount(VANTAI,",");\r\ntb9=iclose9/num9;\r\nichange9+=ROC(Foreign(sym9,"Close"),1)/num9;\r\nivol9 +=Foreign(sym9,"volume")/num9;\r\nmavol9 = MA(ivol9,50);\r\nvchange9 = ivol9/mavol9*100;\r\n}\r\n_SECTION_END();\r\n//===================== * SECTOR KHAC * ==============================\r\n_SECTION_BEGIN("KHAC");\r\n\r\nSymCount10 = StrCount( KHAC, "," ) + 1;\r\nrow10 = ceil(SymCount10/col);\r\npy10 = py9 + CellHeight+ CellHeight*row9;\r\npy11 = py10 + CellHeight+ CellHeight*row10;\r\nivol10 = 0;\r\niclose10=0;\r\nichange10=0;\r\nfor( i = 0; ( sym10 = StrExtract(KHAC,i ) ) != ""; i++ )\r\n{\r\niclose10+=Foreign(sym10,"Close");\r\nnum10=1+StrCount(KHAC,",");\r\ntb10=iclose10/num10;\r\nichange10+=ROC(Foreign(sym10,"Close"),1)/num10;\r\nivol10 +=Foreign(sym10,"volume")/num10;\r\nmavol10 = MA(ivol10,50);\r\nvchange10 = ivol10/mavol10*100;\r\n}\r\n_SECTION_END();\r\n\r\nrow_num = row1 + row2+ row3+ row4+ row5 + row6+ row7+ row8 + row9 + row10 ;\r\n//Stockprice Dashboard\r\ncolor = Null;\r\n//GfxFillSolidRect( x1, y1, x1+CellWidth*col, y1+CellHeight*row, colorGrey40 );\r\nfunction SymPicker(tickerlist,x1, y1,CellHeight,CellWidth,col)\r\n{\r\nGfxSelectPen( colorGrey40 ); \r\n\r\nsym_num = StrCount(tickerlist, ",")+1;\r\nmat = Matrix(sym_num, 2);\r\nrownum = MxGetSize(mat, 0);\r\nlast_bar = BarCount-1;\r\n\r\n\tfor ( i = 0; i &lt; sym_num; i++ )\r\n\t{\r\n\t\t\r\n\tTicker = StrExtract( tickerlist, i, ',' );\r\n\tSetForeign(Ticker);\r\n\tfC = close;\r\n\tRestorePriceArrays();\r\n\tidx = Max(Min(NullCount(fc),last_bar), fvb);\r\n\t\t\r\n\t\tif (! IsNull(fc[ idx ])) {\r\n\t\t\trelP = ROC(fc,1);\r\n\t\t\tmat[i][0] = LastValue( relP ); \r\n\t\t\tmat[i][1] = i; \t\t\r\n\t\t\t}\r\n\t}\r\n\tmat = MxSortRows(mat, False, 0);\r\n\tfor ( i = 0; i &lt; rownum; i++ ) \r\n\t{\r\n\t\tval = mat[i][0];\tn = mat[i][1];\r\n\t\tif (! IsNull(val)) \r\n\t{\t\r\n\t\tTicker = StrExtract(tickerlist, n);\r\n\t\tif (val[i] &gt;= 6.7)\r\n\t\tcolor = ColorRGB(255,128,255);\r\n\t\telse if (val[i] &gt;= 3 AND val[i]&lt; 6.7)\r\n\t\tcolor = ColorRGB(0,255,0); \r\n\t\telse if (val[i] &gt;= 1 AND val[i]&lt; 3)\r\n\t\tcolor = ColorRGB(102,225,102); \r\n\t\t\telse if (val[i] &gt; 0 AND val[i]&lt; 1)\r\n\t\t\tcolor = ColorRGB(178,256,102); \r\n\t\t\t\telse if (val[i] == 0 )\r\n\t\t\t\tcolor = ColorRGB(255,255,128); \r\n\t\t\t\t\telse if (val[i] &lt; 0 AND val[i] &gt;= -1)\r\n\t\t\t\t\tcolor = ColorRGB(255,204,153); \r\n\t\t\t\t\t\telse if (val[i] &lt; -1 AND val[i] &gt;= -3)\r\n\t\t\t\t\t\tcolor = ColorRGB(255,128,0);\r\n\t\t\t\t\t\t\telse if (val[i] &lt; -3 AND val[i] &gt;= -6.7)\r\n\t\t\t\t\t\t\tcolor = ColorRGB(255,51,51);\r\n\t\t\t\t\t\t\t\telse ColorRGB(0,255,255);\r\n\t\t\r\n\t\tGfxSelectSolidBrush(  color);\r\n\t\t\r\n\t\tGfxSelectFont( "Arial",fontsize/3.2 ); \r\n\t\tGfxSelectPen(colorGrey40);\r\n\t\tGfxRoundRect( x1, y1, x1+CellWidth, y1+CellHeight , 5, 5 ) ;\t\r\n\t\tGfxSetTextColor(colorBlack);\r\n\t\tGfxTextOut( Ticker + WriteVal(val,5.1)+"%", x1+10, y1+3 );\r\n\t\t\r\n\t\tif ( px &gt; x1 AND px&lt;x1+CellWidth AND py&gt; y1 AND py &lt; y1+CellHeight AND Click )\t{\r\n        AB = CreateObject( "Broker.Application" );\r\n\t\tdoc = AB.ActiveDocument;\r\n\t\tdoc.Name = Ticker;\r\n\t\t\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\tif( x1 + CellWidth &gt;= start_x + CellWidth*col ) \r\n\t\t{\r\n\t\t\ty1 += CellHeight ;\r\n\t\t\tx1 = start_x ;\r\n\t\t}\r\n\t\t\telse x1 += CellWidth ;\r\n\t\t}\t\t\r\n\t}\r\n\r\n}\r\n\r\nfunction toplist(TickerList,topn,period,text,_x0,_y0,CellWidth,CellHeight)\r\n{\r\n\t\tGfxSelectSolidBrush(colorDarkGreen);\r\n\t\tGfxRoundRect(_x0, _y0+10, _x0 + CellWidth*col/3+5, _y0+CellHeight*(topn+2)+10,15,15);\r\n\t\tGfxLabel(text,_x0, _y0+10, CellWidth*col/3,CellHeight,1);\r\n\t\t\t\r\n\t\tsym_num = StrCount(tickerlist, ",")+1;\r\n\t\t\r\n\t\tmat = Matrix(sym_num, 2);\r\n\t\trownum = MxGetSize(mat, 0);\r\n\t\tlast_bar = BarCount-1;\r\n\t\tfor ( i = 0; ( symbol = StrExtract( TickerList, i ) ) != ""; i++ )\r\n\t\t{\r\n\t\tsymbol = StrExtract( tickerlist, i );\r\n\t\tSetForeign(symbol);\r\n\t\tfc = Close; \r\n\t\tRestorePriceArrays();\r\n\t\tidx = Max(Min(NullCount(fc),last_bar), fvb);\r\n\t\tif (! IsNull(fc[ idx ])) {\r\n\t\t\trelP = ROC(fc,period);\r\n\t\t\tmat[i][0] = LastValue( relP ); \r\n\t\t\tmat[i][1] = i; \t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tmat = MxSortRows(mat, False, 0);\r\n\t\tfor ( i = 0; i &lt; topn AND i &lt; sym_num; i++ ) {\r\n\t\tval = mat[i][0];\tn = mat[i][1];\r\n\t\tif (! IsNull(val))\r\n\t\t\t{\r\n\t\t\t\tif (val[i] &gt;= 35)\r\n\t\t\t\tcolor = ColorRGB(255,128,255);\r\n\t\t\t\t\telse if (val[i] &gt;= 20 AND val[i]&lt; 35)\r\n\t\t\t\t\tcolor = ColorRGB(0,255,0); \r\n\t\t\t\t\t\telse if (val[i] &gt;= 5 AND val[i]&lt; 20)\r\n\t\t\t\t\t\tcolor = ColorRGB(102,225,102); \r\n\t\t\t\t\t\t\telse if (val[i] &gt; 0 AND val[i]&lt; 5)\r\n\t\t\t\t\t\t\tcolor = ColorRGB(178,256,102); \r\n\t\t\t\t\t\t\t\telse if (val[i] == 0 )\r\n\t\t\t\t\t\t\t\tcolor = ColorRGB(255,255,128); \r\n\t\t\t\t\t\t\t\t\telse if (val[i] &lt; 0 AND val[i] &gt;= -5)\r\n\t\t\t\t\t\t\t\t\tcolor = ColorRGB(255,204,153); \r\n\t\t\t\t\t\t\t\t\t\telse if (val[i] &lt; -5 AND val[i] &gt;= -20)\r\n\t\t\t\t\t\t\t\t\t\tcolor = ColorRGB(255,128,0);\r\n\t\t\t\t\t\t\t\t\t\t\telse if (val[i] &lt; -20 AND val[i] &gt;= -35)\r\n\t\t\t\t\t\t\t\t\t\t\tcolor = ColorRGB(255,51,51);\r\n\t\t\t\t\t\t\t\t\t\t\t\telse ColorRGB(0,255,255);\r\n\t\t\t\t\r\n\t\t\tsymbol = StrExtract(tickerlist, n);\r\n\t\t\t////////////\r\n\t\t\ttextname=symbol;\r\n\t\t\t//mauneno=ColorBlend( colorLavender, colorLavender, 0 );\r\n\t\t\tGfxSelectFont( "Arial", fontsize/3.2, 500 );\r\n\t\t\tGfxSetTextColor( colorGold);\r\n\t\t\tGfxDrawText("Ticker     % ",_x0 +10 , _y0 + cellHeight+5, _x0+cellWidth*col/3, _y0+2*cellHeight+5, 0);\r\n\t\t\tGfxSelectSolidBrush(color);\r\n\t\t\tGfxRoundRect(_x0,_y0 + (i+2) * cellHeight+3,_x0+cellWidth*col/3, (i+3) * cellHeight+_y0 +3,15,15);\r\n\t\t\tif ( px &gt; _x0 AND px&lt;_x0+cellWidth*col/3 AND py&gt; _y0 + (i+2) * cellHeight+3 AND py &lt; (i+3) * cellHeight+_y0 +3 AND Click )\t{\r\n\t\t\tAB = CreateObject( "Broker.Application" );\r\n\t\t\tdoc = AB.ActiveDocument;\r\n\t\t\tdoc.Name = symbol;\r\n\t\t\t}\r\n\t\t\tGfxSetTextColor( colorBlack);\r\n\t\t\tGfxDrawText(textname,_x0 +10 , _y0 + (i+2) * cellHeight +  5, _x0+cellWidth, (i+3) * cellHeight+_y0 +5, 0);\r\n\t\t\t\r\n\t\t\t//GfxDrawText(textgia,_x0 ,_y0 + (i+2) * cellHeight +  5, _x0 +  cellWidth*col/3, (i+3) * cellHeight+_y0 +5 , 1);\r\n\t\t\t\r\n\t\t\tGfxDrawText(StrFormat( "%s  %.1f%%", "    ",val),_x0 ,_y0 + (i+2) * cellHeight +  5, _x0 +  cellWidth*col/3-10, (i+3) * cellHeight+_y0 +5 , 2);\r\n\t\t\r\n\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t\r\n}\r\n\r\n\r\nfunction topKL(TickerList,topn,Sort_,text,_x0,_y0,CellWidth,CellHeight)\r\n{\r\n\t\tGfxSelectSolidBrush(colorDarkGreen);\r\n\t\tGfxRoundRect(_x0, _y0+10, _x0 + CellWidth*col/2+5, _y0+CellHeight*(topn+2)+10,15,15);\r\n\t\tGfxLabel(text,_x0, _y0+10, CellWidth*col/2,CellHeight,1);\r\n\t\t\t\r\n\t\tsym_num = StrCount(tickerlist, ",")+1;\r\n\t\t\r\n\t\tmat = Matrix(sym_num, 2);\r\n\t\trownum = MxGetSize(mat, 0);\r\n\t\tlast_bar = BarCount-1;\r\n\t\tfor ( i = 0; i&lt; sym_num; i++ )\r\n\t\t{\r\n\t\t\r\n\t\tsymbol = StrExtract( tickerlist, i, ',' );\r\n\t\tSetForeign(symbol);\r\n\t\tfc = Close; \r\n\t\trfc = ROC(fc,1);\r\n\t\t\r\n\t\tidx = Max(Min(NullCount(fc),last_bar), fvb);\r\n\t\tif (! IsNull(fc[ idx ])) {\r\n\t\tEV=V;\r\n\t\tDBKL = EV/MA(V,50)*100 ;\r\n\t\t\r\n\t\tRestorePriceArrays();\r\n\t\t\tmat[i][0] = LastValue( DBKL ); \r\n\t\t\tmat[i][1] = i; \t\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tmat = MxSortRows(mat, Sort_, 0);\r\n\t\tfor ( i = 0; i &lt; topn AND i &lt; sym_num; i++ ) {\r\n\t\tval = mat[i][0];\tn = mat[i][1];\r\n\t\t\t\r\n\t\tif (! IsNull(val))\r\n\t\t{\r\n\t\t\t\tif (val[i] &lt;= 60)\r\n\t\t\t\tcolor = colorGrey40;\r\n\t\t\t\t\telse if (val[i] &gt; 60 AND val[i]&lt;= 80)\r\n\t\t\t\t\tcolor = colorGold; \r\n\t\t\t\t\t\telse if (val[i] &gt;80 AND val[i]&lt;= 110 AND  rfc[i] &gt;= 0)\r\n\t\t\t\t\t\tcolor = colorGreen; \r\n\t\t\t\t\t\t\telse if (val[i] &gt;80 AND val[i]&lt;= 110 AND rfc[i] &lt; 0)\r\n\t\t\t\t\t\t\tcolor = colororange; \r\n\t\t\t\t\t\t\t\telse if (val[i] &gt; 110 AND val[i]&lt;= 200 AND  rfc[i] &gt;= 0)\r\n\t\t\t\t\t\t\t\tcolor = colorBrightGreen; \r\n\t\t\t\t\t\t\t\t\telse if (val[i] &gt; 110 AND val[i]&lt;= 200 AND rfc[i] &lt; 0)\r\n\t\t\t\t\t\t\t\t\tcolor = colorRed; \r\n\t\t\t\t\t\t\t\t\t\telse if (val[i] &gt; 200 AND   rfc[i] &gt;= 0)\r\n\t\t\t\t\t\t\t\t\t\tcolor = ColorRGB(249,4,249);\r\n\t\t\t\t\t\t\t\t\t\t\telse ColorRGB(0,253,251);\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t////////////\r\n\t\t\tsymbol = StrExtract(tickerlist, n,',');\r\n\t\t\tSetForeign(symbol);\r\n\t\t\tfc1 = LastValue(close);\r\n\t\t\r\n\t\t\tRestorePriceArrays();\r\n\t\t\ttextname=symbol;\r\n\t\t\ttextgia=WriteIf(fc1&lt;10,"0"+WriteVal(fc1,1.2),WriteVal(fc1,1.2));\t\r\n\t\t\t//mauneno=ColorBlend( colorLavender, colorLavender, 0 );\r\n\t\t\tGfxSelectFont( "Arial", fontsize/3.2, 500 );\r\n\t\t\tGfxSetTextColor( colorGold);\r\n\t\t\tGfxDrawText("Ticker  % Gia   % DBKL",_x0 +8 , _y0 + cellHeight+5, _x0+cellWidth*col/2, _y0+2*cellHeight+5, 0);\r\n\t\t\tGfxSelectSolidBrush(color);\r\n\t\t\tGfxRoundRect(_x0,_y0 + (i+2) * cellHeight+3,_x0+cellWidth*col/2, (i+3) * cellHeight+_y0 +3,15,15);\r\n\t\t\tif ( px &gt; _x0 AND px&lt;_x0+cellWidth*col/2 AND py&gt; _y0 + (i+2) * cellHeight+3 AND py &lt; (i+3) * cellHeight+_y0 +3 AND Click )\t{\r\n\t\t\tAB = CreateObject( "Broker.Application" );\r\n\t\t\tdoc = AB.ActiveDocument;\r\n\t\t\tdoc.Name = symbol;\r\n\t\t\t}\r\n\t\t\tGfxSetTextColor( colorBlack);\r\n\t\t\tGfxDrawText(textname,_x0 +10  , _y0 + (i+2) * cellHeight +  5, _x0+cellWidth/2, (i+3) * cellHeight+_y0 +5, 1);\r\n\t\t\t\r\n\t\t\tGfxDrawText(textgia,_x0+cellWidth/1.5 ,_y0 + (i+2) * cellHeight +  5, _x0 +  150, (i+3) * cellHeight+_y0 +5 , 1);\r\n\t\t\t\r\n\t\t\tGfxDrawText(StrFormat( "%s  %.1f%%", "    ",val),_x0 +  150,_y0 + (i+2) * cellHeight +  5, _x0 + cellWidth*col/2-10, (i+3) * cellHeight+_y0 +5 ,2);\r\n\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\t\t}\r\n}\r\n\r\nfunction DMDT(TickerList,text,_x0,_y0,CellWidth,CellHeight)\r\n{\r\n\tGfxSelectSolidBrush(colorDarkGreen);\r\n\tsym_num = StrCount(tickerlist, "|")+1;\r\n\tGfxRoundRect(_x0, _y0+10, _x0 + CellWidth*col+5, _y0+CellHeight*(sym_num+2)+10,15,15);\r\n\tGfxLabel(text,_x0, _y0+10, CellWidth*col,CellHeight,1);\r\n\t\t\r\n\tfor ( i = 0; i&lt; sym_num; i++ )\r\n\t{\r\n\tlist = StrExtract( Myasset, i, '|' );\r\n\r\n\tsymbol = StrExtract( list, 0, ',' ) ;\r\n\tGiamua = StrExtract( list, 1, ',' ) ;\r\n\tStoploss = StrExtract( list, 2, ',' ) ;\r\n\tTarget = StrExtract( list, 3, ',' ) ;\r\n\t\r\n\tSetForeign(symbol);\r\n\tfC = close;\r\n\trfc = ROC(fc,1);\r\n\tRestorePriceArrays();\r\n\tfC1 = LastValue(fC);\r\n\trfc1 = LastValue(rfc);\r\n\tPnL = (fC1 - StrToNum(giamua))/StrToNum(giamua)*100;\r\n\t\r\n\tCutloss = fC1 &lt; StrToNum(Stoploss);\r\n\ttakeprofit = fC1 &gt; StrToNum(Target);\r\n\t\r\n\tif (fC1 &lt; StrToNum(Stoploss))\r\n\t\tcolor = colorRed;\r\n\t\telse if (fC1 &gt;= StrToNum(Stoploss) AND fC1 &lt;= StrToNum(giamua))\r\n\t\t\tcolor = colorOrange; \r\n\t\t\telse if (fC1 &lt;= StrToNum(Target) AND  fC1 &gt; StrToNum(giamua))\r\n\t\t\t\tcolor = colorGreen; \r\n\t\t\t\t\telse if (fC1 &gt; StrToNum(Target) )\r\n\t\t\t\t\t\tcolor = ColorRGB(249,4,249);\r\n\t\t\r\n\t\t\ttextname=symbol;\r\n\t\t\ttextgia=WriteIf(fC1&lt;10,"0"+WriteVal(fC1,1.2),WriteVal(fC1,1.2));\t\r\n\t\t\t//mauneno=ColorBlend( colorLavender, colorLavender, 0 );\r\n\t\t\tGfxSelectFont( "Arial", fontsize/3.2, 500 );\r\n\t\t\tGfxSetTextColor( colorGold);\r\n\t\t\tGfxDrawText("Ticker  Gia Mua   Stoploss   Price   Target   PnL",_x0 +8 , _y0 + cellHeight+5, _x0+cellWidth*col, _y0+2*cellHeight+5, 0);\r\n\t\t\tGfxSelectSolidBrush(color);\r\n\t\t\tGfxRoundRect(_x0,_y0 + (i+2) * cellHeight+3,_x0+cellWidth*col, (i+3) * cellHeight+_y0 +3,15,15);\r\n\t\t\tif ( px &gt; _x0 AND px&lt;_x0+cellWidth*col AND py&gt; _y0 + (i+2) * cellHeight+3 AND py &lt; (i+3) * cellHeight+_y0 +3 AND Click )\t{\r\n\t\t\tAB = CreateObject( "Broker.Application" );\r\n\t\t\tdoc = AB.ActiveDocument;\r\n\t\t\tdoc.Name = symbol;\r\n\t\t\t}\r\n\t\t\tGfxSetTextColor( colorBlack);\r\n\t\t\tGfxDrawText(textname,_x0   , _y0 + (i+2) * cellHeight +  5, _x0+cellWidth*col/6, (i+3) * cellHeight+_y0 +5, 1);\r\n\t\t\tGfxDrawText(giamua,_x0 +cellWidth*col/6 , _y0 + (i+2) * cellHeight +  5, _x0+cellWidth*col/3, (i+3) * cellHeight+_y0 +5, 1);\r\n\t\t\tGfxDrawText(stoploss,_x0 +cellWidth*col/3  , _y0 + (i+2) * cellHeight +  5, _x0 +cellWidth*col/2, (i+3) * cellHeight+_y0 +5, 1);\r\n\r\n\t\t\tGfxDrawText(textgia,_x0 +cellWidth*col/2 ,_y0 + (i+2) * cellHeight +  5, _x0 +cellWidth*col/3*2, (i+3) * cellHeight+_y0 +5 , 1);\r\n\t\t\tGfxDrawText(target,_x0 +cellWidth*col/3*2  , _y0 + (i+2) * cellHeight +  5, _x0 +cellWidth*col/6*5, (i+3) * cellHeight+_y0 +5, 1);\r\n\t\t\t\r\n\t\t\tGfxDrawText(StrFormat( "%s  %.1f%%", "    ",Pnl),_x0 +cellWidth*col/6*5 ,_y0 + (i+2) * cellHeight +  5, _x0 + cellWidth*col, (i+3) * cellHeight+_y0 +5 ,2);\r\n\t\t\r\n\t\t\r\n\t}\r\n}\r\n\r\nfunction watchlist(TickerList,text,_x0,_y0,CellWidth,CellHeight)\r\n{\r\n\tGfxSelectSolidBrush(colorDarkGreen);\r\n\tsym_num = StrCount(tickerlist, "|")+1;\r\n\tGfxRoundRect(_x0, _y0+10, _x0 + CellWidth*col+5, _y0+CellHeight*(sym_num+2)+10,15,15);\r\n\tGfxLabel(text,_x0, _y0+10, CellWidth*col,CellHeight,1);\r\n\tfor ( i = 0; i&lt; wl_count; i++ )\r\n\t{\t\r\n\tlist = StrExtract( Mywl, i, '|' );\r\n\r\n\tsymbol = StrExtract( list, 0, ',' ) ;\r\n\tpivot = StrExtract( list, 1, ',' ) ;\r\n\t\r\n\tSetForeign(symbol);\r\n\tfC = close;\r\n\trfc = ROC(fc,1);\r\n\tGTGD = LastValue(V*C);\r\n\tDBKL = LastValue(V/MA(V,50)*100) ;\r\n\tRestorePriceArrays();\r\n\t\r\n\t\r\n\tRestorePriceArrays();\r\n\tfC1 = LastValue(fC);\r\n\trfc1 = LastValue(rfc);\r\n\t\r\n\tbreakout = fC1 &gt; StrToNum(pivot);\r\n\t\t\r\n\tif (breakout)\r\n\t\t\tcolor = colorGreen;\r\n\t\telse color = colorGold;\r\n\t\t\r\n\t\t\ttextname=symbol;\r\n\t\t\ttextgia=WriteIf(fC1&lt;10,"0"+WriteVal(fC1,1.2),WriteVal(fC1,1.2));\t\r\n\t\t\t//mauneno=ColorBlend( colorLavender, colorLavender, 0 );\r\n\t\t\tGfxSelectFont( "Arial", fontsize/3.2, 500 );\r\n\t\t\tGfxSetTextColor( colorGold);\r\n\t\t\tGfxDrawText("Ticker    Gia      %       GTGD         %DBKL   Pivot",_x0 +8 , _y0 + cellHeight+5, _x0+cellWidth*col, _y0+2*cellHeight+5, 0);\r\n\t\t\tGfxSelectSolidBrush(color);\r\n\t\t\tGfxRoundRect(_x0,_y0 + (i+2) * cellHeight+3,_x0+cellWidth*col, (i+3) * cellHeight+_y0 +3,15,15);\r\n\t\t\tif ( px &gt; _x0 AND px&lt;_x0+cellWidth*col AND py&gt; _y0 + (i+2) * cellHeight+3 AND py &lt; (i+3) * cellHeight+_y0 +3 AND Click )\t{\r\n\t\t\tAB = CreateObject( "Broker.Application" );\r\n\t\t\tdoc = AB.ActiveDocument;\r\n\t\t\tdoc.Name = symbol;\r\n\t\t\t}\r\n\t\t\tGfxSetTextColor( colorBlack);\r\n\t\t\tGfxDrawText(textname,_x0   , _y0 + (i+2) * cellHeight +  5, _x0+cellWidth*col/6, (i+3) * cellHeight+_y0 +5, 1);\r\n\t\t\tGfxDrawText(textgia,_x0 +cellWidth*col/6-30 , _y0 + (i+2) * cellHeight +  5, _x0+cellWidth*col/3, (i+3) * cellHeight+_y0 +5, 1);\r\n\t\t\tGfxDrawText(StrFormat( "%s  %.1f%%", "    ",rfc1),_x0 +cellWidth*col/6 ,_y0 + (i+2) * cellHeight +  5, _x0 + cellWidth*col/2, (i+3) * cellHeight+_y0 +5 ,1);\r\n\t\t\tGfxDrawText(numtostr(GTGD,4.0),_x0 +cellWidth*col/2-30  , _y0 + (i+2) * cellHeight +  5, _x0 +cellWidth*col/3*2+10, (i+3) * cellHeight+_y0 +5, 1);\r\n\r\n\t\t\tGfxDrawText(StrFormat( "%s  %.1f%%", "    ",DBKL),_x0 +cellWidth*col/3*2-20 ,_y0 + (i+2) * cellHeight +  5, _x0 +cellWidth*col/6*5+20\t, (i+3) * cellHeight+_y0 +5 , 1);\r\n\t\t\tGfxDrawText(pivot,_x0 +cellWidth*col/6*5  , _y0 + (i+2) * cellHeight +  5, _x0 +cellWidth*col-10, (i+3) * cellHeight+_y0 +5, 2);\r\n\t\t\r\n\t}\r\n}\r\n\r\n_SECTION_BEGIN("TOP CP");\r\nNday1  = Param("list 1 period",1,1,5,1);\r\nNday2  = Param("list 2 period",5,1,10,1);\r\nNday3  = Param("list 3 period",10,1,21,1);\r\nNday4  = Param("list 4 period",21,1,65,1);\r\nNday5  = Param("list 5 period",65,1,120,1);\r\nNday6  = Param("list 6 period",120,1,250,1);\r\ntopn1 = Param("Top 1",15,5,20,1); //Lay Top 15\r\ntopn2 = Param("Top 2",15,5,20,1); //Lay Top 15\r\n_SECTION_END();\t\r\nprocedure GfxHT(x,y) {\r\n\tSetOrigin(x1,y1+CellHeight*3);\r\n\tG = GfxHTabs("HTab1", "BANG GIA,DANH MUC,TOP CP", 30, _x0, _y0-CellHeight+4, CellWidth*col, CellHeight, colorWhite, colorGrey40); \r\n\t\r\n\t\r\n\t\r\n\tswitch(G)\r\n\t{\r\n\r\n\t\tcase 0: \r\n\t\t\t\r\n\t\t\tGfxSelectSolidBrush(colorDarkGreen);\r\n\t\t\tGfxRoundRect(_x0, _y0+10, _x0 + CellWidth*col+5, _y0+CellHeight*(row_num+11)+10,15,15);\r\n\t\t\tGfxSetTextColor(colorYellow);\r\n\t\t\tGfxLabel(" NGAN HANG"+NumToStr(LastValue(ichange1),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange1),8.2)+"%",_x0, _y0+12, CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( NGANHANG, x1, py1+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" CHUNG KHOAN"+NumToStr(LastValue(ichange2),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange2),8.2)+"%",_x0, py1+row1*CellHeight+7, CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( CHUNGKHOAN, x1, py2+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" BAT DONG SAN"+NumToStr(LastValue(ichange3),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange3),8.2)+"%",_x0, py2+row2*CellHeight+7, CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( BATDONGSAN, _x0,py3+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" XD- VLXD"+NumToStr(LastValue(ichange4),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange4),8.2)+"%",_x0, py3+row3*CellHeight+7, CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( XD_VLXD, _x0, py4+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" HANG HOA"+NumToStr(LastValue(ichange5),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange5),8.2)+"%",_x0, py4+row4*CellHeight+7, CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( HANGHOA, _x0, py5+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" BAN LE - CN"+NumToStr(LastValue(ichange6),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange6),8.2)+"%",_x0, py5+row5*CellHeight+7,CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( BLECONGNGHE, _x0, py6+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" NANG LUONG"+NumToStr(LastValue(ichange7),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange7),8.2)+"%",_x0, py6+row6*CellHeight+7, CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( DIEN_DK, _x0, py7+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" TIEU DUNG"+NumToStr(LastValue(ichange8),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange8),8.2)+"%",_x0, py7+row7*CellHeight+7,CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( TIEUDUNG, _x0, py8+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" CANG-VAN TAI"+NumToStr(LastValue(ichange9),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange9),8.2)+"%",_x0, py8+row8*CellHeight+7, CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( VANTAI, _x0, py9+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\tGfxLabel(" NGANH KHAC"+NumToStr(LastValue(ichange10),8.1)+"%  Vol/TB"+ NumToStr(LastValue(vchange10),8.2)+"%",_x0, py9+row9*CellHeight+7,  CellWidth*col,CellHeight,4);\r\n\t\t\tSymPicker( KHAC, _x0, py10+5,CellHeight,CellWidth,col);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\tbreak;\r\n\t\t//////////\r\n\t\tcase 1:\r\n\t\t\r\n\t\t\tDMDT(Myasset," DANH MUC DAU TU",_x0,_y0,CellWidth,CellHeight);\r\n\t\t\twatchlist(mywl,"DANH MUC THEO DOI",_x0,_y0+CellHeight*asset_count+2*CellHeight,CellWidth,CellHeight);\r\n\t\tbreak;\r\n\t\t///////////\t\r\n\t\tcase 2:\t\r\n\t\tGfxSelectSolidBrush(colorDarkGreen);\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\ttoplist(TickerList,topn1,Nday1," TOP " +Nday1+" NGAY",_x0,_y0,CellWidth,CellHeight);\r\n\t\t\r\n\t\ttoplist(TickerList,topn1,Nday2," TOP " +Nday2+" NGAY",_x0+CellWidth*col/3,_y0,CellWidth,CellHeight);\r\n\t\t\r\n\t\ttoplist(TickerList,topn1,Nday3," TOP " +Nday3+" NGAY",_x0+CellWidth*col/3*2,_y0,CellWidth,CellHeight);\r\n\t\t\r\n\t\ttoplist(TickerList,topn2,Nday4," TOP " +Nday4+" NGAY",_x0,_y0+CellHeight*(topn1+2),CellWidth,CellHeight);\r\n\t\ttoplist(TickerList,topn2,Nday5," TOP " +Nday5+" NGAY",_x0+CellWidth*col/3,_y0+CellHeight*(topn1+2),CellWidth,CellHeight);\r\n\t\t\r\n\t\ttoplist(TickerList,topn2,Nday6," TOP " +Nday6+" NGAY",_x0+CellWidth*col/3*2,_y0+CellHeight*(topn1+2),CellWidth,CellHeight);\r\n\t\t\t\t\r\n\tbreak;\t\r\n\r\n\t}\r\n}\r\n \r\n\r\nif( id == IDset AND event == 1 )  // If ToggleButton is clicked\r\n{\r\n    if( ToggleButton ) StaticVarSet( "ToggleButton" + MyChartID, ToggleButton = 0, 0 );\r\n    else  StaticVarSet( "ToggleButton" + MyChartID, ToggleButton = 1, 0 );\r\n}\r\n\r\nif( ToggleButton ) \r\n{ \r\n\t\r\n\tGuiSetText( "On", IDset ); \r\n\tGfxHT(x1,y1+CellHeight*3);\t\r\n}\r\n\r\nelse \r\n{\r\nGuiSetText( "Off", IDset );\r\nGuiSetColors(IDset,IDset,1,colorWhite, colorRed, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n}\r\n\r\n_SECTION_BEGIN("Button");\r\nybutton = Param("Vi tri Button",0,0,5000,1);\r\n\r\n_SECTION_END();\t\r\n_SECTION_BEGIN("Pivot high low");\r\n\r\nprocedure alternate_proc( pk, tr, sumpk, sumtr )\r\n{\r\n    global pkg;\r\n    global trg;\r\n\r\n    pkg = pk;\r\n    trg = tr;\r\n    idxpk = 0;\r\n    idxtr = 0;\r\n    flgtr = 0;\r\n    flgpk = 0;\r\n\r\n    for( i = 1; i &lt; BarCount; i++ )\r\n    {\r\n        if( pk[i] AND sumpk[i] == 1 AND !tr[i] AND flgpk == 0 )\r\n        {\r\n            idxpk = i;\r\n            flgtr = 0;\r\n        }\r\n        else\r\n            if( ( pk[i] AND sumpk[i] &gt; 1 AND !tr[i] ) OR( pk[i] AND flgpk == 1 ) )\r\n            {\r\n                if( H[i] &gt; H[idxpk] )\r\n                {\r\n                    pkg[idxpk] = 0;\r\n                    idxpk = i;\r\n                    flgpk = 0;\r\n                }\r\n                else\r\n                    if( H[i] &lt;= H[idxpk] )\r\n                    {\r\n                        pkg[i] = 0;\r\n                        flgpk = 0;\r\n                    }\r\n            }\r\n            else\r\n                if( tr[i] AND sumtr[i] == 1 AND !pk[i] AND flgtr == 0 )\r\n                {\r\n                    idxtr = i;\r\n                    flgpk = 0;\r\n                }\r\n                else\r\n                    if( ( tr[i] AND sumtr[i] &gt; 1 AND !pk[i] ) OR( tr[i] AND flgtr == 1 ) )\r\n                    {\r\n                        if( L[i] &lt; L[idxtr] )\r\n                        {\r\n                            trg[idxtr] = 0;\r\n                            idxtr = i;\r\n                            flgtr = 0;\r\n                        }\r\n                        else\r\n                            if( L[i] &gt;= L[idxtr] )\r\n                            {\r\n                                trg[i] = 0;\r\n                                flgtr = 0;\r\n                            }\r\n                    }\r\n                    else\r\n                        if( pk[i] AND tr[i] )\r\n                        {\r\n                            if( sumpk[i - 1] &gt; sumtr[i - 1] )\r\n                            {\r\n                                pkg[i] = 0;\r\n                                flgtr = 1;\r\n                                idxtr = i;\r\n                            }\r\n                            else\r\n                                if( sumtr[i - 1] &gt; sumpk[i - 1] )\r\n                                {\r\n                                    trg[i] = 0;\r\n                                    flgpk = 1;\r\n                                    idxpk = i;\r\n                                }\r\n                        }\r\n    }\r\n}\r\n\r\n// Fractal Pivots\r\nx = bi = BarIndex();\r\nfvb = FirstVisibleValue( bi );\r\nlvb = LastVisibleValue( bi );\r\n\r\nrightstrength = Param( "Right Strength", 9, 2, 50, 1 );\r\nleftstrength = Param( "Left Strength", 9, 2, 50, 1 );\r\nleftstrength = rightstrength;\r\n\r\npk = H == HHV( H, leftstrength ) AND Ref( HHV( H, rightstrength ), rightstrength ) &lt; H;\r\ntr = L == LLV( L, leftstrength ) AND Ref( LLV( L, rightstrength ), rightstrength ) &gt; L;\r\n\r\nsumpk = Sum( pk, BarsSince( tr ) );\r\nsumtr = Sum( tr, BarsSince( pk ) );\r\nalternate_proc( pk, tr, sumpk, sumtr );\r\npk = pkg;\r\ntr = trg;\r\n\r\nfor( i = 0; i &lt; 3; i++ )\r\n{\r\n    VarSet( "px" + i, ValueWhen( pk, bi, i ) );\r\n    VarSet( "tx" + i, ValueWhen( tr, bi, i ) );\r\n    VarSet( "ph" + i, ValueWhen( pk, H, i ) );\r\n    VarSet( "tl" + i, ValueWhen( tr, L, i ) );\r\n}\r\n\r\nll = tr AND tl1 &lt; tl2;\r\nhl = tr AND tl1 &gt; tl2;\r\nhh = pk AND ph1 &gt; ph2;\r\nlh = pk AND ph1 &lt; ph2;\r\ndt = pk AND ph1 == ph2;\r\ndb = tr AND tl1 == tl2;\r\n\r\n\r\nclrpk = colorblack;\r\nclrtr = colorblack;\r\n\r\nfor( i = lvb; i &gt; fvb; i-- )\r\n{\r\n    // troughs\r\n    if( ll[i] )\r\n    {\r\n        str = "" + WriteVal(L[i],8.2);\r\n        PlotTextSetFont( str, "Arial", 8, i, L[i], clrtr, colorDefault, -30 );\r\n    }\r\n\r\n    if( hl[i] )\r\n    {\r\n        str = "" + WriteVal(L[i],8.2);\r\n        PlotTextSetFont( str, "Arial", 8, i, L[i], clrtr, colorDefault, -30 );\r\n    }\r\n\r\n    if( db[i] )\r\n    {\r\n        str = "DB";\r\n        PlotTextSetFont( str, "Arial", 8, i, L[i], clrtr, colorDefault, -30 );\r\n    }\r\n\r\n    //peaks\r\n    if( hh[i] )\r\n    {\r\n        str = ""+WriteVal(H[i],8.2);\r\n        PlotTextSetFont( str, "Arial", 8, i, H[i], clrpk, colorDefault, 20 );\r\n    }\r\n\r\n    if( lh[i] )\r\n    {\r\n        str = "" +WriteVal(H[i],8.2);\r\n        PlotTextSetFont( str, "Arial", 8, i, H[i], clrpk, colorDefault, 20 );\r\n    }\r\n\r\n    if( dt[i] )\r\n    {\r\n        str = "DT";\r\n        PlotTextSetFont( str, "Arial", 8, i, H[i], clrpk, colorDefault, 20 );\r\n    }\r\n}\r\n\r\nGraphXSpace = 8;\r\n\r\n\r\n\r\n//Trailing stop\r\n\r\nTrendUp=TrendDown=Null;\r\ntrend[0]=1;\r\nchangeOfTrend=0;\r\nup_threshold = abs(ph1 - tl1)*0.127+ph1;\r\ndn_threshold = tl1 - abs(ph1 - tl1)*0.127;\r\nfor (i = 1; i &lt;BarCount-1; i++) {\r\n      TrendUp[i] = Null;\r\n      TrendDown[i] = Null;\r\n    \r\n      trend[i]=1;\r\n  \r\n      \r\n      if (Close[i]&gt;up_threshold[i-1]) {\r\n        trend[i]=1;\r\n        if (trend[i-1] == -1) changeOfTrend = 1;\r\n        \r\n      }\r\n      else if (Close[i]&lt;dn_threshold[i-1]) {\r\n        trend[i]=-1;\r\n        if (trend[i-1] == 1) changeOfTrend = 1;\r\n      }\r\n      else if (trend[i-1]==1) {\r\n        trend[i]=1;\r\n        changeOfTrend = 0;      \r\n      }\r\n      else if (trend[i-1]==-1) {\r\n        trend[i]=-1;\r\n        changeOfTrend = 0;\r\n      }\r\n\r\n   \r\n      \r\n      if (trend[i]&gt;0 &amp;&amp; dn_threshold[i]&lt;dn_threshold[i-1]){\r\n        dn_threshold[i]=dn_threshold[i-1];\r\n      }\r\n      \r\n      if (trend[i]&lt;0 &amp;&amp; up_threshold[i]&gt;up_threshold[i-1])\r\n        { up_threshold[i]=up_threshold[i-1];\r\n      }\r\n      \r\n     \r\n      if (trend[i]==1) {\r\n        TrendUp[i]=dn_threshold[i];\r\n        \r\n      }\r\n      else if (trend[i]==-1) {\r\n        TrendDown[i]=up_threshold[i];\r\n       \r\n      }\r\n  } \r\n\r\nTrailingstop = ParamToggle("Trailingstop","Yes|No");\r\nif(Trailingstop)\r\n{\r\nPlot(TrendUp,"",colorBlack,styleThick);\r\nPlot(TrendDown,"",colorBlack,styleThick);\r\nBuy = trend==1;\r\nSell=trend==-1;\r\n\r\nBuy=ExRem(Buy,Sell);\r\nSell=ExRem(Sell,Buy);\r\nShort=Sell;\r\nCover=Buy;\r\n\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorGreen, 0, L, Offset=-40);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLime, 0,L, Offset=-50);                      \r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-45); \r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=40);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorOrange, 0,H, Offset=50);                      \r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-45);\r\n}\r\n\r\n\r\n_SECTION_END();\r\n_SECTION_BEGIN("Volume");\r\n\r\n//Volume\r\n\r\nhhvv = HighestVisibleValue( V );\r\nminv = -hhvv/50;\r\nVdn=IIf(C&lt;Ref(C,-1),V,0);\r\nVup=IIf(C&gt;Ref(C,-1),V,0);\r\nhvup10=HHV(vup,10);\r\nhv10=HHV(Vdn,10);\r\nV50=MA(V,50);\r\nVolratio = V/V50*100;\r\nupday = C&gt;Ref(C,-1);\r\ncolorPricechg = IIf(upday,colorGreen,colorred);\r\nTypeofVol  = ParamList("Type of Volume","Zanger volume ratio,pivot pocket volume,standard",0);\r\nswitch(TypeofVol)\r\n{\r\n\tcase "Zanger volume ratio":\r\n   color = IIf( Volratio &lt;= 60, colorGrey40, IIf(Volratio &gt; 60 AND Volratio &lt;= 80, colorGold, IIf(Volratio&gt;80 AND Volratio &lt;= 110 AND upday , colorGreen \t, IIf(Volratio&gt;80 AND Volratio &lt;= 110 AND NOT upday , colororange , IIf(Volratio &gt; 110 AND Volratio  &lt;= 200 AND upday, colorBrightGreen,  IIf(Volratio &gt; 110 AND Volratio &lt;= 200 AND NOT upday , colorRed, IIf(Volratio &gt; 200 AND upday, ColorRGB(249,4,249), ColorRGB(0,253,251))))))))\t; \r\n   \r\n  \r\n\tbreak;\r\n\tcase "pivot pocket volume":\r\n\tcolor=IIf( C &gt; Ref(C,-1) AND V&lt;hv10, ParamColor("Volume up", colorGreen ), IIf(C&gt;Ref(C,-1) AND V&gt;hv10,ParamColor("Pivot Pocket", colorBrightGreen)  ,IIf(C&lt;Ref(C,-1) AND V&gt;hvup10,ParamColor("Max Volumn down",ColorRGB(0,253,251)),ParamColor("Volume down",colorred))));\r\n\t\r\n\tbreak;\r\n      \r\n   \r\n    case "standard":\r\n    color = IIf(C&gt;= Ref(C,-1),ParamColor("Volume up", colorGreen ),ParamColor("Volume down",colorred));\r\n    break;\r\n}\r\nSetBarFillColor(color);\r\nPlot(V,_DEFAULT_NAME(),ParamColor("color Volume",colorWhite),styleArea|styleOwnScale|styleNoLabel, minv, hhvv*9);\r\nCHANGE=((C - Ref(C,-1))/Ref(C,-1))*100;\r\nPlot(V50, "Vol TB 50 Day", colorBlue, styleLine|styleOwnScale|styleNoLabel, minv, hhvv*9, 0, 10);\r\n\r\n_SECTION_END();\r\n_SECTION_BEGIN("Price Chart");\r\n\r\nema13 = eMA (C,13);\r\n//Plot(ema13,"EMA13",colorGold,styleLine+styleThick+styleNoLabel+styleNoTitle);\r\nr1 = 12; \r\nr2 = 26;\r\nr3 = 9; \r\n \r\nhist = MACD(12,26) - Signal(12,26,9);\r\n \r\nbuyhist = hist &gt; Ref(hist,-1);\r\nsellhist = hist &lt; Ref(hist,-1);\r\nstay = hist == Ref(hist,-1);\r\n \r\nbuyema = ema13  &gt; Ref(ema13 ,-1);\r\nsellema =ema13  &lt; Ref(ema13 ,-1);\r\n \r\n \r\nallowbuy = buyhist AND buyema;\r\nnotallowbuy = sellhist AND sellema;\r\n\r\n\r\n//ICHIMOKU SYSTEM - 3 KIJUN\r\n\r\nTenkanSenPeriods = 9;\r\nKijunSenPeriods = 17;\r\nSenkouSpanBPeriods = 26;\r\n\r\nkijun = ( HHV( H, KijunSenPeriods ) + LLV( L, KijunSenPeriods) )/2;\r\ntekan = ( HHV( H, TenkanSenPeriods ) + LLV( L, TenkanSenPeriods ) )/2;\r\nLagging = Ref( C, -26 );\r\nSpan1 = (( tekan + kijun )/2);\r\nSpan2 = (HHV( H, SenkouSpanBPeriods) + LLV(L, SenkouSpanBPeriods))/2;\r\n\r\nKJ5 = ( HHV( H, 5 ) + LLV( L, 5) )/2;\r\nKJ13 = ( HHV( H, 13 ) + LLV( L, 13) )/2;\r\nKJ26 = ( HHV( H, 26 ) + LLV( L, 26) )/2;\r\nKJ65 = ( HHV( H, 65 ) + LLV( L, 65) )/2;\r\nKJ130 = ( HHV( H, 130 ) + LLV( L, 130) )/2;\r\n\r\nH130=HHV(H,130);\r\nH65=HHV(H,65);\r\nH26=HHV(H,26);\r\nH13=HHV(H,13);\r\nH5=HHV(H,5);\r\n\r\n\r\nTypeofPrice  = ParamList("Type of Price","Candle Stick,Bar Chart,Elder chart",0);\r\nswitch(TypeofPrice)\r\n{\r\n   case "Bar Chart":\r\n        BarColor=IIf(C&gt;Ref(C,-1),colorrgb(46,82,173),colorrgb(238,82,160));\r\n        PlotOHLC( Close,  High,  Low,  Close, "", BarColor, styleBar+styleThick,minv,hhvv*9,0,0,2);\r\n   GraphXSpace = 15;\r\n      break;\r\n      \r\n      \r\n   case "Candle Stick":\r\n        upcolor=ParamColor("Up color ",colorGreen);\r\n        downcolor=ParamColor("Down color ",colorRed);\r\n        barcolor=ParamColor("Bar color ",colorBlack);\r\n        SetBarFillColor(IIf(C&gt;O,upcolor,downcolor));\r\n        PlotOHLC( Open, High, Low, Close, " " , barcolor, styleCandle  +styleNoTitle,minv,hhvv*9);\r\n   GraphXSpace = 15;\r\n        break;\r\n    case "Elder chart":\r\n    thiscolor = IIf(allowbuy, colorGreen, IIf (notallowbuy, colorRed, IIf (stay,colorGreen,colorGold)));\r\n       PlotOHLC( O, H, L, C, "", ThisColor, styleBar+styleThick,minv,hhvv*9,0,0,2); \r\n   GraphXSpace = 15;\r\n\t\tbreak;\r\n\t\r\n} \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("MA");\r\n\r\np1 = Param("Short MA",25,5,200,1);\r\np2 = Param("mid MA",50,20,200,1);\r\np3 = Param("Long MA",200,50,200,1);\r\n\r\n\r\n\r\n\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\n_N(Title =  Name() + " - "+ MarketID(1) + " - "+ StrFormat(" {{DATE}} ")+" - "+ " O " + EncodeColor(colorGold)+ O + EncodeColor(colorGrey40)+ " ,H "+ EncodeColor(colorViolet)+H + EncodeColor(colorGrey40)+" ,L "+EncodeColor(colorRed)+L + EncodeColor(colorGrey40)+" ,C "+ EncodeColor(colorGreen)+C+" "+EncodeColor( SelectedValue(colorPricechg)) + WriteVal(C-Ref(C,-1),1.2) +EncodeColor( SelectedValue(colorPricechg)) + " ("+ WriteVal( ROC( C, 1),1.1)+"%) "+ EncodeColor(colorGrey40)+  " , V " + EncodeColor( SelectedValue(color)) + WriteVal(V,1.0) + EncodeColor(SelectedValue(color))+  " (" +WriteVal(Volratio,1.2) +"%)"+EncodeColor(colorGrey40)+  " , GTGD TB 50 day " + EncodeColor( SelectedValue(color)) + WriteVal(mA(V,50)*C,1.0) );\r\n\r\nGraphLabelDecimals = 2;\r\nGfxSetZOrder(0);\r\n\r\nfunction GetMonth( MonthNumber ) \r\n{ \r\n         switch (MonthNumber) { \r\n            case 2 :  \r\n              result = "Feb"; \r\n               break ; \r\n            case 3 : \r\n              result = "Mar"; \r\n              break ; \r\n            case 4 : \r\n              result = "Apr"; \r\n            break ; \r\n          case 5 : \r\n            result = "May"; \r\n            break ; \r\n          case 6 : \r\n            result = "Jun"; \r\n            break ; \r\n          case 7 : \r\n            result = "Jul"; \r\n            break ; \r\n          case 8 : \r\n            result = "Aug"; \r\n            break ; \r\n          case 9 : \r\n            result = "Sep"; \r\n            break ; \r\n          case 10 : \r\n            result = "Oct"; \r\n            break ; \r\n          case 11 : \r\n            result = "Nov"; \r\n            break ; \r\n          case 12 : \r\n            result = "Dec"; \r\n      break ; \r\n   } \r\n\r\n   return result; \r\n} \r\n\r\n\r\npxchartleft = Status("pxchartleft"); //returns x-coordinate of top-left corner of chart area\r\npxcharttop = Status("pxcharttop"); //returns y-coordinate of top-left corner of chart area \r\n\r\npxchartright = Status("pxchartright");//returns x-coordinate of bottom-right corner of chart area \r\npxchartbottom = Status("pxchartbottom"); //returns y-coordinate of bottom-right corner of chart area\r\n \r\npxchartwidth = Status("pxchartwidth"); //returns width chart area (right-left) \r\npxchartheight = Status("pxchartheight"); //returns width chart area (bottom-top) \r\n\r\nMiny = Status("axisminy"); //retrieves the minimum (bottom) value of Y axis \r\nMaxy = Status("axismaxy"); //retrieves the maximum (top) value of Y axis \r\n\r\n\r\n\r\nToggleButton1 = Nz( StaticVarGet( "ToggleButton1" + MyChartID ));\r\n\r\nGuiButtonTrigger( "Weekly Off", pxchartright -CellWidth*4, ybutton, CellWidth, CellHeight );\r\nGuiSetColors(IDset,IDset,2,colorWhite, colorGreen, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n\r\nif( id == IDset AND event == 1 )  // If ToggleButton is clicked\r\n{\r\n    if( ToggleButton1 ) StaticVarSet( "ToggleButton1" + MyChartID, ToggleButton1 = 0, 0 );\r\n    else  StaticVarSet( "ToggleButton1" + MyChartID, ToggleButton1 = 1, 0 );\r\n}\r\nif( ToggleButton1 ) \r\n{ \r\n\t\r\nGuiSetText( "Weekly On", IDset ); \r\n\r\nGfxSetZOrder(2);\r\n_SECTION_BEGIN("Chart in chart");\r\nletrai1=Param ( "Le Trai", 1250 , 0 , 2000 , 1 ) ;\r\nletren1=Param ( "le Tren", 50 , 0 , 2000 , 1 ) ;\r\nChartHeight = Param ( "chieu cao", 350 , 0 , 2000 , 1 ) ;   \r\nWidth = Param ( "chieu rong", 700 , 0 , 2000 , 1 ) ; \r\nChartsWiNum = 1;\r\nChartsHiNum = 1;\r\nBars =Param ( "Number Of Bars", 65, 50 , 250 , 1 ) ;   \r\nlDays =Param ( "Long EMA", 200 , 50 , 250 , 1 ) ;\r\nsDays =Param ( "Mid EMA", 50 , 5 , 100 , 1 ) ;\r\ntDays= Param ( "Short EMA", 20 , 5 , 100 , 1 ) ;\r\nvDays =Param ( "Volume MA", 20 , 5 , 100 , 1 ) ;\r\nChartMargin = 5 ;\r\nDateMargin = 10 ;\r\nDataMargin = 20 ;\r\nNumCharts = ChartsWiNum * ChartsHiNum ;\r\nScreenHeight = Status ( "pxheight" )  ;\r\nSceernWidth = Status ( "pxwidth" ) ;\r\n\r\nBarChartHeight=  (0.75 ) * ChartHeight - DataMargin;\r\nVolChartHeight = ChartHeight - BarChartHeight - DataMargin*2 ;\r\nNumberPriceLevels = BarChartHeight / 25 ;\r\nBarChartWidth=  Width - 45 ;\r\nBarWidth = (BarChartWidth - ChartMargin * 3 ) / Bars  ;\r\nLastBar =  BarCount ;\r\nFirstBar =  LastBar - Bars;\r\n\r\nSymbolNum = NumCharts;\r\n\r\n\r\nTypeofchart  = ParamList("Type of Chart","Candlestick,Barchart,Linechart",0);\r\n\r\nmaunenboad=ParamColor("colorkhung", colorWhite);\r\nGfxSelectSolidBrush( maunenboad );\r\nfor ( x = 0 ; x &lt; ChartsHiNum ; x++ ) \r\n{ \r\n         for ( i = 0 ; i &lt; ChartsWiNum ; i++ ) \r\n        { \r\n                 notDone = True;\r\n                 \r\n                 x1 = Width * i + 5 +letrai1; \r\n                 y1 = ChartHeight * x -20 + letren1;\r\n                 x2 = Width * (i + 1 )+letrai1 +20;\r\n                 y2 = ChartHeight * (x + 1 )-DateMargin+letren1;\r\n                  GfxSelectPen ( colorBlack ); \r\n                  GfxRectangle ( x1, y1, x2, y2 );\r\n                 SymbolNum++;\r\n\r\n                  \r\n                  TimeFrameSet(inWeekly);\r\nop =O; \r\nhi =H;\r\nlo = L; \r\nclo = C; \r\nvold = V;\r\n             \r\n\t\t\t\t\r\n\t\t\t\tCindex = Foreign("vnindex","close");\r\n\t\t\t\tRS = clo/Cindex*1000 + clo[BarCount-1]/10;\r\n\t\t\t\tEMAShort= EMA (RS,sDays);\r\n                 EMAT= EMA (RS,tDays);\r\n                 EMALong= EMA (clo,lDays);\r\n                //ichimoku\r\n\t\t\t\tkj = ( HHV( hi, 26 ) + LLV( lo, 26) )/2;\r\n\t\t\t\ttk = ( HHV( hi, 9 ) + LLV( lo, 9 ) )/2;\r\n\t\t\t\tLag = Ref( clo, 26 );\r\n\t\t\t\tSp1 = Ref((( tk + kj )/2),-26);\r\n\t\t\t\tSp2 = Ref((HHV( hi, 52) + LLV(lo, 52))/2,-26);\r\n \r\n                 EMAVol= MA (vold,vDays);\r\n                 D = Day ();\r\n                 M = Month ();\r\n                 Y = Year ();\r\n\r\n                 priceHigh = 0 ;\r\n                 VolHigh = 0 ;\r\n                 priceMin = 1000000 ;\r\n                  for ( z = FirstBar; z &lt; LastBar ; z++ ) \r\n                 { \r\n                          Vol = vold[z];\r\n                          BarH = hi[z];\r\n                          BarL = lo[z];  \r\n                          barlag = lag[z]; \r\n                           if ( Vol &gt; VolHigh ) \r\n                          { \r\n                                   VolHigh = Vol;\r\n                          }\r\n                           if ( BarH &gt; priceHigh ) \r\n                          { \r\n                                   priceHigh = BarH;\r\n                          }\r\n                           if ( BarL &lt; priceMin ) \r\n                          { \r\n                                   priceMin = BarL;\r\n                          }\r\n                          }\r\n                   \r\n                 \r\n\t\t\t\t\r\n                 LOpen = O[LastBar- 1];\r\n                 LHigh = H[LastBar- 1];\r\n                 LLow = L[LastBar- 1];\r\n                 LClose = C[LastBar- 1];\r\n                 LVol = V[LastBar- 1];\r\n                  GfxSelectFont ( "Tahoma" , 8 ); \r\n                  GfxSetTextColor (colorBlack); \r\n                  GfxTextOut (Name() + "   O: " +LOpen + "   H: " +LHigh + "   L: " +LLow + "   C: " +LClose + "   Vol: " +LVol/ 1000000 + " M", x1+5 , y1+2 ); \r\n\r\n                 VolRatio = VolChartHeight /  VolHigh ;\r\n                 Range = priceHigh - priceMin;\r\n                 Ratio = BarChartHeight / Range ;\r\n                 PriceLineLevel = Range / NumberPriceLevels;\r\n                 yHi=(((priceHigh - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                  GfxTextOut ( WriteVal (priceHigh, 1.2 ),   x1 + BarChartWidth, yHi -8 );\r\n                  GfxSelectPen ( colorLightGrey ); \r\n                  //GfxMoveTo ( x1 , yHi );\r\n                  //GfxLineTo ( x1 + BarChartWidth -5 , yHi );\r\n                  for ( z = 0 ; z &lt; NumberPriceLevels- 1   ; z++ ) \r\n                 { \r\n                          PriceLevel = PriceLineLevel*z + priceMin;\r\n\r\n                          yHi=(((PriceLevel - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                           GfxTextOut ( WriteVal (PriceLevel, 1.2 ),   x1 + BarChartWidth, yHi -8 );\r\n                           GfxSelectPen ( colorLightGrey ); \r\n                           //draw horizontal price level\r\n                           //GfxMoveTo ( x1 , yHi );\r\n                           //GfxLineTo ( x1 + BarChartWidth -5 , yHi );\r\n                 }\r\n\r\n                 HighestLast = 0 ;\r\n                 w = 0 ;\r\n                 sEMAlast = EMAShort[FirstBar];\r\n                 tEMAlast = EMAT[FirstBar];\r\n                 lEMAlast = EMALong[FirstBar];\r\n                 vEMAlast = EMAVol[FirstBar];\r\n                 clast\t  = clo[FirstBar];\r\n                 RSlast = RS[FirstBar];\r\n                 kjlast = kj[FirstBar];\r\n                 tklast = tk[FirstBar];\r\n                 Laglast = Lag[FirstBar];\r\n                 Sp1last = Sp1[FirstBar];\r\n                 Sp2last = Sp2[FirstBar];\r\n                 \r\n                  for ( z = FirstBar; z &lt; LastBar ; z++ ) \r\n                 {\r\n                \r\n                        BarH = hi[z];\r\n                        BarL = lo[z];\r\n                        BarO = op[z];\r\n                        BarC = clo[z];\r\n                        BarRS = RS[z];\r\n                        Vol = vold[z];\r\n                        sEMA = EMAShort[z];\r\n                        ttEMA = EMAT[z];\r\n                         lEMA = EMALong[z];\r\n                        vEMA = EMAVol[z];\r\n                        barkj = kj[z];\r\n                        bartk = tk[z];\r\n\t\t\t\t\t\t//barLag = Lag[z];\r\n\t\t\t\t\t\tbarSp1 = Sp1[z];\r\n\t\t\t\t\t\tbarSp2 = Sp2[z];\r\n                          \r\n                          \r\n                          \r\n                          \r\n                          BarDay = D[z];\r\n                          BarMonth = M[z];\r\n                          BarYear = Y[z];\r\n                          yO = (((BarO - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          yC = (((BarC - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          yHi = (((BarH - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          yLo = (((BarL - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin ;\r\n                          yRS = (((BarRS - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin ;\r\n                          ysEMAlast = (((IIf(sEMAlast&gt;pricehigh,pricehigh,sEMAlast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ysEMA = (((IIf(sEMA&gt;pricehigh,pricehigh,sEMA) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                           ytEMAlast = (((IIf(tEMAlast&gt;pricehigh,pricehigh,tEMAlast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ytEMA = (((IIf(ttEMA&gt;pricehigh,pricehigh,ttEMA) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ylEMAlast = (((lEMAlast - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ylEMA = (((lEMA - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ykj = (((IIf(Barkj&gt;pricehigh,pricehigh,Barkj) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ytk = (((iif(Bartk&gt;pricehigh,pricehigh,bartk) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          //ylag = (((IIf(Barlag&gt;pricehigh,pricehigh,Barlag) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ysp1 = (((IIf(Barsp1&gt;pricehigh,pricehigh,Barsp1) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ysp2 = (((IIf(Barsp2&gt;pricehigh,pricehigh,Barsp2) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ykjlast = (((IIf(kjlast&gt;pricehigh,pricehigh,kjlast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ytklast = (((iif(tklast&gt;pricehigh,pricehigh,tklast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          //ylaglast = (((IIf(laglast&gt;pricehigh,pricehigh,laglast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;                   \r\n                          ysp1last = (((IIf(sp1last&gt;pricehigh,pricehigh,sp1last) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ysp2last = (((IIf(sp2last&gt;pricehigh,pricehigh,sp2last) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;                     \r\n                     \r\n\r\n                         \r\n                          vHi = y2 - (Vol * VolRatio)  ;\r\n                          yvEMAlast = y2 - (vEMAlast  * VolRatio) ;\r\n                          yvEMA = y2 - (vEMA * VolRatio)  ;\r\n                          ///////////\r\n                          yClast = (((clast - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          yRSlast = (((RSlast - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          \r\n                           // Plot RS\r\n\t\t\t\t\t\t\t//GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , yRSlast );\r\n                           //GfxLineTo ( BarWidth * w + x1 + ChartMargin, yRS ); \t\r\n                           \r\n\t\t\t\t\t\t\t// Plot ichimoku\r\n\t\t\t\t\t\t\tshowichi = ParamToggle("ichi","No|Yes",0);\r\n\t\t\t\t\t\t\tif(showichi)\r\n\t\t\t\t\t\t\t{\r\n                           \r\n                            if ( ysp1 &gt; ysp2)\r\n                          {\r\n                                    //GfxSelectSolidBrush ( colorOrange ); \r\n                                    GfxSelectPen ( colorOrange ); \r\n                          }\r\n                           else\r\n                          { \r\n                                     //GfxSelectSolidBrush ( colorLime );\r\n                                     GfxSelectPen ( colorGreen ); \r\n                          }\r\n                           GfxRectangle( BarWidth * w + x1 + ChartMargin -4   , ysp1,BarWidth * w + x1 + ChartMargin +4 , ysp2);  \r\n                           GfxSelectPen ( colorBlue ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ytklast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ytk );\r\n                           GfxSelectPen ( colorRed ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ykjlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ykj );\r\n                          \r\n                           //GfxSelectPen ( colorgreen ); \r\n                           //GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ylaglast );\r\n                           //GfxLineTo ( BarWidth * w + x1 + ChartMargin, ylag );\r\n                           \r\n                           }\r\n                           else\r\n                           {\r\n                           GfxSelectPen ( colorRed ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ysEMAlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ysEMA );\r\n                           GfxSelectPen ( colorBlue ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ytEMAlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ytEMA );\r\n                           GfxSelectPen ( colorViolet ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ylEMAlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ylEMA );\r\n                          \r\n                            \r\n                            } \r\n                              if ( BarO &gt; BarC)\r\n                          {\r\n                                    GfxSelectSolidBrush ( colorRed ); \r\n                                    GfxSelectPen ( colorRed ,2);\r\n                          }\r\n                           else\r\n                          { \r\n                                    GfxSelectSolidBrush ( colorGreen );\r\n                                    GfxSelectPen ( colorGreen ,2);\r\n                          }    \r\n                                  \r\n\t\t\t\t\t\t\t\t// Plot chart\r\n\t\t\t\t\t\t switch(Typeofchart)\r\n\t\t\t\t\t\t {\r\n\t\t\t\t\t\tcase "Candlestick":\t\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin , yHi );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yLo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin -2   , yo );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin +2, yo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin +2   , yC );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin -2, yC );\r\n                           GfxRectangle( BarWidth * w + x1 + ChartMargin -3   , yo,BarWidth * w + x1 + ChartMargin +3 , yC);\t\r\n                        break;  \r\n                        case "Barchart":\t\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin , yHi );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yLo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin -3   , yo );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin , yo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin +3   , yC );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin , yC );\r\n                           \r\n                         break;  \r\n                        case "Linechart":\t\r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , yClast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yC );\r\n                         break;    \r\n                        \r\n                        }   \r\n                        \r\n                         GfxSelectSolidBrush( maunenboad );  \r\n                          // Plot Volume\r\n                           if ( BarO &gt; BarC)\r\n                          {\r\n                                    GfxSelectPen ( colorRed ,2); \r\n                          }\r\n                           else\r\n                          { \r\n                                    GfxSelectPen ( colorGreen ,2);\r\n                          }\r\n\t\t\t\t\t\t\t\t\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin , vHi-20 );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, y2-20 );\r\n\t\t\t\t\t\t\t\t// Plot Price and Volume EMAs\r\n                           \r\n                           GfxSelectPen ( colorBlack ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , yvEMAlast-20 );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yvEMA-20 );\r\n                            \r\n                                                   \r\n                          w++;                          \r\n                          sEMAlast = sEMA ;\r\n                          tEMAlast = ttEMA ;\r\n                          lEMAlast = lEMA ;\r\n                         kjlast = Barkj;\r\n                         tklast = Bartk;\r\n                         //laglast = Barlag;\r\n                         \r\n                         sp1last = Barsp1;\r\n                         sp2last = Barsp2;\r\n                          vEMAlast = vEMA ;\r\n                          clast=BarC;\r\n                          RSlast=BarRS;  \r\n                          \r\n                                                   \r\n                                  /////////////////////\r\n                           GfxSetTextColor (colorBlack); \r\n                           GfxSelectFont ( "Tahoma" , 7 ); \r\n                           GfxSelectPen ( colorLightGrey ); \r\n\t\t\t\t\t\t\t\t// Draw vertical month separator and X-axis labels\r\n                           if (BarDay== 1 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );                                  \r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                    //GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                    //GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 2 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                    //GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                    //GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 3 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                    //GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                    //GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 4 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                    //GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                    //GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 5 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                    //GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2 - VolChartHeight );\r\n                                    //GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin );\r\n                                   notDone = False;\r\n                          }\r\n                           if (BarDay== 6 |BarDay== 7 |BarDay== 8 |BarDay== 9 |BarDay== 10 )\r\n                          {\r\n                                   notDone = True;\r\n                          }       \r\n                                                     \r\n                 }\r\n                 if(showichi)\r\n                 {\r\n                 for ( z = FirstBar; z &lt; LastBar-26 ; z++ ) \r\n                 {\r\n                 barLag = Lag[z];\r\n                 ylag = (((IIf(Barlag&gt;pricehigh,pricehigh,Barlag) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                 ylaglast = (((IIf(laglast&gt;pricehigh,pricehigh,laglast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;GfxSelectPen ( colorgreen ); \r\n                 GfxMoveTo ( BarWidth * (w -Bars-1 ) + x1  + ChartMargin , ylaglast );\r\n                 GfxLineTo ( BarWidth * (w-Bars) + x1 + ChartMargin, ylag );           \r\n                  w++;  \r\n                   laglast = Barlag;    \r\n                 }\r\n                 }\r\n                  RestorePriceArrays (); \r\n                 }\r\n                 GfxSelectFont ( "Arial" , 11,600 ); \r\n                 GfxTextOut ("Weekly", x1+25 , y1+25);\r\n        } \r\n\r\n_SECTION_END();\r\n\r\n\r\n_SECTION_BEGIN("Chart in chart 2");\r\n\r\nletrai1=Param ( "Le Trai", 525 , 0 , 2000 , 1 ) ;\r\nletren1=Param ( "le Tren", 50 , 0 , 2000 , 1 ) ;\r\nChartHeight = Param ( "chieu cao", 350 , 0 , 2000 , 1 ) ;   \r\nWidth = Param ( "chieu rong", 700 , 0 , 2000 , 1 ) ; \r\nChartsWiNum = 1;\r\nChartsHiNum = 1;\r\nBars =Param ( "Number Of Bars", 65, 50 , 250 , 1 ) ;   \r\nlDays =Param ( "Long EMA", 200 , 50 , 250 , 1 ) ;\r\nsDays =Param ( "Mid EMA", 50 , 5 , 100 , 1 ) ;\r\ntDays= Param ( "Short EMA", 20 , 5 , 100 , 1 ) ;\r\nvDays =Param ( "Volume MA", 20 , 5 , 100 , 1 ) ;\r\nChartMargin = 5 ;\r\nDateMargin = 10 ;\r\nDataMargin = 20 ;\r\nNumCharts = ChartsWiNum * ChartsHiNum ;\r\nScreenHeight = Status ( "pxheight" )  ;\r\nSceernWidth = Status ( "pxwidth" ) ;\r\n\r\nBarChartHeight=  (0.75 ) * ChartHeight - DataMargin;\r\nVolChartHeight = ChartHeight - BarChartHeight - DataMargin*2 ;\r\nNumberPriceLevels = BarChartHeight / 25 ;\r\nBarChartWidth=  Width - 45 ;\r\nBarWidth = (BarChartWidth - ChartMargin * 3 ) / Bars  ;\r\nLastBar =  BarCount ;\r\nFirstBar =  LastBar - Bars;\r\n\r\nSymbolNum = NumCharts;\r\n\r\n\r\nTypeofchart  = ParamList("Type of Chart","Candlestick,Barchart,Linechart",0);\r\n\r\nmaunenboad=ParamColor("colorkhung", colorWhite);\r\nGfxSelectSolidBrush( maunenboad );\r\nfor ( x = 0 ; x &lt; ChartsHiNum ; x++ ) \r\n{ \r\n         for ( i = 0 ; i &lt; ChartsWiNum ; i++ ) \r\n        { \r\n                 notDone = True;\r\n                 \r\n                 x1 = Width * i + 5 +letrai1; \r\n                 y1 = ChartHeight * x -20 + letren1;\r\n                 x2 = Width * (i + 1 )+letrai1 +20;\r\n                 y2 = ChartHeight * (x + 1 )-DateMargin+letren1;\r\n                  GfxSelectPen ( colorBlack ); \r\n                  GfxRectangle ( x1, y1, x2, y2 );\r\n                 SymbolNum++;\r\n\r\n                  \r\n                  TimeFrameSet(inMonthly);\r\nop =O; \r\nhi =H;\r\nlo = L; \r\nclo = C; \r\nvold = V;\r\n             \r\n\t\t\t\t\r\n\t\t\t\tCindex = Foreign("vnindex","close");\r\n\t\t\t\tRS = clo/Cindex*1000 + clo[BarCount-1]/10;\r\n\t\t\t\tEMAShort= EMA (RS,sDays);\r\n                 EMAT= EMA (RS,tDays);\r\n                 EMALong= EMA (clo,lDays);\r\n                //ichimoku\r\n\t\t\t\tkj = ( HHV( hi, 26 ) + LLV( lo, 26) )/2;\r\n\t\t\t\ttk = ( HHV( hi, 9 ) + LLV( lo, 9 ) )/2;\r\n\t\t\t\tLag = Ref( clo, 26 );\r\n\t\t\t\tSp1 = Ref((( tk + kj )/2),-26);\r\n\t\t\t\tSp2 = Ref((HHV( hi, 52) + LLV(lo, 52))/2,-26);\r\n \r\n                 EMAVol= MA (vold,vDays);\r\n                 D = Day ();\r\n                 M = Month ();\r\n                 Y = Year ();\r\n\r\n                 priceHigh = 0 ;\r\n                 VolHigh = 0 ;\r\n                 priceMin = 1000000 ;\r\n                  for ( z = FirstBar; z &lt; LastBar ; z++ ) \r\n                 { \r\n                          Vol = vold[z];\r\n                          BarH = hi[z];\r\n                          BarL = lo[z];  \r\n                          barlag = lag[z]; \r\n                           if ( Vol &gt; VolHigh ) \r\n                          { \r\n                                   VolHigh = Vol;\r\n                          }\r\n                           if ( BarH &gt; priceHigh ) \r\n                          { \r\n                                   priceHigh = BarH;\r\n                          }\r\n                           if ( BarL &lt; priceMin ) \r\n                          { \r\n                                   priceMin = BarL;\r\n                          }\r\n                          }\r\n                   \r\n                 \r\n\t\t\t\t\r\n                 LOpen = O[LastBar- 1];\r\n                 LHigh = H[LastBar- 1];\r\n                 LLow = L[LastBar- 1];\r\n                 LClose = C[LastBar- 1];\r\n                 LVol = V[LastBar- 1];\r\n                  GfxSelectFont ( "Tahoma" , 8 ); \r\n                  GfxSetTextColor (colorBlack); \r\n                  GfxTextOut (Name() + "   O: " +LOpen + "   H: " +LHigh + "   L: " +LLow + "   C: " +LClose + "   Vol: " +LVol/ 1000000 + " M", x1+5 , y1+2 ); \r\n\r\n                 VolRatio = VolChartHeight /  VolHigh ;\r\n                 Range = priceHigh - priceMin;\r\n                 Ratio = BarChartHeight / Range ;\r\n                 PriceLineLevel = Range / NumberPriceLevels;\r\n                 yHi=(((priceHigh - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                  GfxTextOut ( WriteVal (priceHigh, 1.2 ),   x1 + BarChartWidth, yHi -8 );\r\n                  GfxSelectPen ( colorLightGrey ); \r\n                  //GfxMoveTo ( x1 , yHi );\r\n                  //GfxLineTo ( x1 + BarChartWidth -5 , yHi );\r\n                  for ( z = 0 ; z &lt; NumberPriceLevels- 1   ; z++ ) \r\n                 { \r\n                          PriceLevel = PriceLineLevel*z + priceMin;\r\n\r\n                          yHi=(((PriceLevel - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                           GfxTextOut ( WriteVal (PriceLevel, 1.2 ),   x1 + BarChartWidth, yHi -8 );\r\n                           GfxSelectPen ( colorLightGrey ); \r\n                           //GfxMoveTo ( x1 , yHi );\r\n                           //GfxLineTo ( x1 + BarChartWidth -5 , yHi );\r\n                 }\r\n\r\n                 HighestLast = 0 ;\r\n                 w = 0 ;\r\n                 sEMAlast = EMAShort[FirstBar];\r\n                 tEMAlast = EMAT[FirstBar];\r\n                 lEMAlast = EMALong[FirstBar];\r\n                 vEMAlast = EMAVol[FirstBar];\r\n                 clast\t  = clo[FirstBar];\r\n                 RSlast = RS[FirstBar];\r\n                 kjlast = kj[FirstBar];\r\n                 tklast = tk[FirstBar];\r\n                 Laglast = Lag[FirstBar];\r\n                 Sp1last = Sp1[FirstBar];\r\n                 Sp2last = Sp2[FirstBar];\r\n                 \r\n                  for ( z = FirstBar; z &lt; LastBar ; z++ ) \r\n                 {\r\n                \r\n                        BarH = hi[z];\r\n                        BarL = lo[z];\r\n                        BarO = op[z];\r\n                        BarC = clo[z];\r\n                        BarRS = RS[z];\r\n                        Vol = vold[z];\r\n                        sEMA = EMAShort[z];\r\n                        ttEMA = EMAT[z];\r\n                         lEMA = EMALong[z];\r\n                        vEMA = EMAVol[z];\r\n                        barkj = kj[z];\r\n                        bartk = tk[z];\r\n\t\t\t\t\t\t//barLag = Lag[z];\r\n\t\t\t\t\t\tbarSp1 = Sp1[z];\r\n\t\t\t\t\t\tbarSp2 = Sp2[z];\r\n                          \r\n                          \r\n                          \r\n                          \r\n                          BarDay = D[z];\r\n                          BarMonth = M[z];\r\n                          BarYear = Y[z];\r\n                          yO = (((BarO - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          yC = (((BarC - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          yHi = (((BarH - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          yLo = (((BarL - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin ;\r\n                          yRS = (((BarRS - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin ;\r\n                          ysEMAlast = (((IIf(sEMAlast&gt;pricehigh,pricehigh,sEMAlast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ysEMA = (((IIf(sEMA&gt;pricehigh,pricehigh,sEMA) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                           ytEMAlast = (((IIf(tEMAlast&gt;pricehigh,pricehigh,tEMAlast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ytEMA = (((IIf(ttEMA&gt;pricehigh,pricehigh,ttEMA) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ylEMAlast = (((lEMAlast - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ylEMA = (((lEMA - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ykj = (((IIf(Barkj&gt;pricehigh,pricehigh,Barkj) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ytk = (((iif(Bartk&gt;pricehigh,pricehigh,bartk) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          //ylag = (((IIf(Barlag&gt;pricehigh,pricehigh,Barlag) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ysp1 = (((IIf(Barsp1&gt;pricehigh,pricehigh,Barsp1) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ysp2 = (((IIf(Barsp2&gt;pricehigh,pricehigh,Barsp2) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                          ykjlast = (((IIf(kjlast&gt;pricehigh,pricehigh,kjlast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ytklast = (((iif(tklast&gt;pricehigh,pricehigh,tklast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          //ylaglast = (((IIf(laglast&gt;pricehigh,pricehigh,laglast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;                   \r\n                          ysp1last = (((IIf(sp1last&gt;pricehigh,pricehigh,sp1last) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          ysp2last = (((IIf(sp2last&gt;pricehigh,pricehigh,sp2last) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;                     \r\n                     \r\n\r\n                         \r\n                          vHi = y2 - (Vol * VolRatio)  ;\r\n                          yvEMAlast = y2 - (vEMAlast  * VolRatio) ;\r\n                          yvEMA = y2 - (vEMA * VolRatio)  ;\r\n                          ///////////\r\n                          yClast = (((clast - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          yRSlast = (((RSlast - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;\r\n                          \r\n                           // Plot RS\r\n\t\t\t\t\t\t\t//GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , yRSlast );\r\n                           //GfxLineTo ( BarWidth * w + x1 + ChartMargin, yRS ); \t\r\n                           \r\n\t\t\t\t\t\t\t// Plot ichimoku\r\n\t\t\t\t\t\t\tshowichi = ParamToggle("ichi","No|Yes",0);\r\n\t\t\t\t\t\t\tif(showichi)\r\n\t\t\t\t\t\t\t{\r\n                           \r\n                            if ( ysp1 &gt; ysp2)\r\n                          {\r\n                                    //GfxSelectSolidBrush ( colorOrange ); \r\n                                    GfxSelectPen ( colorOrange ); \r\n                          }\r\n                           else\r\n                          { \r\n                                     //GfxSelectSolidBrush ( colorLime );\r\n                                     GfxSelectPen ( colorGreen ); \r\n                          }\r\n                           GfxRectangle( BarWidth * w + x1 + ChartMargin -4   , ysp1,BarWidth * w + x1 + ChartMargin +4 , ysp2);  \r\n                           GfxSelectPen ( colorBlue ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ytklast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ytk );\r\n                           GfxSelectPen ( colorRed ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ykjlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ykj );\r\n                          \r\n                           //GfxSelectPen ( colorgreen ); \r\n                           //GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ylaglast );\r\n                           //GfxLineTo ( BarWidth * w + x1 + ChartMargin, ylag );\r\n                           \r\n                           }\r\n                           else\r\n                           {\r\n                           GfxSelectPen ( colorRed ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ysEMAlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ysEMA );\r\n                           GfxSelectPen ( colorBlue ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ytEMAlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ytEMA );\r\n                           GfxSelectPen ( colorViolet ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , ylEMAlast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, ylEMA );\r\n                          \r\n                            \r\n                            } \r\n                              if ( BarO &gt; BarC)\r\n                          {\r\n                                    GfxSelectSolidBrush ( colorRed ); \r\n                                    GfxSelectPen ( colorRed ,2);\r\n                          }\r\n                           else\r\n                          { \r\n                                    GfxSelectSolidBrush ( colorGreen );\r\n                                    GfxSelectPen ( colorGreen ,2);\r\n                          }    \r\n                                  \r\n\t\t\t\t\t\t\t\t// Plot chart\r\n\t\t\t\t\t\t switch(Typeofchart)\r\n\t\t\t\t\t\t {\r\n\t\t\t\t\t\tcase "Candlestick":\t\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin , yHi );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yLo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin -2   , yo );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin +2, yo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin +2   , yC );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin -2, yC );\r\n                           GfxRectangle( BarWidth * w + x1 + ChartMargin -3   , yo,BarWidth * w + x1 + ChartMargin +3 , yC);\t\r\n                        break;  \r\n                        case "Barchart":\t\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin , yHi );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yLo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin -3   , yo );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin , yo );\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin +3   , yC );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin , yC );\r\n                           \r\n                         break;  \r\n                        case "Linechart":\t\r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , yClast );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yC );\r\n                         break;    \r\n                        \r\n                        }   \r\n                        \r\n                         GfxSelectSolidBrush( maunenboad );  \r\n                          // Plot Volume\r\n                           if ( BarO &gt; BarC)\r\n                          {\r\n                                    GfxSelectPen ( colorRed ,2); \r\n                          }\r\n                           else\r\n                          { \r\n                                    GfxSelectPen ( colorGreen ,2);\r\n                          }\r\n\t\t\t\t\t\t\t\t\r\n                           GfxMoveTo ( BarWidth * w + x1 + ChartMargin , vHi-20 );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, y2-20 );\r\n\t\t\t\t\t\t\t\t// Plot Price and Volume EMAs\r\n                           \r\n                           GfxSelectPen ( colorBlack ); \r\n                           GfxMoveTo ( BarWidth * (w -1 ) + x1  + ChartMargin , yvEMAlast-20 );\r\n                           GfxLineTo ( BarWidth * w + x1 + ChartMargin, yvEMA-20 );\r\n                            \r\n                                                   \r\n                          w++;                          \r\n                          sEMAlast = sEMA ;\r\n                          tEMAlast = ttEMA ;\r\n                          lEMAlast = lEMA ;\r\n                         kjlast = Barkj;\r\n                         tklast = Bartk;\r\n                         //laglast = Barlag;\r\n                         \r\n                         sp1last = Barsp1;\r\n                         sp2last = Barsp2;\r\n                          vEMAlast = vEMA ;\r\n                          clast=BarC;\r\n                          RSlast=BarRS;  \r\n                          \r\n                                                   \r\n                                  /////////////////////\r\n                           GfxSetTextColor (colorBlack); \r\n                           GfxSelectFont ( "Tahoma" , 7 ); \r\n                           GfxSelectPen ( colorLightGrey ); \r\n\t\t\t\t\t\t\t\t// Draw vertical month separator and X-axis labels\r\n                           if (BarDay== 1 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );                                  \r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                   // GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                   // GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 2 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                   // GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                   // GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 3 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                    GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                    GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 4 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                   // GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2  );\r\n                                    //GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin  );\r\n                                   notDone = False;\r\n                          }\r\n\r\n                           if (BarDay== 5 &amp; notDone )\r\n                          {\r\n                                    if (BarMonth == 1 ) myLabel =WriteVal (BarYear, 1.0 );\r\n                                    else myLabel =GetMonth(BarMonth);\r\n                                    GfxTextOut (myLabel,   BarWidth * w + x1 + ChartMargin - 5 , y2 +DateMargin/3-25 );\r\n                                    //GfxMoveTo ( BarWidth * w + x1 + ChartMargin , y2 - VolChartHeight );\r\n                                   // GfxLineTo ( BarWidth * w + x1 + ChartMargin, y1 + DataMargin );\r\n                                   notDone = False;\r\n                          }\r\n                           if (BarDay== 6 |BarDay== 7 |BarDay== 8 |BarDay== 9 |BarDay== 10 )\r\n                          {\r\n                                   notDone = True;\r\n                          }       \r\n                                                     \r\n                 }\r\n                 if(showichi)\r\n                 {\r\n                 for ( z = FirstBar; z &lt; LastBar-26 ; z++ ) \r\n                 {\r\n                 barLag = Lag[z];\r\n                 ylag = (((IIf(Barlag&gt;pricehigh,pricehigh,Barlag) - priceMin )* Ratio)- BarChartHeight ) * -1 + y1 + DataMargin;\r\n                 ylaglast = (((IIf(laglast&gt;pricehigh,pricehigh,laglast) - priceMin )* Ratio) - BarChartHeight) * -1 + y1 + DataMargin;GfxSelectPen ( colorgreen ); \r\n                 GfxMoveTo ( BarWidth * (w -Bars-1 ) + x1  + ChartMargin , ylaglast );\r\n                 GfxLineTo ( BarWidth * (w-Bars) + x1 + ChartMargin, ylag );           \r\n                  w++;  \r\n                   laglast = Barlag;    \r\n                 }\r\n                 }\r\n                  RestorePriceArrays (); \r\n                 }\r\n                 GfxSelectFont ( "Arial" , 11,600 ); \r\n                 GfxTextOut ("Monthly", x1+25 , y1+25);\r\n        } \r\n_SECTION_END();\r\n}\r\nelse \r\n{\r\nGuiSetText( "Weekly Off", IDset );\r\nGuiSetColors(IDset,IDset,1,colorWhite, colorRed, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n}\r\n\r\nToggleButton2 = Nz( StaticVarGet( "ToggleButton2" + MyChartID ));\r\n\r\nGuiButtonTrigger( "EMA Off", pxchartright -CellWidth, ybutton, CellWidth, CellHeight );\r\nGuiSetColors(IDset,IDset,2,colorWhite, colorGreen, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n\r\nif( id == IDset AND event == 1 )  // If ToggleButton is clicked\r\n{\r\n    if( ToggleButton2 ) StaticVarSet( "ToggleButton2" + MyChartID, ToggleButton2 = 0, 0 );\r\n    else  StaticVarSet( "ToggleButton2" + MyChartID, ToggleButton2 = 1, 0 );\r\n}\r\nif( ToggleButton2 ) \r\n{ \r\n\t\r\nGuiSetText( "EMA On", IDset ); \r\nPlot(EMA(C,p1),"EMA "+p1,colorRed,styleThick);\r\nPlot(EMA(C,p2),"EMA "+ p2,colorBlue,styleDashed + styleThick);\r\nPlot(EMA(C,p3),"EMA "+ p3,colorViolet,styleDashed + styleThick);\r\n}\r\n\r\nelse \r\n{\r\nGuiSetText( "EMA Off", IDset );\r\nGuiSetColors(IDset,IDset,1,colorWhite, colorRed, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n}\r\n\r\n\r\nToggleButton3 = Nz( StaticVarGet( "ToggleButton3" + MyChartID ));\r\n\r\nGuiButtonTrigger( "BBand Off", pxchartright -CellWidth*2, ybutton, CellWidth, CellHeight );\r\nGuiSetColors(IDset,IDset,2,colorWhite, colorGreen, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n\r\nif( id == IDset AND event == 1 )  // If ToggleButton is clicked\r\n{\r\n    if( ToggleButton3 ) StaticVarSet( "ToggleButton3" + MyChartID, ToggleButton3 = 0, 0 );\r\n    else  StaticVarSet( "ToggleButton3" + MyChartID, ToggleButton3 = 1, 0 );\r\n}\r\nif( ToggleButton3 ) \r\n{ \r\n\t\r\nGuiSetText( "BBand On", IDset ); \r\nPlot( bbt = BBandTop( C, 20, 2 ), "BBTop" + _PARAM_VALUES(), colorLightBlue, styleLine ); \r\nPlot( bbb = BBandBot( C, 20, 2 ), "BBBot" + _PARAM_VALUES(), colorLightBlue, styleLine ); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( colorLightBlue, GetChartBkColor(), 0.8 ), styleNoLabel | styleCloud | styleNoRescale, Null, Null, Null, -1 );\r\nPlot(MA(C,20)," ",colorLightBlue);\r\n}\r\n\r\nelse \r\n{\r\nGuiSetText( "BBand Off", IDset );\r\nGuiSetColors(IDset,IDset,1,colorWhite, colorRed, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n}\r\n\r\n\r\nToggleButton4 = Nz( StaticVarGet( "ToggleButton4" + MyChartID ));\r\n\r\nGuiButtonTrigger( "Ichi Off", pxchartright -CellWidth*3, ybutton, CellWidth, CellHeight );\r\nGuiSetColors(IDset,IDset,2,colorWhite, colorGreen, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n\r\nif( id == IDset AND event == 1 )  // If ToggleButton is clicked\r\n{\r\n    if( ToggleButton4 ) StaticVarSet( "ToggleButton4" + MyChartID, ToggleButton4 = 0, 0 );\r\n    else  StaticVarSet( "ToggleButton4" + MyChartID, ToggleButton4 = 1, 0 );\r\n}\r\nif( ToggleButton4 ) \r\n{ \r\n\t\r\nGuiSetText( "Ichi On", IDset ); \r\n\r\nPlot(Span1,"span A",colorGreen,styleNoLabel,0,0,26);\r\nPlot(Span2,"span B",colorRed,styleNoLabel,0,0,26);\r\n//SetBarFillColor(IIf(Span1&gt;Span2,colorLime,colorOrange));\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorGreen,colorRed),styleBarNoTicks|styleNoLabel,0,0,26);\r\nPlot(KJ26,"KJ 26",colorBlue,  styleThick,Null,Null,0,1);\r\nPlot(KJ65,"KJ 65",colorOrange, styleThick ,Null,Null,0,1);\r\nPlot(KJ130,"KJ 130",colorViolet, styleThick ,Null,Null,0,1);\r\n}\r\n\r\nelse \r\n{\r\nGuiSetText( "Ichi Off", IDset );\r\nGuiSetColors(IDset,IDset,1,colorWhite, colorRed, colorYellow, colorWhite, colorGreen, colorYellow, colorGold, colorDarkTeal, colorYellow );\r\n}\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\chart n stockprice v7 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>13.13</Min>
			<Max>26.2522</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>vsa</Name>
		<Pane>
			<ChartID>1098</ChartID>
			<PercentHeight>60</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (ang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (ang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATRs ", 3, 0.5, 10, 0.1 ); // How many ATRs to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 6.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>11.66</Min>
			<Max>27.8104</Max>
		</Pane>
		<Pane>
			<ChartID>1099</ChartID>
			<PercentHeight>20</PercentHeight>
			<Formula>_SECTION_BEGIN("Volume");\r\nPlot( Volume, _DEFAULT_NAME(), IIf( C &gt; O, ParamColor("Up Color", colorGreen ), ParamColor("Down Color", colorRed ) ), ParamStyle( "Style", styleHistogram | styleThick, maskHistogram  ) );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Volume (color) 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>3.58803e+006</Min>
			<Max>2.86685e+007</Max>
		</Pane>
		<Pane>
			<ChartID>1100</ChartID>
			<PercentHeight>20</PercentHeight>
			<Formula>// Downloaded From https://kakata.vn\r\n_SECTION_BEGIN("WeisWave");\r\n//up[0] = V[0]; \r\n//dn[0] = V[0];\r\n//vol[0] = V[0]; \r\ntrend[0] = 0;\r\nwave[0] = 0;\r\nvol[0] = 0;\r\nmov[0] = 0;\r\ndif=1;\r\nrp    = Param("Reversal Bars", 0.03,0.1,5,0.1);\r\nfor( i=1; i&lt;BarCount; i++) {\r\n\r\nif (Close[i]-Close[i-1]&gt;rp) mov[i]=1;\r\nif (Close[i]-Close[i-1]==rp) mov[i]=0;\r\nif (Close[i]-Close[i-1]&lt;-rp) mov[i]=-1; \r\n\r\nif ((mov[i]!=0) &amp;&amp; (mov[i]!=mov[i-1])) \r\n{\r\ntrend[i]=mov[i];\r\n} \r\nelse {trend[i]=trend[i-1];} \r\nif ((trend[i]!=wave[i-1]) &amp;&amp; (abs(Close[i]-Close[i-1])*10000&gt;=dif)) \r\n{\r\nwave[i]=trend[i];\r\n} \r\nelse \r\n{\r\nwave[i]=wave[i-1];\r\n}    \r\nif (wave[i]==wave[i-1]) \r\n{\r\nvol[i]=vol[i-1]+Volume[i];\r\n} \r\nelse \r\n{\r\nvol[i]=Volume[i];\r\n}\r\n\r\nif (wave[i]==1) \r\n{\r\nup[i]=vol[i]; \r\ndn[i]=0;\r\n}\r\nif (wave[i]==-1) \r\n{\r\ndn[i]=vol[i]; \r\nup[i]=0;\r\n}\r\nif (wave[i]==0) \r\n{\r\ndn[i]=vol[i-1]; \r\nup[i]=vol[i-1];\r\n}\r\n}\r\n\r\n \r\nPlotOHLC(0,up,0,up,"SwingWave",5 , 2|styleThick ) ;\r\nPlotOHLC(0,dn,0,dn,"",4 , 2|styleThick ) ;\r\n\r\n\r\n\r\n\r\nGfxSetOverlayMode(1);\r\nGfxSetTextColor(10); \r\nGfxSelectFont("MS Sans Serif", 6, 300, False, False, 0); \r\nGfxTextOut(" By : Casoni ", Status("pxwidth")-60 , Status("pxheight")-13 );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Wyckoff wave 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>-1.46807e+006</Min>
			<Max>7.7162e+007</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>may</Name>
		<Pane>
			<ChartID>1101</ChartID>
			<PercentHeight>60</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (ang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (ang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATRs ", 3, 0.5, 10, 0.1 ); // How many ATRs to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 7.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>11.66</Min>
			<Max>27.8104</Max>
		</Pane>
		<Pane>
			<ChartID>1102</ChartID>
			<PercentHeight>20</PercentHeight>
			<Formula>\r\n// Code: Foreign (NN).afl (AmiBroker - Designed by  MAI DUY KHANH, Edited by @ KHANH BLADE - KAKATA.VN)\r\n\r\n// A. Foreign Activity\r\n\r\n_SECTION_BEGIN("Foreign Activity For Steel");\r\n\r\nfunction SFormatDate (NumFormatDate)\r\n{\r\nS=StrFormat("%0.9g",NumFormatDate);\r\n\r\nyyy=StrLeft(S,3);\r\nmm=StrMid(S,3,2);\r\ndd=StrRight(S,2);\r\n\r\nyyyy=StrToNum(yyy)+1900;\r\n\r\nSD= dd + "/" + mm + "/" + NumToStr(yyyy,1,False);\r\nreturn SD;\r\n}\r\n\r\nStartDate1 = ParamDate("Ngay bat dau", NumToStr(DateTime(),formatDateTime),0 );\r\nEndDate1 = ParamDate( "Ngay ket thuc", NumToStr(DateTime(),formatDateTime),0 );\r\n\r\nDStart = BarsSince(DateNum()==StartDate1);\r\nDEnd = BarsSince(DateNum()==EndDate1);\r\n\r\nNOfBars=DStart-DEnd+1;\r\n\r\nNN = "NN_" + Name();\r\n\r\n//C1 = Foreign( "NN_HPG", "C" ) ;\r\n//C2 = Foreign( "NN_HSG", "C" ) ;\r\n//C3 = Foreign( "NN_NKG", "C" ) ;\r\n//C4 = Foreign( "NN_SMC", "C" ) ;\r\n//C5 = Foreign( "NN_TVN", "C" ) ;\r\n//C6 = Foreign( "NN_HMC", "C" ) ;\r\n//C6 = Foreign( "NN_TLH", "C" ) ;\r\n\r\n//O1 = Foreign( "NN_HPG", "O" ) ;\r\n//O2 = Foreign( "NN_HSG", "O" ) ;\r\n//O3 = Foreign( "NN_NKG", "O" ) ;\r\n//O4 = Foreign( "NN_SMC", "O" ) ;\r\n//O5 = Foreign( "NN_TVN", "O" ) ;\r\n//O6 = Foreign( "NN_HMC", "O" ) ;\r\n//O6 = Foreign( "NN_TLH", "O" ) ;\r\n\r\n//KLBan = C1 + C2 + C3 + C4 + C5 + C6;\r\n//KLMua = O1 + O2 + O3 + O4 + O5 + O6\r\nKLBan = IIf(IsEmpty(Foreign(NN,"C",0)),0,Foreign(NN,"C",0));\r\nKLMua = IIf(IsEmpty(Foreign(NN,"O",0)),0,Foreign(NN,"O",0));\r\nKLRong = KLMua - KLBan;\r\n\r\nSKLRong=Ref(Sum(KLRong,NOfBars),-DEnd);\r\nSKLMua=Ref(Sum(KLMua,NOfBars),-DEnd);\r\nSKLBan=Ref(Sum(KLBan,NOfBars),-DEnd);\r\n\r\n//I1 = IIf(IsEmpty(Foreign("NN_HPG","interest",0)),0,Foreign("NN_HPG","interest",0));\r\n//I2 = IIf(IsEmpty(Foreign("NN_HSG","interest",0)),0,Foreign("NN_HSG","interest",0));\r\n//I3 = IIf(IsEmpty(Foreign("NN_NKG","interest",0)),0,Foreign("NN_NKG","interest",0));\r\n//I4 = IIf(IsEmpty(Foreign("NN_SMC","interest",0)),0,Foreign("NN_SMC","interest",0));\r\n//I5 = IIf(IsEmpty(Foreign("NN_TVN","interest",0)),0,Foreign("NN_TVN","interest",0));\r\n//I6 = IIf(IsEmpty(Foreign("NN_TLH","interest",0)),0,Foreign("NN_TLH","interest",0));\r\n\r\n//V1 = IIf(IsEmpty(Foreign("NN_HPG","V",0)),0,Foreign("NN_HPG","V",0));\r\n//V2 = IIf(IsEmpty(Foreign("NN_HSG","V",0)),0,Foreign("NN_HSG","V",0));\r\n//V3 = IIf(IsEmpty(Foreign("NN_NKG","V",0)),0,Foreign("NN_NKG","V",0));\r\n//V4 = IIf(IsEmpty(Foreign("NN_SMC","V",0)),0,Foreign("NN_SMC","V",0));\r\n//V5 = IIf(IsEmpty(Foreign("NN_TVN","V",0)),0,Foreign("NN_TVN","V",0));\r\n//V6 = IIf(IsEmpty(Foreign("NN_TLH","V",0)),0,Foreign("NN_TLH","V",0));\r\n\r\n//GTBan = I1 + I2 + I3 + I4 + I5 + I6;\r\n//GTMua = V1 + V2 + V3 + V4 + V5 + V6;\r\nGTBan = IIf(IsEmpty(Foreign(NN,"interest",0)),0,Foreign(NN,"interest",0));\r\nGTMua = IIf(IsEmpty(Foreign(NN,"V",0)),0,Foreign(NN,"V",0));\r\nGTRong = GTMua - GTBan;\r\n\r\nSGTRong=Ref(Sum(GTRong,NOfBars),-DEnd);\r\nSGTMua=Ref(Sum(GTMua,NOfBars),-DEnd);\r\nSGTBan=Ref(Sum(GTBan,NOfBars),-DEnd);\r\n\r\nGiaBQMua = IIf(SKLMua != 0,SGTMua/SKLMua,0);\r\nGiaBQBan = IIf(SKLBan != 0,SGTBan/SKLBan,0);\r\n\r\nRR = "RR_" + Name(); // File RR_: C = I/(I+V);\r\n\r\nptramroom = IIf(IsEmpty(Foreign(RR,"O",0)),0,Foreign(RR,"O",0));\r\nroombg = Ref(ptramroom,-NOfBars-DEnd);\r\nroomed = Ref(ptramroom,-DEnd);\r\n\r\nSetOption("NoDefaultColumns", True );\r\nAddTextColumn(Name(),"Ticker");\r\nAddTextColumn(SFormatDate(StartDate1),"Ngay bat dau");\r\nAddTextColumn(SFormatDate(EndDate1),"Ngay ket thuc");\r\nAddColumn(NOfBars,"Tong so phien",1.0);\r\nAddColumn(roombg,"% SHNN bat dau",1.2);\r\nAddColumn(roomed,"% SHNN ket thuc",1.2);\r\nAddColumn(roomed-roombg,"% SHNN (+|-)",1.2);\r\nAddColumn(SKLMua,"Tong KLNN mua",1.0); \r\nAddColumn(SKLBan,"Tong KLNN ban",1.0);\r\nAddColumn(SKLRong,"Tong KLNN rong",1.0);\r\nratioKL = IIf((SKLMua==0)AND(SKLBan==0),0,IIf(SKLRong &gt;= 0,SKLRong/SKLMua,SKLRong/SKLBan));\r\nAddColumn(ratioKL,"M/B ratio",1.2); \r\nAddColumn(SGTMua,"Tong GTNN mua (ng. vnd)",1.0); \r\nAddColumn(SGTBan,"Tong GTNN ban (ng. vnd)",1.0);\r\nAddColumn(SGTRong,"Tong GTNN rong (ng. vnd)",1.0);\r\nratioGT = IIf(SGTBan != 0,SGTMua/SGTBan,0);\r\nAddColumn(ratioGT,"M/B ratio",1.2);  \r\nAddColumn(GiaBQMua,"Gia mua TB/cp",1.2); \r\nAddColumn(GiaBQBan,"Gia ban TB/cp",1.2); \r\nAddColumn(C,"Gia hien tai",1.1);\r\nAddColumn(DateTime(), "Ngay hien tai", formatDateTime );\r\nSetSortColumns(-11, -8); \r\n\r\nFilter=1;\r\n\r\n_SECTION_END();\r\n\r\n// B. Chart\r\n\r\n_SECTION_BEGIN("Chart");\r\n\r\n//SetChartBkGradientFill( ParamColor("Top Color", colorWhite),ParamColor("Bottom Color", colorWhite));\r\n\r\n//Set Variables\r\nbarvisible = Status("barvisible");\r\nFVB = barvisible AND NOT Ref( barvisible, -1 );\r\nCVB = ValueWhen( FVB,C) ;\r\nLeftbar=ValueWhen(Ref(barvisible,-1)==0 AND barvisible,DateTime() );\r\nRightbar=LastValue(DateTime() );\r\nDateSpan = EndValue(BarIndex()) - BeginValue(BarIndex());\r\nRange = DateSpan ;\r\nStartDate = BeginValue(BarIndex());\r\nEndDate = EndValue(BarIndex());\r\n\r\nKLTLMua = Sum(KLMua,BarIndex());\r\n//FKLTLMua = KLTLMua - ValueWhen(FVB,KLTLMua);\r\nFKLTLMua = KLTLMua - ValueWhen(FVB,KLTLMua) + ValueWhen(FVB,KLMua);\r\n\r\nKLTLBan = Sum(KLBan,BarIndex());\r\n//FKLTLBan = KLTLBan - ValueWhen(FVB,KLTLBan);\r\nFKLTLBan = KLTLBan - ValueWhen(FVB,KLTLBan) + ValueWhen(FVB,KLBan);\r\n\r\nKLTLRong = Sum(KLRong,BarIndex());\r\n//FKLTLRong = KLTLRong - ValueWhen(FVB,KLTLRong);\r\nFKLTLRong = KLTLRong - ValueWhen(FVB,KLTLRong) + ValueWhen(FVB,KLRong);\r\n\r\nGTTLMua = Sum(GTMua,BarIndex())/1000000;\r\n//FGTTLMua = GTTLMua - ValueWhen(FVB,GTTLMua);\r\nFGTTLMua = GTTLMua - ValueWhen(FVB,GTTLMua) + ValueWhen(FVB,GTMua)/1000000;\r\n\r\nGTTLBan = Sum(GTBan,BarIndex())/1000000;\r\n//FGTTLBan = GTTLBan - ValueWhen(FVB,GTTLBan);\r\nFGTTLBan = GTTLBan - ValueWhen(FVB,GTTLBan) + ValueWhen(FVB,GTBan)/1000000;\r\n\r\nGTTLRong = Sum(GTRong,BarIndex())/1000000;\r\n//FGTTLRong = GTTLRong - ValueWhen(FVB,GTTLRong);\r\nFGTTLRong = GTTLRong - ValueWhen(FVB,GTTLRong) + ValueWhen(FVB,GTRong)/1000000;\r\n\r\nColorKL = IIf(KLRong &gt;0,colorGreen,colorRed);\r\nColorGT = IIf(GTRong &gt;0,colorGreen,colorRed);\r\n\r\nTitle = EncodeColor(colorYellow) + EncodeColor(colorViolet) + " - GIAO DICH NUOC NGOAI " + EncodeColor(colorYellow)\r\n+" [" + WriteIf(startdate==0, WriteVal(leftbar,formatDateTime),WriteVal(BeginValue(DateTime()),formatDateTime))+ " - "+WriteIf(EndValue(DateTime() )==rightbar, Date(),\r\n"                       "+WriteVal(Range,1)+" days                       "+WriteVal(EndValue(Month()),1.0) +"/" + WriteVal(EndValue(Day()),1.0) + "/20" + StrRight( WriteVal(EndValue(Year()),1.0),2))+"]"\r\n+ EncodeColor(colorYellow) +" - "\r\n+ EncodeColor(colorGreen)+ "KL: "+ EncodeColor(colorYellow) + WriteVal(KLMua,1.0) + " - " + WriteVal(KLBan,1.0)  + " = " +  WriteVal(KLRong,1.0)+ " (cp)"+", " \r\n+ EncodeColor(colorRed)+ "GT: "+ EncodeColor(colorYellow) + WriteVal(GTMua,1.0) + " - " + WriteVal(GTBan,1.0) + " = " +  WriteVal(GTRong,1.0)+ " (ng. vnd)"\r\n+ "\\n"\r\n+ EncodeColor(colorBlue)+ "KL tch luy: "+ EncodeColor(colorYellow) + WriteVal(FKLTLMua,1.0) + " - " + WriteVal(FKLTLBan,1.0) + " = " +  WriteVal(FKLTLRong,1.0)+ " (cp)"\r\n+ "\\n"\r\n+ EncodeColor(colorCustom12)+ "GT tch luy: "+ EncodeColor(colorYellow) + WriteVal(FGTTLMua,1.3) + " - " + WriteVal(FGTTLBan,1.3) + " = " +  WriteVal(FGTTLRong,1.3)+ " (ty vnd)";\r\n\r\n//Plot(KLRong, "NetVolFgn", ColorKL, ParamStyle( "Style", styleHistogram | styleOwnScale | styleThick, maskHistogram ),0);\r\n\r\nbarcolor=IIf(GTRong&lt;0, colorRed , IIf(GTRong&gt;0, colorGreen , colorPaleBlue));\r\n\r\nOpen=IIf(GTRong&lt;0, 0, GTRong);\r\nClose=IIf(GTRong&lt;0, GTRong, 0);\r\nHigh=Low=Open;\r\n\r\nChtl = ParamToggle("Chart tich luy","On|Off",1);\r\n\r\nif(Chtl)\r\n{\r\nPlotOHLC(O,H,L,C, "GTRong", barcolor, styleCandle|styleThick); \r\nPlot(EMA(GTRong,5), "AvgGTRong", colorPlum, styleLine);\r\n}\r\nelse\r\n{\r\nPlot(0,"", colorYellow, styleLine | styleThick | styleDashed | styleNoLabel);\r\nPlot(FGTTLRong, "FGTTL", colorBlue, styleLine | styleThick | styleNoLabel);\r\nPlot(GTRong,"GTRong", IIf(GTRong &gt; 0, colorTeal, colorCustom16), styleHistogram | styleThick | styleOwnScale | styleNoLabel);\r\n}\r\n\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\khoingoai 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>-1.34581e+010</Min>
			<Max>6.17495e+010</Max>
		</Pane>
		<Pane>
			<ChartID>1110</ChartID>
			<PercentHeight>20</PercentHeight>
			<Formula>_SECTION_BEGIN("MCDX");\r\n\r\n//  https://www.facebook.com/AmibrokerPlatform/\r\n\r\nRSIBaseBanker = Param("Banker Base",50,10,100,1);\r\n\r\nRSIPeriodBanker = Param("Banker RSI Period",50,10,100,1);\r\n\r\nRSIBaseHotMoney = Param("Hot Money RSI Base",30,10,100,1);\r\n\r\nRSIPeriodHotMoney = Param("Hot Money RSI Period",40,10,100,1);\r\n\r\nSensitivityBanker = Param("Sensitivity Banker ",1.5,0.1,10,0.1);\r\n\r\nSensitivityHotMoney = Param("Sensitivity Hot Money ",0.7,0.1,10,0.1);\r\n\r\nbankerPeriodMA = Param("MA Banker Period", 10 , 1 ,260 , 1);\r\n\r\nRSI_Banker = SensitivityBanker * (RSI(RSIPeriodBanker) - RSIBaseBanker);\r\n\r\nRSI_HotMoney = SensitivityHotMoney * (RSI(RSIPeriodHotMoney ) - RSIBaseHotMoney );\r\n\r\n \r\n\r\nRSI_Banker  =  IIf(RSI_Banker &gt; 20 , 20 , IIf( RSI_Banker &lt; 0 , 0 , RSI_Banker )); \r\n\r\nRSI_HotMoney  =  IIf( RSI_HotMoney &gt; 20 , 20 , IIf(  RSI_HotMoney &lt; 0 , 0 ,  RSI_HotMoney)); \r\n\r\n   \r\n\r\nBankerMA = MA(RSI_Banker,bankerPeriodMA);  \r\n\r\n\r\n\r\n Plot( RSI_Banker," Banker",iif(RSI_Banker&gt;BankerMA,colorRed,colorPink),styleHistogram,0,0,0,1,5); \r\n Plot(BankerMA,"Banker MA",colorBlue,styleThick,0,0,0,2);\r\n\r\n Plot(RSI_HotMoney,"Hot Money",colorYellow,styleHistogram,0,0,0,0,5); \r\n\r\n Plot( 20,"Retailer",colorGreen,styleHistogram,0,0,0,-1,5); \r\n\r\n \r\n\r\n Plot(15,"",ColorRGB(173,52,203),styleLine,0,0,0,2); //75%\r\n\r\n Plot(10,"",ColorRGB(173,52,203),styleLine,0,0,0,2); // 50%\r\n\r\n Plot(5,"",ColorRGB(173,52,203),styleLine,0,0,0,2); // 25%\r\n\r\n \r\n\r\nBuy = Cross( RSI_Banker,BankerMA) ;\r\n\r\nSell = Cross( BankerMA ,RSI_Banker );\r\n\r\n\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\MCDX 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>-0.4</Min>
			<Max>21.024</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>coban</Name>
		<Pane>
			<ChartID>1103</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (ang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (ang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATRs ", 3, 0.5, 10, 0.1 ); // How many ATRs to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 8.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>11.12</Min>
			<Max>30.2368</Max>
		</Pane>
		<Pane>
			<ChartID>1104</ChartID>
			<PercentHeight>17</PercentHeight>
			<Formula>_SECTION_BEGIN("MACD");\r\nr1 = Param( "Fast avg", 12, 2, 200, 1 );\r\nr2 = Param( "Slow avg", 26, 2, 200, 1 );\r\nr3 = Param( "Signal avg", 9, 2, 200, 1 );\r\nPlot( ml = MACD(r1, r2), StrFormat(_SECTION_NAME()+"(%g,%g)", r1, r2), ParamColor("MACD color", colorRed ), ParamStyle("MACD style") );\r\nPlot( sl = Signal(r1,r2,r3), "Signal" + _PARAM_VALUES(), ParamColor("Signal color", colorBlue ), ParamStyle("Signal style") );\r\nPlot( ml-sl, "MACD Histogram", ParamColor("Histogram color", colorDefault ), styleNoTitle | ParamStyle("Histogram style", styleHistogram | styleNoLabel, maskHistogram ) );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\MACD - Moving Average Convergence Divergence 3.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>-0.620203</Min>
			<Max>1.04163</Max>
		</Pane>
		<Pane>
			<ChartID>1105</ChartID>
			<PercentHeight>17</PercentHeight>
			<Formula>_SECTION_BEGIN("RSI");\r\nSetChartOptions(0,0,chartGrid30|chartGrid70);\r\nperiods = Param( "Periods", 15, 1, 200, 1 );\r\nPlot( RSI( periods), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style")  );\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\RSI - Relative Strength Index 2.afl</FilePath>
			<Flags>3072</Flags>
			<MoreFlags>1073741825</MoreFlags>
			<Min>35.9598</Min>
			<Max>73.2321</Max>
		</Pane>
		<Pane>
			<ChartID>1106</ChartID>
			<PercentHeight>17</PercentHeight>
			<Formula>_SECTION_BEGIN("RS vs. VNindex");\t\r\nticker=ParamStr("ticker","vnindex");\r\n\r\nRSL = C/Foreign(ticker, "C")*1000;\r\n\r\nRSLHigh \t\t= RSL == HHV(RSL, 65);\r\nrslb\t\t\t= RSL + C[BarCount-1]/4;\r\nPlotShapes(IIf(RSLb&gt;=Ref(HHV(rslb,26),-1),shapeCircle, shapeNone), IIf(RSLb&gt;=Ref(HHV(rslb,26),-1) AND RSLb&lt;Ref(HHV(RSLb,65),-1) ,colorGold,IIf(RSLb&gt;=Ref(HHV(RSLb,65),-1) AND RSLb&lt;Ref(HHV(RSLb,130),-1),colorRed,colorAqua)), 0, rslb, 0);\r\npd=Param("Period",20,5,50,1);\r\nPlot(HHV(rslb,26),"H26",colorGold,styleDashed);\r\nPlot(HHV(rslb,65),"H65",colorRed,styleDashed);\r\nPlot(HHV(rslb,130),"H130",colorTeal,styleDashed);\r\nPlot(rslb, "RS Line", colorTeal, styleDashed+styleThick+styleNoLabel);\r\n\r\nsig = EMA(rslb, 20);\r\nPlot(sig, "EMA of Ratio", colorBrown, styleLine | styleThick);\r\n\r\nvonhoa= C*GetFnData("SharesOut");\r\ndkvol = V&gt;100000 AND C*V&gt;3000000 AND vonhoa &gt; 1000000000 ;\r\n\r\nFilter= RSLhigh and dkvol;\r\n\r\nAddColumn(C, "Close",1.2,IIf(C&gt;=O,colorBlack,colorRed));\r\nAddColumn( ( ( C - Ref ( C ,-1 )) / O ) * 100 , " % Change " , 1.2 ) ;\r\nAddColumn(V,"Vol",1.0,colorWhite,IIf(V&gt;MA(V,30),colorBlue,colorGold));\r\nAddColumn(Sum(RSLhigh,10),"RSL",1.0,colorWhite,IIf(RSLb&gt;=Ref(HHV(rslb,26),-1) AND RSLb&lt;Ref(HHV(RSLb,65),-1),colorgold,IIf(RSLb&gt;=Ref(HHV(rslb,65),-1) AND RSLb&lt;Ref(HHV(RSLb,130),-1),colorRed,colorTeal )));\r\nAddColumn(RSLhigh,"New RS high",1.0,colorWhite,IIf(rslhigh==1,colorBlue,colorWhite));\r\nSetSortColumns(-6);\r\n\r\n_SECTION_END();\r\n\r\nlistnum = 5; // we use watchlist 10 for storing results\r\n\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n    // retrieve watchlist members\r\n    oldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n\r\n    // iterate through the list and remove tickers\r\n    for ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n    {\r\n        CategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n    }\r\n}\r\n\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) )  )\r\n    CategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\RS vs. VNindex 11.04.21 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>19.3571</Min>
			<Max>27.3551</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>nen</Name>
		<Pane>
			<ChartID>1116</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for PlotOHLCsupport AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixedupmajoroff\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n       29. VAP Anna Coulling\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\n\r\n\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\n\r\nGraphXSpace=Param("* - GraphXSpace - Zoom Chart",20,5,300,5);   //Chon che do Zoom\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                         Thong tin Gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN(" - Thong tin Gia thi truong");\r\n\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\nHorGia      = Param(" - Horizontal - Toa do Ngang",450,-900,1500,1);  // Vi tri ngang\r\nVerGia      = Param(" - Vertical - Toa do Doc",1,1,1000,1);    // Vi tri doc\r\n\r\n//Phong nen\r\nGfxSetBkMode( colorWhite );\r\nGfxSetTextColor( ParamColor(" - Fonts Color",colorCustom9));  // Hien thi mau chu\r\n\r\nif (ParamToggle( "* - Hien thi Thong tin Gia",  "OFF|ON", 1 ))\r\n{\r\n\r\n//Hien chu\r\nGfxSelectFont("Times New Roman", Param("Font Size",25,1,100,1), 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxTextOut( Name(), HorGia+700,  VerGia -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,    HorGia+950 , VerGia-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", Param("Number Size",10,1,100,1), 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", HorGia+950, VerGia+50); //|Hien thi thay doi gia dong cua\r\nGfxTextOut("("+MarketID(1)+")", HorGia+700,  VerGia +50 ); \r\n\r\n\r\n}\r\n\r\n\r\nif (ParamToggle( "* - Hien thi Thong tin Tai chinh",  "OFF|ON", 1 ))\r\n{\r\n//Thong tin tai chinh\r\nHor=Param("Horizontal Position",1800,-700,2500,1);  // Vi tri ngang\r\nVer=Param("Vertical Position",-55,-55,600,1);    // Vi tri doc\r\nGfxSelectFont("Times New Roman",  Param("TC Font Size",10,1,100,1), 600, bold =True, underline = False, True );\r\nGfxTextOut("CHI SO TAI CHINH:", Hor+10, Ver+55 );\r\nGfxTextOut("EPS: " + Prec( GetFnData( "EPS" )*1000,0), Hor+10, Ver+85 );\r\nGfxTextOut("P/E: " + Prec( (Close/GetFnData( "EPS" )),1), Hor+10, Ver+105 );\r\nGfxTextOut("P/B: " + Prec(  Close / GetFnData( "BookValuePerShare" ),1), Hor+10, Ver+125 );\r\nGfxTextOut("P/S: " + Prec( Close / GetFnData( "SalesPerShare" ),1), Hor+10, Ver+145 );\r\nGfxTextOut("Sales/CP: " + Prec(  GetFnData( "SalesPerShare" )*1000,0), Hor+10, Ver+165 );\r\nGfxTextOut("Bookvalue: " + Prec(  GetFnData( "BookValuePerShare" )*1000,0), Hor+10, Ver+185 );\r\nGfxTextOut("ROE: " + Prec(  GetFnData( "ReturnOnEquity" ),0)+"%", Hor+10, Ver+205 );\r\nGfxTextOut("ROA: " + Prec(  GetFnData( "ReturnOnAssets" ),0)+"%", Hor+10, Ver+225 );\r\nGfxTextOut("KLCP: " + Prec( GetFnData("SharesOut")/1000000,3)+" (Trieu)", Hor+10, Ver+245 );\r\nGfxTextOut("Float: " + Prec(  GetFnData("sharesfloat")/1000000,3)+" (Trieu)"+" = ("+ Prec(  GetFnData("sharesfloat")/GetFnData("SharesOut")*100,0)  +"%)", Hor+10, Ver+265 );\r\nGfxTextOut("Von hoa: " + Prec( GetFnData("SharesOut")*C/1000000,0)+" (Ty)", Hor+10, Ver+285 );\r\nGfxTextOut("VCSH: " + Prec(  GetFnData("SharesOut") * GetFnData( "BookValuePerShare" ) / 1000000,0) +" (Ty)", Hor+10, Ver+305 );\r\nGfxTextOut("Market: " + MarketID(1), Hor+10, Ver+325 );\r\nGfxTextOut("Nganh: " + IcbID(1), Hor+10, Ver+345 );\r\nGfxTextOut("Nhom: " + SectorID(1), Hor+10, Ver+365 );\r\n\r\n}\r\n\r\n//    END Hien thi gia thi truong  \r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*******************************************************************************************************\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                   Dash Board - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN(" - Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param(" - Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param(" - Horizontal - Toa do Ngang",570,-200,1300,1);  //Ngang\r\nyf=Param(" - Vertical - Toa do Doc", 0,-130,600,1); //Doc\r\n\r\n\r\n//==========================================================================|\r\n//                   Hien thi Dash Board - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\nif (ParamToggle( "* - Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\n//Luc Cau (Mua)\r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); \r\n//Luc Cung (Ban)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  \r\n\r\n//Phong nen\r\n\r\nGfxSetBkMode( colorWhite );\r\n\r\n//Vi tri toan bo bieu bo \r\nxDashBoard=Status("pxchartleft")+xf;  \r\nyDashBoard=Status("pxcharttop")+yf;\r\n\r\n\r\n//================= Buying Pressure Bar graph ================\r\n//--------------Bieu do luc Cau - Mua-------------------------\r\n//============================================================\r\n\r\n//Gia tri tinh luc Cau - Mua\r\nx1Buy = SelectedValue(bfnor);   \r\n//Vi tri hinh chu nhat the hien Gia tri tinh luc Cau - Mua trong bieu do\r\ny1Buy = yDashBoard + 100-x1Buy;\r\n\r\n//--------------bargraph---------------------------------------\r\n//Nen chu nhat co dinh \r\nGfxSelectSolidBrush( colorLime ); \r\n//Vien chu nhat co dinh\r\nGfxSelectPen( colorPaleTurquoise );  \r\n//Vi tri chu nhat co dinh\r\nGfxRectangle(   xDashBoard+55-40-20,    yDashBoard+100+1  , \r\n                xDashBoard+65-40-20+3,    yDashBoard +1     );\r\n//Vi tri luc Cau - Mua\r\nGfxGradientRect(xDashBoard+55-40-20+1,  y1Buy +3,\r\n                xDashBoard+65-40-20+3-1,  yDashBoard+100,\r\n//Mau sac luc Cau - Mua\r\ncolorDarkGreen,colorGreen);\r\n//Chu "Buy"\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", xDashBoard+55-40-22-3,yDashBoard+100+6 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//--------------Bieu do luc Cung - Ban-------------------------\r\n//=============================================================\r\n\r\n//Gia tri tinh luc Cung - Ban\r\nx2Sell = SelectedValue(nfnor);  \r\n//Vi tri hinh chu nhat the hien Gia tri tinh luc Cung - Ban trong bieu do\r\ny2Sell = yDashBoard + 100-x2Sell;\r\n\r\n//--------------bargraph---------------------------------------\r\n//Nen chu nhat co dinh \r\nGfxSelectSolidBrush( colorLightOrange );\r\n//Vien chu nhat co dinh \r\nGfxSelectPen( colorRose );\r\n//Vi tri chu nhat co dinh\r\nGfxRectangle(    xDashBoard+75+20-60-10-3,   yDashBoard+100+1, \r\n                 xDashBoard+85+20-60-10,   yDashBoard +1      );\r\n//Vi tri luc Cung - Ban\r\nGfxGradientRect( xDashBoard+75+20-60-10-3+1, y2Sell+2,\r\n                 xDashBoard+85+20-60-10-1, yDashBoard+100,\r\n//Mau sac luc Cung - Ban                \r\ncolorDarkRed,colorBrown);\r\n//Chu "Sell"\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", xDashBoard+75+17-60-10-3,yDashBoard+100+6 );\r\n\r\n//======================\r\n//Dau cach\r\nGfxSelectSolidBrush( colorOrange );\r\n//Vien chu nhat co dinh \r\nGfxSelectPen( colorRose );\r\n//Vi tri chu nhat co dinh\r\nGfxRectangle(    xDashBoard+75+20-60+5,   yDashBoard+100+1, \r\n                 xDashBoard+85+20-60+5,   yDashBoard +97      );\r\n\r\n\r\n\r\n//========================Effort (Volume - No luc)===============================\r\n//------------------------------------------------\r\n//Effort (Volume - No luc)\r\n//------------------------------------------------\r\nVrg1  = WMA(V,40);// average volume - Volume trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume hien tai so voi trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume hien tai so voi trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume hien tai so voi trung binh\r\n\r\n//Gia tri tinh Effort (Volume - No luc)\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\n//------------------------------------------------\r\n//========Effort===========\r\n//Gia tri tinh Effort\r\nx5Effort = SelectedValue(vnor);\r\n//Vi tri cua Gia tri tinh Effort\r\ny5Effort = yDashBoard+230-39-90-x5Effort;\r\n\r\n//Nen chu nhat co dinh \r\nGfxSelectSolidBrush(colorTurquoise); \r\n//Vien chu nhat co dinh \r\nGfxSelectPen(colorLightYellow );\r\n\r\n//Vi tri chu nhat co dinh\r\nGfxRectangle(   xDashBoard+55-1,    yDashBoard+230-39-90   , \r\n                xDashBoard+65+1,    yDashBoard+130-39 -90    );\r\n//Vi tri bien dong Effort\r\nGfxGradientRect(xDashBoard+55,     yDashBoard+130+x5Effort-39-90+1   ,\r\n                xDashBoard+65,     yDashBoard+230-39-90-1    ,\r\n//Mau cua bien dong Effort\r\ncolorIndigo,colorViolet);\r\n\r\n//Chu "Ef"\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Ef", xDashBoard+55,yDashBoard+235-39-90 );\r\n\r\n\r\n\r\n\r\n//========================Result - Danh gia ket qua tang giam Gia===============================\r\n//------------------------------------------------\r\n//Result - Danh gia ket qua tang giam Gia\r\n//------------------------------------------------\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua hien tai (Gia hien tai tang giam so voi hom truoc)\r\nrsg  = Wilders(rs,40);//Average Result - Ket qua trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le Ket qua hien tai so voi Trung binh\r\nrmax = HHV(rso,40); //High cua Ty le Ket qua hien tai so voi Trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le Ket qua hien tai so voi Trung binh\r\n//Gia tri tinh Result\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n//------------------------------------------------\r\n//========Result===========\r\n//Gia tri tinh Result\r\nx4Result = SelectedValue(rnor);\r\n//Vi tri cua Gia tri tinh Spread\r\ny4Result = yDashBoard+230-39-90-x4Result;\r\n//Nen chu nhat co dinh \r\nGfxSelectSolidBrush(colorTurquoise); \r\n//Vien chu nhat co dinh \r\nGfxSelectPen(colorRose);\r\n//Vi tri chu nhat co dinh\r\nGfxRectangle(    xDashBoard+75-1,     yDashBoard+230-39-90,\r\n                 xDashBoard+85+1,     yDashBoard+130-39-90);\r\n//Vi tri bien dong Result\r\nGfxGradientRect( xDashBoard+75,     yDashBoard+130+x4Result-39-90+1,\r\n                 xDashBoard+85,     yDashBoard+230-39-90-1,\r\n//Mau cua bien dong Result\r\ncolorGrey40,colorSeaGreen) ;\r\n//Chu "Re"\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", xDashBoard+75,yDashBoard+235-39-90 );\r\n\r\n\r\n\r\n\r\n//=======================Spread - Chenh lech gia========================================\r\n//------------------------------------------------\r\n//Tinh Spread la chenh lech giua gia mo cua (Open) va dong cua (Close)\r\n//------------------------------------------------\r\n//Tinh gia tri cua Spread\r\nspC_O   = IIf(/*Neu tang gia (Open&gt;Close)*/ (C &gt; O), sp1 = (H-L)-(H-C)-(O-L),IIf(/*Neu giam gia (Open&lt;Close)*/ (C &lt; O), sp2 = (H-L)-(H-O)-(C-L), /*Neu tham chieu (Open=Close)*/ 0)); //Spread - Chenh lech gia\r\narg2 = Wilders(spC_O,40);//Average Spread - Muc Spread trung binh\r\nsro2  = spC_O/arg2;//ratio of spread to average - Ty le Spread hien tai so voi trung binh\r\nsmax2 = HHV(sro2,40); //High cua Ty le Spread hien tai so voi trung binh\r\nsmin2 = LLV(sro2,40); //Low cua Ty le Spread hien tai so voi trung binh\r\n//Gia tri tinh Spread\r\nsnor2 = ( smax2-sro2 )*100/(smax2-Smin2 + 1e-9); //Danh gia gia tri cua Spread hien tai\r\n//------------------------------------------------\r\n//========Spread===========\r\n//Gia tri tinh Spread\r\nx6Spread = SelectedValue(snor2);\r\n//Vi tri cua Gia tri tinh Spread\r\ny6Spread = yDashBoard+230-39-90-x6Spread;\r\n\r\n//Nen chu nhat co dinh \r\nGfxSelectSolidBrush(colorTurquoise); \r\n//Vien chu nhat co dinh \r\nGfxSelectPen(colorAqua);\r\n\r\n//Vi tri chu nhat co dinh\r\nGfxRectangle(   xDashBoard+95-1,     yDashBoard+230-39-90, \r\n                xDashBoard+105+1,    yDashBoard+130-39-90    );\r\n//Vi tri bien dong Spread\r\nGfxGradientRect(xDashBoard+95,     yDashBoard+130+x6Spread-39-90+1,\r\n                xDashBoard+105,    yDashBoard+230-39-90-1    ,\r\n                \r\n//Mau cua bien dong Spread\r\ncolorDarkBlue,colorBlue);\r\n\r\n//Chu "Sp"\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sp", xDashBoard+95,yDashBoard+235-39 -90    );\r\n\r\n\r\n\r\n\r\n//=======================Range - Bien dong gia========================================\r\n//------------------------------------------------\r\n//Range - Bien dong gia\r\n//------------------------------------------------\r\nrg   = (H-L); //Range - Bien dong gia\r\narg1 = Wilders(rg,40);//Average Range - Muc Range trung binh\r\nsro  = rg/arg1;//ratio of Range to average - Ty le Range hien tai so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Range hien tai so voi trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Range hien tai so voi trung binh\r\n//Gia tri tinh Range\r\nsnor = ( smax-sro )*100/(smax-Smin + 1e-9); //Danh gia gia tri cua Range hien tai\r\n//------------------------------------------------\r\n//========Range===========\r\n//Gia tri tinh Range\r\nx3Range = SelectedValue(snor);\r\n//Vi tri cua Gia tri tinh Range\r\ny3Range = yDashBoard+230-39-90-x3Range;\r\n\r\n//Nen chu nhat co dinh \r\nGfxSelectSolidBrush(colorTurquoise); \r\n//Vien chu nhat co dinh \r\nGfxSelectPen(colorSkyblue);\r\n\r\n//Vi tri chu nhat co dinh\r\nGfxRectangle(   xDashBoard+95+20-1,     yDashBoard+230-39-90, \r\n                xDashBoard+105+20+1,    yDashBoard+130-39-90    );\r\n//Vi tri bien dong Range\r\nGfxGradientRect(xDashBoard+95+20,     yDashBoard+130+x3Range-39-90+1,\r\n                xDashBoard+105+20,    yDashBoard+230-39-90-1    ,\r\n                \r\n//Mau cua bien dong Range\r\ncolorOrange,colorYellow);\r\n\r\n//Chu "Ra"\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Ra", xDashBoard+95+20,yDashBoard+235-39 -90    );\r\n\r\n//*********************************************************************\r\n\r\n//========Strength RSI===========\r\nRSIPeriod =  Param(" - Time RSI", 14, 2, 100, 1);\r\nLbRSI     = Param("LookBack RSI Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(RSIPeriod);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RSIPeriod); //Suc manh RSI\r\njhRSI = HHV(mySig1,LbRSI); //High cua muc RSI trong ky\r\njlRSI = LLV(mySig1,LbRSI); //Low cua muc RSI trong ky\r\njcRSI = (WMA((jhRSI-jlRSI),RSIPeriod)*0.60)+WMA(jlRSI,RSIPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jhRSI-jcRSI*0.2; //Vung gia tri tren\r\nLoline = jlRSI+jcRSI*0.2; //Vung gia tri duoi\r\nmidline = (jhRSI-jlRSI)/2; //Vung gia tri giua\r\n\r\nRStrengthRSI =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;\r\n\r\nRxRSI =IIf(RStrengthRSI&gt;HiLine,1,IIf(RStrengthRSI&lt;loLine,0,2));\r\nPARSI =SelectedValue(RxRSI);\r\n//Vong tron Den co dinh\r\nGfxSelectSolidBrush( colorBlack ); \r\n//Vien vong tron Den co dinh\r\nGfxSelectPen( colorWhite );\r\n//Vi tri vong tron Den co dinh\r\nGfxCircle(              xDashBoard+135+20,   yDashBoard+200-39 -90      ,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(              xDashBoard+135+20,   yDashBoard+200-39 -90      ,15);\r\n//Chu "Strength"\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", xDashBoard+120+20,    yDashBoard+235-39-90 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PARSI[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  xDashBoard+135+20,   yDashBoard+200-39 -90   ,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PARSI[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( xDashBoard+135+20,   yDashBoard+200-39 -90   ,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( xDashBoard+135+20,   yDashBoard+200-39 -90    ,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n\r\n}\r\n \r\n\r\n////END Dash Board\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n//**************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                     Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN(" - Phan tich Trend xu huong");\r\n\r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( " - Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( " - Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n kTrend      = RWI   (minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( " - Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( " - Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n jTrend      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2Trend     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2Trend     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(jTrend,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,jTrend); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,jTrend); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(jTrend,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2Trend,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2Trend); // quay tro lai dinh trung han\r\n k2a    = Cross(k2Trend,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2Trend); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = jTrend &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = jTrend &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = jTrend &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = jTrend &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2Trend &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2Trend &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2Trend &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2Trend &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2Trend&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2Trend&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(jTrend&gt;1,1,IIf(jTrend&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n//======================================================================================================\r\n\r\n//====================================================================================|\r\n\r\n//0.Loc gia thap nhat\r\nPriceMin = C &gt;= 10;\r\n\r\n//1. Gia tang trong Uptrend kem thanh khoan cao\r\n//===============================================\r\n//Gia dang tang so voi hom qua \r\nPriceup = C &gt;= 1.01*Ref(C,-1) ;\r\n\r\n//Gia dang tang so voi hom qua \r\nPriceupMarketdown = C &gt;= 1.0*Ref(C,-1) ;\r\n\r\n\r\n//Loc CP co thanh khoan cao\r\nHighVolume = Volume &gt; 50000 AND MA(V,30) &gt; 100000 AND Ref(V,-5) &gt; 50000 AND Ref(V,-10) &gt; 50000 AND Ref(V,-20) &gt; 50000 ;  \r\n\r\n//Gia cao hon cac duong MA10,20,30,50,100\r\nPriceUpMA = C &gt; EMA(C,5) AND C &gt; EMA(C,10) AND C &gt; EMA(C,20)  AND C &gt; EMA(C,30) AND C &gt; MA(C,50) AND C &gt; MA(C,100)  ;\r\n\r\n//Duong EMA5 cao hon EMA10,20,30 MA50,100\r\nEMA5up = EMA(C,5) &gt; EMA(C,10) AND EMA(C,5) &gt; EMA(C,20) AND EMA(C,5) &gt; EMA(C,30)  AND EMA(C,5) &gt; MA(C,50)   AND EMA(C,5) &gt; MA(C,100) ;  \r\n\r\n//Duong EMA10 cao hon EMA20,30 MA50,100\r\nEMA10up = EMA(C,10) &gt; EMA(C,20) AND EMA(C,10) &gt; EMA(C,30)  AND EMA(C,10) &gt; MA(C,50)   AND EMA(C,10) &gt; MA(C,100); \r\n \r\n//Giai doan 2 Uptrend Mark Minervini     \r\nUptrendMark = C &gt; MA(C,150) AND C &gt; MA(C,200)   \r\nAND EMA(C,5) &gt; MA(C,150)   AND EMA(C,5) &gt; MA(C,200) \r\nAND EMA(C,10) &gt; MA(C,150)   AND EMA(C,10) &gt; MA(C,200) \r\nAND MA(C,50) &gt; MA(C,150) AND MA(C,50) &gt; MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-22)  ;  \r\n\r\n//Gia cao hon Day it nhat 30% &amp; gan Dinh it nhat 30% trong 52 tuan\r\nPrice52WeekLow  = C &gt;= 1.3*LLV(C,260);\r\nPrice52WeekHigh = C &gt;= 0.7*HHV(C,260) ;\r\n\r\n\r\n\r\n\r\n//2. Gia giam trong Downtrend \r\n//===============================================\r\n//Gia dang giam so voi hom qua \r\nPricedown = C &lt; 1.01*Ref(C,-1) ;\r\n\r\n//Gia thap hon cac duong MA 10,20,30,50,100\r\nPriceDownMA = C &lt; EMA(C,10) AND C &lt; EMA(C,20)  AND C &lt; EMA(C,30) AND C &lt; MA(C,50) AND C &lt; MA(C,100)  ;\r\n\r\n//Duong EMA5 thap hon EMA10,20,30 MA50,100\r\nEMA5down = EMA(C,5) &lt; EMA(C,10) AND EMA(C,5) &lt; EMA(C,20) AND EMA(C,5) &lt; EMA(C,30)  AND EMA(C,5) &lt; MA(C,50)   AND EMA(C,5) &lt; MA(C,100) ;  \r\n\r\n//Duong EMA 10 thap hon EMA20,30 MA50,100\r\nEMA10down = EMA(C,10) &lt; EMA(C,20) AND EMA(C,10) &lt; EMA(C,30)  AND EMA(C,10) &lt; MA(C,50)   AND EMA(C,10) &lt; MA(C,100);   \r\n\r\n//Giai doan 4 Downtrend Mark Minervini \r\nDowntrendMark = C &lt; MA(C,150) AND C &lt; MA(C,200)                                                                                \r\nAND EMA(C,5) &lt; MA(C,150)   AND EMA(C,5) &lt; MA(C,200) \r\nAND EMA(C,10) &lt; MA(C,150)   AND EMA(C,10) &lt; MA(C,200) \r\nAND MA(C,50) &lt; MA(C,150) AND MA(C,50) &lt; MA(C,200) AND MA(C,200) &lt; Ref(MA(C,200),-22)  ;   \r\n\r\n\r\n//====================================================================================|\r\n\r\n\r\n//============== High Low MA ==============\r\nHLMAPeriods = Param(" - High Low MA Periods",  20,  1,  260, 1);\r\n\r\nHLMAUp =  C &gt; ( MA( H, HLMAPeriods ) + MA( L, HLMAPeriods ) ) / 2;// then Buy next bar at market;\r\n\r\nHLMADown = C &lt; ( MA( H, HLMAPeriods ) + MA( L, HLMAPeriods ) ) / 2;// then Sell Short next bar at market;\r\n\r\nHLMAstate = IIf( BarsSince( HLMAUp ) &lt; BarsSince( HLMADown ), 1, 0 );\r\n\r\nHLMABuy = HLMAstate == 1;\r\n\r\nHLMASell = HLMAstate == 0;\r\n\r\n//Chart\r\nHLMAColorbar = IIf( HLMABuy, colorBlue, IIf( HLMASell, colorRed, colorGold ) );\r\n\r\n\r\n\r\n//======== EMAStrength ===========\r\n\r\n//Xac dinh xu huong\r\nEMAStrengthUp   = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nEMAStrengthDown = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\nEMAStrength = IIf( EMAStrengthUp, 1, IIf( EMAStrengthDown, -1, 0 ) ); \r\n\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nEMAStrengthColor = IIf( EMAStrengthUp, colorBlue, IIf( EMAStrengthDown, colorRed, colorGold ) ); \r\n\r\n\r\n\r\n//*********************************************************************\r\n\r\n//======== RSI Strength===========\r\n\r\nRSIPeriod =  Param(" - RSI Periods", 14, 2, 100, 1);\r\nLbRSI     =  Param(" - LookBack RSI Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1    =  RSI(RSIPeriod);  //Tin hieu RSI\r\nAdev      =  StDev(mySig1, 3*RSIPeriod); //Suc manh RSI\r\njhRSI     =  HHV(mySig1,LbRSI); //High cua muc RSI trong ky\r\njlRSI     =  LLV(mySig1,LbRSI); //Low cua muc RSI trong ky\r\njcRSI     =  (WMA((jhRSI-jlRSI),RSIPeriod)*0.60)+WMA(jlRSI,RSIPeriod); //trung binh cua muc RSI trong ky\r\nHiline    =  jhRSI-jcRSI*0.2; //Vung gia tri tren\r\nLoline    =  jlRSI+jcRSI*0.2; //Vung gia tri duoi\r\nmidline   =  (jhRSI-jlRSI)/2; //Vung gia tri giua\r\n\r\nRStrengthRSI =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;\r\n\r\n\r\nRSIStrength = IIf( RStrengthRSI&gt;HiLine, 1, IIf( RStrengthRSI&lt;loLine, -1, 0 ) ); \r\n\r\nRSIStrengthColor = IIf(RStrengthRSI&gt;HiLine,colorBlue,IIf(RStrengthRSI&lt;loLine,colorRed,colorGold));\r\n\r\n\r\n\r\n//**********************************************************************\r\n//MADC Strength\r\n//Alexander Elder Impulse\r\n\r\n//MACD\r\nr1MACD   = Param( " - MACD Impulse Fast Avg", 12, 2, 200, 1 );\r\nr2MACD   = Param( " - MACD Impulse Slow Avg", 26, 2, 200, 1 );\r\nr3MACD   = Param( " - MACD Impulse Signal Avg", 9, 2, 200, 1 );\r\n\r\nmlMACD   = MACD(r1MACD, r2MACD);\r\nslMACD   = Signal(r1MACD,r2MACD,r3MACD);\r\n\r\n//Histogram\r\nHistMACD = mlMACD-slMACD;\r\nHistMACDUp   = HistMACD &gt; Ref(HistMACD,-1);\r\nHistMACDDown = HistMACD &lt; Ref(HistMACD,-1);\r\n\r\n//MAImpluse\r\nMAImpluse  = Param( " - MA Impluse ", 20, 5, 200, 1 );\r\nMAImpluseUp   = EMA(C,MAImpluse) &gt; Ref(EMA(C,MAImpluse),-1);\r\nMAImpluseDown = EMA(C,MAImpluse) &lt; Ref(EMA(C,MAImpluse),-1);\r\n\r\n//MACDStrength\r\nMACDStrength       = IIf(HistMACDUp AND MAImpluseUp,  1  ,    IIf(HistMACDDown AND MAImpluseDown,-1,0));\r\nMACDStrengthColor  = IIf(HistMACDUp AND MAImpluseUp,colorBlue,IIf(HistMACDDown AND MAImpluseDown,colorRed,colorGold));\r\n\r\n//===================================================================\r\n\r\n//Chi bao\r\n//Cac chi bao ky thuat\r\n\r\n\r\n\r\n//============== Accumulation/Distribution ==============\r\nTRHWilliamR = IIf( Ref( C, -1 ) &gt; H, Ref( C, -1 ), H );\r\nTRLWilliamR = IIf( Ref( C, -1 ) &lt; L, Ref( C, -1 ), L );\r\nadWilliamR = IIf( C &gt; Ref( C, -1 ), C - TRLWilliamR, IIf( C &lt; Ref( C, -1 ), C - TRHWilliamR, 0 ) );\r\nWADWilliamR = Cum( adWilliamR );\r\nwuWilliamR = WADWilliamR &gt; Ref( WADWilliamR, -1 ); //Tich luy\r\nwdWilliamR = WADWilliamR &lt; Ref( WADWilliamR, -1 ); //Phan phoi\r\n\r\n//============== RSIBUY ==============\r\nRSIbuy =  Cross( RSI( 14 ), EMA( RSI( 14 ), 9 ) );//Buy RSI\r\nRSIsell = Cross( EMA( RSI( 14 ), 9 ), RSI( 14 ) );//Sell RSI\r\nRSIbuy = ExRem( RSIbuy, RSIsell );\r\nRSIsell = ExRem( RSIsell, RSIbuy );\r\nRSIBullish = RSI( 14 ) &gt; EMA( RSI( 14 ), 9 );//Bullish\r\nRSIBearish = RSI( 14 ) &lt; EMA( RSI( 14 ), 9 );//Bearish\r\n\r\n//============== MACD ==============\r\nMACDbuy = Cross ( MACD(), Signal() ); //Buy MACD\r\nMACDsell = Cross( Signal(), MACD() );  //Sell MACD\r\nMACDbuy = ExRem( MACDbuy, MACDsell );\r\nMACDsell = ExRem( MACDsell, MACDbuy );\r\nMACDBulish = MACD() &gt; Signal();\r\nMACDBearish = MACD() &lt; Signal();\r\n\r\n//============== STOCHASTIC ==============\r\nStochKval = StochK( 14, 5 );\r\nStochDval = StochD( 14, 5, 5 );\r\nStochBuy = Cross( StochK( 14, 5 ), StochD( 14, 5, 5 ) ); //Buy Stochastic\r\nStochSell = Cross ( StochD( 14, 5, 5 ), StochK( 14, 5 ) );//Sell Stochastic\r\nStochBullish = StochK( 14, 5 ) &gt; StochD( 14, 5, 5 ); //Bullish\r\nStochBearish = StochK( 14, 5 ) &lt; StochD( 14, 5, 5 ); //Bearish\r\n\r\n//============== ADX ==============\r\nADXBuy =  Cross( PDI( 14 ), MDI( 14 ) );//Buy ADX\r\nADXSell = Cross( MDI( 14 ), PDI( 14 ) );//Sell ADX\r\nADXBuy = ExRem( adxBuy, adxSell );\r\nADXSell = ExRem( adxSell, adxBuy );\r\nADXBullish = PDI( 14 ) &gt; MDI( 14 );//Bullish\r\nADXBearish = MDI( 14 ) &gt; PDI( 14 );//Bearish\r\n\r\n//============== WILLIAM'S %R ==============\r\nWilliamR = ( ( HHV( H, 14 ) - C ) / ( HHV ( H, 14 ) - LLV ( L, 14 ) ) ) * -100;\r\n\r\n//==============ZeroLagTMA ==============\r\n//---------------Heiken Ashi Color------------------------\r\nper1HA = 6;\r\nper2HA = 2;\r\nOmHA = MA( O, per1HA );\r\nhmHA = MA( H, per1HA );\r\nlmHA = MA( L, per1HA );\r\nCmHA = MA( C, per1HA );\r\n\r\n// 1. Heiken Ashi\r\nHACLOSE = ( OmHA + hmHA + LmHA + CmHA ) / 4;\r\nHaOpen = AMA( Ref( HaClose,  -1 ),  0.5 );\r\nHaHigh = Max( hmHA,  Max( HaClose,  HaOpen ) );\r\nHaLow = Min( lmHA,  Min( HaClose,  HaOpen ) );\r\n\r\n// 2. Heiken Ashi MA2\r\nOf = MA( Haopen, per2HA );\r\nCf = MA( Haclose, per2HA );\r\nLf = IIf( haOpen &lt; haClose, MA( Halow, per2HA ), MA( Hahigh, per2HA ) );\r\nHf = IIf( haOpen &lt; haClose, MA( Hahigh, per2HA ), MA( Halow, per2HA ) );\r\n//HeikenAshiColor = IIf( Cf &gt; Of, colorGreen, colorRed );\r\n\r\nfunction ZeroLagTEMA( array, period )\r\n{\r\n    TMA1 = TEMA( array, period );\r\n    TMA2 = TEMA( TMA1, period );\r\n    Diff = TMA1 - TMA2;\r\n    return TMA1 + Diff ;\r\n}\r\n\r\nhaClose = ( haClose + haOpen + haHigh + haLow ) / 4;\r\n\r\nperiodtm = 55;\r\nZLHa = ZeroLagTEMA( haClose, periodtm );\r\nZLTyp = ZeroLagTEMA( Avg, periodtm );\r\nTMBuy = Cross( ZLTyp, ZLHa );//Buy\r\nTMSell = Cross( ZLHa, ZLTyp );//Sell\r\nTMBuy1 = ZLTyp &gt; ZLHa ;//Bullish\r\nTMSell1 = ZLHa &gt; ZLTyp ;//Bearish\r\n\r\n//============== ZeroLagEMA ==============\r\nZeroLagEMA = ( ( HHV( H, 14 ) - C ) / ( HHV ( H, 14 ) - LLV ( L, 14 ) ) ) * -100;\r\nMaxGraph = 10;\r\nPeriodZ = 10;\r\nEMA1ZeroLag = EMA( ZeroLagEMA, PeriodZ );\r\nEMA2ZeroLag = EMA( EMA1ZeroLag, 5 );\r\nDifference = EMA1ZeroLag - EMA2ZeroLag;\r\nZeroLagEMA = EMA1ZeroLag + Difference;\r\nPRZeroLag = 100 - abs( ZeroLagEMA );\r\nMoveAvgZeroLag = MA( PRZeroLag, 5 );\r\nZeroLagBuy = Cross( PRZeroLag, MoveAvgZeroLag ) AND PRZeroLag &lt; 30;\r\nZeroLagSell = Cross( MoveAvgZeroLag, PRZeroLag ) AND PRZeroLag &gt; 70;\r\nZeroLagBuy1 = PRZeroLag &gt;= MoveAvgZeroLag AND PRZeroLag &gt;= Ref( PRZeroLag, -1 ) ;\r\nZeroLagSell1 = ( PRZeroLag &lt; MoveAvgZeroLag ) OR PRZeroLag &gt;= MoveAvgZeroLag AND PRZeroLag &lt; Ref( PRZeroLag, -1 ) ;\r\n\r\n//============== Support Resistance ==============\r\n//Chinh lai theo muc ho tro khang cu Gan nhat\r\n\r\nRSPrice = ( H + L + C ) / 3;\r\nr1RS = ( 2 * RSPrice ) - L;\r\ns1RS = ( 2 * RSPrice ) - H;\r\nr2RS = RSPrice + ( r1RS - s1RS );\r\ns2RS = RSPrice - ( r2RS - s1RS );\r\nR3RS = RSPrice + ( R2RS - S2RS );\r\nS3RS = RSPrice - ( R3RS - S2RS );\r\n\r\n\r\n//===============================================================\r\n\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\n//=========================================\r\nMA20Short = C&gt;MA(C,20);\r\nMA50Mid   = C&gt;MA(C,50);\r\nMA100Long  = C&gt;MA(C,100);\r\nShortStatus = WriteIf(MA20Short,"Bullish",WriteIf(IsNull(MA(C,20)) ,"N/A","Bearish"));\r\nShortColor  = IIf(MA20Short,colorSeaGreen,colorRed);\r\nMidStatus   = WriteIf(MA50Mid,"Bullish",WriteIf(IsNull(MA(C,50))," N/A","Bearish"));\r\nMidColor    = IIf(MA50Mid,colorSeaGreen,colorRed);\r\nLongStatus  = WriteIf(MA100Long,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor   = IIf(MA100Long,colorSeaGreen,colorRed);\r\n\r\n\r\n//MACD\r\n//=========================================\r\nMACDBull    = MACD(12,26)&gt;Signal(12,26,9);\r\nMACDStatus  = WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor   = IIf(MACDBull,colorSeaGreen,colorRed);\r\n\r\n\r\n//RSI\r\n//=========================================\r\nRSI1      = RSI(14)&gt;70 ;\r\nRSI2      = RSI(14)&lt;30 ;\r\nRSI3      = RSI(14)&gt;50 ;\r\nRSI4      = RSI(14)&lt;50 ;\r\nRSIStatus = WriteIf(RSI1,"Overbought",WriteIf(RSI2,"Oversold",WriteIf(RSI3,"Bullish",WriteIf(RSI4,"Bearish","Neutral"))));\r\nRSIColor  = IIf(RSI1,colorSeaGreen,IIf(RSI2,colorRed,IIf(RSI3,colorLime,IIf(RSI4,colorRed,colorGold))));\r\n\r\n//Stochastic\r\n//=========================================\r\nStochKBull    = StochK(14,5)&gt;StochD(14,5,5);\r\nStochKStatus  = WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,5)),"N/A","Bearish"));\r\nStochKColor   = IIf(StochKBull,colorSeaGreen,colorRed);\r\n\r\n\r\n\r\n//MFI\r\n//=========================================\r\nMFI1       = MFI(14)&gt;80;\r\nMFI2       = MFI(14)&lt;20;\r\nMFI3       = MFI(14)&gt;50;\r\nMFI4       = MFI(14)&lt;50;\r\nMFIStatus  = WriteIf(MFI1,"Overbought",WriteIf(MFI2,"Oversold",WriteIf(MFI3,"Bullish",WriteIf(MFI4,"Bearish","Neutral"))));\r\nMFIColor   = IIf(MFI1,colorSeaGreen,IIf(MFI2,colorRed,IIf(MFI3,colorLime,IIf(MFI4,colorRed,colorGold))));\r\n\r\n//Bollinger Band\r\n//=========================================\r\nBB1       = C&gt;BBandTop(C,20,2) ;\r\nBB2       = C&lt;BBandBot(C,20,2) ;\r\nBBStatus  = WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor   = IIf(BB1,colorSeaGreen,IIf(BB2,colorRed,colorGold));\r\n\r\n\r\n//Aroon\r\n//=========================================\r\nLLVBarsSince     = LLVBars(L,14)+1;\r\nHHVBarsSince     = HHVBars(H,14)+1;\r\nAroonDown        = 100*(14-LLVBarsSince)/(14-1);\r\nAroonUp          = 100*(14-HHVBarsSince)/(14-1);\r\nAroonOsc         = AroonUp-AroonDown;\r\nAroon            = AroonOsc&gt;0;\r\nAroonStatus      = WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor       = IIf(Aroon,colorSeaGreen,IIf(IsNull(RSI(14) ),colorGold,colorRed));\r\n\r\n\r\n TrendScore =\r\n IIf(MA20Short,1,0)+\r\n IIf(MA50Mid,1,0) + \r\n IIf(MA100Long,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(RSI1 OR RSI3,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(MFI1 OR MFI3,1,0) +\r\n IIf(BB1,1,0)+\r\n IIf(Aroon,1,0) ;\r\n \r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n\r\n\r\n//**************************************************************************************\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN(" - VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,45);  //Volume trung binh 45 ngay\r\nvolMean \t\t= \tStDev(volAvg,45); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,45); //Spread trung binh\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND Ref(V,-1) &lt; Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVol  \t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1) &gt; Ref(V,-2) AND V &gt; VolAvg;//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.55)+L) AND C&lt;((spread*0.7)+L);// close is between 55% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.45)+L) AND C&gt;((spread*0.3)+L);// close is between 45% and 30% of the bar\r\nmidClose\t\t=\tC&gt;=((spread*0.45)+L) AND C&lt;=((spread*0.55)+L);// close is between 45% and 55% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.25;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L) AND C&gt;((spread*0.2)+L) ,2,IIf((C&lt;=((spread*0.6)+L) AND C&gt;((spread*0.4)+L)) ,3,IIf(C&lt;=((spread*0.8)+L) AND C&gt;((spread*0.6)+L),4,5))));\r\n                    //1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;=volAvg*1.6,1,IIf(V&gt;=volAvg*1.1 AND V&lt;volAvg*1.6 ,2,IIf(V&gt;=volAvg*0.9 AND V&lt;volAvg*1.1,3,IIf(V&lt;volAvg*0.9 AND V&gt;=volAvg*0.5,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);//Muc cao nhat 5 ngay gan day\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);//Muc thap nhat 5 ngay gan day\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,45); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick - Rau nen tren\r\nbwh      =  bw &gt;= 2*pm; // big wick - Rau dai\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (ang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (ang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN(" - Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND highVol;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n//***************************************************************************************************\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//               Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN(" - Chon che do Chart: Candle | Bar | Line");\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation - Trend                                   |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n\r\n//=====================\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//=====================\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//=====================\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param(" - Khoang thoi gian xem lai Volume Bar Chart",130,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\n//=====================\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//=====================\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n \r\n//=====================\r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( " - Color Bar Up ", colorBlue );\r\nColordown    = ParamColor( " - Color Bar Down", colorRed );\r\nColorsideway = ParamColor( " - Color Bar Sideway ", colorGold );\r\nColorceiling = ParamColor( " - Color Bar Ceiling ", colorViolet );\r\nColorfloor   = ParamColor( " - Color Bar Floor ", colorTurquoise );\r\n\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n\r\n//Change Color theo Gia tran, san\r\nChangePcolor = IIf(/*Gia tran&gt;=6%*/xx&gt;=6,Colorceiling,/*Gia san&lt;6%*/IIf(xx&lt;=-6,Colorfloor,/*Tang gia*/IIf(xx&gt;0 AND xx&lt;6,Colorup,/*Giam gia*/IIf(xx&lt;0 AND xx&gt;-6,Colordown,/*Tham chieu*/Colorsideway))));\r\n\r\nPStyle       = ParamStyle(" - Chart Style", styleThick );\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*******************************************************************\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\n                                                                      \r\nswitch ( ParamList( "* - Chon che do hien thi Candle | Bar", "Candle (1)|Candle (2)|Candle MACD Strength|Candle RSI Strength|Candle High Low MA|Candle EMAStrength|Heiken Ashi|Heiken Ashi (MA)|Bar Close|Bar Based|Bar Trend|Bar VSA Based|Bar Trend Based|Bar Marar Trend Based|Bar Strength|Bar PA|Line", 0 ) )\r\n{\r\n\r\n//Nen Nhat 1\r\ncase "Candle (1)":\r\n\r\nPlot(C, "Close", ChangePcolor , styleCandle | PStyle  );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n//Nen Nhat 2\r\ncase "Candle (2)":\r\n\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle  );\r\n\r\nbreak;\r\n\r\n\r\n\r\n//*********************************\r\n\r\n//Candle MACDStrengt - Alexander Elder Impulse\r\ncase "Candle MACD Strength":\r\n\r\n\r\nPlot( C, "Close", MACDStrengthColor, styleCandle | PStyle  );\r\nbreak;\r\n\r\n//*********************************\r\n\r\n//Nen Nhat RSIStrength\r\ncase "Candle RSI Strength":\r\n\r\nPlot(C, "Close", RSIStrengthColor , styleCandle | PStyle  );\r\n\r\nbreak;\r\n\r\n\r\n\r\n//*********************************\r\n\r\n//Nen Nhat High Low MA\r\ncase "Candle High Low MA":\r\n\r\nPlot( C, "Close", HLMAColorbar, styleCandle  | PStyle );\r\n\r\nbreak;\r\n\r\n\r\n\r\n//*********************************\r\n\r\n//Nen Nhat EMAStrength\r\ncase "Candle EMAStrength":\r\n\r\nPlot(C, "Close", EMAStrengthColor , styleCandle | PStyle  );\r\n\r\nbreak;\r\n\r\n\r\n//*********************************\r\ncase "Heiken Ashi":\r\nHeikenAshiClose = (O + H + L + C)/4; \r\nHeikenAshiOpen = AMA( Ref( HeikenAshiClose, -1 ), 0.5 ); \r\nHeikenAshiHigh = Max( H, Max( HeikenAshiClose, HeikenAshiOpen ) ); \r\nHeikenAshiLow = Min( L, Min( HeikenAshiClose, HeikenAshiOpen ) ); \r\nxDiff = (HeikenAshiHigh - HeikenAshiLow) * 10000;\r\nHeikenAshiColor = IIf(HeikenAshiClose &gt;= HeikenAshiOpen,colorBlue,colorRed);\r\nPlotOHLC( HeikenAshiOpen, HeikenAshiHigh, HeikenAshiLow, HeikenAshiClose, "", HeikenAshiColor, styleCandle );\r\n\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\ncase "Heiken Ashi (MA)":\r\n//---------------Color------------------------\r\nHeikenper1 = 5;\r\nHeikenper2 = 2;\r\n\r\nCmHeiken = MA( C, Heikenper1 );\r\nOmHeiken = MA( O, Heikenper1 );\r\nHmHeiken = MA( H, Heikenper1 );\r\nLmHeiken = MA( L, Heikenper1 );\r\n\r\n// 1. Heiken Ashi MA\r\nHaCloseMA = ( OmHeiken + HmHeiken + LmHeiken + CmHeiken ) / 4;\r\nHaOpenMA = AMA( Ref( HaCloseMA,  -1 ),  0.5 );\r\nHaHighMA = Max( HmHeiken,  Max( HaCloseMA,  HaOpenMA ) );\r\nHaLowMA = Min( LmHeiken,  Min( HaCloseMA,  HaOpenMA ) );\r\n\r\n// 2. New Heiken Ashi MA\r\nCfMA = MA( HaCloseMA, Heikenper2 );\r\nOfMA = MA( HaOpenMA, Heikenper2 );\r\nHfMA = IIf( HaOpenMA &lt; HaCloseMA, MA( HaHighMA, Heikenper2 ), MA( HaLowMA, Heikenper2 ) );\r\nLfMA = IIf( HaOpenMA &lt; HaCloseMA, MA( HaLowMA, Heikenper2 ), MA( HaHighMA, Heikenper2 ) );\r\n\r\nHeikenAshiMAColor = IIf( CfMA &gt; OfMA, colorBlue, colorRed);\r\n\r\nPlotOHLC( OfMA, HfMA, LfMA, CfMA, "", HeikenAshiMAColor, styleCandle );\r\n\r\n//----------------------------------------------------\r\n\r\n\r\nbreak;\r\n\r\n//*********************************\t\t\r\n\r\n\r\n//Bar Close\r\ncase "Bar Close":\r\n\r\nPlotOHLC(Close,  High,  Low,  Close, "",  ChangePcolor, styleBar | PStyle  );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n\r\n//Bar Based\r\ncase "Bar Based":\r\n\r\nPlotOHLC(Open,  High,  Low,  Close, "", ChangePcolor, styleBar | PStyle    );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Bar Trend":\r\n\r\nPlot(C, "Price",  EMAStrengthColor , styleBar | PStyle  );\r\n\r\nbreak;\r\n\r\n\r\n//*********************************\r\n\r\n\r\n//Bar VSA Based\r\ncase "Bar VSA Based":\r\n\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleBar  | PStyle     );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n\r\n//Bar VSA Trend Based\r\ncase "Bar Trend Based":\r\n\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleBar | PStyle   );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n//Bar Marar Trend Based\r\ncase "Bar Marar Trend Based":\r\n\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleBar | PStyle    );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n//Strength Bars\r\ncase "Bar Strength":\r\n\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleBar   | PStyle   );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n//PA Bars\r\ncase "Bar PA":\r\n\r\nPlotOHLC(Open,  High,  Low,  Close, "", pacolor, styleBar | PStyle    );\r\n\r\nbreak;\r\n\r\n//*********************************\r\n\r\n//Line\r\ncase "Line":\r\n\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"", ParamColor(" - Line Color", colorGold ), styleLine  | PStyle   ); \r\n\r\nbreak;\r\n\r\n}\r\n\r\n\r\n\r\nColorPriceintraday = ParamColor( " - Color Price Intraday", colorSeaGreen ) ;\r\n\r\n\r\n\r\nif (ParamToggle( "* - Hien thi Thong tin Gia",  "OFF|ON", 1 ))\r\n{\r\n\r\ny = LastValue( C ); \r\n\r\nPlotText(" " + Name() +"             " +"C: " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)" +\r\n                "\\n                      V: " +WriteVal(V,1)+   "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  MA30"+ " (" + WriteVal( MA(V,30),1.0) + ")"\r\n\r\n, BarCount+ 2 , y, ColorPriceintraday );\r\n\r\n\r\n}\r\n\r\n/*\r\n\r\n//Danh gia Volume\r\nIf(V&gt;=MA(V,30)*1.6)\r\n{PlotText(  "\\n\\n Danh gia:    " + "SIEU CAO" ,   BarCount+ 2 , y, ColorPriceintraday );}\r\nIf(V&lt;MA(V,30)*1.6 AND V&gt;=MA(V,30)*1.1)\r\n{PlotText(  "\\n\\n Danh gia:    " + "CAO" ,        BarCount+ 2 , y, ColorPriceintraday );}\r\nIf(V&lt;MA(V,30)*1.1 AND V&gt;=MA(V,30)*0.9) \r\n{PlotText(  "\\n\\n Danh gia:    " + "TRUNG BINH" , BarCount+ 2 , y, ColorPriceintraday );}\r\nIf(V&lt;MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5)\r\n{PlotText(  "\\n\\n Danh gia:    " + "THAP" ,       BarCount+ 2 , y, ColorPriceintraday );} \r\nIf(V&lt;MA(V,30)*0.5)\r\n{PlotText(  "\\n\\n Danh gia:    " + "SIEU THAP" ,  BarCount+ 2 , y, ColorPriceintraday );}\r\n\r\n\r\n*/\r\n\r\n       \r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n//************************************************************************************************\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr   (" - So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor (" - Ticker Color ", colorAqua );\r\nStyleForeign      =  ParamStyle(" - Ticker Style ",styleThick);\r\n  \r\nif (ParamToggle( "* - Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale |styleNoRescale );\r\n\r\ny = LastValue( C ); \r\n\r\nPlotText("\\n\\n\\n\\n^" + Ticker +  ":      " +  WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 2 , y, ColorForeign);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN(" - Cac duong Trung binh dong");\r\n\r\n\r\n/*\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1 - Lua chon Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n*/\r\n\r\n//Cac duong EMAs\r\n//EMA5\r\nema5Day              = Param(" - EMA5 Day",  5,  1,  500, 1);\r\nLastHigh_ema5Day     = Ref( HHV( High, ema5Day ), -1 );\r\nLastLow_ema5Day      = Ref( LLV( Low, ema5Day ), -1 );\r\nMA_ema5Day           = EMA(C, ema5Day);\r\n\r\n//EMA10\r\nema10Day              = Param(" - EMA10 Day",  10,  1,  500, 1);\r\nLastHigh_ema10Day     = Ref( HHV( High, ema10Day ), -1 );\r\nLastLow_ema10Day      = Ref( LLV( Low, ema10Day ), -1 );\r\nMA_ema10Day           = EMA(C, ema10Day);\r\n\r\n//EMA20\r\nema20Day              = Param(" - EMA20 Day",  20,  1,  500, 1);\r\nLastHigh_ema20Day     = Ref( HHV( High, ema20Day ), -1 );\r\nLastLow_ema20Day      = Ref( LLV( Low, ema20Day ), -1 );\r\nMA_ema20Day           = EMA(C, ema20Day);\r\n\r\n//EMA30\r\nema30Day              = Param(" - EMA30 Day",  30,  1,  500, 1);\r\nLastHigh_ema30Day     = Ref( HHV( High, ema30Day ), -1 );\r\nLastLow_ema30Day      = Ref( LLV( Low, ema30Day ), -1 );\r\nMA_ema30Day           = EMA(C, ema30Day);\r\n\r\n//EMA40\r\nema40Day              = Param(" - EMA40 Day",  40,  1,  500, 1);\r\nLastHigh_ema40Day     = Ref( HHV( High, ema40Day ), -1 );\r\nLastLow_ema40Day      = Ref( LLV( Low, ema40Day ), -1 );\r\nMA_ema40Day           = EMA(C, ema40Day);\r\n\r\n\r\n//Cac duong MAs\r\n\r\n//EMA50\r\nma50Day              = Param(" - MA50 Day",  50,  1,  500, 1);\r\nLastHigh_ma50Day     = Ref( HHV( High, ma50Day ), -1 );\r\nLastLow_ma50Day      = Ref( LLV( Low, ma50Day ), -1 );\r\nMA_ma50Day           = MA(C, ma50Day);\r\n\r\n//EMA100\r\nma100Day              = Param(" - MA100 Day",  100,  1,  500, 1);\r\nLastHigh_ma100Day     = Ref( HHV( High, ma100Day ), -1 );\r\nLastLow_ma100Day      = Ref( LLV( Low, ma100Day ), -1 );\r\nMA_ma100Day           = MA(C, ma100Day);\r\n\r\n//EMA150\r\nma150Day              = Param(" - MA150 Day",  150,  1,  500, 1);\r\nLastHigh_ma150Day     = Ref( HHV( High, ma150Day ), -1 );\r\nLastLow_ma150Day      = Ref( LLV( Low, ma150Day ), -1 );\r\nMA_ma150Day           = MA(C, ma150Day);\r\n\r\n//EMA200\r\nma200Day              = Param(" - MA20 Day",  200,  1,  500, 1);\r\nLastHigh_ma200Day     = Ref( HHV( High, ma200Day ), -1 );\r\nLastLow_ma200Day      = Ref( LLV( Low, ma200Day ), -1 );\r\nMA_ma200Day           = MA(C, ma200Day);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Ve duong EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1 - EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, MA_ema5Day ,Null), "EMA5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, MA_ema10Day ,Null),"EMA10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, MA_ema20Day ,Null),"EMA20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Cloud Up Color",      colorTurquoise );  \r\nmadncolor   = ParamColor(" - MA Cloud Down Color",    colorLavender );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve May EMA10,20\r\nCloudMAswitch = ParamToggle("* - Fill MA10,20 Cloud Color",  "OFF|ON", 0 );\r\nCloudMAcolor = IIf(MA_ema10Day &gt; MA_ema20Day, bullColor , bearColor); \r\n\r\n//Ve may EMA 10 va 20\r\n//PlotOHLC( MA_ema10Day, MA_ema20Day, MA_ema10Day, MA_ema20Day, "", IIf(MA_ema10Day &gt; MA_ema20Day, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\nPlotOHLC( IIf(CloudMAswitch,MA_ema10Day,-1e10),IIf(CloudMAswitch,MA_ema10Day,-1e10),IIf(CloudMAswitch,MA_ema20Day,-1e10),IIf(CloudMAswitch,MA_ema10Day,-1e10), "", CloudMAcolor, styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n//Hien thong tin EMA20\r\nif (ParamToggle("* - Thong tin EMA20","OFF|ON" , 0 ))\r\n{\r\ny = LastValue( MA_ema20Day ); \r\nPlotText("EMA" + WriteVal(ema20Day,1.0) +": "  +WriteVal(MA_ema20Day,1.1), BarCount+ 2 , y, colorSeaGreen );\r\n}\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong EMA30,40\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2 - EMA30","OFF|ON" , 0 )  ==1, MA_ema30Day ,Null),"EMA30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong EMA40\r\nPlot(IIf(ParamToggle("3 - EMA40","OFF|ON" , 0 )  ==1, MA_ema40Day ,Null),"EMA40", colorSeaGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n//===============================================\r\n// Ve duong MA50,100,150,200\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("4 - MA50", "OFF|ON" , 0 ) ==1, MA_ma50Day ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("5 - MA100","OFF|ON" , 0 ) ==1, MA_ma100Day ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("6 - MA150","OFF|ON" , 0 ) ==1, MA_ma150Day ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("7 - MA200","OFF|ON" , 0)  ==1, MA_ma200Day ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n// END EMA va MA\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*********************************************************************************************\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                    Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN(" - Muc HO TRO - KHANG CU gan nhat");\r\n\r\n\t\r\n \r\n\r\n \r\n \r\n //==========================================================================|\r\n//                    Ve duong HO TRO - KHANG CU gan nhat                       |\r\n//==========================================================================\r\n \r\nif (ParamToggle("* - Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\r\nWarnaResistant = ParamColor(" - Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor(" - Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle(" - S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale );\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 3, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 3, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 3, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 3, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n\r\n//END duong HO TRO - KHANG CU gan nhat  \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN(" - Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( " - Resistance Color", colorRed );\r\nScolor=ParamColor( " - Support Color", colorBlue );\r\nPer   =Param(" - Chon do nhay",5,1,100,1);\r\ng     =Param(" - Chon so duong",5,1,20,1);\r\n\r\nsr    =ParamToggle("* - Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n\r\n//*****************************************************************\r\n//Resistance lines commentary - Dien gia duong ho tro khang cu\r\n//*****************************************************************\r\n\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n\r\n//******************************************************************************************************\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - Darvas Box");\r\n\r\nPeriods     = Param(" - Darvas Periods",5,1,260); \r\n\r\nboxHigh     = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n              Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n          \r\n\r\nTopbox      = ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox      = ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* - Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor(" - Box Top Color",  colorRed),  ParamStyle(" - Box Top Style",styleNoLabel)   |styleNoLabel  |styleNoRescale );\r\nPlot(Botbox, "Bot", ParamColor(" - Box Bottom Color",colorBlue),  ParamStyle(" - Box Bottom Style",styleNoLabel)  |styleNoLabel  |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n\r\n\r\n\r\n//***********************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                        Auto Trendline                                 |\r\n//====================================================================================|\r\n_SECTION_BEGIN(" - Auto Trenline");\r\n\r\n \r\n \r\n \r\n //====================================================================================|\r\n//                       Ve duong Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\nif (ParamToggle("* - Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nxTrenline = Cum(1);\r\nperTrenline = 3;\r\ns1Trenline=L;\r\ns11Trendline=H;\r\npSTrendline = TroughBars( s1Trenline, perTrenline, 1 ) == 0;\r\nendtTrenline= LastValue(ValueWhen( pSTrendline, xTrenline, 1 ));\r\nstarttTrenline=LastValue(ValueWhen( pSTrendline, xTrenline, 2 ));\r\ndtSTrenline =endtTrenline-starttTrenline;\r\nendSTrendline = LastValue(ValueWhen( pSTrendline, s1Trenline, 1 ) );\r\nstartSTrendline = LastValue( ValueWhen( pSTrendline, s1Trenline, 2 ));\r\naSTrendline = (endSTrendline-startSTrendline)/dtSTrenline;\r\nbSTrendline = endSTrendline;\r\ntrendlineS = aSTrendline * ( xTrenline -endtTrenline ) + bSTrendline;\r\n\r\nPlot(IIf(xTrenline&gt;starttTrenline-10,trendlineS,-1e10),"",colorBlue,styleNoLabel   |styleNoRescale);\r\n\r\nH1Trendline=LastValue(Highest((Cum(1)&gt;starttTrenline AND Cum(1)&lt;endtTrenline)*H));\r\ntH1Trendline=LastValue(ValueWhen(H==H1Trendline,Cum(1)));\r\n\r\nUpperParallel=aSTrendline*(xTrenline-tH1Trendline)+H1Trendline;\r\n\r\nPlot(IIf(xTrenline&gt;starttTrenline-10,UpperParallel,-1e10),"UpperLine",colorOrange, styleNoLabel  |styleNoRescale);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\n\r\npRTrendline = PeakBars( s11Trendline, perTrenline, 1 ) == 0;\r\nendt1Trendline= LastValue(ValueWhen( pRTrendline, xTrenline, 1 ));\r\nstartt1Trendline=LastValue(ValueWhen( pRTrendline, xTrenline, 2 ));\r\ndtRTrendline =endt1Trendline-startt1Trendline;\r\nendRTrendline = LastValue(ValueWhen( pRTrendline, s11Trendline, 1 ) );\r\nstartRTrendline = LastValue( ValueWhen( pRTrendline, s11Trendline, 2 ));\r\naRTrendline = (endRTrendline-startRTrendline)/dtRTrendline;\r\nbRTrendline = endRTrendline;\r\ntrendlineR = aRTrendline * ( xTrenline -endt1Trendline ) + bRTrendline;\r\n\r\nPlot(IIf(xTrenline&gt;startt1Trendline-10,trendlineR,-1e10),"",colorBlue, styleNoLabel  |styleNoRescale);\r\n\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1Trendline AND Cum(1)&lt;endt1Trendline,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1Trendline OR Cum(1)==endt1Trendline),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\n\r\nLowerParallel=aRTrendline*(xTrenline-tL1)+L1;\r\n\r\nPlot(IIf(xTrenline&gt;startt1Trendline-10,LowerParallel,-1e10),"LowerLine",colorOrange, styleNoLabel  |styleNoRescale);\r\n\r\n\r\n}\r\n\r\n// END AUTO TRENDLINE\r\n\r\n _SECTION_END();\r\n\r\n\r\n\r\n//**************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN(" - Fibonacci Internal + External Retracements");\r\n\r\n\tpctH  = Param (" - Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB  = Param (" - Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL  = Param (" - Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB  = Param (" - Lo LookBack",1,1,BarCount-1,1);\r\n\tBack  = Param (" - Extend Left = 2",1,1,500,1);\r\n\tFwd   = Param(" - Plot Forward", 0, 0, 500, 1);\r\n\thts   = Param (" - Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle(" - Line Style",styleLine,styleNoLabel);\r\n\t\r\n\tfibs = ParamToggle("1 - Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2 - Hien thi thong so","OFF|ON",0);\r\n\t\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, BarIndex(), HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, BarIndex(), LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0Fibonacci = Min(xSp0,xRp0)-Back;\r\nx1Fibonacci = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\n\r\n//************* Ve Fibonacci\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1Fibonacci,yRp0,Back),"PR",32,8 |styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1Fibonacci,ySp0,Back),"PS",27,8|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,r236,x1Fibonacci,r236,Back),"",45,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,r382,x1Fibonacci,r382,Back),"",44,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,r050,x1Fibonacci,r050,Back),"",41,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,r618,x1Fibonacci,r618,Back),"",43,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,r786,x1Fibonacci,r786,Back),"",42,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,e127,x1Fibonacci,e127,Back),"e127",47,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,e162,x1Fibonacci,e162,Back),"e162",47,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,e200,x1Fibonacci,e200,Back),"p200",47,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,e262,x1Fibonacci,e262,Back),"p262",47,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0Fibonacci-Fwd,e424,x1Fibonacci,e424,Back),"p424",25,style|styleNoLabel  |styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n//*******************************************************************************************\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - VAP - Volume At Price");\r\n\r\nVAPline  = Param      (" - VAP Lines - So luong thanh VAP", 200, 1, 1000, 1 );\r\nVAPwidth = Param      (" - VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor (" - VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("* - Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* - VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  VAP - Volume At Price   \r\n   \r\n \r\n\r\n\r\n//*******************************************************************************************\r\n\r\n\r\n\r\n \r\n          \r\n//==========================================================================|\r\n//                    Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN(" - Volume At Price Anna Coulling");\r\n\r\n\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Hien thi Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n\r\nif (VAPanna = ParamToggle( "* - Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\nQvapAnna       = Param( " - So luong thanh VAP", 50, 1, 300, 1 );\r\npRecHeight     = Param( " - Rectangle Height - Kich thuoc hop chu nhat", 0.80, 0.10, 1, 0.01 );\r\n\r\n\r\nBarindexAna = BarIndex();\r\nBeginValueAnna = BeginValue( BarindexAna );\r\nEndValueAnna = EndValue( BarindexAna );\r\n\r\nif( BeginValueAnna == 0 &amp;&amp; EndValueAnna == LastValue( BarindexAna ) )\r\n{\r\n    BeginValueAnna = FirstVisibleValue( BarindexAna );\r\n    EndValueAnna = LastVisibleValue( BarindexAna );\r\n}\r\n\r\nBeginValueAnna = Max( 0, BeginValueAnna );\r\nEndValueAnna = Max( 0, EndValueAnna );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbarAnna = C &gt; ( High - BullBearZone );\r\nbearbarAnna = C &lt; ( Low + BullBearZone );\r\n\r\nmxAnna  = PriceVolDistribution( H, L, V, QvapAnna, True, BeginValueAnna, EndValueAnna );\r\nmx1Anna = PriceVolDistribution( H, L, IIf( bullbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );\r\nmx2Anna = PriceVolDistribution( H, L, IIf( bearbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );\r\n\r\nbins  = MxGetSize( mxAnna, 0 );\r\nbins1 = MxGetSize( mx1Anna, 0 );\r\nbins2 = MxGetSize( mx2Anna, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mxAnna[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mxAnna[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mxAnna[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mxAnna=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mxAnna[ 1 ][ 0 ] - mxAnna[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont     = GfxSelectFont( " - Arial", SelectsizeFont = Param( " - Chon Font Size", 8, 1, 30, 1 ) );  // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1Anna = Bull\r\n        price = mx1Anna[ i ][ 0 ]; // price level\r\n        absVolume = mx1Anna[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( EndValueAnna - BeginValueAnna + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1Anna = BeginValueAnna;\r\n        y1Anna = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2Anna = BeginValueAnna + relbar;\r\n        y2Anna = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );\r\n\r\n        // mx2Anna = Bear\r\n        absVolume = mx2Anna[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );\r\n        x1Anna = x2Anna;\r\n        x2Anna = x1Anna + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );\r\n\r\n        // mxAnna = All Bars\r\n        absVolume = mxAnna[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );\r\n        x1Anna = x2Anna;\r\n        x2Anna = x1Anna + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n//*******************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN(" - High Volume Lines");\r\n\r\njVolumeLines        = Param(" - So luong thanh High Volume Lines",5,1,20,1);\r\nkVolumeLines        = Param(" - He so Volume factor",2,1.5,3,0.5);\r\nhvlColor            = ParamColor( " - HVL Colorr", colorOrange );\r\nvronoff             =ParamToggle("* - Hien thi High volume lines","OFF|ON" ,0);\r\nyVolumeLines =Cum(1);\r\nHk1=V&gt;kVolumeLines*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,yVolumeLines,1));\r\nhx2=LastValue(ValueWhen(hk1,yVolumeLines,2));\r\nhx3=LastValue(ValueWhen(hk1,yVolumeLines,3));\r\nhx4=LastValue(ValueWhen(hk1,yVolumeLines,4));\r\nhx5=LastValue(ValueWhen(hk1,yVolumeLines,5));\r\nhx6=LastValue(ValueWhen(hk1,yVolumeLines,6));\r\nhx7=LastValue(ValueWhen(hk1,yVolumeLines,7));\r\nhx8=LastValue(ValueWhen(hk1,yVolumeLines,8));\r\nhx9=LastValue(ValueWhen(hk1,yVolumeLines,9));\r\nhx10=LastValue(ValueWhen(hk1,yVolumeLines,10));\r\nhx11=LastValue(ValueWhen(hk1,yVolumeLines,11));\r\nhx12=LastValue(ValueWhen(hk1,yVolumeLines,12));\r\nhx13=LastValue(ValueWhen(hk1,yVolumeLines,13));\r\nhx14=LastValue(ValueWhen(hk1,yVolumeLines,14));\r\nhx15=LastValue(ValueWhen(hk1,yVolumeLines,15));\r\nhx16=LastValue(ValueWhen(hk1,yVolumeLines,16));\r\nhx17=LastValue(ValueWhen(hk1,yVolumeLines,17));\r\nhx18=LastValue(ValueWhen(hk1,yVolumeLines,18));\r\nhx19=LastValue(ValueWhen(hk1,yVolumeLines,19));\r\nhx20=LastValue(ValueWhen(hk1,yVolumeLines,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(yVolumeLines&gt;hx1 AND jVolumeLines&gt;=1 AND vronoff,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx2 AND jVolumeLines&gt;=2 AND vronoff,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx3 AND jVolumeLines&gt;=3 AND vronoff,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx4 AND jVolumeLines&gt;=4 AND vronoff,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx5 AND jVolumeLines&gt;=5 AND vronoff,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx6 AND jVolumeLines&gt;=6 AND vronoff,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx7 AND jVolumeLines&gt;=7 AND vronoff,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx8 AND jVolumeLines&gt;=8 AND vronoff,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx9 AND jVolumeLines&gt;=9 AND vronoff,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx10 AND jVolumeLines&gt;=10 AND vronoff,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx11 AND jVolumeLines&gt;=11 AND vronoff,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx12 AND jVolumeLines&gt;=12 AND vronoff,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx13 AND jVolumeLines&gt;=13 AND vronoff,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx14 AND jVolumeLines&gt;=14 AND vronoff,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx15 AND jVolumeLines&gt;=15 AND vronoff,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx16 AND jVolumeLines&gt;=16 AND vronoff,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx17 AND jVolumeLines&gt;=17 AND vronoff,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx18 AND jVolumeLines&gt;=18 AND vronoff,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx19 AND jVolumeLines&gt;=19 AND vronoff,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(yVolumeLines&gt;hx20 AND jVolumeLines&gt;=20 AND vronoff,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//*******************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//            Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField(" - Volume Weighted Average Price Field",-1);\r\nVwapPeriods = Param(" - Volume Weighted Average Price Periods", 20, 2, 300, 1, 10 );\r\nVWAPcolor   = ParamColor( " - VWAP Color", colorYellow );\r\nVWAPstyle   = ParamStyle( " - VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1 - VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle |styleNoLabel  |styleNoRescale);\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nVWAPPeriod = ParamList( " - Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2 - WAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(VWAPPeriod=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(VWAPPeriod=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(VWAPPeriod=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor,styleNoLabel  |styleNoRescale);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n//********************************************************************************************\r\n\r\n\r\n//==========================================================================|\r\n//                    Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - Bollinger Bands");\r\n\r\n\r\n//==========================================================================|\r\n//                    Hien thi Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\nif (bBollingerBands = ParamToggle( "* - Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBTop" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); \r\nPlot( bbb = BBandBot( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBBot" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( ParamColor(" - Bollinger Color", colorDarkOliveGreen), colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n// END Bollinger Bands  \r\n\r\n_SECTION_END();\r\n\r\n\r\n//*******************************************************************************************\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - Keltner Bands system");\r\n\r\n//Keltner Band Code\r\n\r\nKma        = Param(" - Keltner MA", 20, 1, 300, 1 ); \r\nKMid       = MA (Close, Kma);  //Middle Line\r\n\r\nATRPeriod  = Param(" - ATR Period", 20, 2, 300, 1 ); //ATR Period\r\nKFactor    = Param(" - ATR Width", 3, 0, 10, 0.05 ); //Multiplier\r\nKValue     = ATR(ATRPeriod) * KFactor; \r\n\r\nKTop       = KMid + KValue;   //Upper Band\r\nKBottom    = KMid - KValue;    //Lower Ban\r\n \r\n\r\nBuyKeltner = Cross(High,KTop)\r\n\r\n//Volume - Co thanh khoan cao\r\nAND Volume &gt; 0.7*EMA( Volume, 30 ) AND volume &gt; 50000 AND Ref(V,-5) &gt; 50000 AND Ref(V,-10) &gt; 50000 AND MA(V,20) &gt; 100000  \r\n//Gia dang tang so voi hom qua                                        \r\nAND C &gt;= 1.01*Ref(C,-1) \r\n//Gia cao hon cac duong MA 10,20\r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,20)  \r\n//EMA10 cao hon cac duong 20                         \r\nAND EMA(C,10) &gt;= EMA(C,20)  \r\n//Giai doan 2 Uptrend Mark Minervini  \r\nAND C &gt;  MA(C,200)                                                                                    \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) ;\r\n\r\n//Ban khong\r\nShortKeltner= ( Cross(KBottom,Low)  AND C &lt;= EMA(C,10) AND C &lt;= EMA(C,20) AND EMA(C,10) &lt;= EMA(C,20) )  ;\r\n\r\n\r\n\r\nSellKeltner =   ( Cross(KMid,Low) AND C &lt;= EMA(C,10) )\r\n     OR ( Cross(KMid,Low) AND C &lt;= EMA(C,20) )\r\n     OR ( Cross(KMid,Low) AND EMA(C,10) &lt;= EMA(C,20) )\r\n     OR ( Cross(KMid,Low) AND C &lt;= EMA(C,10) AND C &lt;= EMA(C,20) AND EMA(C,10) &lt;= EMA(C,20) );\r\n\r\n     \r\nCoverKeltner = Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuyKeltner   = ExRem(BuyKeltner,SellKeltner);\r\nSellKeltner  = ExRem(SellKeltner,BuyKeltner);\r\nShortKeltner = ExRem(ShortKeltner,CoverKeltner);\r\nCoverKeltner = ExRem(CoverKeltner,ShortKeltner);\r\n   \r\n \r\n \r\n \r\n //==========================================================================|\r\n//                 Ve duong Keltner Bands system                                 |\r\n//==========================================================================|  \r\n   \r\n  \r\nif (Keltner = ParamToggle( "* - Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop," - KTop",colorRed,styleLine|styleNoLabel  |styleNoRescale);\r\nPlot(KMid," - KMid",colorGold,styleDashed|styleNoLabel|styleNoRescale);\r\nPlot(KBottom," - KBottom",colorBlue,styleLine|styleNoLabel|styleNoRescale);\r\n \r\n \r\n \r\nprintf("\\nBuy : " + BuyKeltner );  \r\nprintf("\\nSell : " + SellKeltner );  \r\nprintf("\\nShort : " + ShortKeltner );  \r\nprintf("\\nCover : " + CoverKeltner );  \r\n\r\n// Hien thi cac tin hieu Mua Ban theo  Keltner Bands system     \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(BuyKeltner, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-25);\r\nPlotShapes(IIf(SellKeltner, shapeDownArrow, shapeNone),colorRed, 0, H, Offset=-25);\r\n\r\nPlotShapes(IIf(ShortKeltner, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-25);\r\nPlotShapes(IIf(ShortKeltner, shapeStar, shapeNone),colorYellow, 0,H, Offset=40);\r\n\r\n//Hien chu E10\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyKeltner[i] == 1 )\r\n    {\r\n PlotText( "Kel", i , L[ i ], colorBlack, colorBrightGreen,Offset=-50  ) ;\r\n     }  \r\n  //Sell   \r\n if( SellKeltner[i] == 1 )\r\n    {\r\nPlotText( "Kel", i , H [ i ], colorBlack, colorRed,Offset= 40  ) ;\r\n     }      \r\n }  \r\n \r\n\r\n}\r\n// END Keltner Bands system \r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n//*******************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         Center of Gravity indicator  - Trung tam cua Trong luc  |\r\n//==========================================================================|\r\n// \r\n// \r\n_SECTION_BEGIN(" - Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param(" - n-th Order",3,1,20,1);\t\r\nbars=Param(" - Chon time qua khu",260,50,1000,1);\r\nalt=ParamToggle(" - Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\nsv=ParamToggle("* - Chon che do hien thi theo Click chuot","OFF|ON",1);\r\n \r\n \r\nif (Gravity = ParamToggle( "* - Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n//Plot(C, "Close",colorLightGrey,styleCandle);\r\nPlot(reg,"reg",colorBlue,1 |styleNoLabel|styleNoRescale );\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick |styleNoLabel|styleNoRescale );\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed |styleNoLabel|styleNoRescale );\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed |styleNoLabel|styleNoRescale );\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick |styleNoLabel|styleNoRescale );\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed |styleNoLabel|styleNoRescale );\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed |styleNoLabel|styleNoRescale );\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n//Plot(C, "Close",colorLightGrey,styleCandle);\r\nPlot(reg,"reg",colorBlue,1 |styleNoLabel|styleNoRescale );\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick |styleNoLabel|styleNoRescale );\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed |styleNoLabel|styleNoRescale );\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed |styleNoLabel|styleNoRescale );\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick |styleNoLabel|styleNoRescale );\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed |styleNoLabel|styleNoRescale );\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed |styleNoLabel|styleNoRescale );\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud |styleNoLabel|styleNoRescale ,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n//END Center of Gravity indicator\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n//*******************************************************************************************\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param(" - Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param(" - Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* - Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault)  |styleNoLabel|styleNoRescale );\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n\r\n\r\n\r\n//*****************************************************************************************************\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                     Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - Zig Zag Indicator ");\r\n\r\n\r\n\r\nif (ParamToggle( "* - Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(ParamField( "Zig Zag Price field" ), Param("Zig Zag % Change",5,0.1,25,0.1)), "Zig Zag", ParamColor( "Zig Zag Color", colorBlue ), ParamStyle( "Zig Zag Style" , styleThick |styleNoLabel|styleNoRescale  ));\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//*****************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                   GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - GAP Indicator ");\r\n\r\nLinLen = Param(" - Chon do dai Gap Line",3,1,15,1);\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\n\r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\n\r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null);  \r\n\r\n\r\n//======================================================\r\n\r\n//Ve Gap\r\nif (gapindicator = ParamToggle( "* - Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n \r\n//Ve duong Gapline\r\nPlot(GapLineHi,"",ParamColor( " - GapLine High Color", colorGold ), styleLine |styleNoLabel|styleNoRescale );  \r\nPlot(GapLineLo,"",ParamColor( " - GapLine Low Color", colorBlue ), styleLine |styleNoLabel|styleNoRescale );  \r\n\r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\n\r\n//Hien so Number\r\nPlotText(     NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],ParamColor( " - GapLine High Color", colorGold ));  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],ParamColor( " - GapLine Low Color", colorBlue ));  \r\n}  \r\n}\r\n\r\n}\r\n// END GAP Indicator \r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*****************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                Chien luoc giao dich Luot song ngan han                  \r\n//|============================================================================================|\r\n\r\n_SECTION_BEGIN(" - Chien luoc giao dich luot song ngan han");\r\n\r\n\r\n\r\n\r\n//===========================================================================\r\n// 1. Chien luoc Breakout vung tich luy Sideway ngan han\r\n//===========================================================================\r\n\r\nBside = Param(" ****** Breakout Sideway ****** ",0,0,0,0); \r\n\r\nSidewayDay           = Param(" - Chon ky cho vung Sideway",  10, 1, 260, 1);\r\nLastHigh_SidewayDay  = Ref( HHV( High, SidewayDay ), -1 );\r\nLastLow_SidewayDay   = Ref( LLV( Low, SidewayDay ), -1 );\r\n\r\n//Chon % Giao dong cua vung Sideway\r\nSidewayDay_Percent    = Param( " - Gioi han bien dong % trong vung Sideway", 0.1, 0.01, 0.5, 0.01 ); //Bien dong gia trong vung sideway\r\n\r\n//Gioi han cao nhat va thap nhat vung Sideway thoa man dieu kien da chon\r\nLowHigh_SidewayDay    = ( LastHigh_SidewayDay - LastLow_SidewayDay ) / LastLow_SidewayDay &lt;= SidewayDay_Percent;\r\n\r\n\r\n//Dieu kien Mua khi xay ra Breakout thoat vung Sideway\r\nBreakout_SidewayDay   = \r\n//1. Vuot dinh 10 ngay\r\n(Close &gt; LastHigh_SidewayDay  AND LowHigh_SidewayDay  AND C &gt; MA_ema5Day AND C &gt; MA_ema10Day AND MA_ema5Day &gt; MA_ema10Day)\r\n//2. EMA14 vuot duong tin hieu 9 va vuot dinh 5 ngay\r\nOR (EMA(C,14)&gt;EMA(EMA(C,14),9) AND  Cross (C,Peak(C,5,1)));\r\n\r\n\r\n\r\n// Tin hieu Mua cua Chien luoc Breakout vung tich luy Sideway ngan han\r\n//===========================================================================\r\n\r\n\r\nNew_Breakout_SidewayDay[0] = 0;\r\nNew_Breakout_SidewayDay[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( Breakout_SidewayDay[i] == 1 AND( Breakout_SidewayDay[i - 1] == 1 OR Breakout_SidewayDay[i - 2] == 1 OR Breakout_SidewayDay[i - 3] == 1 ) )\r\n    {\r\n        New_Breakout_SidewayDay[i] = 0;\r\n    }\r\n    else\r\n        if( Breakout_SidewayDay[i] == 0 )\r\n        {\r\n            New_Breakout_SidewayDay[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            New_Breakout_SidewayDay[i] = 1;\r\n        }\r\n        \r\n}\r\n\r\n//Buy Breakout\r\nBuyBreakout_SidewayDay =  New_Breakout_SidewayDay AND Priceup AND HighVolume AND UptrendMark;\r\n\r\n\r\n//Sell Breakout\r\nSellBreakout_SidewayDay =  \r\n//1. Pha day 10 ngay\r\n((Close &lt; LastLow_SidewayDay AND C &lt; MA_ema5Day AND C &lt; MA_ema10Day AND MA_ema5Day &lt; MA_ema10Day )\r\n//2.EMA14 cat xuong duong tin hieu 9\r\nOR (Cross (EMA(EMA(C,14),9),EMA(C,14))))\r\nAND Pricedown ;\r\n\r\nBuyBreakout_SidewayDay =  ExRem (BuyBreakout_SidewayDay , SellBreakout_SidewayDay);\r\nSellBreakout_SidewayDay =  ExRem (SellBreakout_SidewayDay , BuyBreakout_SidewayDay);\r\n\r\nBuySellBreakout_SidewayDay = BuyBreakout_SidewayDay OR SellBreakout_SidewayDay;\r\n\r\n\r\n\r\n//===========================================================================\r\n//1. Ve kenh Chien luoc Breakout vung tich luy Sideway ngan han\r\n//===========================================================================\r\n\r\nif (Sidewayon = ParamToggle( "1 - Hien thi vung Sideway",  "OFF|ON", 0 ))\r\n{\r\n\r\nAbove_SidewayDay = ValueWhen( Breakout_SidewayDay, LastHigh_SidewayDay, 0 );\r\nBelow_SidewayDay = ValueWhen( Breakout_SidewayDay, LastLow_SidewayDay, 0 );\r\nPlot( Above_SidewayDay, "Resistance", colorRed, styleDashed|styleThick|styleNoLabel|styleNoRescale );\r\nPlot( Below_SidewayDay, "Support", colorBlue, styleDashed|styleThick|styleNoLabel|styleNoRescale );\r\n\r\n//Ve kenh gia cao nhat n Ngay\r\nPlot(LastHigh_SidewayDay, " HHV(H, " + WriteVal(SidewayDay, 1) + ")", colorYellow, styleDashed|styleThick|styleNoLabel|styleNoRescale );\r\n\r\n}\r\n\r\n//Ve tin hieu Mua Ban - Chien luoc Breakout vung tich luy Sideway ngan han\r\n//===========================================================================\r\n\r\n//Plot Breakout vuot vung tich luy\r\n//Ve tin hieu Mua va hien chu (Bo)\r\n\r\nif (ParamToggle( "2 - Breakout Sideway",  "OFF|ON", 0 ))\r\n{\r\n\r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{       \r\n //Buy Neu xay ra but pha thi hien chu (Bo)\r\n     if( BuyBreakout_SidewayDay[i] == 1 )\r\n    {\r\n       // PlotText( "Br", i, L[i], colorBlack, colorYellow,Offset=-75 );  //phong nen mau Xanh, chu mau den\r\n    }\r\n//Sell Breakout  \r\n if( SellBreakout_SidewayDay[i] == 1 )\r\n    {\r\n       //  PlotText( "Br", i , H [ i ], colorBlack, colorRed,Offset= 68  ) ;\r\n     }  \r\n} \r\n//Buy\r\nPlotShapes( IIf( BuyBreakout_SidewayDay , shapeUpArrow + shapeDigit0 , shapeNone ), colorGold, 0, L, Offset = 10 );  //Hien thi so 0\r\nPlotShapes(IIf(BuyBreakout_SidewayDay, shapeUpArrow, shapeNone),colorGold, 0,L, Offset=-25); //Hien thi tin hieu mui ten\r\n//PlotShapes( IIf( New_Breakout_SidewayDay , shapeUpArrow + shapeHollowCircle, shapeNone ), colorGold, 0, H, Offset = -35 );  // dau hieu Hoa vang phia tren Gia\r\n//Sell\r\nPlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow + shapeHollowStar , shapeNone ), colorGold, 0, H , Offset=10 );\r\nPlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25 );\r\n\r\n }\r\n\r\n \r\n \r\n \r\n //*****************************************************************************************************************\r\n \r\n \r\n \r\n \r\n\r\n//===========================================================================\r\n// 2. Chien luoc luot song ngan han T+ \r\n//===========================================================================\r\n\r\n//A.  Mua khi gia vuot dinh 5 ngay, Ban khi gia pha day 5 ngay\r\n//===========================================================================\r\n\r\n//Buy T+5\r\nBuy5Day = C &gt; LastHigh_ema5Day  AND C &gt; MA_ema5Day AND C &gt; MA_ema10Day  \r\nAND Priceup AND HighVolume AND UptrendMark;\r\n                                                                \r\n//Sell T+5\r\nSell5Day =  C &lt; LastLow_ema5Day AND C &lt; MA_ema5Day AND C &lt; MA_ema10Day AND Pricedown ;\r\n\r\n//Loc Tin hieu Buy Sell T+5\r\nBuy5Day  = ExRem(Buy5Day, Sell5Day);\r\nSell5Day = ExRem(Sell5Day, Buy5Day); \r\n\r\nBuySell5Day = Buy5Day OR Sell5Day;\r\n\r\n//B.  Mua khi gia vuot dinh 10 ngay, Ban khi gia pha day 10 ngay  \r\n//===========================================================================\r\n\r\n//Buy T+10\r\nBuy10Day = Buy5Day AND  C &gt; LastHigh_ema10Day AND C &gt; MA_ema20Day  AND MA_ema5Day &gt; MA_ema10Day AND MA_ema5Day &gt; MA_ema20Day\r\nAND Priceup AND HighVolume AND UptrendMark; \r\n                       \r\n                                                                 \r\n//Sell T+10\r\nSell10Day =  Sell5Day AND C &lt; LastLow_ema10Day AND C &lt; MA_ema20Day AND MA_ema5Day &lt; MA_ema10Day AND MA_ema5Day &lt; MA_ema20Day\r\nAND Pricedown ;\r\n\r\n\r\n//Loc Tin hieu Buy Sell T+10\r\nBuy10Day  = ExRem(Buy10Day, Sell10Day);\r\nSell10Day = ExRem(Sell10Day, Buy10Day);  \r\n//Tong hop\r\nBuySell10Day = Buy10Day OR Sell10Day;\r\n\r\n\r\n\r\n\r\n//===========================================================================\r\n// 2. Ve tin hieu Mua Ban - Chien luoc luot song ngan han T+ \r\n//===========================================================================\r\n\r\nif (ParamToggle( "3 - Luot song T+",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n/*\r\n\r\n//Hien chu duoi tin hieu \r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy T+5         \r\n if( Buy5Day[i] == 1 )\r\n    {\r\nPlotText( "B4", i , L[ i ], colorBlack, colorSeaGreen,Offset=-92  ) ;\r\n     }  \r\n   //Buy T+10        \r\n if( Buy10Day[i] == 1 )\r\n    {\r\nPlotText( "B8", i , L[ i ], colorBlack, colorLime,Offset=-110  ) ;\r\n     }    \r\n  //Sell T5   \r\n if( Sell5Day[i] == 1 )\r\n    {\r\nPlotText( "S4", i , H [ i ], colorBlack, colorRed,Offset= 86  ) ;\r\n     }  \r\n    //Sell T+10   \r\n if( Sell5Day[i] == 1 )\r\n    {\r\nPlotText( "S8", i , H [ i ], colorBlack, colorRed,Offset= 104  ) ;\r\n     }          \r\n }  \r\n\r\n*/\r\n\r\n\r\n\r\n// Hien thi lenh Mua T+5 T+10\r\n\r\nPlotShapes( IIf( Buy5Day , shapeUpArrow + shapeDigit4 , shapeNone ), colorSeaGreen, 0, L, Offset =55 );\r\nPlotShapes( IIf( Buy5Day , shapeUpArrow , shapeNone ), colorSeaGreen, 0, L, Offset =-25 );\r\n\r\nPlotShapes( IIf( Buy10Day , shapeUpArrow + shapeDigit8 , shapeNone ), colorLime, 0, L, Offset =85 );\r\nPlotShapes( IIf( Buy10Day , shapeUpArrow , shapeNone ), colorLime, 0, L, Offset =-25 );\r\n\r\n\r\n\r\n// Hien thi lenh Ban T+5 T+10\r\n\r\n\r\nPlotShapes( IIf( Sell5Day , shapeDownArrow + shapeDigit3 , shapeNone ), colorOrange, 0, H , Offset=55 );\r\nPlotShapes( IIf( Sell5Day , shapeDownArrow , shapeNone ), colorOrange, 0, H , Offset=-25 );\r\n  \r\nPlotShapes( IIf( Sell10Day , shapeDownArrow + shapeDigit7 , shapeNone ), colorBrown, 0, H , Offset=85 );\r\nPlotShapes( IIf( Sell10Day , shapeDownArrow , shapeNone ), colorBrown, 0, H , Offset=-25 );\r\n\r\n}\r\n\r\n\r\n//***********************************************************************************************************\r\n\r\n\r\n\r\n\r\n//===========================================================================\r\n// 3. Chien luoc Giao cat giua EMA5 voi cac duong EMA 10,20,30\r\n//===========================================================================\r\n\r\n\r\n\r\n//Buy Cross EMA 5 vs EMA 10,20,30\r\n//============================\r\nBuyEMA5cross = \r\n(//A. Cross EMA 5 vs 10\r\nCross(MA_ema5Day, MA_ema10Day) \r\nOR \r\n//B. Cross EMA 5 vs 20\r\nCross(MA_ema5Day, MA_ema20Day) \r\nOR \r\n//C. Cross EMA 5 vs 30\r\nCross(MA_ema5Day, MA_ema30Day) \r\nOR \r\n//C. Cross EMA 5 vs 40\r\nCross(MA_ema5Day, MA_ema40Day) \r\nOR \r\n//D. Cross EMA 5 vs 50\r\nCross(MA_ema5Day, MA_ma50Day)  )\r\n\r\n//Gia cao hon dinh 5, 10 ngay\r\nAND C &gt; LastHigh_ema5Day AND C &gt; LastHigh_ema10Day\r\n//Gia cao hon cac duong MA \r\nAND C &gt; MA_ema5Day AND C &gt; MA_ema10Day AND C &gt; MA_ema20Day AND C &gt; MA_ema30Day AND C &gt; MA_ema40Day AND C &gt; MA_ma50Day\r\n\r\nAND Priceup AND HighVolume AND UptrendMark ;\r\n\r\n\r\n//Sell Cross EMA 10 vs 20,30,50   \r\n//==============================\r\nSellEMA5cross = \r\n(//A. Cross EMA 5 vs 10\r\nCross(MA_ema10Day, MA_ema5Day) \r\nOR \r\n//B. Cross EMA 5 vs 20\r\nCross(MA_ema20Day, MA_ema5Day) \r\nOR \r\n//C. Cross EMA 5 vs 30\r\nCross(MA_ema30Day, MA_ema5Day) \r\nOR \r\n//C. Cross EMA 5 vs 40\r\nCross(MA_ema40Day, MA_ema5Day) \r\nOR \r\n//D. Cross EMA 5 vs 50\r\nCross(MA_ma50Day, MA_ema5Day)  )\r\n\r\n//Gia cao hon dinh 5, 10 ngay\r\nAND C &lt; LastHigh_ema5Day AND C &lt; LastHigh_ema10Day\r\n//Gia cao hon cac duong MA \r\nAND C &lt; MA_ema5Day AND C &lt; MA_ema10Day AND C &lt; MA_ema20Day \r\n\r\nAND Pricedown ;\r\n\r\n\r\n//Loc tin hieu Buy Sell theo EMA giao cat nhau\r\n\r\nBuyEMA5cross  = ExRem(BuyEMA5cross, SellEMA5cross) ;\r\nSellEMA5cross = ExRem(SellEMA5cross, BuyEMA5cross) ;\r\n//Tong hop\r\nBuySellEMA5cross = BuyEMA5cross OR SellEMA5cross;\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================\r\n// 3. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50\r\n//====================================================================================\r\n\r\nif (ParamToggle( "4 - EMA5 Cross",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*\r\n\r\n//Hien chu E5\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyEMA5cross[i] == 1 )\r\n    {\r\n //PlotText( "E5", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;\r\n     }  \r\n  //Sell   \r\n if( SellEMA5cross[i] == 1 )\r\n    {\r\n //PlotText( "E5", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;\r\n     }      \r\n }  \r\n\r\n*/\r\n\r\n\r\n// Hien thi lenh Mua Ban\r\nPlotShapes( IIf( BuyEMA5cross , shapeUpArrow + shapeDigit5 , shapeNone ), colorGreen, 0, L, Offset =70 );\r\nPlotShapes( IIf( BuyEMA5cross , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\nPlotShapes( IIf( SellEMA5cross , shapeDownArrow + shapeDigit4 , shapeNone ), colorRed, 0, H , Offset=70 );\r\nPlotShapes( IIf( SellEMA5cross , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n\r\n\r\n}\r\n\r\n\r\n\r\n//********************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n//===========================================================================\r\n// 4. Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50\r\n//===========================================================================\r\n\r\n\r\n\r\n//Buy Cross EMA 10 vs 20,30,50\r\n//============================\r\nBuyEMA10cross = \r\n(//A. Cross EMA 10 vs 20\r\nCross(MA_ema10Day, MA_ema20Day)  \r\nOR \r\n//B. Cross EMA 10 vs 30\r\nCross(MA_ema10Day, MA_ema30Day)\r\nOR \r\n//C. Cross EMA 10 vs 40\r\nCross(MA_ema10Day, MA_ema40Day) \r\nOR \r\n//D. Cross EMA 10 vs 50\r\nCross(MA_ema10Day, MA_ma50Day) ) \r\n\r\n//Gia cao hon dinh 5, 10 ngay\r\nAND C &gt; LastHigh_ema5Day AND C &gt; LastHigh_ema10Day\r\n//Gia cao hon cac duong MA \r\nAND C &gt; MA_ema5Day AND C &gt; MA_ema10Day AND C &gt; MA_ema20Day AND C &gt; MA_ema30Day AND C &gt; MA_ema40Day AND C &gt; MA_ma50Day\r\n\r\nAND Priceup AND HighVolume AND UptrendMark ;\r\n\r\n//Sell Cross EMA 10 vs 20,30,50   \r\n//==============================\r\nSellEMA10cross =  Cross(MA_ema20Day, MA_ema10Day) AND C &lt; MA_ema10Day AND C &lt; MA_ema20Day AND Pricedown ;\r\n(//A. Cross EMA 10 vs 20\r\nCross(MA_ema20Day, MA_ema10Day)  \r\nOR \r\n//B. Cross EMA 10 vs 30\r\nCross(MA_ema30Day, MA_ema10Day)\r\nOR \r\n//C. Cross EMA 10 vs 40\r\nCross(MA_ema40Day, MA_ema10Day) \r\nOR \r\n//D. Cross EMA 10 vs 50\r\nCross(MA_ma50Day, MA_ema10Day) ) \r\n\r\n//Gia thap hon dinh 5, 10 ngay\r\nAND C &lt; LastHigh_ema5Day AND C &lt; LastHigh_ema10Day\r\n//Gia cao hon cac duong MA \r\nAND C &lt; MA_ema5Day AND C &lt; MA_ema10Day AND C &lt; MA_ema20Day \r\n\r\nAND Pricedown ;\r\n\r\n//Loc tin hieu Buy Sell theo EMA giao cat nhau\r\n\r\nBuyEMA10cross  = ExRem(BuyEMA10cross, SellEMA10cross) ;\r\nSellEMA10cross = ExRem(SellEMA10cross, BuyEMA10cross) ;\r\n//Tong hop\r\nBuySellEMA10cross = BuyEMA10cross OR SellEMA10cross;\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================\r\n// 4. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50\r\n//====================================================================================\r\n\r\nif (ParamToggle( "5 - EMA10 Cross",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*\r\n\r\n//Hien chu E10\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyEMA10cross[i] == 1 )\r\n    {\r\n //PlotText( "E10", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;\r\n     }  \r\n  //Sell   \r\n if( SellEMA10cross[i] == 1 )\r\n    {\r\n //PlotText( "E10", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;\r\n     }      \r\n }  \r\n\r\n*/\r\n\r\n\r\n// Hien thi lenh Mua Ban\r\nPlotShapes( IIf( BuyEMA10cross , shapeUpArrow + shapeDigit6 , shapeNone ), colorBlue, 0, L, Offset =70 );\r\nPlotShapes( IIf( BuyEMA10cross , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );\r\n\r\nPlotShapes( IIf( SellEMA10cross , shapeDownArrow + shapeDigit5 , shapeNone ), colorDarkRed, 0, H , Offset=70 );\r\nPlotShapes( IIf( SellEMA10cross , shapeDownArrow , shapeNone ), colorDarkRed, 0, H , Offset=-25 );\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n//******************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//=====================================================================================\r\n// 5. Chien luoc Giao cat giua EMA20 voi cac duong EMA 40 - Turtle Trading System\r\n//=====================================================================================\r\nTurtletrade = Param(" ****** Turtle Trading System ****** ",0,0,0,0); \r\n\r\n//Buy Vuot dinh kenh Turtle EMA20 va EMA20 &gt; EMA40\r\n//=============================================================\r\nBuyturtle = Close &gt; LastHigh_ema20Day AND MA_ema20Day &gt; MA_ema40Day\r\nAND Priceup;\r\n\r\n\r\n// Enters short trade - Vao lenh Ban (Short)\r\n//Pha day kenh Turtle va EMAfast &lt; EMASlow\r\n\r\n//Ban khong (Short Sell)\r\nShortturtle = MA_ema20Day &lt; MA_ema40Day AND C &lt; LastLow_ema20Day\r\nAND Pricedown;\r\n\r\n\r\n//Diem thoat lenh (Cat lo)\r\n//=============================================================\r\n\r\nMultiple   = Param( " - So ATR thoat lenh", 3, 0.5, 10, 0.1 ); // How many ATRs to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( " - ATR Periods", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Shortturtle[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buyturtle[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n        \r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\n//Sell \r\n//=============================================================\r\n\r\nSellturtle = Coverturtle = \r\nexitarray AND C &lt;= MA_ema10Day  AND C &lt;= MA_ema20Day AND MA_ema10Day &lt;= MA_ema20Day;\r\n\r\n        \r\n\r\n\r\n//Buy\r\nBuyTurtle   = ExRem( BuyTurtle, Sellturtle ) \r\nAND Priceup AND HighVolume AND PriceUpMA AND EMA5up AND EMA10up AND UptrendMark;\r\n\r\n//Sell\r\nSellturtle  = ExRem( Sellturtle, BuyTurtle ) AND Pricedown;\r\n\r\nShortturtle       = ExRem( Shortturtle, Coverturtle );\r\nCoverturtle       = ExRem( Coverturtle, Shortturtle );\r\n\r\n\r\n//Tong hop \r\nBuySellTurtle = BuyTurtle OR SellTurtle;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//======================================================================================================\r\n// 5. Tin hieu Mua Ban theo Chien luoc Giao cat giua EMA20 voi cac duong EMA 40 - Turtle Trading System\r\n//======================================================================================================\r\n\r\n\r\n\r\n//                 Buy - Sell Turtle trading system                 |\r\n//==========================================================================|\r\n \r\nif (ParamToggle( "6 - Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n//Hien chu Tur\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyTurtle[i] == 1 )\r\n    {\r\nPlotText( "Tur", i , L[ i ], colorSeaGreen, Colorback=-1 , Offset= -90 ) ;\r\n     }  \r\n  //Sell   \r\n if( SellTurtle[i] == 1 )\r\n    {\r\nPlotText( "Tur", i , H [ i ], colorRed, Colorback=-1 ,  Offset= 90  ) ;\r\n     }      \r\n }  \r\n\r\n\r\n\r\n\r\n// Hien thi lenh Mua Ban\r\nPlotShapes( IIf( BuyTurtle ,  shapeUpArrow ,   shapeNone ), colorBlue,   0, L,  Offset =-25 );\r\nPlotShapes( IIf( SellTurtle , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset =-25 );\r\n\r\n\r\n//Tin hieu thoat lenh\r\nPlotShapes( abs( exitArray )*shapeHollowCircle  , colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 ); //Vong tron mau Vang\r\nPlotShapes( IIf( exitArray , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n\r\n\r\n}\r\n\r\n//Bat tat Turtle Trading System\r\n\r\nif (Turtle = ParamToggle( "7 - Kenh Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n//Ve cac duong Turtle\r\n// Plots a 20 period Donchian channel (pdsTurtle)\r\n//Duong tren\r\nPlot( LastHigh_ema20Day,  "Donchian Uper",   ParamColor(  "Donchian Uper Color", colorBlue ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale );\r\n//Duong duoi\r\nPlot( LastLow_ema20Day,   "Donchian Lower",  ParamColor(  "Donchian Lower Color", colorRed ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale  );\r\n\r\n//Ve kenh thoat lenh\r\nPlot( stopArray, "Chand Stop", ParamColor( "Chand Color:", colorYellow ), ParamStyle( "Chand Style", styleDashed )  |styleNoLabel|styleNoRescale );\r\n\r\n//plot color ribbon - Thanh xu huong duoi man hinh\r\n//Plot(1, "", TurtleColor, styleArea | styleOwnScale | styleNoLabel, -0.1, 100 );\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n// 6. Chien luoc MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n//Dung de bat Dinh Day\r\n//Mua ban theo muc % co dinh tu Dinh hoac Day hoac theo so ATR\r\n//(Noi them mot chut ve chien luoc ty le phan tram: gia tang tu day len x % thi mua, giam tu dinh xuong x% thi ban, rat phu hop cho nhung ma co phieu dang co xu huong tang).\r\n//La cong cu de chot loi mot cach co he thong (danh cho ai khong biet phai chot loi nhu the nao)\r\n\r\nATRtrade = Param(" ****** ART Trading System ****** ",0,0,0,0); \r\n\r\n// get start date \r\n\r\nStart         = Cross( DateNum(), ParamDate(" - Chon ngay bat dau tinh Diem Mua - Ban", "2020-01-01" ) ); \r\nStarted       = Flip( Start, 0 ); \r\n \r\nStopMode      = ParamToggle(" - Chon che do vao Lenh theo", "Ty le % | So ATR" ); \r\nStopLevel     = Param(" - Vao lenh theo Ty le % ", 15, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param(" - Vao lenh theo so ATR", 3, 0.5 , 10, 0.1 ); \r\nStopATRPeriod = Param(" - Time ATR period", 20, 1 , 100 , 1 ); \r\n\r\n\r\n \r\n// calculate support and resistance levels \r\n//Xac dinh muc Ho tro Khang cu\r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); // Ho tro\r\n res = C * ( 1 + stoplevel ); // Khang cu\r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); // Muc ho tro theo so ATR\r\n res = C + StopATRFactor * ATR( StopATRPeriod ); // Muc khang cu theo so ATR\r\n} \r\n \r\n// calculate trailing stop line - Tinh toan diem Vao va thoat lenh\r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n //Tin hieu MUA - Ban theo ATR        \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuyatr = ( Start OR Cross(C,trailArray) )\r\nAND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;   \r\n                                                                           \r\n                                                                                                 \r\nSellatr = Cross( trailArray, C ) AND Pricedown AND C &lt;= EMA(C,10) AND C &lt;= EMA(C,20) ;\r\n\r\n\r\nBuyatr       = ExRem( Buyatr, Sellatr );\r\nSellatr      = ExRem( Sellatr, Buyatr );\r\n\r\nBuySellatr   = Buyatr OR Sellatr;\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n// 6. Tin hieu Mua Ban theo Chien luoc ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (ParamToggle("8 - Buy - Sell theo % (Dinh - Day) or ATR", "OFF|ON" , 0 ))\r\n{\r\n//Hien chu ATR\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n//Buy\r\n if( Buyatr[i] == 1 )\r\n    {\r\n PlotText( "Atr", i , L[ i ],  colorGreen, colorback=-1 , Offset=-105  ) ;\r\n     }   \r\n//Sell     \r\n if( Sellatr[i] == 1 )\r\n    {\r\n PlotText( "Atr", i , H [ i ],  colorRed, colorback=-1 , Offset= 105  ) ;\r\n     }        \r\n \r\n }\r\n \r\n // Vao lenh Mua Ban\r\nPlotShapes( IIf( Buyatr , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\nPlotShapes( IIf( Sellatr , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n  \r\n}\r\n\r\n\r\n\r\n/*\r\n \r\n \r\n// Ve kenh thoat lenh theo ATR \r\n  \r\nif (ParamToggle("8 - Kenh thoat lenh theo ATR", "OFF|ON" , 0 ))\r\n{\r\n\r\n//Kenh thoat lenh ATR\r\nPlot( trailARRAY,"Trailing stop level", ParamColor( " - ATR Color", colorBlue ) , styleLine | ParamStyle(" - ATR Style" , styleThick) |styleNoLabel|styleNoRescale  );\r\n\r\n}\r\n\r\n*/\r\n\r\n\r\n \r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n\r\n//***********************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================\r\n// 7. Canh bao Dinh - Day\r\n//====================================================================================\r\n\r\n\r\n\r\n\r\n//****************************************\r\n//Code to automatically identify pivots\r\n//****************************************\r\n\r\n// -- what will be our lookback range for the hh and ll?\r\n// - pham vi xem lai cua chung ta cho HH va LL se la bao nhieu?\r\n//Thoi gian theo doi tin hieu trong qua khu\r\n\r\nDinhday = Param(" ****** Canh bao Dinh - Day ****** ",0,0,0,0); \r\n\r\n//----------------------------------------------------\r\n\r\nfarback = Param(" - So Ngay xem lai Tin hieu",130,20,10000,20);//How Far back to go\r\nnBars   = Param(" - So Ngay tinh vung Dinh - Day ", 20, 1, 200,1);//Number of bars\r\n\r\n// -- Create 0-initialized arrays the size of barcount\r\naHPivs = H - H;\r\naLPivs = L - L;\r\n\r\n// -- More for future use, not necessary for basic plotting\r\naHPivHighs = H - H;\r\naLPivLows = L - L;\r\naHPivIdxs = H - H;\r\naLPivIdxs = L - L;\r\nnHPivs = 0;\r\nnLPivs = 0;\r\nlastHPIdx = 0;\r\nlastLPIdx = 0;\r\nlastHPH = 0;\r\nlastLPL = 0;\r\ncurPivBarIdx = 0;\r\n\r\n// -- looking back from the current bar, how many bars\r\n// back were the hhv and llv values of the previous\r\n// n bars, etc.?\r\naHHVBars = HHVBars( H, nBars );\r\naLLVBars = LLVBars( L, nBars );\r\naHHV = HHV( H, nBars );\r\naLLV = LLV( L, nBars );\r\n\r\n// -- Would like to set this up so pivots are calculated back from\r\n// last visible bar to make it easy to "go back" and see the pivots\r\n// this code would find. However, the first instance of\r\n// _Trace output will show a value of 0\r\naVisBars = Status( "barvisible" );\r\nnLastVisBar = LastValue( Highest( IIf( aVisBars, BarIndex(), 0 ) ) );\r\n_TRACE( "Last visible bar: " + nLastVisBar );\r\n\r\n// -- Initialize value of curTrend\r\ncurBar = ( BarCount - 1 );\r\ncurTrend = "";\r\n\r\nif ( aLLVBars[curBar] &lt; aHHVBars[curBar] )\r\n{\r\n    curTrend = "D";\r\n}\r\nelse\r\n{\r\n    curTrend = "U";\r\n}\r\n\r\n// -- Loop through bars. Search for\r\n// entirely array-based approach\r\n// in future version\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    curBar = ( BarCount - 1 ) - i;\r\n// -- Have we identified a pivot? If trend is down...\r\n\r\n    if ( aLLVBars[curBar] &lt; aHHVBars[curBar] )\r\n    {\r\n// ... and had been up, this is a trend change\r\n        if ( curTrend == "U" )\r\n        {\r\n            curTrend = "D";\r\n// -- Capture pivot information\r\n            curPivBarIdx = curBar - aLLVBars[curBar];\r\n            aLPivs[curPivBarIdx] = 1;\r\n            aLPivLows[nLPivs] = L[curPivBarIdx];\r\n            aLPivIdxs[nLPivs] = curPivBarIdx;\r\n            nLPivs++;\r\n        }\r\n\r\n// -- or current trend is up\r\n    }\r\n    else\r\n    {\r\n        if ( curTrend == "D" )\r\n        {\r\n            curTrend = "U";\r\n            curPivBarIdx = curBar - aHHVBars[curBar];\r\n            aHPivs[curPivBarIdx] = 1;\r\n            aHPivHighs[nHPivs] = H[curPivBarIdx];\r\n            aHPivIdxs[nHPivs] = curPivBarIdx;\r\n            nHPivs++;\r\n        }\r\n\r\n// -- If curTrend is up...else...\r\n    }\r\n\r\n// -- loop through bars\r\n}\r\n\r\n// -- Basic attempt to add a pivot this logic may have missed\r\n// -- OK, now I want to look at last two pivots. If the most\r\n// recent low pivot is after the last high, I could\r\n// still have a high pivot that I didn't catch\r\n// -- Start at last bar\r\ncurBar = ( BarCount - 1 );\r\n\r\ncandIdx = 0;\r\n\r\ncandPrc = 0;\r\n\r\nlastLPIdx = aLPivIdxs[0];\r\n\r\nlastLPL = aLPivLows[0];\r\n\r\nlastHPIdx = aHPivIdxs[0];\r\n\r\nlastHPH = aHPivHighs[0];\r\n\r\nif ( lastLPIdx &gt; lastHPIdx )\r\n{\r\n// -- Bar and price info for candidate pivot\r\n    candIdx = curBar - aHHVBars[curBar];\r\n    candPrc = aHHV[curBar];\r\n\r\n    if (\r\n        lastHPH &lt; candPrc AND\r\n        candIdx &gt; lastLPIdx AND\r\n        candIdx &lt; curBar )\r\n    {\r\n// -- OK, we'll add this as a pivot...\r\n        aHPivs[candIdx] = 1;\r\n// ...and then rearrange elements in the\r\n// pivot information arrays\r\n\r\n        for ( j = 0; j &lt; nHPivs; j++ )\r\n        {\r\n            aHPivHighs[nHPivs-j] = aHPivHighs[nHPivs- ( j+1 )];\r\n            aHPivIdxs[nHPivs-j] = aHPivIdxs[nHPivs-( j+1 )];\r\n        }\r\n\r\n        aHPivHighs[0] = candPrc ;\r\n\r\n        aHPivIdxs[0] = candIdx;\r\n        nHPivs++;\r\n    }\r\n}\r\nelse\r\n{\r\n// -- Bar and price info for candidate pivot\r\n    candIdx = curBar - aLLVBars[curBar];\r\n    candPrc = aLLV[curBar];\r\n\r\n    if (\r\n        lastLPL &gt; candPrc AND\r\n        candIdx &gt; lastHPIdx AND\r\n        candIdx &lt; curBar )\r\n    {\r\n// -- OK, we'll add this as a pivot...\r\n        aLPivs[candIdx] = 1;\r\n// ...and then rearrange elements in the\r\n// pivot information arrays\r\n\r\n        for ( j = 0; j &lt; nLPivs; j++ )\r\n        {\r\n            aLPivLows[nLPivs-j] = aLPivLows[nLPivs-( j+1 )];\r\n            aLPivIdxs[nLPivs-j] = aLPivIdxs[nLPivs-( j+1 )];\r\n        }\r\n\r\n        aLPivLows[0] = candPrc;\r\n\r\n        aLPivIdxs[0] = candIdx;\r\n        nLPivs++;\r\n    }\r\n}\r\n\r\n\r\nDinhTop    = aHPivs;\r\nDayBottom  = aLPivs;\r\n\r\nDinhDayTopBottom = DinhTop OR DayBottom;\r\n\r\n\r\n\r\n//====================================================================================\r\n// 7. Buy Sell Canh bao Dinh - Day\r\n//====================================================================================\r\n\r\n//============== EXPLORATION ==============\r\n\r\n\r\nPivotTrailStop = HHV( C - 2 * ATR( 10 ), 15 );\r\nPivotProfitTaker = EMA( H, 13 ) + 2 * ATR( 10 );\r\n\r\n//----------------------------------------------------\r\n\r\n\r\nBuyDayBottom =  aLPivs == 1 AND HighVolume;\r\n\r\nSellDinhTop  =  aHPivs == 1 AND HighVolume;\r\n\r\n \r\nPivotSellPrice = ValueWhen( SellDinhTop, C, 1 );\r\n\r\nPivotBuyPrice = ValueWhen( BuyDayBottom, C, 1 );\r\n\r\nPivotLong = Flip( BuyDayBottom, SellDinhTop );\r\n\r\nPivotShort = Flip( SellDinhTop, BuyDayBottom );\r\n\r\n//============================================\r\n\r\n\r\n\r\nif (BsTurtle = ParamToggle( "9 - Canh bao Dinh - Day",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Hien canh bao Dinh Day\r\n//Hien chu Text\r\n\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n\r\n//Day\r\nif( DayBottom[i] == 1 )\r\n    {\r\n PlotText( "Bot ("+NumToStr(PivotBuyPrice[i],1.1)+")", i , L[ i ], colorGold, colorback=-1 , Ofset = -15 ) ;\r\n     }  \r\n\r\n//Dinh\r\nif( DinhTop[i] == 1 )\r\n    {\r\n PlotText( "Top ("+NumToStr(PivotSellPrice[i], 1.1)+")", i , H [ i ],  colorGold, colorback=-1 , Ofset = 5 ) ;\r\n     }     \r\n            \r\n     \r\n }  \r\n\r\n//*********************************************************************\r\n// Dau hieu Buy Day + Sell Dinh\r\n\r\n//Mua Day\r\nPlotShapes( IIf( DayBottom==1 , shapeUpArrow , shapeNone ), colorGold, 0, L, Offset =-25 );\r\nPlotShapes( IIf(BuyDayBottom, shapeStar, shapeNone),colorYellow, 0, H, Offset = 0 );\r\nPlotShapes( IIf(BuyDayBottom, shapeHollowCircle, shapeNone),colorGold, 0, H, Offset = 0 );\r\n\r\n//Ban Dinh\r\nPlotShapes( IIf( DinhTop==1 , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25);\r\nPlotShapes( IIf(SellDinhTop, shapeStar, shapeNone),colorYellow, 0 ,L,  Offset = 0  );\r\nPlotShapes( IIf(SellDinhTop, shapeHollowCircle, shapeNone),colorYellow, 0 ,L,  Offset = 0  );\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n\r\n\r\n\r\n//***********RSI Divergence***************\r\n//RSI Phan ky\r\n//RSI Divergence\r\nRSIDivergence          = Param(" ****** RSI Divergence - Phan ky ****** ",0,0,0,0); \r\n\r\nRSIPrice               = ParamField( " - RSI Price field" );\r\nRSIperiods             = Param(" - RSI Periods", 14, 1, 200, 1 );\r\nZigZagRSIPeriods       = Param(" - Zig Zag RSI Periods",20,0,100,1);\r\nVarRSI                 = Zig(RSIa( RSIPrice, RSIperiods), ZigZagRSIPeriods); \r\ntRSI                   = Trough(RSIa( RSIPrice, RSIperiods), ZigZagRSIPeriods, 1); \r\npRSI                   = Peak(RSIa( RSIPrice, RSIperiods), ZigZagRSIPeriods, 1); \r\nxRSI[0] =VarRSI[0];\r\npriceRSI[0] = C[0];\r\nj=0;\r\nBuyRSIDivergence=0;\r\nSellRSIDivergence=0;\r\n// bearish divergence\r\nfor ( i=0; i&lt;BarCount; i++) \r\n{\r\nif(VarRSI[i] == pRSI[i])\r\n{\r\n  \r\nj++;\r\nxRSI[j] =VarRSI[i];\r\npriceRSI[j] =C[i];\r\nif(xRSI[j] &lt;xRSI[j-1] &amp;&amp; priceRSI[j-1]&lt; priceRSI[j]) \r\nSellRSIDivergence[i] =1;\r\n \r\n}\r\n}\r\n  \r\n// bullish divergence\r\nfor ( i=0; i&lt;BarCount; i++) \r\n{\r\nif(VarRSI[i] == tRSI[i])\r\n{\r\nj++;\r\nxRSI[j] =VarRSI[i];\r\npriceRSI[j] =C[i];\r\nif(xRSI[j] &gt;xRSI[j-1] &amp;&amp; priceRSI[j]&lt;priceRSI[j-1]) \r\nBuyRSIDivergence[i] =1;\r\n\r\n\r\n}\r\n}\r\n  \r\n  \r\n  \r\n//***********************************************************************************************\r\n  \r\n\r\n//====================================================================================|\r\n// 8. Tin hieu Mua Ban theo RSI Divergence                                |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (ParamToggle("10 - Buy - Sell theo RSI Divergence", "OFF|ON" , 0 ))\r\n{\r\n//Hien chu RSI\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n//Buy\r\n if( BuyRSIDivergence[i] == 1 )\r\n    {\r\n PlotText( "Rsi", i , L[ i ],  colorBlue, colorback=-1 , Offset=-40  ) ;\r\n     }   \r\n//Sell     \r\n if( SellRSIDivergence[i] == 1 )\r\n    {\r\n PlotText( "Rsi", i , H [ i ],  colorRed, colorback=-1 , Offset= 40  ) ;\r\n     }        \r\n \r\n }\r\n \r\n // Vao lenh Mua Ban\r\nPlotShapes( IIf( BuyRSIDivergence , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );\r\nPlotShapes( IIf( SellRSIDivergence , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n  \r\n}\r\n\r\n\r\n  \r\n//***********END RSI Divergence***************\r\n\r\n\r\n\r\n\r\n//======================================================================================\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*****************************************************\r\n//Tong hop toan bo tin hieu Buy Sell ngan han\r\n//*****************************************************\r\n\r\n\r\nBuyluotsong = BuyBreakout_SidewayDay OR Buy5Day OR Buy10Day OR BuyEMA5cross OR BuyEMA10cross OR BuyTurtle OR Buyatr OR DayBottom OR BuyDayBottom OR BuyRSIDivergence;\r\n\r\nSellluotsong = SellBreakout_SidewayDay OR Sell5Day OR Sell10Day OR SellEMA5cross OR SellEMA10cross OR SellTurtle OR exitArray OR Sellatr OR DinhTop OR SellDinhTop OR SellRSIDivergence;\r\n\r\nluotsong = Buyluotsong OR Sellluotsong ;\r\n\r\n\r\n//*****************************************************\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|             END Chien luoc giao dich Luot song ngan han                  \r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*****************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 33 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* - Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 0 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( " - Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( " - Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( " - Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( " - Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param(" - Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( " - Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( " - Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( " - Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( " - Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( " - Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param(" - Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( " - Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;Ref(Span1,-timeKumo) AND C&gt;Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\n      \r\n      \r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;Ref(Span1,-timeKumo) AND C&lt;Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;Ref(TL,-prds) AND C&lt;Ref(SL,-turn)),1,0)  ; \r\n\r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   Ref(Lagging, -1) &gt; C AND Lagging &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = Ref(Lagging, -1) &lt; C AND Lagging &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua theo Taken Sen va Kijun Sen******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; SL ; //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  ) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  ) ; //OK \r\n                   \r\n\r\n\r\n\r\n             //*************** Tin hieu Mua khi pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  ; //OK\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  ; //OK\r\n\r\n             \r\n \r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStrongSenkouSpanCross = aboveKumo AND Cross(span1,span2) ; //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL AND C &gt; SL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n                                                                     \r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  ; //OK\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n                                                                         \r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; SL ; //OK\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n                                                                            \r\n//BuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  ) \r\n//                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  ) ; //OK \r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStrongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n                                                                           \r\n//BuyStrongSenkouSpanCross = aboveKumo AND Cross(span1,span2) ; //OK\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL AND C &gt; SL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n//dlUp =   Ref(Lagging, -1) &gt; C AND Lagging &lt; C AND C &gt; Ref(C,-1); \r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL  and aboveKumo AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n                                                                            \r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  ; //OK\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo =  BuyKumoBreakout AND VuotMay AND TL &gt; SL;\r\n                                                                         \r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  ; //OK\r\n//VuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL  and aboveKumo AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n                                                                             \r\n//9. Tin hieu Bom no\r\n//Bom no = (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n// Vuot may Sen va Kumo, Span A &gt; Span B, Tenkan &gt; Kijun\r\n\r\nBomno = VuotMaySenKumo AND VuotMay  AND span1 &gt; span2 ;\r\n\r\n//VuotMaySenKumo =  BuyKumoBreakout AND VuotMay AND TL &gt; SL;                                                                        \r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  ; //OK\r\n//VuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL  and aboveKumo AND Priceup AND HighVolume AND PriceUpMA AND UptrendMark;\r\n\r\n\r\n//***************************************************************************************************************\r\n                                                                         \r\n//************** Tin hieu Mua som theo Tenkan Sen va Kijun Sen******************\r\n\r\n//1. Tin hieu Mua som - Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen\r\n        \r\nBuyPriceCross    =      ( Ref(belowSenCloud,-1) AND withinSenCloud )  \r\n                      OR ( Ref(belowSenCloud ,-1) AND aboveSenCloud ) \r\n                      OR ( Ref(withinSenCloud,-1) AND aboveSenCloud )\r\n                      OR ( Cross(TL,SL) AND C &gt; TL AND C &gt; SL       ); \r\n\r\n//2. Tin hieu Mua som khi Gia vuot may Kumo - Kumo Breakout\r\n\r\n        //Tin hieu Mua som khi pha len may Kumo\r\n        //Ban khi Gia tu trong may hoac tren may vuot len may Kumo \r\nBuyKumoBreakdown = (aboveKumo AND Ref(withinKumo,-1))   OR (aboveKumo AND Ref(belowKumo ,-1));\r\n\r\n//********************************************************************************\r\n\r\n        //Tin hieu Mua som ngan han Yeu \r\n        //Tin hieu Mua som - Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen, van nam duoi may Kumo\r\n\r\nBuyichimoku1  = BuyPriceCross AND belowKumo AND Priceup AND HighVolume;\r\n\r\n\r\n        //Tin hieu Mua som ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu Mua som ngan han Trung lap (Ko ro rang) Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen, nam trong may Kumo\r\n\r\nBuyichimoku2  = BuyPriceCross AND withinKumo AND Priceup AND HighVolume;\r\n\r\n\r\n        //Tin hieu Mua som ngan han Manh\r\n        //Tin hieu Mua som ngan han Manh Xuat hien khi Gia cat len duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat len Kijun Sen, nam tren may Kumo\r\n\r\n\r\nBuyichimoku3  = (BuyPriceCross OR BuyKumoBreakdown) AND aboveKumo AND Priceup AND HighVolume;\r\n\r\n\r\n\r\n\r\n//***************************************************************************************************************\r\n\r\n//***************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//***************************************************\r\n\r\n\r\n//************** Tin hieu Ban theo Tenkan Sen va Kijun Sen******************\r\n\r\n//1. Tin hieu Ban - Xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen\r\n        \r\nSellPriceCross    =      ( Ref(aboveSenCloud,-1) AND withinSenCloud )  \r\n                      OR ( Ref(aboveSenCloud ,-1) AND belowSenCloud ) \r\n                      OR ( Ref(withinSenCloud,-1) AND belowSenCloud )\r\n                      OR ( Cross(SL,TL) AND C &lt; TL AND C &lt; SL       ); \r\n\r\n//2. Tin hieu Ban khi pha xuong may Kumo - Kumo Breakdown\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may hoac tren may cat xuong may Kumo \r\nSellKumoBreakdown = (belowKumo AND Ref(withinKumo,-1))   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n\r\n//********************************************************************************\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen, van nam tren may Kumo\r\n\r\nSellichimoku1  = SellPriceCross AND Pricedown AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen, nam trong may Kumo\r\n\r\nSellichimoku2  = SellPriceCross AND Pricedown AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong Tenkan Sen va Kijun Sen hoac Tenkan Sen cat xuong Kijun Sen, nam duoi may Kumo\r\n\r\n\r\nSellichimoku3  = (SellPriceCross OR SellKumoBreakdown) AND Pricedown AND belowKumo;\r\n\r\n\r\n//*****************************************************************************\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nBuyichimoku  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich OR Bomno OR Buyichimoku2 OR Buyichimoku3 ;\r\n\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Ban Ichimoku*************\r\n\r\n\r\n\r\nSellichimoku  =   Sellichimoku1  OR Sellichimoku2  OR Sellichimoku3 ;\r\n\r\n\r\n//Loc tin hieu Mua \r\nTinHieu1         = ExRem (TinHieu1,Sellichimoku);\r\nTinHieu2         = ExRem (TinHieu2,Sellichimoku);\r\nTinHieu3         = ExRem (TinHieu3,Sellichimoku);\r\nTinHieu4         = ExRem (TinHieu4,Sellichimoku);\r\nTinHieu5         = ExRem (TinHieu5,Sellichimoku);\r\nVuotMay          = ExRem (VuotMay,Sellichimoku);\r\nVuotMaySenKumo   = ExRem (VuotMaySenKumo,Sellichimoku);\r\nBomno            = ExRem (Bomno,Sellichimoku);\r\nBuyichimoku2 OR Buyichimoku3  = ExRem (Buyichimoku2 OR Buyichimoku3,Sellichimoku);\r\n\r\n\r\n//Loc tin hieu Ban \r\nSellichimoku1    = ExRem (Sellichimoku1,Buyichimoku);  \r\nSellichimoku2    = ExRem (Sellichimoku2,Buyichimoku);  \r\nSellichimoku3    = ExRem (Sellichimoku3,Buyichimoku);  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//================================================================================|\r\n//   Thanh xac dinh xu huong Ichimoku\r\n//================================================================================|\r\n//********Xac dinh xu huong Ichimiku -Duong mau Xanh Do o duoi cung man hinh******\r\n//Xu huong Tang: mau Xanh - Giam: mau Do - Ko ro rang: mau Vang\r\n// Ve Ribbon - Xac dinh xu huong \r\n\r\n//Xu huong Tang: Tren may Kumo, tren may sen, gia dang tang, Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nXuhuongIchimokuTang = ( aboveKumo AND aboveSenCloud  AND TL &gt;= SL AND C&gt;=DG )\r\n\r\nOR   ( aboveKumo AND aboveSenCloud AND PriceUpMA AND EMA10up AND UptrendMark )                      \r\n                       \r\nOR   ( aboveKumo AND aboveSenCloud AND PriceUpMA )\r\n                      \r\nOR   ( aboveKumo AND aboveSenCloud  AND TL &gt;= SL AND C&gt;=DG AND PriceUpMA AND EMA10up AND UptrendMark  )\r\n\r\nOR   ( aboveKumo AND aboveSenCloud  AND PriceUpMA AND EMA10up );\r\n                                                                      \r\n\r\n//Xu huong Giam: Duoi may Kumo, duoi may sen, gia dang giam, Tenkan Sen nam duoi Kijun Sen va Gia nam duoi duong ho tro dai han Dao gam\r\nXuhuongIchimokuGiam = (belowKumo AND belowSenCloud AND TL &lt; SL AND C&lt;DG )\r\n\r\nOR  (belowKumo AND belowSenCloud AND TL &lt; SL AND C&lt;DG \r\nAND PriceDownMA AND EMA10down )\r\n\r\nOR  (belowKumo AND belowSenCloud AND TL &lt; SL AND C&lt;DG \r\nAND PriceDownMA AND EMA10down AND DowntrendMark )\r\n\r\nOR  (belowKumo AND belowSenCloud \r\nAND PriceDownMA AND EMA10down )   \r\n\r\nOR  (belowKumo AND belowSenCloud \r\nAND PriceDownMA AND EMA10down AND DowntrendMark );   \r\n                                     \r\n\r\n//******************************************************\r\n\r\nXuhuongIchimokuTangoff = Sellichimoku2 OR Sellichimoku3;    \r\n\r\nXuhuongIchimokuGiamoff = Buyichimoku2 OR Buyichimoku3;                     \r\n\r\n  \r\n\r\n\r\n//****************************************************************************\r\n//Dieu kien ve xu huong Ichimoku\r\n\r\n Xuhuongichimoku   = IIf(XuhuongIchimokuTang,1,IIf(XuhuongIchimokuGiam,-1,0));  \r\n\r\n XuhuongichimokuColor   = IIf(XuhuongIchimokuTang,colorBlue,IIf(XuhuongIchimokuGiam,colorRed,colorYellow));  \r\n\r\n\r\n//****************************************************************************************\r\n\r\n\r\n//====================================================================================|\r\n//         Hien thi tin hieu Mua Ban theo Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n\r\n//  Ve Tenkan Kijun Chikou Dao gam cua Ichimoku\r\n//==========================================================\r\n\r\nTenkanKijunIchimoku = ParamToggle("* - Hien thi Tenkan Sen + Kijun Sen","OFF|ON",0);\r\n\r\n\r\nif(TenkanKijunIchimoku==1)\r\n{\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick|styleNoLabel|styleNoRescale ); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick |styleNoLabel|styleNoRescale ); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud| styleNoLabel|styleNoRescale  );\r\n\r\n}\r\n\r\n\r\n//  Ve Chikou Span cua Ichimoku\r\n//==========================================================\r\n\r\nChikouIchimoku = ParamToggle("* - Hien thi Chikou Span","OFF|ON", 0);\r\n\r\nif(ChikouIchimoku==1)\r\n{\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick| styleNoLabel|styleNoRescale ,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n}\r\n  \r\n\r\n//  Ve Dao gam cua Ichimoku\r\n//==========================================================\r\n\r\n\r\nDaogamIchimoku = ParamToggle("* - Hien thi Dao gam","OFF|ON",0);\r\n\r\n\r\nif(DaogamIchimoku==1)\r\n{\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick |styleNoLabel|styleNoRescale ); //Duong ho tro dai han Dao Gam\r\n\r\n}\r\n \r\n \r\n\r\n//  Ve May Kumo cua Ichimoku\r\n//==========================================================\r\n\r\n\r\nif(ParamToggle("* - Hien thi May Kumo","OFF|ON", 0))\r\n{\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorLightOrange,1| styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorLime,1 |styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\n//PlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2, ColorBlend( colorLime, colorBlack, 0.01 ) , ColorBlend( colorLightOrange, colorBlack, 0.4 )),styleCloud|4096,0,0,timeKumo); \r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud |styleNoLabel|styleNoRescale ,0,0,timeKumo); \r\n\r\n}\r\n\r\n\r\n//   Thanh xac dinh xu huong Ichimoku\r\n//==========================================================================|\r\n\r\n// Ve xu huong Ichimoku - Thanh xu huong cuoi man hinh\r\n\r\nif (ParamToggle("* - Ichimoku Kinko Hyo Trend - Xu huong Ichimoku","OFF|ON" , 0 ))\r\n{\r\n// Hien thi xu huong Ichimoku - Thanh xu huong cuoi man hinh\r\nPlot( 0.9,"Ichimoku Trend",XuhuongichimokuColor, styleArea | styleOwnScale | styleNoLabel |styleNoRescale, 0, 100 );\r\nPlot( 1.1,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100 );\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n  \r\n  \r\n \r\n//                 Mua Ban theo Ichimoku                |\r\n//==========================================================================|\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\nif(ParamToggle("* - Buy - Sell Ichimoku","OFF|ON", 0 ))\r\n{\r\n\r\n//Tin hieu Mua so 0\r\nPlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow + shapeDigit0 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so0\r\nPlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua Vuot May Sen\r\n//PlotShapes( IIf( VuotMay , shapeUpArrow + shapeStar, shapeNone ), colorSeaGreen, 0, H, Offset =-25 ); // dau hieu Hoa xanh la phia tren Gia\r\nPlotShapes( IIf( VuotMay , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu Sen\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\n//PlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeStar, shapeNone ), colorLime, 0, H, Offset =-35 ); // dau hieu Hoa xanh la phia tren Gia\r\nPlotShapes( IIf( VuotMaySenKumo , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu SenKumo\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeStar, shapeNone ), colorGold, 0, H, Offset = -25 );  // dau hieu Hoa vang phia tren Gia\r\n\r\n//Tin hieu Mua Bom no\r\nPlotShapes( IIf( Bomno , shapeUpArrow + shapeStar, shapeNone ), colorViolet, 0, H, Offset =-25 ); // dau hieu Hoa xanh phia tren Gia\r\nPlotShapes( IIf( Bomno , shapeUpArrow , shapeNone ), colorViolet, 0, L, Offset =-25 ); //Mui ten vang va chu Bom No\r\n\r\n//Buy Ichimoku\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L [i], colorSeaGreen, Colorback=-1 , Offset =-75 ) ;  //Hien chu Sen\r\nif ( VuotMaySenKumo[i] ) \r\n\tPlotText( "SenKumo", i , L [i],  colorLime, Colorback=-1 , Offset =-90 ) ;  //Hien chu SenKumo\t\r\nif (Bomno[i] )\r\n\tPlotText( "Bom No", i , L [i],  colorViolet , Colorback=-1 , Offset =-105 ); //Hien chu Bom No\r\n} \r\n\r\n//*****************************\r\n//Sell Ichimoku\r\n//*****************************\r\n\r\n\r\n\r\n\r\n//Tin hieu Ban tren may Kumo\r\n\r\nPlotShapes( IIf( Sellichimoku1 , shapeDownArrow + shapeDigit0, shapeNone ), colorRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia\r\nPlotShapes( IIf( Sellichimoku1 , shapeDownArrow , shapeNone ), colorRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1\r\n\r\n//Tin hieu Ban trong may Kumo\r\n\r\nPlotShapes( IIf( Sellichimoku2 , shapeDownArrow + shapeDigit1, shapeNone ), colorBrown, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia\r\nPlotShapes( IIf( Sellichimoku2 , shapeDownArrow , shapeNone ), colorBrown, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1\r\n\r\n//Tin hieu Ban duoi may Kumo\r\n\r\nPlotShapes( IIf( Sellichimoku3 , shapeDownArrow + shapeDigit2, shapeNone ), colorDarkRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia\r\nPlotShapes( IIf( Sellichimoku3 , shapeDownArrow , shapeNone ), colorDarkRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1\r\n\r\n\r\n/*\r\n\r\n//Hien chu\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\n//Tin hieu Ban tren may Kumo\r\nif ( Sellichimoku1[i] ) \r\nPlotText( "I1", i , H [i], colorBlack, colorRed, Offset = 50 ) ;  \r\n\r\n//Tin hieu Ban trong may Kumo\t\r\nif ( Sellichimoku2[i] ) \r\nPlotText( "I2", i , H [i], colorBlack, colorGold, Offset = 50 ) ; \t\r\n\r\n//Tin hieu Ban duoi may Kumo\t\r\nif (Sellichimoku3[i] )\r\nPlotText( "I3", i , H [i], colorBlack, colorDarkRed, Offset = 50 ) ; \t\r\n} \r\n\r\n*/\r\n\r\n}\r\n  \r\n\r\n\r\n\r\n\r\n//========================================================================================\r\n\r\n\r\n//=======================================================\r\n//Ichimuko Time Series\r\n//=======================================================\r\n\r\nIchiTimeonoff = ParamToggle("* - Ichimuko Time Series","OFF|ON", 0 );\r\n\r\nValueY = LowestVisibleValue(L);\r\n\r\n//IIf(IchiTimeonoff,-1e10,0)\r\n\r\n//1. Ichimuko Time Series\r\n//============================================\r\n\r\nfunction DrawSeries( start, series, Color )\r\n{\r\n\tx = BarsSince( start );\r\n\tresult = 0;\r\n\tfor( i = 0; ( bar = StrToNum( StrExtract( series, i ) ) ) != 0; i++ )\r\n\t{\r\n\t\tresult += x == bar;\r\n\t\tValueX = SelectedValue(BarIndex()+1)+bar;\r\n\t\t\r\nPlotText(""+bar,IIf(IchiTimeonoff,ValueX,-1e10),IIf(IchiTimeonoff,ValueY,-1e10),Color );\r\n\t}\r\n\t\r\nPlot(IIf(IchiTimeonoff,result,-1e10) , "", Color, styleHistogram|styleOwnScale|styleNoLabel|styleDashed , 0,1 );\r\n\r\n}\r\nIchiSeries = "9,13,17,26,33,42,52,83,97";\r\nbi = BarIndex();\r\nstart = bi == SelectedValue( bi-0);\r\nDrawSeries( start, IchiSeries, ParamColor( " - Ichimuko Time Series Line Color", colorLightGrey)  );\r\n\r\n\r\n//2. Ichimuko Time Series Reserver\r\n//============================================\r\n\r\nfunction DrawSeriesReserver( start, series, Color )\r\n{\r\n\tx = BarsSince( start );\r\n\tresult = 0;\r\n\tfor( i = 0; ( bar = StrToNum( StrExtract( series, i ) ) ) != 0; i++ )\r\n\t{\r\n\t\tresult += x == (52-bar);\r\n\t\tValueX = SelectedValue(BarIndex()+1-51)+(52-bar);\r\n\t\tPlotText("-"+bar,IIf(IchiTimeonoff,ValueX,-1e10),IIf(IchiTimeonoff,ValueY,-1e10),Color );\r\n\r\n\t}\r\n\tPlot( IIf(IchiTimeonoff,result,-1e10), "", Color, styleHistogram|styleOwnScale|styleNoLabel|styleDashed , 0, 1 );\r\n}\r\nIchiSeries = "9,26,52";\r\nbi = BarIndex();\r\nstart = bi == SelectedValue( bi - 52 );\r\nDrawSeriesReserver( start, IchiSeries, ParamColor( " - Ichimuko Time Series Line Color", colorLightGrey)  );\r\n\r\n//End Ichimuko Time Series\r\n\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//***************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//***************************************************************************\r\n//===========================================================================\r\n//***************************************************************************\r\n\r\n\r\n//==========================================================================|\r\n//                    Tong hop Cac chi bao thuong dung                         |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN(" - Cac chi bao thuong dung");\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Ve duong EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1 - EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, MA_ema5Day ,Null), "EMA5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, MA_ema10Day ,Null),"EMA10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, MA_ema20Day ,Null),"EMA20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( MA_ema10Day, MA_ema20Day, MA_ema10Day, MA_ema20Day, "", IIf(MA_ema10Day &gt; MA_ema20Day, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong EMA30,40\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2 - EMA30","OFF|ON" , 0 )  ==1, MA_ema30Day ,Null),"EMA30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong EMA40\r\nPlot(IIf(ParamToggle("3 - EMA40","OFF|ON" , 0 )  ==1, MA_ema40Day ,Null),"EMA40", colorSeaGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n//===============================================\r\n// Ve duong MA50,100,150,200\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("4 - MA50", "OFF|ON" , 0 ) ==1, MA_ma50Day ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("5 - MA100","OFF|ON" , 0 ) ==1, MA_ma100Day ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("6 - MA150","OFF|ON" , 0 ) ==1, MA_ma150Day ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("7 - MA200","OFF|ON" , 0 )  ==1, MA_ma200Day ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n// END EMA va MA\r\n\r\n\r\n//*********************************************************************************************************************\r\n\r\n\r\n\r\n\r\n \r\n \r\n //==========================================================================|\r\n//                    Ve duong HO TRO - KHANG CU gan nhat                       |\r\n//==========================================================================\r\n \r\nif (ParamToggle("* - Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\r\nWarnaResistant = ParamColor(" - Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor(" - Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle(" - S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale );\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 3, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle  |styleNoLabel  |styleNoRescale);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 3, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 3, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 3, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 3, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle |styleNoLabel  |styleNoRescale);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 3, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n\r\n//END duong HO TRO - KHANG CU gan nhat  \r\n\r\n\r\n//************************************************************************************************************************\r\n\r\n\r\n\r\n //====================================================================================|\r\n//                       Ve duong Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\nif (ParamToggle("* - Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nxTrenline = Cum(1);\r\nperTrenline = 3;\r\ns1Trenline=L;\r\ns11Trendline=H;\r\npSTrendline = TroughBars( s1Trenline, perTrenline, 1 ) == 0;\r\nendtTrenline= LastValue(ValueWhen( pSTrendline, xTrenline, 1 ));\r\nstarttTrenline=LastValue(ValueWhen( pSTrendline, xTrenline, 2 ));\r\ndtSTrenline =endtTrenline-starttTrenline;\r\nendSTrendline = LastValue(ValueWhen( pSTrendline, s1Trenline, 1 ) );\r\nstartSTrendline = LastValue( ValueWhen( pSTrendline, s1Trenline, 2 ));\r\naSTrendline = (endSTrendline-startSTrendline)/dtSTrenline;\r\nbSTrendline = endSTrendline;\r\ntrendlineS = aSTrendline * ( xTrenline -endtTrenline ) + bSTrendline;\r\n\r\nPlot(IIf(xTrenline&gt;starttTrenline-10,trendlineS,-1e10),"",colorBlue,styleNoLabel   |styleNoRescale);\r\n\r\nH1Trendline=LastValue(Highest((Cum(1)&gt;starttTrenline AND Cum(1)&lt;endtTrenline)*H));\r\ntH1Trendline=LastValue(ValueWhen(H==H1Trendline,Cum(1)));\r\n\r\nUpperParallel=aSTrendline*(xTrenline-tH1Trendline)+H1Trendline;\r\n\r\nPlot(IIf(xTrenline&gt;starttTrenline-10,UpperParallel,-1e10),"UpperLine",colorOrange, styleNoLabel  |styleNoRescale);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\n\r\npRTrendline = PeakBars( s11Trendline, perTrenline, 1 ) == 0;\r\nendt1Trendline= LastValue(ValueWhen( pRTrendline, xTrenline, 1 ));\r\nstartt1Trendline=LastValue(ValueWhen( pRTrendline, xTrenline, 2 ));\r\ndtRTrendline =endt1Trendline-startt1Trendline;\r\nendRTrendline = LastValue(ValueWhen( pRTrendline, s11Trendline, 1 ) );\r\nstartRTrendline = LastValue( ValueWhen( pRTrendline, s11Trendline, 2 ));\r\naRTrendline = (endRTrendline-startRTrendline)/dtRTrendline;\r\nbRTrendline = endRTrendline;\r\ntrendlineR = aRTrendline * ( xTrenline -endt1Trendline ) + bRTrendline;\r\n\r\nPlot(IIf(xTrenline&gt;startt1Trendline-10,trendlineR,-1e10),"",colorBlue, styleNoLabel  |styleNoRescale);\r\n\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1Trendline AND Cum(1)&lt;endt1Trendline,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1Trendline OR Cum(1)==endt1Trendline),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\n\r\nLowerParallel=aRTrendline*(xTrenline-tL1)+L1;\r\n\r\nPlot(IIf(xTrenline&gt;startt1Trendline-10,LowerParallel,-1e10),"LowerLine",colorOrange, styleNoLabel  |styleNoRescale);\r\n\r\n\r\n}\r\n\r\n// END AUTO TRENDLINE\r\n\r\n\r\n//************************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Hien thi Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n\r\nif (VAPanna = ParamToggle( "* - Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\nQvapAnna       = Param( " - So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight     = Param( " - Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\n\r\n\r\nBarindexAna = BarIndex();\r\nBeginValueAnna = BeginValue( BarindexAna );\r\nEndValueAnna = EndValue( BarindexAna );\r\n\r\nif( BeginValueAnna == 0 &amp;&amp; EndValueAnna == LastValue( BarindexAna ) )\r\n{\r\n    BeginValueAnna = FirstVisibleValue( BarindexAna );\r\n    EndValueAnna = LastVisibleValue( BarindexAna );\r\n}\r\n\r\nBeginValueAnna = Max( 0, BeginValueAnna );\r\nEndValueAnna = Max( 0, EndValueAnna );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbarAnna = C &gt; ( High - BullBearZone );\r\nbearbarAnna = C &lt; ( Low + BullBearZone );\r\n\r\nmxAnna  = PriceVolDistribution( H, L, V, QvapAnna, True, BeginValueAnna, EndValueAnna );\r\nmx1Anna = PriceVolDistribution( H, L, IIf( bullbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );\r\nmx2Anna = PriceVolDistribution( H, L, IIf( bearbarAnna, V, 0 ), QvapAnna, True, BeginValueAnna, EndValueAnna );\r\n\r\nbins  = MxGetSize( mxAnna, 0 );\r\nbins1 = MxGetSize( mx1Anna, 0 );\r\nbins2 = MxGetSize( mx2Anna, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mxAnna[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mxAnna[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mxAnna[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mxAnna=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mxAnna[ 1 ][ 0 ] - mxAnna[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont     = GfxSelectFont( " - Arial", SelectsizeFont = Param( " - Chon Font Size", 9, 1, 30, 1 ) );  // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1Anna = Bull\r\n        price = mx1Anna[ i ][ 0 ]; // price level\r\n        absVolume = mx1Anna[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( EndValueAnna - BeginValueAnna + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1Anna = BeginValueAnna;\r\n        y1Anna = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2Anna = BeginValueAnna + relbar;\r\n        y2Anna = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );\r\n\r\n        // mx2Anna = Bear\r\n        absVolume = mx2Anna[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );\r\n        x1Anna = x2Anna;\r\n        x2Anna = x1Anna + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );\r\n\r\n        // mxAnna = All Bars\r\n        absVolume = mxAnna[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( EndValueAnna - BeginValueAnna + 1 );\r\n        x1Anna = x2Anna;\r\n        x2Anna = x1Anna + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1Anna, y1Anna, x2Anna, y2Anna, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1Anna, y1Anna );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n//************************************************************************************************************************\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Hien thi Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\nif (bBollingerBands = ParamToggle( "* - Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBTop" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); \r\nPlot( bbb = BBandBot( ParamField(" - Bollinger Price field",-1), Param(" - Bollinger Periods", 20, 2, 300, 1 ), Param(" - Bollinger Width", 2, 0, 10, 0.05 ) ), "BBBot" + _PARAM_VALUES(), ParamColor(" - Bollinger Color", colorDarkOliveGreen), ParamStyle(" - Bollinger Style",styleNoLabel) |styleNoLabel  |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( ParamColor(" - Bollinger Color", colorDarkOliveGreen), colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n\r\n\r\n//************************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n //==========================================================================|\r\n//                 Ve duong Keltner Bands system                                 |\r\n//==========================================================================|  \r\n   \r\n  \r\nif (Keltner = ParamToggle( "* - Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop," - KTop",colorRed,styleLine|styleNoLabel  |styleNoRescale);\r\nPlot(KMid," - KMid",colorGold,styleDashed|styleNoLabel|styleNoRescale);\r\nPlot(KBottom," - KBottom",colorBlue,styleLine|styleNoLabel|styleNoRescale);\r\n \r\n \r\n \r\nprintf("\\nBuy : " + BuyKeltner );  \r\nprintf("\\nSell : " + SellKeltner );  \r\nprintf("\\nShort : " + ShortKeltner );  \r\nprintf("\\nCover : " + CoverKeltner );  \r\n\r\n// Hien thi cac tin hieu Mua Ban theo  Keltner Bands system     \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(BuyKeltner, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-25);\r\nPlotShapes(IIf(SellKeltner, shapeDownArrow, shapeNone),colorRed, 0, H, Offset=-25);\r\n\r\nPlotShapes(IIf(ShortKeltner, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-25);\r\nPlotShapes(IIf(ShortKeltner, shapeStar, shapeNone),colorYellow, 0,H, Offset=40);\r\n\r\n//Hien chu E10\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyKeltner[i] == 1 )\r\n    {\r\n PlotText( "Kel", i , L[ i ], colorBlack, colorBrightGreen,Offset=-50  ) ;\r\n     }  \r\n  //Sell   \r\n if( SellKeltner[i] == 1 )\r\n    {\r\nPlotText( "Kel", i , H [ i ], colorBlack, colorRed,Offset= 40  ) ;\r\n     }      \r\n }  \r\n \r\n\r\n}\r\n// END Keltner Bands system \r\n\r\n\r\n\r\n\r\n\r\n\r\n//************************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//======================================================\r\n\r\n//Ve Gap\r\nif (gapindicator = ParamToggle( "* - Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n \r\n//Ve duong Gapline\r\nPlot(GapLineHi,"",ParamColor( " - GapLine High Color", colorGold ), styleLine |styleNoLabel|styleNoRescale );  \r\nPlot(GapLineLo,"",ParamColor( " - GapLine Low Color", colorBlue ), styleLine |styleNoLabel|styleNoRescale );  \r\n\r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\n\r\n//Hien so Number\r\nPlotText(     NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],ParamColor( " - GapLine High Color", colorGold ));  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],ParamColor( " - GapLine Low Color", colorBlue ));  \r\n}  \r\n}\r\n\r\n}\r\n// END GAP Indicator \r\n\r\n\r\n//*************************************************************************************************************\r\n\r\n\r\n\r\n//  Ve May Kumo cua Ichimoku\r\n//==========================================================\r\n\r\n\r\nif(ParamToggle("* - Hien thi May Kumo","OFF|ON", 0))\r\n{\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorLightOrange,1| styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorLime,1 |styleNoLabel|styleNoRescale ,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\n//PlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2, ColorBlend( colorLime, colorBlack, 0.01 ) , ColorBlend( colorLightOrange, colorBlack, 0.4 )),styleCloud|4096,0,0,timeKumo); \r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud |styleNoLabel|styleNoRescale ,0,0,timeKumo); \r\n\r\n}\r\n\r\n\r\n//   Thanh xac dinh xu huong Ichimoku\r\n//==========================================================================|\r\n\r\n// Ve xu huong Ichimoku - Thanh xu huong cuoi man hinh\r\n\r\nif (ParamToggle("* - Ichimoku Kinko Hyo Trend - Xu huong Ichimoku","OFF|ON" , 0 ))\r\n{\r\n// Hien thi xu huong Ichimoku - Thanh xu huong cuoi man hinh\r\nPlot( 0.9,"Ichimoku Trend",XuhuongichimokuColor, styleArea | styleOwnScale | styleNoLabel |styleNoRescale, 0, 100 );\r\nPlot( 1.1,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100 );\r\n\r\n}\r\n\r\n\r\n\r\n//************************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n//====================================================================================|\r\n//    END Tong hop Cac chi bao thuong dung                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n\r\n\r\n\r\n//********************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//===========================================================================\r\n//*************Tong hop Tin hieu Buy Sell Luot song ngan han*****************\r\n//===========================================================================\r\n\r\n_SECTION_BEGIN(" - Tong hop Tin hieu Buy Sell Luot song ngan han");\r\n\r\n\r\n\r\n\r\n//===========================================================================\r\n//1. Ve kenh Chien luoc Breakout vung tich luy Sideway ngan han\r\n//===========================================================================\r\n\r\nif (Sidewayon = ParamToggle( "1 - Hien thi vung Sideway",  "OFF|ON", 0 ))\r\n{\r\n\r\nAbove_SidewayDay = ValueWhen( Breakout_SidewayDay, LastHigh_SidewayDay, 0 );\r\nBelow_SidewayDay = ValueWhen( Breakout_SidewayDay, LastLow_SidewayDay, 0 );\r\nPlot( Above_SidewayDay, "Resistance", colorRed, styleDashed|styleThick|styleNoLabel|styleNoRescale );\r\nPlot( Below_SidewayDay, "Support", colorBlue, styleDashed|styleThick|styleNoLabel|styleNoRescale );\r\n\r\n//Ve kenh gia cao nhat n Ngay\r\nPlot(LastHigh_SidewayDay, " HHV(H, " + WriteVal(SidewayDay, 1) + ")", colorYellow, styleDashed|styleThick|styleNoLabel|styleNoRescale );\r\n\r\n}\r\n\r\n//Ve tin hieu Mua Ban - Chien luoc Breakout vung tich luy Sideway ngan han\r\n//===========================================================================\r\n\r\n//Plot Breakout vuot vung tich luy\r\n//Ve tin hieu Mua va hien chu (Bo)\r\n\r\nif (ParamToggle( "2 - Breakout Sideway",  "OFF|ON", 0 ))\r\n{\r\n\r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{       \r\n //Buy Neu xay ra but pha thi hien chu (Bo)\r\n     if( BuyBreakout_SidewayDay[i] == 1 )\r\n    {\r\n       // PlotText( "Br", i, L[i], colorBlack, colorYellow,Offset=-75 );  //phong nen mau Xanh, chu mau den\r\n    }\r\n//Sell Breakout  \r\n if( SellBreakout_SidewayDay[i] == 1 )\r\n    {\r\n       //  PlotText( "Br", i , H [ i ], colorBlack, colorRed,Offset= 68  ) ;\r\n     }  \r\n} \r\n//Buy\r\nPlotShapes( IIf( BuyBreakout_SidewayDay , shapeUpArrow + shapeDigit0 , shapeNone ), colorGold, 0, L, Offset = 10 );  //Hien thi so 0\r\nPlotShapes(IIf(BuyBreakout_SidewayDay, shapeUpArrow, shapeNone),colorGold, 0,L, Offset=-25); //Hien thi tin hieu mui ten\r\n//PlotShapes( IIf( New_Breakout_SidewayDay , shapeUpArrow + shapeHollowCircle, shapeNone ), colorGold, 0, H, Offset = -35 );  // dau hieu Hoa vang phia tren Gia\r\n//Sell\r\nPlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow + shapeHollowStar , shapeNone ), colorGold, 0, H , Offset=10 );\r\nPlotShapes( IIf( SellBreakout_SidewayDay , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25 );\r\n\r\n }\r\n\r\n \r\n \r\n \r\n //*****************************************************************************************************************\r\n \r\n \r\n \r\n \r\n//===========================================================================\r\n// 2. Ve tin hieu Mua Ban - Chien luoc luot song ngan han T+ \r\n//===========================================================================\r\n\r\nif (ParamToggle( "3 - Luot song T+",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n/*\r\n\r\n//Hien chu duoi tin hieu \r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy T+5         \r\n if( Buy5Day[i] == 1 )\r\n    {\r\nPlotText( "B4", i , L[ i ], colorBlack, colorSeaGreen,Offset=-92  ) ;\r\n     }  \r\n   //Buy T+10        \r\n if( Buy10Day[i] == 1 )\r\n    {\r\nPlotText( "B8", i , L[ i ], colorBlack, colorLime,Offset=-110  ) ;\r\n     }    \r\n  //Sell T5   \r\n if( Sell5Day[i] == 1 )\r\n    {\r\nPlotText( "S4", i , H [ i ], colorBlack, colorRed,Offset= 86  ) ;\r\n     }  \r\n    //Sell T+10   \r\n if( Sell5Day[i] == 1 )\r\n    {\r\nPlotText( "S8", i , H [ i ], colorBlack, colorRed,Offset= 104  ) ;\r\n     }          \r\n }  \r\n\r\n*/\r\n\r\n\r\n\r\n// Hien thi lenh Mua T+5 T+10\r\n\r\nPlotShapes( IIf( Buy5Day , shapeUpArrow + shapeDigit4 , shapeNone ), colorSeaGreen, 0, L, Offset =55 );\r\nPlotShapes( IIf( Buy5Day , shapeUpArrow , shapeNone ), colorSeaGreen, 0, L, Offset =-25 );\r\n\r\nPlotShapes( IIf( Buy10Day , shapeUpArrow + shapeDigit8 , shapeNone ), colorLime, 0, L, Offset =85 );\r\nPlotShapes( IIf( Buy10Day , shapeUpArrow , shapeNone ), colorLime, 0, L, Offset =-25 );\r\n\r\n\r\n\r\n// Hien thi lenh Ban T+5 T+10\r\n\r\n\r\nPlotShapes( IIf( Sell5Day , shapeDownArrow + shapeDigit3 , shapeNone ), colorOrange, 0, H , Offset=55 );\r\nPlotShapes( IIf( Sell5Day , shapeDownArrow , shapeNone ), colorOrange, 0, H , Offset=-25 );\r\n  \r\nPlotShapes( IIf( Sell10Day , shapeDownArrow + shapeDigit7 , shapeNone ), colorBrown, 0, H , Offset=85 );\r\nPlotShapes( IIf( Sell10Day , shapeDownArrow , shapeNone ), colorBrown, 0, H , Offset=-25 );\r\n\r\n}\r\n\r\n\r\n//***********************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================\r\n// 3. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50\r\n//====================================================================================\r\n\r\nif (ParamToggle( "4 - EMA5 Cross",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*\r\n\r\n//Hien chu E5\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyEMA5cross[i] == 1 )\r\n    {\r\n //PlotText( "E5", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;\r\n     }  \r\n  //Sell   \r\n if( SellEMA5cross[i] == 1 )\r\n    {\r\n //PlotText( "E5", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;\r\n     }      \r\n }  \r\n\r\n*/\r\n\r\n\r\n// Hien thi lenh Mua Ban\r\nPlotShapes( IIf( BuyEMA5cross , shapeUpArrow + shapeDigit5 , shapeNone ), colorGreen, 0, L, Offset =70 );\r\nPlotShapes( IIf( BuyEMA5cross , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\nPlotShapes( IIf( SellEMA5cross , shapeDownArrow + shapeDigit4 , shapeNone ), colorRed, 0, H , Offset=70 );\r\nPlotShapes( IIf( SellEMA5cross , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n\r\n\r\n}\r\n\r\n\r\n\r\n//********************************************************************************************************************\r\n\r\n\r\n\r\n//====================================================================================\r\n// 4. Ve tin hieu Mua Ban - Chien luoc Giao cat giua EMA10 voi cac duong EMA 20,30,50\r\n//====================================================================================\r\n\r\nif (ParamToggle( "5 - EMA10 Cross",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*\r\n\r\n//Hien chu E10\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyEMA10cross[i] == 1 )\r\n    {\r\n //PlotText( "E10", i , L[ i ], colorBlack, colorBrightGreen,Offset=-146  ) ;\r\n     }  \r\n  //Sell   \r\n if( SellEMA10cross[i] == 1 )\r\n    {\r\n //PlotText( "E10", i , H [ i ], colorBlack, colorRed,Offset= 141  ) ;\r\n     }      \r\n }  \r\n\r\n*/\r\n\r\n\r\n// Hien thi lenh Mua Ban\r\nPlotShapes( IIf( BuyEMA10cross , shapeUpArrow + shapeDigit6 , shapeNone ), colorBlue, 0, L, Offset =70 );\r\nPlotShapes( IIf( BuyEMA10cross , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );\r\n\r\nPlotShapes( IIf( SellEMA10cross , shapeDownArrow + shapeDigit5 , shapeNone ), colorDarkRed, 0, H , Offset=70 );\r\nPlotShapes( IIf( SellEMA10cross , shapeDownArrow , shapeNone ), colorDarkRed, 0, H , Offset=-25 );\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n//******************************************************************************************************************\r\n\r\n\r\n\r\n//======================================================================================================\r\n// 5. Tin hieu Mua Ban theo Chien luoc Giao cat giua EMA20 voi cac duong EMA 40 - Turtle Trading System\r\n//======================================================================================================\r\n\r\n\r\n\r\n//                 Buy - Sell Turtle trading system                 |\r\n//==========================================================================|\r\n \r\nif (BsTurtle = ParamToggle( "6 - Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n//Hien chu Tur\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n //Buy         \r\n if( BuyTurtle[i] == 1 )\r\n    {\r\nPlotText( "Tur", i , L[ i ], colorSeaGreen, Colorback=-1 , Offset= -90 ) ;\r\n     }  \r\n  //Sell   \r\n if( SellTurtle[i] == 1 )\r\n    {\r\nPlotText( "Tur", i , H [ i ], colorRed, Colorback=-1 ,  Offset= 90  ) ;\r\n     }      \r\n }  \r\n\r\n\r\n\r\n\r\n// Hien thi lenh Mua Ban\r\nPlotShapes( IIf( BuyTurtle ,  shapeUpArrow ,   shapeNone ), colorBlue,   0, L,  Offset =-25 );\r\nPlotShapes( IIf( SellTurtle , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset =-25 );\r\n\r\n\r\n//Tin hieu thoat lenh\r\nPlotShapes( abs( exitArray )*shapeHollowCircle  , colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 ); //Vong tron mau Vang\r\nPlotShapes( IIf( exitArray , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n\r\n\r\n}\r\n\r\n//Bat tat Turtle Trading System\r\n\r\nif (Turtle = ParamToggle( "7 - Kenh Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n//Ve cac duong Turtle\r\n// Plots a 20 period Donchian channel (pdsTurtle)\r\n//Duong tren\r\nPlot( LastHigh_ema20Day,  "Donchian Uper",   ParamColor(  "Donchian Uper Color", colorBlue ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale );\r\n//Duong duoi\r\nPlot( LastLow_ema20Day,   "Donchian Lower",  ParamColor(  "Donchian Lower Color", colorRed ),  styleLine | ParamStyle(  "Donchian Style", styleThick ) |styleNoLabel|styleNoRescale  );\r\n\r\n//Ve kenh thoat lenh\r\nPlot( stopArray, "Chand Stop", ParamColor( "Chand Color:", colorYellow ), ParamStyle( "Chand Style", styleDashed )  |styleNoLabel|styleNoRescale );\r\n\r\n//plot color ribbon - Thanh xu huong duoi man hinh\r\n//Plot(1, "", TurtleColor, styleArea | styleOwnScale | styleNoLabel, -0.1, 100 );\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n// 6. Tin hieu Mua Ban theo Chien luoc ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (ParamToggle("8 - Buy - Sell theo % (Dinh - Day) or ATR", "OFF|ON" , 0 ))\r\n{\r\n//Hien chu ATR\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n//Buy\r\n if( Buyatr[i] == 1 )\r\n    {\r\n PlotText( "Atr", i , L[ i ],  colorGreen, colorback=-1 , Offset=-105  ) ;\r\n     }   \r\n//Sell     \r\n if( Sellatr[i] == 1 )\r\n    {\r\n PlotText( "Atr", i , H [ i ],  colorRed, colorback=-1 , Offset= 105  ) ;\r\n     }        \r\n \r\n }\r\n \r\n // Vao lenh Mua Ban\r\nPlotShapes( IIf( Buyatr , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\nPlotShapes( IIf( Sellatr , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n  \r\n}\r\n\r\n\r\n\r\n/*\r\n \r\n \r\n// Ve kenh thoat lenh theo ATR \r\n  \r\nif (ParamToggle("8 - Kenh thoat lenh theo ATR", "OFF|ON" , 0 ))\r\n{\r\n\r\n//Kenh thoat lenh ATR\r\nPlot( trailARRAY,"Trailing stop level", ParamColor( " - ATR Color", colorBlue ) , styleLine | ParamStyle(" - ATR Style" , styleThick) |styleNoLabel|styleNoRescale  );\r\n\r\n}\r\n\r\n*/\r\n\r\n\r\n \r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n\r\n//***********************************************************************************************************\r\n\r\n\r\n\r\n\r\n//====================================================================================\r\n// 7. Canh bao Dinh - Day\r\n//====================================================================================\r\n\r\n\r\n\r\nif (BsTurtle = ParamToggle( "9 - Canh bao Dinh - Day",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Hien canh bao Dinh Day\r\n//Hien chu Text\r\n\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{ \r\n\r\n//Day\r\nif( DayBottom[i] == 1 )\r\n    {\r\n PlotText( "Bot", i , L[ i ], colorGold, colorback=-1 , Ofset = -15 ) ;\r\n     }  \r\n\r\n//Dinh\r\nif( DinhTop[i] == 1 )\r\n    {\r\n PlotText( "Top", i , H [ i ],  colorGold, colorback=-1 , Ofset = 5 ) ;\r\n     }     \r\n            \r\n     \r\n }  \r\n\r\n//*********************************************************************\r\n// Dau hieu mui ten\r\n\r\n//Mua Day\r\nPlotShapes( IIf( DayBottom==1 , shapeUpArrow , shapeNone ), colorGold, 0, L, Offset =-25 );\r\nPlotShapes( IIf(BuyDayBottom, shapeStar, shapeNone),colorYellow, 0, H, Offset = 0 );\r\nPlotShapes( IIf(BuyDayBottom, shapeHollowCircle, shapeNone),colorGold, 0, H, Offset = 0 );\r\n\r\n//Ban Dinh\r\nPlotShapes( IIf( DinhTop==1 , shapeDownArrow , shapeNone ), colorGold, 0, H , Offset=-25);\r\nPlotShapes( IIf(SellDinhTop, shapeStar, shapeNone),colorYellow, 0 ,L,  Offset = 0  );\r\nPlotShapes( IIf(SellDinhTop, shapeHollowCircle, shapeNone),colorYellow, 0 ,L,  Offset = 0  );\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n\r\n\r\n\r\n//***********************************************************************************************\r\n  \r\n\r\n//====================================================================================|\r\n// 8. Tin hieu Mua Ban theo RSI Divergence                                |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (ParamToggle("10 - Buy - Sell theo RSI Divergence", "OFF|ON" , 0 ))\r\n{\r\n//Hien chu RSI\r\n for ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n//Buy\r\n if( BuyRSIDivergence[i] == 1 )\r\n    {\r\n PlotText( "Rsi", i , L[ i ],  colorBlue, colorback=-1 , Offset=-40  ) ;\r\n     }   \r\n//Sell     \r\n if( SellRSIDivergence[i] == 1 )\r\n    {\r\n PlotText( "Rsi", i , H [ i ],  colorRed, colorback=-1 , Offset= 40  ) ;\r\n     }        \r\n \r\n }\r\n \r\n // Vao lenh Mua Ban\r\nPlotShapes( IIf( BuyRSIDivergence , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );\r\nPlotShapes( IIf( SellRSIDivergence , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-25 );\r\n  \r\n}\r\n\r\n\r\n  \r\n//***********END RSI Divergence***************\r\n\r\n\r\n//*********************************************************************************************\r\n\r\n \r\n \r\n \r\n//                 Mua Ban theo Ichimoku                |\r\n//==========================================================================|\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\nif(ParamToggle("11 - Buy - Sell Ichimoku","OFF|ON", 0 ))\r\n{\r\n\r\n//Tin hieu Mua so 0\r\nPlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow + shapeDigit0 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so0\r\nPlotShapes( IIf( Buyichimoku2 OR Buyichimoku3, shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =10 ); // dau hieu so5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 );              // dau hieu mui ten xanh\r\n\r\n//Tin hieu Mua Vuot May Sen\r\n//PlotShapes( IIf( VuotMay , shapeUpArrow + shapeStar, shapeNone ), colorSeaGreen, 0, H, Offset =-25 ); // dau hieu Hoa xanh la phia tren Gia\r\nPlotShapes( IIf( VuotMay , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu Sen\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\n//PlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeStar, shapeNone ), colorLime, 0, H, Offset =-35 ); // dau hieu Hoa xanh la phia tren Gia\r\nPlotShapes( IIf( VuotMaySenKumo , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-25 ); // dau hieu mui ten xanh la va hien chu SenKumo\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeStar, shapeNone ), colorGold, 0, H, Offset = -25 );  // dau hieu Hoa vang phia tren Gia\r\n\r\n//Tin hieu Mua Bom no\r\nPlotShapes( IIf( Bomno , shapeUpArrow + shapeStar, shapeNone ), colorViolet, 0, H, Offset =-25 ); // dau hieu Hoa xanh phia tren Gia\r\nPlotShapes( IIf( Bomno , shapeUpArrow , shapeNone ), colorViolet, 0, L, Offset =-25 ); //Mui ten vang va chu Bom No\r\n\r\n//Buy Ichimoku\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L [i], colorSeaGreen, Colorback=-1 , Offset =-75 ) ;  //Hien chu Sen\r\nif ( VuotMaySenKumo[i] ) \r\n\tPlotText( "SenKumo", i , L [i],  colorLime, Colorback=-1 , Offset =-90 ) ;  //Hien chu SenKumo\t\r\nif (Bomno[i] )\r\n\tPlotText( "Bom No", i , L [i],  colorViolet , Colorback=-1 , Offset =-105 ); //Hien chu Bom No\r\n} \r\n\r\n//*****************************\r\n//Sell Ichimoku\r\n//*****************************\r\n\r\n\r\n\r\n\r\n//Tin hieu Ban tren may Kumo\r\n\r\nPlotShapes( IIf( Sellichimoku1 , shapeDownArrow + shapeDigit0, shapeNone ), colorRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia\r\nPlotShapes( IIf( Sellichimoku1 , shapeDownArrow , shapeNone ), colorRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1\r\n\r\n//Tin hieu Ban trong may Kumo\r\n\r\nPlotShapes( IIf( Sellichimoku2 , shapeDownArrow + shapeDigit1, shapeNone ), colorBrown, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia\r\nPlotShapes( IIf( Sellichimoku2 , shapeDownArrow , shapeNone ), colorBrown, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1\r\n\r\n//Tin hieu Ban duoi may Kumo\r\n\r\nPlotShapes( IIf( Sellichimoku3 , shapeDownArrow + shapeDigit2, shapeNone ), colorDarkRed, 0, H, Offset =40 ); // dau hieu Hoa mau Cam phia tren Gia\r\nPlotShapes( IIf( Sellichimoku3 , shapeDownArrow , shapeNone ), colorDarkRed, 0, H, Offset =-25 ); // dau hieu mui ten xanh la va hien chu I1\r\n\r\n\r\n/*\r\n\r\n//Hien chu\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\n//Tin hieu Ban tren may Kumo\r\nif ( Sellichimoku1[i] ) \r\nPlotText( "I1", i , H [i], colorBlack, colorRed, Offset = 50 ) ;  \r\n\r\n//Tin hieu Ban trong may Kumo\t\r\nif ( Sellichimoku2[i] ) \r\nPlotText( "I2", i , H [i], colorBlack, colorGold, Offset = 50 ) ; \t\r\n\r\n//Tin hieu Ban duoi may Kumo\t\r\nif (Sellichimoku3[i] )\r\nPlotText( "I3", i , H [i], colorBlack, colorDarkRed, Offset = 50 ) ; \t\r\n} \r\n\r\n*/\r\n\r\n}\r\n  \r\n\r\n  \r\n//*********************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|              END Tong hop Tin hieu Buy Sell Luot song ngan han                   \r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n//****************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN(" - Volume Buy and Sell ");\r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//Chon mau Volume\r\nVolumeUpcolor       = ParamColor(" - Volume Color Up",      colorGreen );\r\nVolumeDown          = ParamColor(" - Volume Color Down",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - Volume Color Sideway", colorYellow );\r\nVolumecolor         = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Chon MAVolume\r\nVolumeperiod       = Param     (" - Volume MA Periods ", 30,  1, 500, 1); \r\nmaVolume           = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume          = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n\r\nVolumeheight       = Param     (" - Volume Height", 4, 1, 100, 1.0) ; // Chieu cao Volume\r\nPaneHghtMin        = LowestVisibleValue( V);\r\nPaneHghtMax        = HighestVisibleValue(V) *Volumeheight;\r\n\r\nmaVolumecolor      = ParamColor(" - Volume MA Color", colorOrange);\r\n\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* - Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 2 ) )\r\n{\r\n\r\n//Volume OFF\r\n//==============================================================\r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n\r\n\r\n\r\n//==============================================================\r\n//Volume Histogram\r\n//==============================================================\r\ncase "Volume Histogram":\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "Volume" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel|styleNoRescale,  PaneHghtMin, PaneHghtMax, 0, 0, 1);\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleThick|styleNoTitle | styleOwnScale | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);\r\n\r\nbreak;\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==============================================================\r\n//Volume Buy anh Sell\r\n//==============================================================\r\ncase "Volume Buy and Sell":\r\n\r\n\r\nTotalVolumeUp       = ParamColor(" - Total Volume Color Up",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total Volume Color Down",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total Volume Color Sideway", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Volume Sell Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);\r\n\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel|styleNoRescale,   PaneHghtMin, PaneHghtMax, 0, 0, 1);\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n//***********************************************************************************************\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN(" - Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n\r\n //END Chay bo loc VSA\r\n \r\n\r\n _SECTION_END ();\r\n \r\n\r\n \r\n \r\n \r\n \r\n//*********************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// Japanese CandleStick Pattern Recognition - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n\r\n\r\n_SECTION_BEGIN(" - Japanese Candle - Nen Nhat");\r\n/* \r\nSao chep bai kho nay vao khu vuc binh luan "Cong thuc" cua "Binh luan Guru" cua Amibroker.\r\nMui ten mau xanh luc dac cho biet Nen tang gia "tang" voi do tin cay cao.\r\nMui ten mau xanh la cay trong cho biet Nen tang gia "tang" voi do tin cay trung binh va thap.\r\nMui ten mau do dac cho biet "giam gia" Nen giam voi do tin cay cao.\r\nCac mui ten mau do trong rong cho biet "giam gia" Nen giam voi do tin cay vua phai va thap.\r\nDi chuyen con tro va nhap vao cay nen da chon de nhan nhan xet.\r\nNhan xet tu Steve Nison "Ky thuat bieu do hinh nen Nhat Ban" va tu trang web LitWick.\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n// Candle Codes \r\n\r\nAvgRange = Sum( abs(O-C),20 )/20;\r\n//Nen tang gia\r\nWhiteBody = (C &gt; O) OR (IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange); \r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\n//Nen giam gia\r\nBlackBody = (C &lt; O) OR (IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange); \r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\n//Nen Doji\r\nDoji = (C == O AND V &gt; 0) \r\nOR (abs(O-C)&lt;=((H-L)*0.1))\r\nOR abs(C-O) &lt;= (C*0.0025)\r\nOR CdDoji( threshold = 0.05 );\r\n\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n\r\n//====================================================================================================\r\n//Nen Nhat 2\r\n//====================================================================================================\r\n\r\n/*Than Nen*/\r\nsmallBodyMaximum=0.0025;//meno di 0.25%\r\nLargeBodyMinimum=0.01;//meno di 1.0%\r\nsmallBody=(O&gt;=C*(1-smallBodyMaximum) AND whiteBody) \r\n         OR (C&gt;=O*(1-smallBodyMaximum) AND blackBody);\r\nlargeBody=(C&gt;=O*(1+largeBodyMinimum) AND whiteBody) \r\n         OR C&lt;=O*(1-largeBodyMinimum) AND blackBody;\r\nmediumBody=NOT LargeBody AND NOT smallBody;\r\nidenticalBodies=abs(abs(Ref(O,-1)-Ref(C,-1))-abs(O-C)) &lt; \r\n          abs(O-C)*smallBodyMaximum;\r\nrealBodySize=abs(O-C);\r\n\r\n\r\n/*Shadows - Bong Nen (Rau Nen)*/\r\nsmallUpperShadow=(whiteBody AND H&lt;=C*(1+smallBodyMaximum))\r\n               OR (blackBody AND H&lt;=O*(1+smallBodyMaximum));\r\nsmallLowerShadow=(whiteBody AND L&gt;=O*(1-smallBodyMaximum)) \r\n               OR (blackBody AND L&gt;=C*(1-smallBodyMaximum));\r\nlargeUpperShadow=(whiteBody AND H&gt;=C*(1+largeBodyMinimum)) \r\n               OR (blackBody AND H&gt;=O*(1+largeBodyMinimum));\r\nlargeLowerShadow=(whiteBody AND L&lt;=O*(1-largeBodyMinimum)) \r\n              OR (blackBody AND L&lt;=C*(1-largeBodyMinimum));\r\n              \r\n              \r\n  /*Gaps*/\r\nupGap=  IIf(Ref(blackBody,-1)AND whiteBody AND O&gt;Ref(O,-1),1,\r\n        IIf(Ref(blackbody,-1) AND blackBody AND C&gt;Ref(O,-1),1,\r\n        IIf(Ref(whiteBody,-1) AND whiteBody AND O&gt;Ref(C,-1),1,\r\n        IIf(Ref(whiteBody,-1) AND blackBody AND C&gt;Ref(C,-1),1,0))));\r\n\r\ndownGap=IIf(Ref(blackBody,-1)AND whiteBody AND C&lt;Ref(C,-1),1,\r\n        IIf(Ref(blackbody,-1) AND blackBody AND O&lt;Ref(C,-1),1,\r\n        IIf(Ref(whiteBody,-1) AND whiteBody AND C&lt;Ref(O,-1),1,\r\n        IIf(Ref(whiteBody,-1) AND blackBody AND O&lt;Ref(O,-1),1,0))));\r\n\r\n\r\n/*Definizione candele*/\r\nspinningTop=mediumBody;\r\n\r\n\r\ndojiStar=doji AND (upgap OR downgap)AND Ref(LargeBody,-1);\r\nmarabuzu=LargeBody AND smallUpperShadow AND smallLowerShadow;    \r\n\r\nengulfing=\r\n   IIf(blackBody AND Ref(blackbody,-1) AND C&lt;Ref(C,-1) AND O&gt;Ref(O,-1),1,\r\n   IIf(blackBody AND Ref(whiteBody,-1) AND O&gt;Ref(C,-1) AND C&lt;Ref(O,-1),1,\r\n   IIf(whitebody AND Ref(whitebody,-1) AND C&gt;Ref(C,-1) AND O&lt;Ref(O,-1),1,\r\n   IIf(whiteBody AND Ref(blackBody,-1) AND C&gt;Ref(O,-1)AND O&lt;Ref(C,-1),1,0))));        \r\n              \r\n Harami=\r\n   IIf(blackbody AND Ref(blackBody,-1) AND O&lt;Ref(O,-1) AND C&gt;Ref(C,-1),1,\r\n   IIf(blackBody AND Ref(whiteBody,-1) AND C&gt;Ref(O,-1) AND O&lt;Ref(C,-1),1,\r\n   IIf(whiteBody AND Ref(whiteBody,-1) AND C&lt;Ref(C,-1) AND O&gt;Ref(O,-1),1,\r\n   IIf(whiteBody AND Ref(blackBody,-1) AND O&gt;Ref(C,-1) AND C&lt;Ref(O,-1),1,0))));             \r\n              \r\n\r\n// Hammer\r\nHammer = (umbrellaline AND Ref(downtrend,-1))\r\nOR (IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) , 1, 0))\r\nOR CdHammer( rangefactor= 1.1 )\r\nOR (smallUpperShadow AND NOT doji AND\r\n   ((blackBody AND abs(C-L)&gt;2*realBodySize) OR\r\n   (whiteBody AND abs(L-O)&gt;2*realBodySize)));\r\n\r\n\r\n//The upper shadow is less than ten percent of the range\r\n //and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.  \r\n \r\n \r\n \r\n/* Muc cao toi da hom nay - (MHT)\r\nHom nay la muc cao nhat trong 5 ngay qua */\r\n\r\nMHT=  HHV(H,5)==H;\r\n\r\n\r\n/* Muc cao toi da ngay hom qua - (MHY)\r\nHom qua la muc cao nhat trong 5 ngay qua */\r\n\r\nMHY=   HHV(H,5)==Ref ( H, -1);\r\n\r\n\r\n/* Thap toi thieu hom nay - (MLT)\r\nHom nay la muc thap nhat trong 5 ngay qua */\r\n\r\nMLT=   LLV(L,5)==L;\r\n\r\n\r\n/* Muc thap nhat hom qua - (MLY)\r\nHom qua la muc thap nhat trong 5 ngay qua */\r\n\r\nMLY=   LLV(L,5)==Ref(L,-1);\r\n\r\n/*Dinh nghia DOJI */\r\n\r\n/*Doji Today - (DT)*/\r\n\r\nDT = abs(C-O) &lt;= (C*smallBodyMaximum) OR\r\n(abs(O-C)&lt;=((H-L)*0.1));\r\n\r\n/* Doji Yesterday - (DY)*/\r\nDY = abs(Ref ( C, -1)-Ref(O,-1)) &lt;= Ref ( C, -1) *smallBodyMaximum OR\r\nabs (Ref ( O, -1)-Ref(C,-1)) &lt;= (Ref ( H, -1 ) - Ref ( L, -1 ) )*0.1;\r\n            \r\n\r\n//**************************************************************\r\n//----------------------------------------\r\n// CANDELE BULLISH  - TANG GIA\r\n//----------------------------------------\r\n//**************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. \r\n// See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\n//Mo hinh nen tang gia la mo hinh dao chieu hai ngay thuong duoc su dung de canh bao cac nha dau tu ve suc manh thi truong sap xay ra.\r\n\r\n// Kicker Bullish\r\nBullishKicker = (Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1)) \r\nOR (Ref(O,-1) &gt; Ref(C,-1) AND O &gt; Ref(O,-1) AND C &gt; O); \r\n\r\n\r\n/*BreakAway Bullish*/\r\nbreakAwayBullish=Ref(Largebody,-4) AND Ref(blackBody,-4)\r\n              AND Ref(blackBody,-3) AND Ref(O,-3)&lt;Ref(C,-4)\r\n              AND Ref(smallbody,-2) AND Ref(C,-2)&lt;Ref(C,-3)\r\n              AND Ref(C,-1)&lt;Ref(C,-2)\r\n              AND LargeBody AND whiteBody AND C&gt;Ref(O, -3) \r\n              AND C&lt;Ref(C,-4);\r\n              \r\n\r\n/*Concealing Baby Swallow only one trade */\r\nConcealingBabySwallow=Ref(marabuzu,-3) AND Ref(blackbody,-3) AND\r\n                      Ref(MArabuzu,-2) AND Ref(blackBody,-2) AND\r\n                      Ref(blackBody,-1) AND Ref(downGap,-1) AND \r\n                      Ref(H,-1)&gt;Ref(C,-2)AND Ref(blackbody,-1)AND \r\n                      blackBody AND engulfing;\r\n                      \r\n\r\n/*Doji Star Bullish*/\r\ndojiStarBullish=(dojiStar AND (MLT OR MLY))OR \r\n   (doji AND (C&lt;Ref(C,-1) OR O&lt;Ref(C,-1))AND Ref(blackBody,-1)\r\n    AND Ref(LargeBody,-1));\r\n    \r\n    \r\n/* Homing Pigeon*/\r\nhomingPigeon =  Ref(largeBody,-1) AND Ref(blackBody,-1) AND\r\n                H&lt;= Ref ( O, -1 ) AND L&gt;=Ref( C, -1) AND C&lt;O AND MLY;\r\n                    \r\n \r\n \r\n /* Stick Sandwich*/\r\nstickSandwich=Ref(largeBody,-2) AND Ref(blackbody,-2) AND \r\n              Ref(largeBody,-1) AND Ref(whiteBody,-1) AND\r\n              Ref(O,-1)&gt;=Ref(C,-2) AND O&gt;=Ref(C,-1) AND\r\n              abs(C-Ref(C,-2))&lt;=C*0.0025;\r\n \r\n\r\n\r\n\r\n\r\n/* Three Stars in the South*///Rewrite???\r\nthreeStarsInTheSouth=\r\n   Ref(LargeBody,-2) AND Ref(blackBody,-2) AND Ref(largelowerShadow,-2)\r\n   AND Ref(blackBody,-1) AND Ref(largeLowerShadow,-1) AND \r\n   Ref(L,-1)&gt;Ref(L,-2) AND blackBody AND smallUpperShadow AND\r\n   smallLowerShadow AND L&gt;Ref(L,-1) AND H&lt;Ref(H,-1);\r\n   \r\n   \r\n\r\n/* Three River Bottom Bad formula*/\r\nthreeriverBottom=Ref(largeBody,-2) AND Ref(blackBody,-2) AND\r\n                 Ref(blackbody,-1) AND Ref(Largelowershadow,-1) AND\r\n                 Ref(O,-1)&lt;Ref(O,-2) AND Ref(C,-1)&gt;Ref(C,-2) AND\r\n                 whiteBody AND C&lt;Ref(C,-1) AND MLY;  \r\n                 \r\n                 \r\n/* Mat Hold Bullish*/\r\nMAtHoldBullish=Ref(LargeBody,-4) AND Ref(whiteBody,-4)//1st day\r\n   AND Ref(blackBody,-3) AND Ref(upGap,-3) AND NOT Ref(LargeBody,-3)\r\n   AND NOT Ref(LargeBody,-2) AND Ref(C,-2)&lt;Ref(C,-3) AND Ref (O,-2)&lt;Ref(O,-3) AND \r\n   Ref(C,-2)&gt;Ref(O,-4) AND NOT Ref(LargeBody,-1) AND Ref(C,-1)&lt;Ref(C,-2)\r\n   AND LargeBody AND whiteBody AND C&gt;Ref(C,-4); \r\n                    \r\n                    \r\n   \r\n\r\n/*RisingThreeMethods*/\r\nrisingThreeMethods=Ref(LargeBody,-4) AND Ref(whiteBody,-4) AND NOT\r\n  Ref(LargeBody,-3) AND NOT Ref(LargeBody,-2)AND NOT Ref(LargeBody,-1) AND\r\n  Ref(C,-3)&lt;Ref(C,-4) AND Ref(C,-2)&lt;Ref(C,-3) AND Ref(C,-1)&lt;Ref(C,-2) AND\r\n  LargeBody AND whitebody AND C&gt;Ref(C,-4);\r\n  \r\n  \r\n/*Side by Side White Lines*/\r\nsideBySideWhiteLines=NOT Ref(smallBody,-2) AND Ref(whiteBody,-2) \r\n   AND Ref(upGap,-1) AND Ref(whitebody,-1)AND whiteBody AND\r\n   identicalBodies AND abs(O-Ref(O,-1))&lt;O*0.0025;\r\n   \r\n\r\n/*Upside Gap Three Methods not very good*/\r\nupsideGapThreeMethods=Ref(Largebody,-2) AND Ref(whiteBody,-2) AND\r\n   Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND Ref(upGap,-1) AND\r\n   blackBody AND O&gt;Ref(O,-1) AND C&lt;Ref(C,-2)AND C&gt;Ref(O,-2) AND \r\n  MHY;\r\n   \r\n   \r\n/*Three Line Strike not good signals*/\r\nthreeLineStrike=NOT Ref(smallBody,-3) AND NOT Ref(smallBody,-2) AND \r\n   NOT Ref(smallBody,-1) AND Ref(whiteBody,-3) AND Ref(whiteBody,-2) AND\r\n   Ref(whiteBody,-1) AND Ref(C,-1)&gt;Ref(C,-2) AND Ref(C,-2)&gt;Ref(C,-3) AND\r\n   blackBody AND O&gt;Ref(C,-1) AND C&lt;Ref(O,-3);\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n//***************************************************************\r\n// Morning Star\r\nMorningStar = (Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2))\r\nOR \r\n\r\n/* Morning Star*/\r\n(Ref(largeBody,-2) AND Ref(blackBody,-2)//Large black candle \r\nAND Ref(downGap,-1)//Gap down yesterday\r\nAND whiteBody AND LargeBody AND C&gt;Ref(C,-2)//Large white candle today\r\nAND MLY); //Yesterday was the low\r\n\r\n//A large black candlestick followed by a small real body of either colour,\r\n //that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n// higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n\r\n\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = (Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2))\r\nOR (IIf(Ref(Blackbody, -2) AND Ref(Doji, -1) AND whitebody AND C&gt;=Ref(((H+L)/2),-2), 1,0))\r\nOR (Ref(LargeBody,-2) AND Ref(blackBody,-2) AND\r\n                 Ref(doji,-1) AND Ref(O,-1)&lt;Ref(C,-2) AND\r\n                 whiteBody AND C&gt;Ref(C,-2) AND MLY);\r\n\r\n\r\n\r\n\r\n\r\n\r\n//A large black candlestick followed by a doji that gaps below its real body, with a third\r\n// white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n //downtrend.\r\n\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND Ref(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND Ref(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND  Ref(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND Ref(isrising, -4);\r\n\r\n//A strong white candle in a rising window, followed by three \r\n// candles that fall within the high/low range of the strong white candle, followed\r\n //by another strong white candle that closes above the close of the first white candle. \r\n //This is confirmation of the Bullish trend."\r\n\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = (morningdojistar AND Ref(GapDown(),-1) AND GapUp())\r\nOR (Ref(largeBody,-2) AND Ref(blackBody,-2)//Large black candle\r\n             AND Ref(GapDown(),-1)  \r\n             AND whiteBody AND LargeBody AND GapUp());//Large white candle\r\n\r\n\r\n             \r\n\r\n//A morning doji star where there is a gap between the lower shadow of the doji and\r\n//the prior and next candle.\r\n\r\n// Bullish Belt Hold\r\nBullishBeltHold = (belthold AND whitebody AND Ref(downtrend,-1))\r\nOR (largeBody AND smallLowerShadow AND whiteBody AND MLT);\r\n\r\n\r\n\r\n//A large white candle with no upper or lower shadow preceeded by a downtrend.\r\n\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n\r\n//A large black candle followed by a white candle which opens sharply lower but closes at the \r\n//prior white candles close. Must be preceeded by a downtrend\r\n\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = (doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1))\r\nOR (harami AND Ref(LargeBody,-1) AND Ref(blackBody,-1) AND doji); \r\n\r\n\r\n\r\n\r\n//A doji preceded by and contained within the real body of a big \r\n//black candlestick in a downtrend.\r\n\r\n\r\n// Bullish Harami\r\nBullishHarami = (Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1))\r\nOR (harami AND Ref (LargeBody,-1) AND Ref(blackBody,-1) AND\r\n                NOT LargeBody AND whiteBody);\r\n\r\n\r\n\r\n//A small candlestick, preceded by, and whose body is contained within a big black \r\n//candlestick in a downtrend\r\n\r\n\r\n /*Three Inside Up harami confirming*/\r\nthreeInsideUp =Ref(BullishHarami,-1) AND whiteBody AND \r\n    largeBody AND C&gt;Ref(C,-1);\r\n    \r\n    \r\n    \r\n// Bullish Separating Line\r\nBullishSeparatingLine = (Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1))\r\n\r\nOR /* Seperating Lines Bullish - separatingLinesBullish*/\r\n(Ref(blackBody,-1) AND whiteBody AND LargeBody AND\r\nsmallLowerShadow AND MHT AND abs(O-Ref(O,-1))&lt;=O*0.0025);\r\n\r\n\r\n/* Meeting LinesBullish -  */\r\nmeetingLinesbullish= (Ref(LargeBody,-1) AND Ref(blackBody,-1) AND\r\n                     LargeBody AND whiteBody AND\r\n                     C&gt;Ref(C,-1)*0.9975 AND C&lt; Ref(C,-1)*1.0025);\r\n                     \r\n                     \r\n\r\n\r\n\r\n\r\n\r\n//A black candlestick followed by a white candlestick with the same opening price. Continues\r\n //the previous uptrend.\r\n\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = (longleggeddoji AND H==C AND Ref(downtrend,-1))\r\nOR (smallBody AND LargeLowerShadow AND smallUpperShadow AND MLT);\r\n\r\n//A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.\r\n\r\n\r\n\r\n\r\n// Engulfing Bull\r\nEngulfingBull = (Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1))\r\nOR (IIf(Whitebody AND Ref(Blackbody, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0))\r\nOR CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5)\r\nOR (engulfing AND largeBody AND whiteBody AND \r\n    (Ref(blackbody,-1) OR Ref(Doji,-1)) AND MLT);\r\n    \r\n    \r\n    \r\n /* Three Outside Up Engulfing confirmation*/\r\nthreeOutsideUp =Ref(EngulfingBull,-1) AND whiteBody AND C&gt;Ref(C,-1);\r\n\r\n    \r\n    \r\n\r\n//This bar is white and its real body engulfs the previous bars black real body. Must be\r\n//preceeded by a downtrend.\r\n\r\n\r\n/*Hammer Bullish*/\r\nhammerBullish=Hammer AND (MLT OR MLY);\r\n\r\n\r\n\r\n\r\n\r\n\r\n//An upside down Hammer that appears after a downtrend\r\n\r\n\r\n//Piercing Line\r\nPiercingLine = (Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1))\r\nOR (IIf(Ref(Blackbody, -1) AND Whitebody AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0))\r\nOR \r\n\r\n /* Piercing Line*/\r\n(Ref(largeBody,-1) AND Ref(blackBody,-1)AND\r\nO&lt;Ref(L,-1) AND C&gt;=(Ref(O,-1)+Ref(C,-1))/2 AND C&lt;Ref(O,-1) AND MLT);\r\n\r\n\r\n//A stong black candle followed by a white candle that opens below the low of\r\n//the prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\n//white candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n\r\n//a black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = ((whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2))\r\nor\r\n/*Three White Soldiers-threeWhiteSoldiers*/\r\n(NOT Ref(smallbody,-2) AND Ref(whiteBody,-2) AND NOT\r\n   Ref(smallBody,-1) AND Ref(whiteBody,-1) AND NOT\r\n   smallBody AND whiteBody AND C&gt;Ref(C,-1) AND Ref(C,-1)&gt;Ref(C,-2) AND\r\n   Ref(O,-1)&gt;Ref(O,-2) AND Ref(O,-1)&lt;Ref(C,-2) AND O&lt;Ref(C,-1) AND\r\n   O&gt;Ref(O,-1) AND Ref(smallUpperShadow,-2) AND\r\n   Ref(smallUpperShadow,-1) AND smallUppershadow AND LLV(L,12)==Ref(L,-2));\r\n   \r\n   \r\n\r\n//The last three candlesticks are large and white. Each opens within or higher than the \r\n //previous candles real body.\r\n\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n\r\n\r\n\r\n\r\n/* Tri-Star Bullish*/\r\ntriStarBullish=Ref(doji,-2) AND Ref(doji,-1) AND doji AND MLY AND   Ref(downgap,-1) AND upGap;\r\n   \r\n\r\n\r\n   \r\n//A doji followed by a higher doji which is followed by another doji that is lower than the\r\n//second doji. Must be preceeded by an uptrend.\r\n\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = (L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2))\r\nOR (abs(L-Ref(L,-1))&lt;=L*0.0025)\r\nOR \r\n/*Tweezer Bottom - tweezerBottom*/\r\n( (abs(L-Ref(L,-1))/L&lt;0.0025 OR\r\n               abs(L-Ref(L,-2))/L&lt;0.0025)\r\n               AND (MLT OR MLY)); \r\n\r\n\r\n// A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. //\r\n\r\n\r\n\r\n\r\n\r\n//**************************************************************\r\n//----------------------------------------\r\n// CANDELE BEARISH - GIAM GIA \r\n//----------------------------------------\r\n//**************************************************************\r\n\r\n\r\n/*Advance Block Bearish*/\r\nAdvanceBlockBearish=Ref(LargeBody,-2) AND Ref(whiteBody,-2) \r\n    AND Ref(whiteBody,-1) AND\r\n   whiteBody AND Ref(O,-1)&gt;Ref(O,-2) AND Ref(O,-1)&lt;Ref(C,-2) AND\r\n   Ref(C,-1)&gt;Ref(C,-2) AND C&gt;Ref(C,-1) AND\r\n   O&lt;Ref(C,-1) AND O&gt;Ref(O,-1) AND Ref(LargeUpperShadow,-1) AND LargeUpperShadow\r\n   AND C-O&lt;Ref(C,-1)-Ref(O,-1) AND Ref(C,-1)-Ref(O,-1) &lt; Ref(C,-2)-Ref(O,-2);\r\n   \r\n   \r\n  /*Deliberation Bearish: needs confirmation*/\r\ndeliberationBearish=Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND\r\n   Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND Ref(C,-1)&gt;Ref(C,-2) AND\r\n   smallbody AND upGap; \r\n   \r\n   \r\n\r\n\r\n   \r\n   \r\n /*Hammer Bearish*/\r\nHammerBearish=Hammer AND HHV(H,8)==H;  \r\n   \r\n/*dragonfly Doji Bearish*/\r\ndragonflyDojiBearish=doji AND smallUpperShadow AND LargeLowerShadow AND MHT;\r\n   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//Doji Star Bearish needs confirmation\r\ndojiStarBearish= (Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND doji AND upGap AND MHT)\r\n \r\n/*Doji Star Bearish-dojiStarBearish*/\r\nOR   (dojiStar AND (MHT OR MHY)) \r\nOR (doji AND (C&gt;Ref(C,-1) OR O&gt;Ref(C,-1))AND Ref(whiteBody,-1) AND Ref(LargeBody,-1));\r\n   \r\n\r\n/* Downside Gap Three Methods*/\r\ndownsideGapThreeMethods=\r\n     Ref(LargeBody,-2) AND Ref(blackBody,-2) AND Ref(downGap,-2) //first day\r\n     AND Ref(LargeBody,-1) AND Ref(blackBody,-1)//2nd day\r\n     AND whitebody AND O&lt;Ref(O,-1) AND C&gt;Ref(C,-2)\r\n     AND LLV(L,8)==Ref(L,-1);\r\n \r\n \r\n   \r\n /*Falling Three Meothods*/\r\nfallingThreeMethods=Ref(LargeBody,-4) AND Ref(blackBody,-4) AND\r\n  /*Ref(doji,-3) AND Ref(doji,-2) AND Ref(doji,-1) AND*/ Ref(C,-1)&gt;Ref(C,-2) \r\n  AND Ref(C,-2)&gt;Ref(C,-3) AND LargeBody AND blackBody AND O&gt;Ref(C,-4) AND\r\n  O&lt;Ref(O,-4) AND C&lt;Ref(O,-4)AND C&lt;Ref(C,-4);\r\n  \r\n  \r\n  \r\n/*In Neck Bearish not good*/\r\ninNeckBearish=Ref(LargeBody,-1) AND Ref(blackBody,-1) AND\r\n   whiteBody AND O&lt;Ref(L,-1) AND C&lt;Ref(C,-1)*1.0005 AND C&gt;=Ref(C,-1);\r\n   \r\n/*On Neck Bearish not good*/\r\nOnNeckBearish=Ref(LargeBody,-1) AND Ref(blackBody,-1) AND\r\n   whiteBody AND O&lt;Ref(L,-1) AND C&lt;Ref(L,-1)*1.0025 AND C&gt;=Ref(L,-1)*0.9975;\r\n   \r\n   \r\n/*Side By Side White Lines Bearish*/\r\nsideBySideWhiteLinesBearish=NOT Ref(smallBody,-2) AND Ref(blackBody,-2) AND  \r\n   Ref(whiteBody,-1) AND whiteBody AND Ref(downGap,-1) AND identicalBodies\r\n  AND abs(C-Ref(C,-1)&lt;C*0.0025);\r\n   \r\n\r\n\r\n/*Thrusting Bearish*/\r\nthrustingBearish=Ref(blackBody,-1) AND Ref(LargeBody,-1) AND LargeBody AND\r\n   whitebody AND O&lt;Ref(L,-1) AND C&lt;(Ref(O,-1)+Ref(C,-1))/2 AND C&gt;Ref(C,-1);\r\n    \r\n //***************************************************************  \r\n  \r\n\r\n// Kicker Bearish\r\nBearishKicker = (Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(L,-1) AND C &lt; O AND H &lt; Ref(L,-1)) \r\nOR (Ref(O,-1) &lt; Ref(C,-1) AND O &lt; Ref(O,-1) AND C &lt; O)\r\nOR \r\n\r\n/*Kicking Bearish No trades-kickingBearish*/\r\n(Ref(whiteBody,-1) AND Ref(MArabuzu,-1) AND blackBody AND MArabuzu    AND GapDown());\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = (Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2))\r\nOR (IIf(Ref(WhiteBody, -2) AND Ref(Doji, -1) AND BlackBody AND C&lt;=Ref(((H+L)/2),-2), 1,0))\r\nOR \r\n\r\n\r\n/*Evening Doji Star check formula???-eveningDojiStar*/\r\n(Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND\r\n   Ref(dojiStar,-1) AND Ref(GapUp(),-1) AND (MHY OR MHT));\r\n\r\n\r\n//A large white candlestick followed by a doji that gaps up from the\r\n//previous candles real body. This is followed by a third candlestick that is black and has a\r\n//close lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n\r\n\r\n// Evening Star\r\nEveningStar = (Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2))\r\nOR \r\n/*Evening Star-eveningStar*/\r\n(Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND\r\n   Ref(upGap,-1) AND NOT Ref(largeBody,-1) AND blackBody AND NOT smallBody AND\r\n   (MHT OR MHY));\r\n\r\n\r\n\r\n\r\n//A large white candlestick followed by a small real body of either colour that gaps up from the\r\n//previous candles real body. This is followed by a third candlestick that is black and has a\r\n//close lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = (longleggeddoji AND L == C AND Ref(uptrend,-1))\r\n\r\n//A doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\nOR \r\n\r\n/*Gravestone Doji-gravestoneDoji*/\r\n(doji AND largeUpperShadow AND smallLowerShadow AND GapUp() AND MHT);\r\n\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND Ref(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND Ref(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND Ref(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND Ref(isfalling, -4);\r\n//A strong black candle in a falling window, followed by three\r\n //candles that fall within the high/low range of the strong black candle, followed\r\n //by another strong black candle that closes below the close of the first black candle. \r\n// This is a bearish confirmation.\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = (EveningDojiStar AND Ref(GapUp(),-1) AND GapDown())\r\nOR \r\n\r\n/*Abandoned Baby Bearish-AbandonedBabyBearish*/\r\n(Ref(LargeBody,-2) AND Ref(whiteBody,-2) AND\r\n   Ref(smallBody,-1) AND Ref(GapUp(),-1) AND GapDown() AND \r\n   NOT smallBody AND blackBody AND MHY);\r\n   \r\n\r\n// evening doji star where there is a gap between the lower shadow of the doji and\r\n//the upper shadows of the prior and next candle.\r\n\r\n\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = (belthold AND blackbody AND Ref(uptrend,-1))\r\nOR \r\n/*Belt Hold Bearish-beltHoldBearish*/\r\n(LargeBody AND BlackBody AND smalluppershadow AND MHT);\r\n\r\n\r\n\r\n\r\n/*Breakaway Bearish*/\r\nbreakAwayBearish=Ref(LargeBody,-4) AND Ref(whiteBody,-4) AND\r\n   Ref(GapUp(),-3) AND Ref(whiteBody,-3) AND \r\n   Ref(smallbody,-2) AND Ref(smallBody,-1) AND\r\n   blackBody AND O&gt;Ref(O,-3) AND C&lt;Ref(C,-4);\r\n   \r\n   \r\n\r\n//A large black candle with a shaven head and bottom preceeded by an uptrend.\r\n\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = (Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1))\r\nOR \r\n/*CounterAttackBearish-CounterAttackBearish*/\r\n(MHT AND LargeBody AND blackbody AND\r\n   Ref(largeBody,-1) AND Ref(whiteBody,-1) AND\r\n   C&lt;Ref(C,-1)*1.0025 AND C&gt;Ref(C,-1)*0.9975);\r\n   \r\n\r\n//A large white candle followed by a black candle which opens sharply higher but closes\r\n//at the prior black candles close. Must be preceeded by an uptrend.\r\n\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = (doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1))\r\nOR \r\n\r\n/*HaramiCross Bearish-HaramiCrossBearish*/\r\n(harami AND doji AND Ref(whiteBody,-1) AND Ref(Largebody,-1));\r\n\r\n//A doji preceded by and contained within the real body of a big white \r\n//candlestick in an uptrend\r\n\r\n\r\n\r\n// Bearish Harami\r\nBearishHarami = (Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1))\r\nOR \r\n/*Harami Bearish-HaramiBearish*/\r\n(harami AND Ref(Largebody,-1) AND Ref(whiteBody,-1)AND blackBody \r\nAND (MHY OR MHT));\r\n\r\n//A small candlestick preceded by and whose real body is contained \r\n//within, the real body of a big white candlestick in an uptrend\r\n\r\n\r\n\r\n/*Three Inside Down Bearish*/\r\nthreeInsideDownBearish=Ref(BearishHarami,-1) AND blackBody AND C&lt;Ref(C,-1)AND    smallUpperShadow;\r\n\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = (Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1))\r\nOR \r\n/*separating Lines Bearish-separatingLinesBearish*/\r\n(Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND\r\n   blackBody AND O&gt;Ref(O,-1)*0.9975 AND O&lt;=Ref(O,-1)*1.0025);\r\n\r\n\r\n/*Meeting Lines Bearish*/\r\nMeetingLinesBearish=Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND\r\n  HHV(C,8)==Ref(C,-1) AND LargeBody AND blackBody AND \r\n  abs(C-Ref(C,-1))&lt;C*0.0025;\r\n  \r\n  \r\n\r\n//A white candlestick followed by a black candlestick with the same opening price. Continues\r\n //the previous downtrend.\r\n\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = (Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1))\r\nOR (IIf(Ref(whitebody, -1) AND BlackBody AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0))\r\nOR \r\n/*Dark Cloud Cover-darkCloudCover*/\r\n(Ref(LargeBody,-1) AND Ref(whiteBody,-1) AND\r\n   blackBody AND O&gt;Ref(H,-1) AND C&gt;Ref(O,-1) AND C&lt;(Ref(O,-1)+Ref(C,-1))/2\r\n   AND MHT);\r\n\r\n\r\n\r\n\r\n//A strong white candle in an uptrend followed by a black candle that opens above the high of the \r\n//white candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\n//engulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = (Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1))\r\nOR (IIf(BlackBody AND Ref(whitebody, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0))\r\nOR CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5)\r\nOR \r\n/*Engulfing Bearish-engulfingBearish*/\r\n(engulfing AND largeBody AND blackBody AND \r\n    (Ref(whitebody,-1) OR Ref(Doji,-1))AND (MHT OR MHY));\r\n\r\n\r\n\r\n//This bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\n//an uptrend.\r\n\r\n\r\n\r\n\r\n/*Three Outside Down Bearish*/\r\nthreeoutsideDownBearish=Ref(EngulfingBear,-1) AND blackBody AND C&lt;Ref(C,-1)AND\r\n   NOT LargeUpperShadow;\r\n\r\n\r\n\r\n\r\n\r\n//Hamging Man\r\nHangingMan = (umbrellaline AND uptrend AND Ref(uptrend,-1))\r\nOR \r\n/*hangingMan-HangingMan*/\r\n(NOT largeBody AND smallUpperShadow AND LargeLowerShadow AND MHT);\r\n\r\n//The same as a hammer except must be preceeded by an uptrend.\r\n\r\n\r\n\r\n   \r\n   \r\n     //Shooting Star\r\nshootingStar=(NOT largeBody AND smallLowerShadow AND LargeUpperShadow) \r\nOR (   smallLowerShadow AND NOT doji AND    ((blackBody AND abs(O-H)&gt;2*realBodySize) OR   (whiteBody AND abs(H-C)&gt;2*realBodySize)))\r\nOR (smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1));\r\n   \r\n   \r\n   \r\n   /*ShootingStarGap*/\r\nshootingStarGap=shootingStar AND GapUp() AND MHT;\r\n\r\n\r\n\r\n\r\n  //Inverted Hammer\r\nInvertedHammer = (smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1))\r\nOR (shootingStar AND (MLT OR MLY));\r\n\r\n  \r\n   \r\n//A small body that closes near the bottom of its range and \r\n//has a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\n//pattern occurs only after an uptrend.\r\n\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = ((big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4))\r\n\r\nOR \r\n   /*Three Black Crows-threeBlackCrows*/\r\n(Ref(blackBody,-2) AND Ref(blackBody,-1) AND blackBody  AND Ref(C,-1)&lt;Ref(C,-2) AND C&lt;Ref(C,-1) AND HHV(H,8)==Ref(H,-2) AND NOT Ref(doji,-2) AND NOT Ref(doji,-1) AND NOT doji);\r\n   \r\n   \r\n   \r\n /*Three Line Strike no trades*/\r\nthreeLineStrike=threeBlackCrows AND whiteBody AND O&lt;Ref(C,-1) AND C&gt;Ref(O,-3);  \r\n\r\n\r\n/*Identical three black crows-idendicalThreeBlackCrows*/\r\nidendicalThreeBlackCrows = (Ref(blackBody,-2) AND Ref(blackBody,-1) AND blackBody AND\r\n   abs(Ref(C,-2)-Ref(O,-1))&lt;Ref(C,-1)*0.0025 AND abs(Ref(C,-1)-O)&lt;O*0.0025 AND\r\n   HHV(H,20)==Ref(H,-2) AND NOT Ref(doji,-2) AND NOT Ref(doji,-1) AND NOT doji AND\r\n   Ref(smallLowerShadow,-2) AND Ref(smallLowerShadow,-1) AND smallLowerShadow);\r\n   \r\n\r\n   \r\n\r\n//The last three candlesticks are large and black. Each opens within or lower than the \r\n //previous candles real body.Must be preceeded by an uptrend.\r\n\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n\r\n   \r\n   \r\n/*Tri Star Bearish*/\r\ntriStarBearish=Ref(doji,-2) AND Ref(doji,-1) AND doji AND MHY AND Ref(upGap,-1)AND    downGap;\r\n\r\n//A doji followed by a lower doji which is followed by another doji that is higher than the\r\n//second doji. Must be preceeded by a downtrend.\r\n\r\n\r\n//Tweezer Tops\r\nTweezerTops = (H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2))\r\nOR (abs(H-Ref(H,-1))&lt;=H*0.0025)\r\n\r\nOR \r\n/*Tweezer Top-tweezerTop*/\r\n((abs(H-Ref(H,-1))/H&lt;0.0025 OR\r\n               abs(H-Ref(H,-2))/H&lt;0.0025)\r\n               AND (MHT OR MHY)); \r\n\r\n\r\n\r\n\r\n// A large candle followed by a candle with the same high. Must be preceeded by an uptrend.\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = (Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2))\r\n// A strong white candle followed by a small black candle which gaps above the previous \r\n//candles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. \r\n\r\nOR \r\n/*Upside Gap Two Crows-upsideGapTwoCrows*/\r\n( Ref(whiteBody,-2) AND Ref(LargeBody,-2)// first day\r\n   AND Ref(upGap,-1) AND Ref(blackBody,-1) // 2nd day\r\n   AND blackbody AND O&gt;Ref(O,-1) AND C&lt;Ref(C,-1) AND C&gt;Ref(C,-2));\r\n   \r\n\r\n/*Two Crows Bearish*/\r\ntwoCrows=Ref(whiteBody,-2) AND Ref(LargeBody,-2) //first day\r\n   AND Ref(blackBody,-1) AND Ref(upGap,-1)//Second Day\r\n   AND blackBody AND O&lt;Ref(O,-1) AND O&gt;Ref(C,-1)AND C&lt;Ref(C,-2) AND \r\n   C&gt;Ref(O,-2) AND MHY;//Third day\r\n\r\n\r\n\r\n\r\n\r\n\r\n//*****************************************************************************\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = (isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize)\r\n// A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. //\r\n\r\nOR \r\n/*Downside Tasuki Gap-downsideTasukiGap*/\r\n(Ref(blackBody,-2)//first day\r\n   AND Ref(blackbody,-1) AND Ref(downgap,-1) //2nd day\r\n   AND whiteBody AND O&lt;Ref(O,-1) AND O&gt;Ref(C,-1) AND C&gt;Ref(O,-1) AND C&lt;Ref(C,-2)\r\n   AND Ref(identicalBodies,-1)                                                                                                                   \r\n   AND LLV(L,15)==Ref(L,-1));\r\n   \r\n   \r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = (isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize)\r\n// A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; //\r\n\r\nOR \r\n/*Upside Tasuki Gap-upsideTasukiGap*/\r\n(Ref(largeBody,-2) AND Ref(largeBody,1) AND\r\n   Ref(whiteBody,-2) AND Ref(whiteBody,-1) AND Ref(upGap,-1) AND\r\n   blackBody AND O&gt;Ref(O,-1) AND C&lt;Ref(O,-1) AND C&gt;Ref(C,-2) AND\r\n   identicalBodies AND O&lt;Ref(C,-1));\r\n   //AND HHV(H,5)==Ref(H,-1); Do not use this line\r\n   \r\n   \r\n   \r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************\r\n//Tong hop cac tin hieu Nen Nhat\r\n\r\n//Phan loai theo Bull Bear Continuation\r\n\r\n//----------------------------------------\r\n// CANDELE BULLISH  - TANG GIA\r\n//----------------------------------------\r\nBullishJapaneseCandle =\r\nBullishKicker\r\nOR breakAwayBullish\r\nOR ConcealingBabySwallow\r\nOR dojiStarBullish\r\nOR homingPigeon\r\nOR stickSandwich\r\nOR threeInsideUp\r\nOR threeOutsideUp\r\nOR threeStarsInTheSouth\r\nOR threeriverBottom\r\nOR MAtHoldBullish\r\nOR risingThreeMethods\r\nOR sideBySideWhiteLines\r\nOR upsideGapThreeMethods\r\nOR threeLineStrike\r\nOR MorningStar\r\nOR MorningDojiStar\r\nOR Bull3Formation\r\nOR BullishAbandonedBaby\r\nOR BullishBeltHold\r\nOR BullishCounterAttack\r\nOR BullishHaramiCross\r\nOR BullishHarami\r\nOR BullishSeparatingLine\r\nOR meetingLinesbullish\r\nOR DragonflyDoji\r\nOR EngulfingBull\r\nOR hammerBullish\r\nOR InvertedHammer\r\nOR PiercingLine\r\nOR SeperatingLines\r\nOR ThreeWhiteSoldiers\r\nOR TriStarBottom\r\nOR triStarBullish\r\nOR TweezerBottoms;\r\n\r\n\r\n//----------------------------------------\r\n// CANDELE BEARISH - GIAM GIA \r\n//----------------------------------------\r\nBearishJapaneseCandle =\r\nAdvanceBlockBearish\r\nOR deliberationBearish\r\nOR dojiStarBearish\r\nOR HammerBearish\r\nOR dragonflyDojiBearish\r\nOR threeInsideDownBearish\r\nOR threeoutsideDownBearish\r\nOR downsideGapThreeMethods\r\nOR fallingThreeMethods\r\nOR inNeckBearish\r\nOR OnNeckBearish\r\nOR sideBySideWhiteLinesBearish\r\nOR threeLineStrike\r\nOR thrustingBearish\r\nOR BearishKicker\r\nOR EveningDojiStar\r\nOR EveningStar\r\nOR GraveStoneDoji\r\nOR Bear3Formation\r\nOR BearishAbandonedBaby\r\nOR BearishBeltHold\r\nOR breakAwayBearish\r\nOR BearishCounterAttack\r\nOR BearishHaramiCross\r\nOR BearishHarami\r\nOR BearishSeparatingLine\r\nOR MeetingLinesBearish\r\nOR DarkCloudCover\r\nOR EngulfingBear\r\nOR HangingMan\r\nOR ShootingStar\r\nOR shootingStarGap\r\nOR ThreeBlackCrows\r\nOR idendicalThreeBlackCrows\r\nOR TriStarTop\r\nOR triStarBearish\r\nOR TweezerTops\r\nOR UpsideGapTwoCrows\r\nOR twoCrows;\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\nContinuationJapaneseCandle =\r\nDownwardGappingTasuki\r\nOR UpwardGappingTasuki\r\nOR InvertedBlackHammer;\r\n\r\n//****************************************************\r\n\r\n//Phan loai theo Buy Sell Cover Short\r\n//*************************************************\r\n//Buy\r\n//**************************************************\r\nBuyJapaneseCandle=\r\nBullishAbandonedBaby OR\r\nConcealingBabySwallow OR \r\nMorningDojiStar OR\r\nMorningStar OR\r\nthreeInsideUp OR\r\nthreeOutsideUp OR\r\nMAtHoldBullish OR\r\nrisingThreeMethods OR\r\nsideBySideWhiteLines OR\r\nThreeWhiteSoldiers;\r\n\r\n//************************************\r\n//Sell\r\n//*************************************\r\nSellJapaneseCandle=\r\nBearishAbandonedBaby OR\r\nDarkCloudCover OR\r\nEveningDojiStar OR\r\nEveningStar OR\r\nidendicalThreeBlackCrows OR\r\nBearishKicker OR\r\nthreeInsideDownBearish OR\r\nthreeoutsideDownBearish OR\r\nupsideGapTwoCrows OR\r\nfallingThreeMethods OR\r\nThreeBlackCrows;\r\n\r\n//***********************************************\r\n//Cover\r\n//*************************************************\r\nCoverJapaneseCandle=\r\nBullishKicker OR \r\nBullishBeltHold OR\r\nbreakAwayBullish OR\r\ndojiStarBullish OR\r\nEngulfingBull OR\r\nhammerBullish OR\r\nDragonflyDoji OR\r\nBullishHarami OR\r\nBullishHaramiCross OR\r\nhomingPigeon OR\r\ninvertedHammer OR\r\nmeetingLinesbullish OR\r\nPiercingLine OR\r\nstickSandwich OR\r\nthreeStarsInTheSouth OR   \r\ntriStarBullish OR\r\nTriStarBottom OR \r\nthreeriverBottom OR\r\nBullishSeparatingLine OR\r\nupsideGapThreeMethods OR\r\nthreeLineStrike OR\r\nTweezerBottoms OR\r\nUpwardGappingTasuki OR\r\nBull3Formation OR \r\nBullishCounterAttack OR\r\nSeperatingLines ;\r\n\r\n//************************************\r\n//Short\r\n//************************************\r\nShortJapaneseCandle=\r\nadvanceBlockBearish OR\r\nBearishBeltHold OR\r\nbreakAwayBearish OR\r\nHangingMan OR\r\ndeliberationBearish OR\r\nBearishCounterAttack OR\r\nEngulfingBear OR\r\nHammerBearish OR\r\ndragonflyDojiBearish OR\r\nBearishHarami OR\r\nBearishHaramiCross OR\r\nMeetingLinesBearish OR\r\nShootingStar OR \r\nshootingStarGap OR\r\nGraveStoneDoji OR\r\ntriStarBearish OR\r\ntwoCrows OR\r\ndojiStarBearish OR\r\ndownsideGapThreeMethods OR\r\nDownwardGappingTasuki OR\r\ninNeckBearish OR\r\nOnNeckBearish OR\r\nBearishSeparatingLine OR\r\nsideBySideWhiteLinesBearish OR\r\nthreeLineStrike OR\r\nthrustingBearish OR\r\nTweezerTops OR\r\nBear3Formation OR\r\nTriStarTop OR \r\nInvertedBlackHammer;\r\n\r\n//************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n//************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n_SECTION_BEGIN(" - TITLE - TIEU DE");\r\n\r\nTitle = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() ;\r\n        \r\n       \r\n        \r\n //************************************************************************************************************\r\n\r\nif (ParamToggle( "* - Hien thi Cac thanh xu huong duoi man hinh",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n//   Thanh xac dinh xu huong Ichimoku\r\n//==========================================================================|\r\n\r\n// Ve xu huong Ichimoku - Thanh xu huong cuoi man hinh\r\n\r\nif (ParamToggle("* - Ichimoku Kinko Hyo Trend - Xu huong Ichimoku","OFF|ON" , 1 ))\r\n{\r\n// Hien thi xu huong Ichimoku - Thanh xu huong cuoi man hinh\r\nPlot( 0.9,"Ichimoku Trend",XuhuongichimokuColor, styleArea | styleOwnScale | styleNoLabel |styleNoRescale, 0, 100, 0, 1, 2);\r\nPlot( 1.1,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);\r\n\r\n}\r\n\r\n// Ve EMAStrength Band - Thanh xu huong cuoi man hinh\r\n//=================================================\r\n\r\n\r\nif (ParamToggle("* - Strength EMA Band - Thanh xu huong EMA","OFF|ON" , 1 ))\r\n{\r\n// Hien thi EMAStrength Band - Thanh xu huong cuoi man hinh\r\nPlot( 2.2,"EMAStrength",EMAStrengthColor,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);\r\nPlot( 2.4,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);\r\n\r\n}\r\n\r\n\r\n// Ve Strength Band - Thanh xu huong cuoi man hinh\r\n//=================================================\r\n\r\nif (ParamToggle("* - Strength RSI Band - Thanh Suc manh RSI","OFF|ON" , 1))\r\n{\r\n// Hien thi Strength Band - Thanh xu huong cuoi man hinh\r\nPlot( 3.4,"RStrengthRSI",RSIStrengthColor,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);\r\nPlot( 3.6,"",colorBlack,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);\r\n\r\n}\r\n\r\n\r\n// Ve Alexander Elder Impulse Band - Thanh xu huong cuoi man hinh\r\n//===============================================================\r\n\r\nif (ParamToggle("* - Alexander Elder Impulse Band - MACD","OFF|ON" , 1 ))\r\n{\r\n// Hien thi Alexander Elder Impulse Band - Thanh xu huong cuoi man hinh\r\nPlot( 4.6,"MADC Trend",MACDStrengthColor,styleOwnScale|styleArea|styleNoLabel|styleNoRescale, 0, 100, 0, 1, 2);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n       \r\n\r\n//**********************************************\r\n//Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n//**********************************************\r\n\r\n\r\n\r\n\r\nif (ParamToggle( "* - Hien thi Tin hieu Nen Nhat",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n//Hien dau hieu\r\n//**********************\r\n//Doji\r\nPlotShapes(Doji*shapeSmallCircle,colorYellow,0,H,Offset=25); \r\n//Nen Bua\r\nPlotShapes(Hammer*shapeHollowSmallSquare,colorLime,0,L,Offset=-25); \r\n//Nen nhan chim Giam\r\nPlotShapes(EngulfingBear*shapeSmallDownTriangle,colorRed,0,H,Offset=-25); \r\n//Nen nhan chim Tang\r\nPlotShapes(EngulfingBull*shapeSmallUpTriangle,colorLime,0,L,Offset=-25); \r\n//Nen tang gia Manh\r\nPlotShapes( IIf( BullishKicker , shapeHollowUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -25 );\r\n//May den bao phu\r\nPlotShapes( IIf( DarkCloudCover, shapeDownTriangle, shapeNone ), colorRed, 0, H, Offset = -25 );\r\n//Nen xuyen thau\r\nPlotShapes( IIf( PiercingLine, shapeUpArrow, shapeNone ), colorBrightGreen, 0, L, Offset = -25 );\r\n//Ngoi sao ban chieu\r\nPlotShapes( IIf( EveningDojiStar, shapeDownArrow, shapeNone ), colorRed, 0, H, Offset = -25 );\r\n//Ngoi sao buoi sang\r\nPlotShapes( IIf( MorningDojiStar, shapeUpArrow, shapeNone ), colorBlue, 0, L, Offset = -25 );\r\n\r\n//Hien chu\r\n//***********************\r\nfor(i=0;i&lt;BarCount-1;i++) \r\n{\r\n\tif(Doji[i]==True)PlotText("Doji", i, H[i], colorYellow, bkcolor = colorDefault, Offset = 40); \r\n\tif(Hammer[i]==True)PlotText("Hammer", i, L[i], colorLime, bkcolor = colorDefault, Offset = -45); \r\n\tif(EngulfingBear[i]==True)PlotText("BearishEngulfing", i, H[i], colorRed, bkcolor = colorDefault, Offset = 80); \r\n\tif(EngulfingBull[i]==True)PlotText("BullishEngulfing", i, L[i], colorLime, bkcolor = colorDefault, Offset = -80); \r\n\tif(BullishKicker[i]==True)PlotText("BullishKicker", i, L[i], colorSeaGreen, bkcolor = colorDefault, Offset = -45); \r\n\tif(DarkCloudCover[i]==True)PlotText("Dark Cloud Cover", i, H[i], colorRed, bkcolor = colorDefault, Offset = 45); \r\n\tif(PiercingLine[i]==True)PlotText("Piercing Line", i, L[i], colorBrightGreen, bkcolor = colorDefault,  Offset = -45); \r\n\tif(EveningDojiStar[i]==True)PlotText("Evening Doji Star", i, H[i], colorRed, bkcolor = colorDefault, Offset = 45); \r\n\tif(MorningDojiStar[i]==True)PlotText("Morning Doji Star", i, L[i], colorBlue, bkcolor = colorDefault, Offset = -45); \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n\r\n//************************************************************************************************************\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n \r\nif (vsasignal = ParamToggle( "* - Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n//*********Phan nay khong quan trong********************\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n\r\n//************************************************************************************************************\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "* - Hien thi TITLE - TIEU DE",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE 1                                    |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n//Volume\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\n\r\n//***************************************************\r\n//Thay doi mau sac theo Volume\r\nEncodeColor(colorBlue) + "   - Total Volume: "+ \r\n\r\nWriteIf(V&gt;=maVolume*1.6,                     EncodeColor(colorViolet)+    WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,\r\nWriteIf(V&lt;maVolume*1.6 AND V&gt;=maVolume*1.1 ,EncodeColor(colorLime)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",\r\nWriteIf(V&lt;maVolume*1.1 AND V&gt;=maVolume*0.9,EncodeColor(colorGold)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",\r\nWriteIf(V&lt;maVolume*0.9 AND V&gt;=maVolume*0.5, EncodeColor(colorRed)+       WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,\r\nWriteIf(V&lt;maVolume*0.5,                      EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ","")))))+\r\n\r\n//MA30 Volume\r\nEncodeColor(colorBlue)+ "MA30: " + EncodeColor(colorYellow) + WriteVal(maVolume,1.0)+\r\n\r\n//Danh gia Volume\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;=maVolume*1.6,                        EncodeColor(colorViolet)+   " SIEU CAO",\r\nWriteIf(V&lt;maVolume*1.6  AND V&gt;=maVolume*1.1,   EncodeColor(colorLime)+     " CAO",\r\nWriteIf(V&lt;maVolume*1.1 AND V&gt;=maVolume*0.9,   EncodeColor(colorGold)+     " TRUNG BINH",\r\nWriteIf(V&lt;maVolume*0.9 AND V&gt;=maVolume*0.5,    EncodeColor(colorRed)+      " THAP",\r\nWriteIf(V&lt;maVolume*0.5,                         EncodeColor(colorTurquoise)+" SIEU THAP","")))))+\r\n\r\n//Buy or Sell Volume\r\n"\\n" +\r\nEncodeColor(colorBlue)+   "   - Buy Vol: "+ EncodeColor(colorYellow)+WriteVal(BuyVolume,1.0)+ EncodeColor(colorSeaGreen)+ "   (= "+ WriteVal(BuyVolumep,1.0)+"%" +  " Total"\r\n+")   "+\r\nEncodeColor(colorRed)+   " -   Sell Vol: "+EncodeColor(colorYellow)+WriteVal(SellVolume,1.0)+ EncodeColor(colorSeaGreen)+"   (= "+ WriteVal(SellVolumep,1.0)+"%" +  " Total"\r\n+")   "+\r\nEncodeColor(colorLime)+  " -   Net Vol: "+EncodeColor(colorYellow)+WriteVal(BuyVolume-SellVolume,1.0)+\r\n\r\n\r\n\r\n\r\n\r\n//***************************************************\r\n// Open High Low Close\r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open:    " +  EncodeColor(colorYellow) +WriteVal(O,1.2)+ \r\nEncodeColor(colorLime) + "   -   High:  " +  EncodeColor(colorYellow) +WriteVal(H,1.2)+ \r\nEncodeColor(colorRed)  + "   -   Low:  " +   EncodeColor(colorYellow) +WriteVal(L,1.2)+ \r\n\r\n//***************************************************\r\n//Thay doi mau theo gia Close\r\nEncodeColor(colorSeaGreen) + "   -   Close:  " +\r\n\r\n//Gia tran&gt;6%\r\nWriteIf(xx&gt;=6,\r\nEncodeColor(colorViolet)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Gia san&lt;6%\r\nWriteIf(xx&lt;=-6,\r\nEncodeColor(colorTurquoise) +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Tang gia\r\nWriteIf(xx&gt;0 AND xx&lt;6,\r\nEncodeColor(colorLime)   +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Giam gia\r\nWriteIf(xx&lt;0 AND xx&gt;-6,\r\nEncodeColor(colorRed)       +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Tham chieu\r\nEncodeColor(colorGold)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)"))))+\r\n\r\n//***************************************************\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Spread: ")+\r\n\r\nWriteIf(spread &gt;=avgSpread*1.5,                             EncodeColor(colorViolet)+   " RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;=avgSpread*1.1 ,   EncodeColor(colorLime)+     " TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread*1.1 AND spread &gt;= AvgSpread*0.9, EncodeColor(colorGold)+     " TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.9 AND spread &gt;= AvgSpread*0.4, EncodeColor(colorRed)+      " DUOI TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.4,                             EncodeColor(colorTurquoise)+" HEP","")))))+\r\n\r\n\r\n//***************************************************\r\n(EncodeColor(colorBlue)+"   -   Vi tri Close: ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+   " CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorLime)+     " PHIA TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorGold)+     " NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+      " PHIA DUOI",\r\nWriteIf(ClosePos==1,EncodeColor(colorTurquoise)+" THAP NHAT",\r\n                    EncodeColor(colorYellow)   +" KHONG DOI")))))+\r\n\r\n                     \r\n                    \r\n                    \r\n//***************************************************\r\n//Danh gia xu huong\r\n\r\n("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" + // Xuong dong\r\n\r\n//Suc manh MACD \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(MACDStrength==1,  EncodeColor(colorLime)     +  " MACD Strength:          TANG - UP",\r\nWriteIf(MACDStrength==-1, EncodeColor(colorRed)      +  " MACD Strength:          GIAM - DOWN",\r\n                         EncodeColor(colorGold)      +  " MACD Strength:          Khong ro rang"))+\r\n\r\n//Suc manh RSI \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(RSIStrength==1,  EncodeColor(colorLime)     +  " RSI Strength:               TANG - UP",\r\nWriteIf(RSIStrength==-1, EncodeColor(colorRed)      +  " RSI Strength:               GIAM - DOWN",\r\n                         EncodeColor(colorGold)     +  " RSI Strength:               Khong ro rang"))+\r\n                         \r\n//Xu huong ngan han hien tai\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorLime)         +  " Xu huong hien tai:      TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)          +  " Xu huong hien tai:      GIAM - DOWN",\r\n                 EncodeColor(colorGold)         +  " Xu huong hien tai:      Khong ro rang"))+\r\n\r\n//Xu huong trung gian thu cap                 \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorLime)       +  " Xu huong thu cap:      TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)        +  " Xu huong thu cap:      GIAM - DOWN",\r\n                   EncodeColor(colorGold)       +  " Xu huong thu cap:      Khong ro rang"))+\r\nWriteIf(upminoroff,  EncodeColor(colorOrange)   +  " (Xu huong TANG thu cap co the thay doi)",\r\nWriteIf(dnminoroff,  EncodeColor(colorSeaGreen) +  " (Xu huong GIAM thu cap co the thay doi)","" ))+\r\n\r\n//Xu huong chinh (trung han)\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(trenddaihan==1,  EncodeColor(colorLime) +  " Xu huong chinh:         TANG - UP",\r\nWriteIf(trenddaihan==-1,EncodeColor(colorRed)   +  " Xu huong chinh:         GIAM - DOWN",\r\n                     EncodeColor(colorGold)     +  " Xu huong chinh:         Khong ro rang"))+\r\nWriteIf(upmajoroff,EncodeColor(colorOrange)     +  " (Xu huong TANG chinh co the thay doi)",\r\nWriteIf(dnmajoroff,EncodeColor(colorSeaGreen)   +  " (Xu huong GIAM chinh co the thay doi)","" ))+\r\n\r\n\r\n\r\n//Xu huong EMAs \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(EMAStrength==1,  EncodeColor(colorLime)     +  " Xu huong EMAs:         TANG - UP",\r\nWriteIf(EMAStrength==-1, EncodeColor(colorRed)      +  " Xu huong EMAs:         GIAM - DOWN",\r\n                      EncodeColor(colorGold)     +  " Xu huong EMAs:         Khong ro rang"))+\r\n                      \r\n//Xu huong Ichimoku\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(Xuhuongichimoku==1,  EncodeColor(colorLime) +" Xu huong Ichimoku:   TANG - UP",\r\nWriteIf(Xuhuongichimoku==-1, EncodeColor(colorRed)  +" Xu huong Ichimoku:   GIAM - DOWN",\r\nWriteIf(Xuhuongichimoku==0,EncodeColor(colorGold)   +" Xu huong Ichimoku:   Khong ro rang","" )))+\r\n                                                               \r\nWriteIf(XuhuongIchimokuTangoff,EncodeColor(colorOrange)     +"  (Xu huong TANG Ichimoku co the thay doi)",\r\nWriteIf(XuhuongIchimokuGiamoff,EncodeColor(colorSeaGreen)   +"  (Xu huong GIAM Ichimoku co the thay doi)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================================\r\n//Luot song ngan han\r\n\r\n//Buy\r\n\r\nWriteIf(Buyluotsong,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Buy Luot song:" ,"")+\r\n     \r\n//Canh bao Day - Bottom\r\nEncodeColor(colorYellow) + WriteIf(DayBottom, "\\n" + "   - Chu y: (!) ", "") + \r\nEncodeColor( colorLime ) +WriteIf ( BuyDayBottom , "Tinhieu: Mua bat 'Day'" +\r\nEncodeColor( colorLime ) + "\\n   - Gia Mua:        " + EncodeColor( colorGold ) +WriteVal( C, 1.1 ) + \r\nEncodeColor( colorLime ) +" - Gia muc tieu:     " +  EncodeColor( colorGold) +WriteVal( PivotSellPrice, 1.1 ) + " (" + WriteVal( ( PivotSellPrice - PivotBuyPrice), 1.1 ) + "="+ WriteVal( ( PivotSellPrice - PivotBuyPrice)*100/PivotBuyPrice, 1.0 )+"%" +")" + \r\nEncodeColor( colorRed ) +"\\n   - Gia Cutloss: " + EncodeColor( colorGold ) + WriteVal( C * .95, 1.1 ) + \r\nEncodeColor( colorLime) + " - Ty le LN/Rui do: " + EncodeColor( colorGold) + WriteVal( ( PivotProfitTaker - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" , "" ) +\r\n\r\n\t\r\n//Buy Luot song ngan han\r\nEncodeColor(colorBlue) + WriteIf(BuyBreakout_SidewayDay, "\\n" + "   - Buy Brekout (0): " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(Buy5Day, "\\n" + "   - Buy 4 Day (4):     " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(Buy10Day, "\\n" + "   - Buy 8 Day (8):     " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyEMA5cross, "\\n" + "   - Buy EMA5 Cross (5): " + \r\nEncodeColor(colorLime) + "(+) EMA5 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyEMA10cross, "\\n" + "   - Buy EMA10 Cross (6): " + \r\nEncodeColor(colorLime) + "(+) EMA10 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyTurtle, "\\n" + "   - Buy Turtle Trading System: " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh Turtle + EMAFast &gt; EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Canh bao Bat Day theo RSI\r\nEncodeColor(colorYellow) + WriteIf(BuyRSIDivergence, "\\n" + "   - Bat day theo RSI: " + \r\nEncodeColor(colorLime) + "(!) Dau hieu RSI phan ky Tang: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Tin hieu ATR\r\nEncodeColor(colorBlue) + WriteIf(Buyatr, "\\n" + "   - Buy % &amp; ATR: " + \r\nEncodeColor(colorLime) + "(+) Buy theo % Dinh Day hoac ATR: "  +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n\r\n//Ket qua Mua Day\r\nEncodeColor( colorLime ) +WriteIf( PivotLong AND NOT BuyDayBottom, EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n"  - Ket Qua:"  + \r\nEncodeColor( colorLime) +" Lenh (Mua bat 'Day')" + \r\nEncodeColor( colorGold )  +"\\n   - Gia Mua:        " +  WriteVal( ( PivotBuyPrice ), 1.1 ) +\r\nEncodeColor( colorLime ) + " - Loi nhuan: " + EncodeColor( colorBrightGreen) + WriteVal( ( C - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" +\r\nEncodeColor( colorRed ) + "\\n   - Gia Cutloss: " + EncodeColor( colorGold) + WriteVal( ( PivotBuyPrice * .95 ), 1.1 ) + \r\nEncodeColor( colorSeaGreen ) + " - Ty le LN/Rui do hien tai: " + \r\nEncodeColor( colorGold) + WriteVal( ( C - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" + " - " + \r\nEncodeColor( colorGold ) + " Cu de Lai chay tiep!", "" ) +  \r\n\r\n//***********************************\r\n\r\n\r\n//Sell\r\n\r\nWriteIf(Sellluotsong,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorRed) + "  - Sell Luot song: " ,"")+\t\r\n\r\n\r\n//Canh bao Dinh - Top\r\nEncodeColor(colorYellow) + WriteIf(DinhTop, "\\n" + "   - Chu y: (!) " + \r\nEncodeColor(colorYellow) + "Dau hieu tao Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\nEncodeColor( colorYellow ) +WriteIf ( SellDinhTop , "\\n   - Tinhieu: (-) Ban chot lenh (Mua bat 'Day') truoc" + \r\nEncodeColor( colorRed ) +"\\n   - Gia Ban: " + EncodeColor( colorGold )  +WriteVal( C, 1.1 ) + \r\nEncodeColor( colorLime )  +" - Loi nhuan: " +  EncodeColor( colorGold ) + WriteVal( ( PivotSellPrice - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( PivotSellPrice - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" , "" ) +\r\n\r\n//Sell luot song ngan han\r\nEncodeColor(colorRed) + WriteIf(SellBreakout_SidewayDay, "\\n" + "   - Sell Breakdown (0): " + \r\nEncodeColor(colorDarkYellow) + "(-) Duoi EMA10: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\nEncodeColor(colorRed) + WriteIf(Sell5Day, "\\n" + "   - Sell 4 Day (4):           " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(Sell10Day, "\\n" + "   - Sell 8 Day (8):           " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellEMA5cross, "\\n" + "   - Sell EMA5 Cross (5): " + \r\nEncodeColor(colorDarkYellow) + "(-) EMA5 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellEMA10cross, "\\n" + "   - Sell EMA10 Cross (6): " + \r\nEncodeColor(colorDarkYellow) + "(-) EMA10 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellTurtle, "\\n" + "   - Sell Turtle Trading System: " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day Turtle, EMAFast &lt; EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorYellow) + WriteIf(exitArray, "\\n" + "   - Chu Y: " + \r\nEncodeColor(colorDarkYellow) + "(-) Thoat lenh Turtle truoc do (Chot loi, Cat lo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Canh bao Ban Dinh theo RSI\r\nEncodeColor(colorYellow) + WriteIf(SellRSIDivergence, "\\n" + "   - Ban Dinh theo RSI: " + \r\nEncodeColor(colorDarkYellow) + "(!) Dau hieu RSI phan ky Giam: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Tin hieu ATR\r\nEncodeColor(colorRed) + WriteIf(Sellatr, "\\n" + "   - Sell % &amp; ATR: " + \r\nEncodeColor(colorDarkYellow) + "(-) Theo % Dinh Day hoac ATR: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Muc giam tu Dinh gan nhat\r\nWriteIf( PivotShort AND NOT SellDinhTop, EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\nEncodeColor( colorRed ) + "  - Muc Giam tu Dinh gan nhat: " \r\n+ EncodeColor( colorGold) +"("+WriteVal( ( PivotSellPrice ), 1.1 ) +"): "\r\n+ EncodeColor( colorGold) +WriteVal( ( C - PivotSellPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotSellPrice ) * 100 / PivotSellPrice ), 1.1 ) + "%)" + \r\nEncodeColor( colorGold ) + "\\n   - Cho tin hieu Mua bat 'Day'!", "" ) +\r\n\r\n\r\n//====================================================================================================================\r\n\r\n\r\n//*************************************************************************************\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n//Buy Ichimoku\r\n\r\nWriteIf(Buyichimoku,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Buy Ichimoku Kinko Hyo:" ,"")+\r\n    \r\n    \r\n    EncodeColor(colorBlue) + WriteIf(Buyichimoku2 OR Buyichimoku3, "\\n" + "   - Buy (0): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan &amp; Kijun &amp; Trong hoac Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Buy (1): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Kijun &amp; Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Buy (2): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan + Tenkan vuot Kijun + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Buy (3): " + \r\n\tEncodeColor(colorLime) + "(+) Tenkan vuot Kijun + Tren Sen &amp; Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Buy (4): " + \r\n\tEncodeColor(colorLime) + "(+) SpanA vuot SpanB + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Buy (5): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan + Chikou vuot Gia + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen: " +\r\n\tEncodeColor(colorLime) + "(+) Mua Manh!: "+EncodeColor(colorYellow) + WriteVal(C,1.2) , "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot may Sen &amp; Kumo: " + \r\n\tEncodeColor(colorLime) + "(+) Mua rat Manh!!: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\n\tEncodeColor(colorViolet) + WriteIf(Bomno, "\\n"  + "   - Bung no: " + \r\n\tEncodeColor(colorLime) + "(+) Mua cuc Manh!!!: " + EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t\r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Song kiem hop bich Tenkan &amp; Kijun:" + \r\n\tEncodeColor(colorLime) + "(+) Mua Gia tang: " +EncodeColor(colorYellow) + WriteVal(TL ,1.2) , "") +\r\n\t\r\n\r\n\r\n//Sell Ichimoku\r\n\r\n\r\n\r\nWriteIf(Sellichimoku,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorRed) + "  - Sell Ichimoku Kinko Hyo: " ,"")+\t\r\n\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku1, "\\n" + "   - Sell (1): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Duoi Tenkan &amp; Kijun (Tren Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku2, "\\n" + "   - Sell (2): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Ban Manh!: Duoi Tenkan &amp; Kijun (Trong Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t                         \r\n\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku3, "\\n" + "   - Sell (3): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Ban rat Manh!!!: Duoi Tenkan &amp; Kijun (Duoi Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t \t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\t\r\n\r\n//*********************************************************************************************\r\n//|                            Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su."+"\\n + Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao."+"\\n +Co khoi luong thap hon 2 thanh truoc no. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap."+"\\n +Theo sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). "+"\\n  +Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam)."+"\\n +Voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon."+"\\n +Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. "+"\\n +Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). "+"\\n +Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. "+"\\n +Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . "+"\\n +Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. "+"\\n +Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu."+"\\n +Co the dang gap Vung Khang cu/Ho tro manh.","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. "+"\\n +Bao hieu xu huong giam sap ket thuc. ","") +\r\n\r\n\r\n\t\r\n//******************************************\r\n\r\n\r\n\r\n//Dien giai Nen Nhat\r\n\r\n\r\n WriteIf(BuyJapaneseCandle OR SellJapaneseCandle OR CoverJapaneseCandle OR ShortJapaneseCandle,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Japanese Candle: \\n","")+\r\n                                         \r\n\r\n\r\n\r\n \r\n      \r\n//Buy Candles Bullish \r\n//Nen canh bao Mua Tang Gia Manh\r\n//********************************\r\nWriteIf(BuyJapaneseCandle,EncodeColor(colorBlue)+"    - Buy: \\n" ,"") +\r\nEncodeColor(colorLime)+\r\nWriteIf(BullishAbandonedBaby,"(+) Abandoned Baby Bullish. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(ConcealingBabySwallow,"(+) Concealing Baby Swallow. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MorningDojiStar,"(+) Morning Doji Star. Mau hinh dao chieu.\\n Important sign of reversal.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MorningStar,"(+) Morning Star. Mau hinh dao chieu.\\n Nison: Tot hon nen theo kich thuoc tang cua nen trang (thu ba).\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeInsideUp,"(+) 3 Inside Up. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeOutsideUp,"(+) 3 Outside Up. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MAtHoldBullish,"(+) Mat Hold Bullish. Mau hinh tiep dien.\\n Nison: Trong 2-4 ngay co cay nen Giam gia.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(risingThreeMethods,"(+) Rising Three Methods. Mau hinh tiep dien. \\n Nison: No co y nghia lon hon neu khoi luong cua nen trang lon hon khoi luong cua nen den.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(sideBySideWhiteLines,"(+) Side by Side White Lines. Mau hinh tiep dien.\\n Nison: Neu trong mot xu huong giam co the duoc gay ra boi ricoperture la Ngan. \\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeWhiteSoldiers,"(+) 3 White Soldiers. Mau hinh tiep dien.\\n Nison: Tin hieu Tich cuc.\\n Nhung hay chu y den Mau hinh giam Gia truoc do va mau hinh tiep theo.\\n Do tin cay Cao. \\n","") +\r\n\r\n\r\n//Cover Candles Bullish \r\n//Nen canh bao Tang Gia nhe\r\n//**************************\r\n\r\n\r\nWriteIf(CoverJapaneseCandle,EncodeColor(colorGold)+"    - Cover: \\n","") +\r\nEncodeColor(colorLime)+\r\nWriteIf(BullishKicker,"(+) BullishKicker. Mau hinh dao chieu.\\n Than cay Nen cang Rong thi cang manh.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(EngulfingBull,"(+) Bullish Engulfing. Mau hinh dao chieu.\\n Nison: Cac yeu to lam tang hieu ung cua mo hinh la: \\n 1) Ngay dau tien (truoc do) cay nen co than nho, vao ngay thu hai co than nen rong.\\n 2) Mo hinh xuat hien sau khi di chuyen rat nhanh hoac rat keo dai. \\n 3) Khoi luong cao vao ngay thu hai (hien tai).\\n 4) Nhieu ngay co Nen bao phu cay Nen truoc. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishBeltHold,"(+) Belt Hold Bullish. Mau hinh dao chieu.\\n Than cay Nen cang Rong thi cang manh.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(breakAwayBullish,"(+) Break Bar Away Bullish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dojiStarBullish,"(+) Bullish Doji Star. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. Tin hieu Manh neu o vung Dinh cao.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(hammerBullish,"(+) Bullish Hammer. Mau hinh dao chieu.\\n Nison: Dau hieu Manh neu Than nen phia tren Hep va Duoi Nen phia duoi dai.\\n  Nen tang Gia se tot hon Nen giam Gia \\n Do tin cay Thap. \\n","") +\r\nWriteIf(dragonflyDoji,"(+) Dragonfly Doji. Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishHarami, "(+) Harami Bullish. Mau hinh dao chieu.\\n Nison: Tin hieu Yeu. Nen cho su xac nhan. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(BullishHaramiCross,"(+) Harami Cross. Mau hinh dao chieu.\\n Nison: Dau hieu Harami dang tin cay nhat.\\n  Dau hieu lon nhat se manh hon dau hieu thap hon. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(homingPigeon,"(+) Homing Pigeon. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(invertedHammer,"(+) Inverted Hammer. Mau hinh dao chieu.\\nNison: Nen cho su xac nhan Tang Gia phia sau.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(meetingLinesbullish,"(+) Meeting Lines bullish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(piercingLine,"(+) Piercing Line. Mau hinh dao chieu.\\n Nison: Day la Mo hinh Dao chieu Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(stickSandwich,"(+) Stick Sandwich. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeStarsInTheSouth,"(+) 3 Stars in the South. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(TriStarBottom,"(+) 3 Stars Bottom. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(triStarBullish,"(+) Tri-Star Bullish. Mau hinh dao chieu.\\n Nison: Mo hinh Dao chieu tuong doi Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeriverBottom,"(+) 3 River Bottom. Mau hinh dao chieu.\\n Nison: Ap luc Ban dang Giam dan.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishSeparatingLine,"(+) Separating Lines Bullish. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(upsideGapThreeMethods,"(+) Upside Gap 3 Methods. Mau hinh tiep dien.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeLineStrike,"(+) 3 Line Strike. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(TweezerBottoms,"(+) Tweezer Bottom. Mau hinh dao chieu.\\n  Cung voi su dao chieu cua cac nen khac co the cho thay muc ho tro.\\n Nison: Nen cho su xac nhan. \\n","") +\r\nWriteIf(UpwardGappingTasuki,"(+) Upside Tasuki Gap. Mau hinh tiep dien.\\n Nison: Than cua hai ngon nen trong khoang trong phai co cung do lon.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(Bull3Formation,"(+) Bull3Formation. \\n","") +\r\nWriteIf(BullishCounterAttack,"(+) BullishCounterAttack. \\n","") +\r\nWriteIf(SeperatingLines,"(+) SeperatingLines. \\n","") +\r\n\r\n\r\n//Sell Candle Down - Bearish \r\n//Nen canh bao Sell Giam Gia Manh\r\n//*********************************\r\n\r\nWriteIf(SellJapaneseCandle,EncodeColor(colorRed)+"    - Sell: \\n","") +\r\nEncodeColor(colorBrown)+\r\nWriteIf(BearishAbandonedBaby,"(-) Abandoned Baby Bearish. Mau hinh dao chieu.\\n Nison: Hiem khi xuat hien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(DarkCloudCover,"(-) Dark Cloud Cover. Mau hinh dao chieu.\\n Nison: Cac yeu to cho thay tam quan trong cua tin hieu nay la: \\n 1) Su tham nhap cua ngon nen dau tien trong ngon nen thu hai. \\n 2) Neu ca hai nen deu la nen Marabozu. \\n 3) Than cua cay nen thu hai o tren mot muc khang cu dang ke. \\n 4) Xay ra trong nhung ngay co khoi luong cao.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(EveningDojiStar,"(-) Evening Doji Star. Mau hinh dao chieu.\\n Nison: Phai duoc xac nhan boi mot cay nen den dai.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(EveningStar,"(-) Evening Star. Mau hinh dao chieu.\\n Nison: Khoang cach giua than nen thu hai va thu ba khong phai luc nao cung xuat hien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(idendicalThreeBlackCrows,"(-) Identical 3 Black Crows.\\n  Mo hinh dao chieu cua xu huong tang truoc do.\\n Nison: Dau hieu Giam rat ro rang.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(BearishKicker,"(-) Kicking Bearish. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeInsideDownBearish,"(-) 3 Inside Down. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeoutsideDownBearish,"(-) 3 Outside Down. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(upsideGapTwoCrows,"(-) Upside Gap 2 Crows. Mau hinh dao chieu.\\n Nison: Yeu cau xac nhan voi su dao nguoc tiep tuc vao ngay thu ba.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(fallingThreeMethods,"(-) Falling 3 Methods. Mau hinh tiep dien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeBlackCrows,"(-) 3 Black Crows. Mau hinh dao chieu.\\n Nison: Nen chu y neu trong xu  the tang. \\n Do tin cay Cao. \\n","") +\r\n\r\n\r\n//Short sell Candle Down - Bearish \r\n//Nen canh bao Sell Giam Gia nhe\r\n//**************************************\r\n\r\nWriteIf(ShortJapaneseCandle,EncodeColor(colorGold)+"    - Short: \\n" ,"") +\r\nEncodeColor(colorBrown)+\r\nWriteIf(advanceBlockBearish,"(-) advanceBlockBearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishBeltHold,"(-) Belt Hold Bearish. Mau hinh dao chieu.\\n Nison: Chieu cao cua nen cang dai thi cang Manh. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(breakAwayBearish,"(-) breakvar Away Bearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(HangingMan,"(-) Hanging Man. Mau hinh dao chieu.\\n Nison: Nhu mot 'cay Nen bua giam gia' voi mot khoang trong dang ke vao ngay hom sau. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(deliberationBearish,"(-) Deliberation Bearish. Mau hinh dao chieu.\\n Nison: Day khong phai la mot mo hinh dao chieu thuc su.\\n  Nhung la mot dau hieu cho thay su phuc hoi dang suy yeu. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishCounterAttack,"(-) Counter Attack Bearish.\\n Nison: Dau hieu tiem nang cua su Giam gia. \\n","") +\r\nWriteIf(EngulfingBear,"(-) Engulfing Bearish. Mau hinh dao chieu.\\n Nison: Dau hieu dao chieu quan trong.\\n  Cac yeu to lam tang tam quan trong cua cac mau la: \\n 1) Phia tren cay nen co than rat nho VA cay nen thu hai co than rat lon. \\n 2) Mau hinh xuat hien sau mot xu huong tang gia nhanh truoc do. \\n 3) Khoi luong cao trong Ngay thu Hai. \\n 4) Vao Ngay thu hai bao phu than nen nhieu hon so voi than nen truoc day.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(HammerBearish,"(-) HammerBearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dragonflyDojiBearish,"(-) Dragonfly Doji Bearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishHarami,"(-) Bearish Harami. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishHaramiCross,"(-) Harami Cross Bearish. Mau hinh dao chieu.\\n Nison: Mau hinh bao xu huong giam dang ke hon so voi Nen 'Harami'. \\n Ngay thu hai, cay nen co the co mau trang hoac den.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(MeetingLinesBearish,"(-) Meeting Lines Bearish. Mau hinh dao chieu.\\n Nhung khong qua manh nhu Nen 'Dark Cloud Cover'. \\n Do tin cay Trung binh. ","") +\r\nWriteIf(ShootingStar,"(-) Shooting Star. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(shootingStarGap,"(-) Shooting Star. Mau hinh dao chieu.\\n Nison: Khong quan trong nhu Nen 'evening star'. \\n Tot nhat, than nen phai nam trong mot khoang trong so voi than nen truoc do.\\n No se xuat hien sau mot xu huong tang truoc do.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(GraveStoneDoji,"(-) Gravestone Doji. Mau hinh dao chieu.\\n Nison: Tin hieu quan trong hon khi cham muc cao nhat lich su.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(triStarBearish,"(-) Tri-Star Bearish. Mau hinh dao chieu.\\n Nison: Mau hinh dao chieu rat Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(twoCrows,"(-) 2 Crows. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dojiStarBearish,"(-) Doji Star Bearish. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(downsideGapThreeMethods,"(-) Downside Gap 3 Methods. Mau hinh tiep dien. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(DownwardGappingTasuki,"(-) Downside Tasuki Gap. Dau hieu tiep dien xu the.\\n Nison: Neu ngay cuoi cung Gap bi dong lai.\\n No hinh tiep tuc se bi tu choi.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(inNeckBearish,"(-) In Neck Bearish. Mau hinh tiep dien.\\n Nison: Giong nhu Nen 'piercing pattern' .\\n Nhung giam nhieu hon vao ngay thu hai vi khong co su xam nhap.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(OnNeckBearish,"(-) On Neck Bearish. Mau hinh tiep dien.\\n Nison: Giong nhu Nen 'piercing' - Nen xuyen thau.\\n Nhung giam gia hon vi khong co su xam nhap nao vao ngay thu hai.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishSeparatingLine,"(-) Separating Lines Bearish. \\n","") +\r\nWriteIf(sideBySideWhiteLinesBearish,"(-) Side by Side White Lines Bearish. Mau hinh tiep dien.\\n Nison: Hiem khi xay ra.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeLineStrike,"(-) 3 Line Strike. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(thrustingBearish,"(-) Thrusting - Luc day Manh. Mau hinh tiep dien.\\n Nison: Khong phai la ngay dao chieu.\\n Boi vi ngay thu hai khong tham gia vao diem giua cua ngay dau tien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(TweezerTops,"(-) Tweezer Top. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. \\n","")+\r\nWriteIf(Bear3Formation,"(-) Bear3Formation. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(TriStarTop,"(-) TriStarTop. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(InvertedBlackHammer,"(-) InvertedBlackHammer. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") \r\n\r\n\r\n\t\r\n\r\n);\r\n\r\n}\r\n\r\n//*********************************************************************************************\r\n//|                  END TITLE - TIEU DE 1                                 |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//************************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n//|                  TITLE - TIEU DE 2 (Co dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "* - Hien thi TITLE - TIEU DE (Co dien giai VSA)",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE 2                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n//Volume\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\n\r\n//***************************************************\r\n//Thay doi mau sac theo Volume\r\nEncodeColor(colorBlue) + "   - Total Volume: "+ \r\n\r\nWriteIf(V&gt;=maVolume*1.6,                     EncodeColor(colorViolet)+    WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,\r\nWriteIf(V&lt;maVolume*1.6 AND V&gt;=maVolume*1.1 ,EncodeColor(colorLime)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",\r\nWriteIf(V&lt;maVolume*1.1 AND V&gt;=maVolume*0.9,EncodeColor(colorGold)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",\r\nWriteIf(V&lt;maVolume*0.9 AND V&gt;=maVolume*0.5, EncodeColor(colorRed)+       WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,\r\nWriteIf(V&lt;maVolume*0.5,                      EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ","")))))+\r\n\r\n//MA30 Volume\r\nEncodeColor(colorBlue)+ "MA30: " + EncodeColor(colorYellow) + WriteVal(maVolume,1.0)+\r\n\r\n//Danh gia Volume\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;=maVolume*1.6,                        EncodeColor(colorViolet)+   " SIEU CAO",\r\nWriteIf(V&lt;maVolume*1.6  AND V&gt;=maVolume*1.1,   EncodeColor(colorLime)+     " CAO",\r\nWriteIf(V&lt;maVolume*1.1 AND V&gt;=maVolume*0.9,   EncodeColor(colorGold)+     " TRUNG BINH",\r\nWriteIf(V&lt;maVolume*0.9 AND V&gt;=maVolume*0.5,    EncodeColor(colorRed)+      " THAP",\r\nWriteIf(V&lt;maVolume*0.5,                         EncodeColor(colorTurquoise)+" SIEU THAP","")))))+\r\n\r\n//Buy or Sell Volume\r\n"\\n" +\r\nEncodeColor(colorBlue)+   "   - Buy Vol: "+ EncodeColor(colorYellow)+WriteVal(BuyVolume,1.0)+ EncodeColor(colorSeaGreen)+ "   (= "+ WriteVal(BuyVolumep,1.0)+"%" +  " Total"\r\n+")   "+\r\nEncodeColor(colorRed)+   " -   Sell Vol: "+EncodeColor(colorYellow)+WriteVal(SellVolume,1.0)+ EncodeColor(colorSeaGreen)+"   (= "+ WriteVal(SellVolumep,1.0)+"%" +  " Total"\r\n+")   "+\r\nEncodeColor(colorLime)+  " -   Net Vol: "+EncodeColor(colorYellow)+WriteVal(BuyVolume-SellVolume,1.0)+\r\n\r\n\r\n\r\n\r\n\r\n//***************************************************\r\n// Open High Low Close\r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open:    " +  EncodeColor(colorYellow) +WriteVal(O,1.2)+ \r\nEncodeColor(colorLime) + "   -   High:  " +  EncodeColor(colorYellow) +WriteVal(H,1.2)+ \r\nEncodeColor(colorRed)  + "   -   Low:  " +   EncodeColor(colorYellow) +WriteVal(L,1.2)+ \r\n\r\n//***************************************************\r\n//Thay doi mau theo gia Close\r\nEncodeColor(colorSeaGreen) + "   -   Close:  " +\r\n\r\n//Gia tran&gt;6%\r\nWriteIf(xx&gt;=6,\r\nEncodeColor(colorViolet)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Gia san&lt;6%\r\nWriteIf(xx&lt;=-6,\r\nEncodeColor(colorTurquoise) +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Tang gia\r\nWriteIf(xx&gt;0 AND xx&lt;6,\r\nEncodeColor(colorLime)   +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Giam gia\r\nWriteIf(xx&lt;0 AND xx&gt;-6,\r\nEncodeColor(colorRed)       +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Tham chieu\r\nEncodeColor(colorGold)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)"))))+\r\n\r\n//***************************************************\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Spread: ")+\r\n\r\nWriteIf(spread &gt;=avgSpread*1.5,                             EncodeColor(colorViolet)+   " RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;=avgSpread*1.1 ,   EncodeColor(colorLime)+     " TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread*1.1 AND spread &gt;= AvgSpread*0.9, EncodeColor(colorGold)+     " TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.9 AND spread &gt;= AvgSpread*0.4, EncodeColor(colorRed)+      " DUOI TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.4,                             EncodeColor(colorTurquoise)+" HEP","")))))+\r\n\r\n\r\n//***************************************************\r\n(EncodeColor(colorBlue)+"   -   Vi tri Close: ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+   " CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorLime)+     " PHIA TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorGold)+     " NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+      " PHIA DUOI",\r\nWriteIf(ClosePos==1,EncodeColor(colorTurquoise)+" THAP NHAT",\r\n                    EncodeColor(colorYellow)   +" KHONG DOI")))))+\r\n\r\n                     \r\n                    \r\n                    \r\n//***************************************************\r\n//Danh gia xu huong\r\n\r\n("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" + // Xuong dong\r\n\r\n//Suc manh MACD \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(MACDStrength==1,  EncodeColor(colorLime)     +  " MACD Strength:          TANG - UP",\r\nWriteIf(MACDStrength==-1, EncodeColor(colorRed)      +  " MACD Strength:          GIAM - DOWN",\r\n                         EncodeColor(colorGold)      +  " MACD Strength:          Khong ro rang"))+\r\n\r\n//Suc manh RSI \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(RSIStrength==1,  EncodeColor(colorLime)     +  " RSI Strength:               TANG - UP",\r\nWriteIf(RSIStrength==-1, EncodeColor(colorRed)      +  " RSI Strength:               GIAM - DOWN",\r\n                         EncodeColor(colorGold)     +  " RSI Strength:               Khong ro rang"))+\r\n                         \r\n//Xu huong ngan han hien tai\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorLime)         +  " Xu huong hien tai:      TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)          +  " Xu huong hien tai:      GIAM - DOWN",\r\n                 EncodeColor(colorGold)         +  " Xu huong hien tai:      Khong ro rang"))+\r\n\r\n//Xu huong trung gian thu cap                 \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorLime)       +  " Xu huong thu cap:      TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)        +  " Xu huong thu cap:      GIAM - DOWN",\r\n                   EncodeColor(colorGold)       +  " Xu huong thu cap:      Khong ro rang"))+\r\nWriteIf(upminoroff,  EncodeColor(colorOrange)   +  " (Xu huong TANG thu cap co the thay doi)",\r\nWriteIf(dnminoroff,  EncodeColor(colorSeaGreen) +  " (Xu huong GIAM thu cap co the thay doi)","" ))+\r\n\r\n//Xu huong chinh (trung han)\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(trenddaihan==1,  EncodeColor(colorLime) +  " Xu huong chinh:         TANG - UP",\r\nWriteIf(trenddaihan==-1,EncodeColor(colorRed)   +  " Xu huong chinh:         GIAM - DOWN",\r\n                     EncodeColor(colorGold)     +  " Xu huong chinh:         Khong ro rang"))+\r\nWriteIf(upmajoroff,EncodeColor(colorOrange)     +  " (Xu huong TANG chinh co the thay doi)",\r\nWriteIf(dnmajoroff,EncodeColor(colorSeaGreen)   +  " (Xu huong GIAM chinh co the thay doi)","" ))+\r\n\r\n\r\n\r\n//Xu huong EMAs \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(EMAStrength==1,  EncodeColor(colorLime)     +  " Xu huong EMAs:         TANG - UP",\r\nWriteIf(EMAStrength==-1, EncodeColor(colorRed)      +  " Xu huong EMAs:         GIAM - DOWN",\r\n                      EncodeColor(colorGold)     +  " Xu huong EMAs:         Khong ro rang"))+\r\n                      \r\n//Xu huong Ichimoku\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(Xuhuongichimoku==1,  EncodeColor(colorLime) +" Xu huong Ichimoku:   TANG - UP",\r\nWriteIf(Xuhuongichimoku==-1, EncodeColor(colorRed)  +" Xu huong Ichimoku:   GIAM - DOWN",\r\nWriteIf(Xuhuongichimoku==0,EncodeColor(colorGold)   +" Xu huong Ichimoku:   Khong ro rang","" )))+\r\n                                                               \r\nWriteIf(XuhuongIchimokuTangoff,EncodeColor(colorOrange)     +"  (Xu huong TANG Ichimoku co the thay doi)",\r\nWriteIf(XuhuongIchimokuGiamoff,EncodeColor(colorSeaGreen)   +"  (Xu huong GIAM Ichimoku co the thay doi)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================================\r\n//Luot song ngan han\r\n\r\n//Buy\r\n\r\nWriteIf(Buyluotsong,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Buy Luot song:" ,"")+\r\n     \r\n//Canh bao Day - Bottom\r\nEncodeColor(colorYellow) + WriteIf(DayBottom, "\\n" + "   - Chu y: (!) ", "") + \r\nEncodeColor( colorLime ) +WriteIf ( BuyDayBottom , "Tinhieu: Mua bat 'Day'" +\r\nEncodeColor( colorLime ) + "\\n   - Gia Mua:        " + EncodeColor( colorGold ) +WriteVal( C, 1.1 ) + \r\nEncodeColor( colorLime ) +" - Gia muc tieu:     " +  EncodeColor( colorGold) +WriteVal( PivotSellPrice, 1.1 ) + " (" + WriteVal( ( PivotSellPrice - PivotBuyPrice), 1.1 ) + "="+ WriteVal( ( PivotSellPrice - PivotBuyPrice)*100/PivotBuyPrice, 1.0 )+"%" +")" + \r\nEncodeColor( colorRed ) +"\\n   - Gia Cutloss: " + EncodeColor( colorGold ) + WriteVal( C * .95, 1.1 ) + \r\nEncodeColor( colorLime) + " - Ty le LN/Rui do: " + EncodeColor( colorGold) + WriteVal( ( PivotProfitTaker - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" , "" ) +\r\n\r\n\t\r\n//Buy Luot song ngan han\r\nEncodeColor(colorBlue) + WriteIf(BuyBreakout_SidewayDay, "\\n" + "   - Buy Brekout (0): " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(Buy5Day, "\\n" + "   - Buy 4 Day (4):     " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(Buy10Day, "\\n" + "   - Buy 8 Day (8):     " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyEMA5cross, "\\n" + "   - Buy EMA5 Cross (5): " + \r\nEncodeColor(colorLime) + "(+) EMA5 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyEMA10cross, "\\n" + "   - Buy EMA10 Cross (6): " + \r\nEncodeColor(colorLime) + "(+) EMA10 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyTurtle, "\\n" + "   - Buy Turtle Trading System: " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh Turtle + EMAFast &gt; EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Canh bao Bat Day theo RSI\r\nEncodeColor(colorYellow) + WriteIf(BuyRSIDivergence, "\\n" + "   - Bat day theo RSI: " + \r\nEncodeColor(colorLime) + "(!) Dau hieu RSI phan ky Tang: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Tin hieu ATR\r\nEncodeColor(colorBlue) + WriteIf(Buyatr, "\\n" + "   - Buy % &amp; ATR: " + \r\nEncodeColor(colorLime) + "(+) Buy theo % Dinh Day hoac ATR: "  +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n\r\n//Ket qua Mua Day\r\nEncodeColor( colorLime ) +WriteIf( PivotLong AND NOT BuyDayBottom, EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n"  - Ket Qua:"  + \r\nEncodeColor( colorLime) +" Lenh (Mua bat 'Day')" + \r\nEncodeColor( colorGold )  +"\\n   - Gia Mua:        " +  WriteVal( ( PivotBuyPrice ), 1.1 ) +\r\nEncodeColor( colorLime ) + " - Loi nhuan: " + EncodeColor( colorBrightGreen) + WriteVal( ( C - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" +\r\nEncodeColor( colorRed ) + "\\n   - Gia Cutloss: " + EncodeColor( colorGold) + WriteVal( ( PivotBuyPrice * .95 ), 1.1 ) + \r\nEncodeColor( colorSeaGreen ) + " - Ty le LN/Rui do hien tai: " + \r\nEncodeColor( colorGold) + WriteVal( ( C - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" + " - " + \r\nEncodeColor( colorGold ) + " Cu de Lai chay tiep!", "" ) +  \r\n\r\n//***********************************\r\n\r\n\r\n//Sell\r\n\r\nWriteIf(Sellluotsong,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorRed) + "  - Sell Luot song: " ,"")+\t\r\n\r\n\r\n//Canh bao Dinh - Top\r\nEncodeColor(colorYellow) + WriteIf(DinhTop, "\\n" + "   - Chu y: (!) " + \r\nEncodeColor(colorYellow) + "Dau hieu tao Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\nEncodeColor( colorYellow ) +WriteIf ( SellDinhTop , "\\n   - Tinhieu: (-) Ban chot lenh (Mua bat 'Day') truoc" + \r\nEncodeColor( colorRed ) +"\\n   - Gia Ban: " + EncodeColor( colorGold )  +WriteVal( C, 1.1 ) + \r\nEncodeColor( colorLime )  +" - Loi nhuan: " +  EncodeColor( colorGold ) + WriteVal( ( PivotSellPrice - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( PivotSellPrice - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" , "" ) +\r\n\r\n//Sell luot song ngan han\r\nEncodeColor(colorRed) + WriteIf(SellBreakout_SidewayDay, "\\n" + "   - Sell Breakdown (0): " + \r\nEncodeColor(colorDarkYellow) + "(-) Duoi EMA10: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\nEncodeColor(colorRed) + WriteIf(Sell5Day, "\\n" + "   - Sell 4 Day (4):           " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(Sell10Day, "\\n" + "   - Sell 8 Day (8):           " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellEMA5cross, "\\n" + "   - Sell EMA5 Cross (5): " + \r\nEncodeColor(colorDarkYellow) + "(-) EMA5 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellEMA10cross, "\\n" + "   - Sell EMA10 Cross (6): " + \r\nEncodeColor(colorDarkYellow) + "(-) EMA10 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellTurtle, "\\n" + "   - Sell Turtle Trading System: " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day Turtle, EMAFast &lt; EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorYellow) + WriteIf(exitArray, "\\n" + "   - Chu Y: " + \r\nEncodeColor(colorDarkYellow) + "(-) Thoat lenh Turtle truoc do (Chot loi, Cat lo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Canh bao Ban Dinh theo RSI\r\nEncodeColor(colorYellow) + WriteIf(SellRSIDivergence, "\\n" + "   - Ban Dinh theo RSI: " + \r\nEncodeColor(colorDarkYellow) + "(!) Dau hieu RSI phan ky Giam: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Tin hieu ATR\r\nEncodeColor(colorRed) + WriteIf(Sellatr, "\\n" + "   - Sell % &amp; ATR: " + \r\nEncodeColor(colorDarkYellow) + "(-) Theo % Dinh Day hoac ATR: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Muc giam tu Dinh gan nhat\r\nWriteIf( PivotShort AND NOT SellDinhTop, EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\nEncodeColor( colorRed ) + "  - Muc Giam tu Dinh gan nhat: " \r\n+ EncodeColor( colorGold) +"("+WriteVal( ( PivotSellPrice ), 1.1 ) +"): "\r\n+ EncodeColor( colorGold) +WriteVal( ( C - PivotSellPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotSellPrice ) * 100 / PivotSellPrice ), 1.1 ) + "%)" + \r\nEncodeColor( colorGold ) + "\\n   - Cho tin hieu Mua bat 'Day'!", "" ) +\r\n\r\n\r\n//====================================================================================================================\r\n\r\n\r\n//*************************************************************************************\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n//Buy Ichimoku\r\n\r\nWriteIf(Buyichimoku,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Buy Ichimoku Kinko Hyo:" ,"")+\r\n    \r\n    \r\n    EncodeColor(colorBlue) + WriteIf(Buyichimoku2 OR Buyichimoku3, "\\n" + "   - Buy (0): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan &amp; Kijun &amp; Trong hoac Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Buy (1): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Kijun &amp; Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Buy (2): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan + Tenkan vuot Kijun + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Buy (3): " + \r\n\tEncodeColor(colorLime) + "(+) Tenkan vuot Kijun + Tren Sen &amp; Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Buy (4): " + \r\n\tEncodeColor(colorLime) + "(+) SpanA vuot SpanB + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Buy (5): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan + Chikou vuot Gia + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen: " +\r\n\tEncodeColor(colorLime) + "(+) Mua Manh!: "+EncodeColor(colorYellow) + WriteVal(C,1.2) , "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot may Sen &amp; Kumo: " + \r\n\tEncodeColor(colorLime) + "(+) Mua rat Manh!!: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\n\tEncodeColor(colorViolet) + WriteIf(Bomno, "\\n"  + "   - Bung no: " + \r\n\tEncodeColor(colorLime) + "(+) Mua cuc Manh!!!: " + EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t\r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Song kiem hop bich Tenkan &amp; Kijun:" + \r\n\tEncodeColor(colorLime) + "(+) Mua Gia tang: " +EncodeColor(colorYellow) + WriteVal(TL ,1.2) , "") +\r\n\t\r\n\r\n\r\n//Sell Ichimoku\r\n\r\n\r\n\r\nWriteIf(Sellichimoku,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorRed) + "  - Sell Ichimoku Kinko Hyo: " ,"")+\t\r\n\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku1, "\\n" + "   - Sell (1): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Duoi Tenkan &amp; Kijun (Tren Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku2, "\\n" + "   - Sell (2): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Ban Manh!: Duoi Tenkan &amp; Kijun (Trong Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t                         \r\n\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku3, "\\n" + "   - Sell (3): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Ban rat Manh!!!: Duoi Tenkan &amp; Kijun (Duoi Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t \t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\t\r\n\r\n//*********************************************************************************************\r\n//|                            Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su."+"\\n + Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao."+"\\n +Co khoi luong thap hon 2 thanh truoc no. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap."+"\\n +Theo sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). "+"\\n  +Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam)."+"\\n +Voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon."+"\\n +Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. "+"\\n +Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). "+"\\n +Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. "+"\\n +Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . "+"\\n +Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. "+"\\n +Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu."+"\\n +Co the dang gap Vung Khang cu/Ho tro manh.","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. "+"\\n +Bao hieu xu huong giam sap ket thuc. ","") +\r\n\r\n\r\n\t\r\n//******************************************\r\n\r\n\r\n\r\n//Dien giai Nen Nhat\r\n\r\n\r\n WriteIf(BuyJapaneseCandle OR SellJapaneseCandle OR CoverJapaneseCandle OR ShortJapaneseCandle,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Japanese Candle: \\n","")+\r\n                                         \r\n\r\n\r\n\r\n \r\n      \r\n//Buy Candles Bullish \r\n//Nen canh bao Mua Tang Gia Manh\r\n//********************************\r\nWriteIf(BuyJapaneseCandle,EncodeColor(colorBlue)+"    - Buy: \\n" ,"") +\r\nEncodeColor(colorLime)+\r\nWriteIf(BullishAbandonedBaby,"(+) Abandoned Baby Bullish. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(ConcealingBabySwallow,"(+) Concealing Baby Swallow. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MorningDojiStar,"(+) Morning Doji Star. Mau hinh dao chieu.\\n Important sign of reversal.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MorningStar,"(+) Morning Star. Mau hinh dao chieu.\\n Nison: Tot hon nen theo kich thuoc tang cua nen trang (thu ba).\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeInsideUp,"(+) 3 Inside Up. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeOutsideUp,"(+) 3 Outside Up. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MAtHoldBullish,"(+) Mat Hold Bullish. Mau hinh tiep dien.\\n Nison: Trong 2-4 ngay co cay nen Giam gia.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(risingThreeMethods,"(+) Rising Three Methods. Mau hinh tiep dien. \\n Nison: No co y nghia lon hon neu khoi luong cua nen trang lon hon khoi luong cua nen den.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(sideBySideWhiteLines,"(+) Side by Side White Lines. Mau hinh tiep dien.\\n Nison: Neu trong mot xu huong giam co the duoc gay ra boi ricoperture la Ngan. \\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeWhiteSoldiers,"(+) 3 White Soldiers. Mau hinh tiep dien.\\n Nison: Tin hieu Tich cuc.\\n Nhung hay chu y den Mau hinh giam Gia truoc do va mau hinh tiep theo.\\n Do tin cay Cao. \\n","") +\r\n\r\n\r\n//Cover Candles Bullish \r\n//Nen canh bao Tang Gia nhe\r\n//**************************\r\n\r\n\r\nWriteIf(CoverJapaneseCandle,EncodeColor(colorGold)+"    - Cover: \\n","") +\r\nEncodeColor(colorLime)+\r\nWriteIf(BullishKicker,"(+) BullishKicker. Mau hinh dao chieu.\\n Than cay Nen cang Rong thi cang manh.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(EngulfingBull,"(+) Bullish Engulfing. Mau hinh dao chieu.\\n Nison: Cac yeu to lam tang hieu ung cua mo hinh la: \\n 1) Ngay dau tien (truoc do) cay nen co than nho, vao ngay thu hai co than nen rong.\\n 2) Mo hinh xuat hien sau khi di chuyen rat nhanh hoac rat keo dai. \\n 3) Khoi luong cao vao ngay thu hai (hien tai).\\n 4) Nhieu ngay co Nen bao phu cay Nen truoc. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishBeltHold,"(+) Belt Hold Bullish. Mau hinh dao chieu.\\n Than cay Nen cang Rong thi cang manh.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(breakAwayBullish,"(+) Break Bar Away Bullish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dojiStarBullish,"(+) Bullish Doji Star. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. Tin hieu Manh neu o vung Dinh cao.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(hammerBullish,"(+) Bullish Hammer. Mau hinh dao chieu.\\n Nison: Dau hieu Manh neu Than nen phia tren Hep va Duoi Nen phia duoi dai.\\n  Nen tang Gia se tot hon Nen giam Gia \\n Do tin cay Thap. \\n","") +\r\nWriteIf(dragonflyDoji,"(+) Dragonfly Doji. Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishHarami, "(+) Harami Bullish. Mau hinh dao chieu.\\n Nison: Tin hieu Yeu. Nen cho su xac nhan. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(BullishHaramiCross,"(+) Harami Cross. Mau hinh dao chieu.\\n Nison: Dau hieu Harami dang tin cay nhat.\\n  Dau hieu lon nhat se manh hon dau hieu thap hon. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(homingPigeon,"(+) Homing Pigeon. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(invertedHammer,"(+) Inverted Hammer. Mau hinh dao chieu.\\nNison: Nen cho su xac nhan Tang Gia phia sau.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(meetingLinesbullish,"(+) Meeting Lines bullish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(piercingLine,"(+) Piercing Line. Mau hinh dao chieu.\\n Nison: Day la Mo hinh Dao chieu Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(stickSandwich,"(+) Stick Sandwich. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeStarsInTheSouth,"(+) 3 Stars in the South. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(TriStarBottom,"(+) 3 Stars Bottom. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(triStarBullish,"(+) Tri-Star Bullish. Mau hinh dao chieu.\\n Nison: Mo hinh Dao chieu tuong doi Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeriverBottom,"(+) 3 River Bottom. Mau hinh dao chieu.\\n Nison: Ap luc Ban dang Giam dan.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishSeparatingLine,"(+) Separating Lines Bullish. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(upsideGapThreeMethods,"(+) Upside Gap 3 Methods. Mau hinh tiep dien.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeLineStrike,"(+) 3 Line Strike. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(TweezerBottoms,"(+) Tweezer Bottom. Mau hinh dao chieu.\\n  Cung voi su dao chieu cua cac nen khac co the cho thay muc ho tro.\\n Nison: Nen cho su xac nhan. \\n","") +\r\nWriteIf(UpwardGappingTasuki,"(+) Upside Tasuki Gap. Mau hinh tiep dien.\\n Nison: Than cua hai ngon nen trong khoang trong phai co cung do lon.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(Bull3Formation,"(+) Bull3Formation. \\n","") +\r\nWriteIf(BullishCounterAttack,"(+) BullishCounterAttack. \\n","") +\r\nWriteIf(SeperatingLines,"(+) SeperatingLines. \\n","") +\r\n\r\n\r\n//Sell Candle Down - Bearish \r\n//Nen canh bao Sell Giam Gia Manh\r\n//*********************************\r\n\r\nWriteIf(SellJapaneseCandle,EncodeColor(colorRed)+"    - Sell: \\n","") +\r\nEncodeColor(colorBrown)+\r\nWriteIf(BearishAbandonedBaby,"(-) Abandoned Baby Bearish. Mau hinh dao chieu.\\n Nison: Hiem khi xuat hien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(DarkCloudCover,"(-) Dark Cloud Cover. Mau hinh dao chieu.\\n Nison: Cac yeu to cho thay tam quan trong cua tin hieu nay la: \\n 1) Su tham nhap cua ngon nen dau tien trong ngon nen thu hai. \\n 2) Neu ca hai nen deu la nen Marabozu. \\n 3) Than cua cay nen thu hai o tren mot muc khang cu dang ke. \\n 4) Xay ra trong nhung ngay co khoi luong cao.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(EveningDojiStar,"(-) Evening Doji Star. Mau hinh dao chieu.\\n Nison: Phai duoc xac nhan boi mot cay nen den dai.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(EveningStar,"(-) Evening Star. Mau hinh dao chieu.\\n Nison: Khoang cach giua than nen thu hai va thu ba khong phai luc nao cung xuat hien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(idendicalThreeBlackCrows,"(-) Identical 3 Black Crows.\\n  Mo hinh dao chieu cua xu huong tang truoc do.\\n Nison: Dau hieu Giam rat ro rang.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(BearishKicker,"(-) Kicking Bearish. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeInsideDownBearish,"(-) 3 Inside Down. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeoutsideDownBearish,"(-) 3 Outside Down. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(upsideGapTwoCrows,"(-) Upside Gap 2 Crows. Mau hinh dao chieu.\\n Nison: Yeu cau xac nhan voi su dao nguoc tiep tuc vao ngay thu ba.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(fallingThreeMethods,"(-) Falling 3 Methods. Mau hinh tiep dien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeBlackCrows,"(-) 3 Black Crows. Mau hinh dao chieu.\\n Nison: Nen chu y neu trong xu  the tang. \\n Do tin cay Cao. \\n","") +\r\n\r\n\r\n//Short sell Candle Down - Bearish \r\n//Nen canh bao Sell Giam Gia nhe\r\n//**************************************\r\n\r\nWriteIf(ShortJapaneseCandle,EncodeColor(colorGold)+"    - Short: \\n" ,"") +\r\nEncodeColor(colorBrown)+\r\nWriteIf(advanceBlockBearish,"(-) advanceBlockBearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishBeltHold,"(-) Belt Hold Bearish. Mau hinh dao chieu.\\n Nison: Chieu cao cua nen cang dai thi cang Manh. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(breakAwayBearish,"(-) breakvar Away Bearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(HangingMan,"(-) Hanging Man. Mau hinh dao chieu.\\n Nison: Nhu mot 'cay Nen bua giam gia' voi mot khoang trong dang ke vao ngay hom sau. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(deliberationBearish,"(-) Deliberation Bearish. Mau hinh dao chieu.\\n Nison: Day khong phai la mot mo hinh dao chieu thuc su.\\n  Nhung la mot dau hieu cho thay su phuc hoi dang suy yeu. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishCounterAttack,"(-) Counter Attack Bearish.\\n Nison: Dau hieu tiem nang cua su Giam gia. \\n","") +\r\nWriteIf(EngulfingBear,"(-) Engulfing Bearish. Mau hinh dao chieu.\\n Nison: Dau hieu dao chieu quan trong.\\n  Cac yeu to lam tang tam quan trong cua cac mau la: \\n 1) Phia tren cay nen co than rat nho VA cay nen thu hai co than rat lon. \\n 2) Mau hinh xuat hien sau mot xu huong tang gia nhanh truoc do. \\n 3) Khoi luong cao trong Ngay thu Hai. \\n 4) Vao Ngay thu hai bao phu than nen nhieu hon so voi than nen truoc day.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(HammerBearish,"(-) HammerBearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dragonflyDojiBearish,"(-) Dragonfly Doji Bearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishHarami,"(-) Bearish Harami. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishHaramiCross,"(-) Harami Cross Bearish. Mau hinh dao chieu.\\n Nison: Mau hinh bao xu huong giam dang ke hon so voi Nen 'Harami'. \\n Ngay thu hai, cay nen co the co mau trang hoac den.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(MeetingLinesBearish,"(-) Meeting Lines Bearish. Mau hinh dao chieu.\\n Nhung khong qua manh nhu Nen 'Dark Cloud Cover'. \\n Do tin cay Trung binh. ","") +\r\nWriteIf(ShootingStar,"(-) Shooting Star. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(shootingStarGap,"(-) Shooting Star. Mau hinh dao chieu.\\n Nison: Khong quan trong nhu Nen 'evening star'. \\n Tot nhat, than nen phai nam trong mot khoang trong so voi than nen truoc do.\\n No se xuat hien sau mot xu huong tang truoc do.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(GraveStoneDoji,"(-) Gravestone Doji. Mau hinh dao chieu.\\n Nison: Tin hieu quan trong hon khi cham muc cao nhat lich su.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(triStarBearish,"(-) Tri-Star Bearish. Mau hinh dao chieu.\\n Nison: Mau hinh dao chieu rat Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(twoCrows,"(-) 2 Crows. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dojiStarBearish,"(-) Doji Star Bearish. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(downsideGapThreeMethods,"(-) Downside Gap 3 Methods. Mau hinh tiep dien. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(DownwardGappingTasuki,"(-) Downside Tasuki Gap. Dau hieu tiep dien xu the.\\n Nison: Neu ngay cuoi cung Gap bi dong lai.\\n No hinh tiep tuc se bi tu choi.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(inNeckBearish,"(-) In Neck Bearish. Mau hinh tiep dien.\\n Nison: Giong nhu Nen 'piercing pattern' .\\n Nhung giam nhieu hon vao ngay thu hai vi khong co su xam nhap.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(OnNeckBearish,"(-) On Neck Bearish. Mau hinh tiep dien.\\n Nison: Giong nhu Nen 'piercing' - Nen xuyen thau.\\n Nhung giam gia hon vi khong co su xam nhap nao vao ngay thu hai.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishSeparatingLine,"(-) Separating Lines Bearish. \\n","") +\r\nWriteIf(sideBySideWhiteLinesBearish,"(-) Side by Side White Lines Bearish. Mau hinh tiep dien.\\n Nison: Hiem khi xay ra.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeLineStrike,"(-) 3 Line Strike. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(thrustingBearish,"(-) Thrusting - Luc day Manh. Mau hinh tiep dien.\\n Nison: Khong phai la ngay dao chieu.\\n Boi vi ngay thu hai khong tham gia vao diem giua cua ngay dau tien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(TweezerTops,"(-) Tweezer Top. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. \\n","")+\r\nWriteIf(Bear3Formation,"(-) Bear3Formation. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(TriStarTop,"(-) TriStarTop. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(InvertedBlackHammer,"(-) InvertedBlackHammer. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") \r\n\r\n\r\n\r\n\t\r\n\t\r\n\r\n//*************************************************************************************\r\n//                       Hien thi Phan dien giai VSA                                       \r\n//====================================================================================|\r\n//*************************************************************************************\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n//|                  END TITLE - TIEU DE 2  (Co dien giai VSA)                                   \r\n//|============================================================================================|\r\n//**********************************************************************************************\r\n\r\n\r\n//==============================================================================================================\r\n\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n//|                  TITLE - TIEU DE 3 (Tin hieu Bat Dinh + Day)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "* - Hien thi TITLE - TIEU DE (Bat Dinh - Day)",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE 3                                  |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 Full Indicator (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + " (" + MarketID(2) + ") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n//Volume\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\n\r\n//***************************************************\r\n//Thay doi mau sac theo Volume\r\nEncodeColor(colorBlue) + "   - Total Volume: "+ \r\n\r\nWriteIf(V&gt;=maVolume*1.6,                     EncodeColor(colorViolet)+    WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,\r\nWriteIf(V&lt;maVolume*1.6 AND V&gt;=maVolume*1.1 ,EncodeColor(colorLime)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",\r\nWriteIf(V&lt;maVolume*1.1 AND V&gt;=maVolume*0.9,EncodeColor(colorGold)+      WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ",\r\nWriteIf(V&lt;maVolume*0.9 AND V&gt;=maVolume*0.5, EncodeColor(colorRed)+       WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  " ,\r\nWriteIf(V&lt;maVolume*0.5,                      EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(PmaVolume,1.0) + "%  ","")))))+\r\n\r\n//MA30 Volume\r\nEncodeColor(colorBlue)+ "MA30: " + EncodeColor(colorYellow) + WriteVal(maVolume,1.0)+\r\n\r\n//Danh gia Volume\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;=maVolume*1.6,                        EncodeColor(colorViolet)+   " SIEU CAO",\r\nWriteIf(V&lt;maVolume*1.6  AND V&gt;=maVolume*1.1,   EncodeColor(colorLime)+     " CAO",\r\nWriteIf(V&lt;maVolume*1.1 AND V&gt;=maVolume*0.9,   EncodeColor(colorGold)+     " TRUNG BINH",\r\nWriteIf(V&lt;maVolume*0.9 AND V&gt;=maVolume*0.5,    EncodeColor(colorRed)+      " THAP",\r\nWriteIf(V&lt;maVolume*0.5,                         EncodeColor(colorTurquoise)+" SIEU THAP","")))))+\r\n\r\n//Buy or Sell Volume\r\n"\\n" +\r\nEncodeColor(colorBlue)+   "   - Buy Vol: "+ EncodeColor(colorYellow)+WriteVal(BuyVolume,1.0)+ EncodeColor(colorSeaGreen)+ "   (= "+ WriteVal(BuyVolumep,1.0)+"%" +  " Total"\r\n+")   "+\r\nEncodeColor(colorRed)+   " -   Sell Vol: "+EncodeColor(colorYellow)+WriteVal(SellVolume,1.0)+ EncodeColor(colorSeaGreen)+"   (= "+ WriteVal(SellVolumep,1.0)+"%" +  " Total"\r\n+")   "+\r\nEncodeColor(colorLime)+  " -   Net Vol: "+EncodeColor(colorYellow)+WriteVal(BuyVolume-SellVolume,1.0)+\r\n\r\n\r\n\r\n\r\n\r\n//***************************************************\r\n// Open High Low Close\r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open:    " +  EncodeColor(colorYellow) +WriteVal(O,1.2)+ \r\nEncodeColor(colorLime) + "   -   High:  " +  EncodeColor(colorYellow) +WriteVal(H,1.2)+ \r\nEncodeColor(colorRed)  + "   -   Low:  " +   EncodeColor(colorYellow) +WriteVal(L,1.2)+ \r\n\r\n//***************************************************\r\n//Thay doi mau theo gia Close\r\nEncodeColor(colorSeaGreen) + "   -   Close:  " +\r\n\r\n//Gia tran&gt;6%\r\nWriteIf(xx&gt;=6,\r\nEncodeColor(colorViolet)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Gia san&lt;6%\r\nWriteIf(xx&lt;=-6,\r\nEncodeColor(colorTurquoise) +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Tang gia\r\nWriteIf(xx&gt;0 AND xx&lt;6,\r\nEncodeColor(colorLime)   +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Giam gia\r\nWriteIf(xx&lt;0 AND xx&gt;-6,\r\nEncodeColor(colorRed)       +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)",\r\n//Tham chieu\r\nEncodeColor(colorGold)    +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)"))))+\r\n\r\n//***************************************************\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Spread: ")+\r\n\r\nWriteIf(spread &gt;=avgSpread*1.5,                             EncodeColor(colorViolet)+   " RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;=avgSpread*1.1 ,   EncodeColor(colorLime)+     " TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread*1.1 AND spread &gt;= AvgSpread*0.9, EncodeColor(colorGold)+     " TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.9 AND spread &gt;= AvgSpread*0.4, EncodeColor(colorRed)+      " DUOI TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.4,                             EncodeColor(colorTurquoise)+" HEP","")))))+\r\n\r\n\r\n//***************************************************\r\n(EncodeColor(colorBlue)+"   -   Vi tri Close: ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+   " CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorLime)+     " PHIA TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorGold)+     " NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+      " PHIA DUOI",\r\nWriteIf(ClosePos==1,EncodeColor(colorTurquoise)+" THAP NHAT",\r\n                    EncodeColor(colorYellow)   +" KHONG DOI")))))+\r\n\r\n                     \r\n                    \r\n                    \r\n//***************************************************\r\n//Danh gia xu huong\r\n\r\n("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" + // Xuong dong\r\n\r\n//Suc manh MACD \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(MACDStrength==1,  EncodeColor(colorLime)     +  " MACD Strength:          TANG - UP",\r\nWriteIf(MACDStrength==-1, EncodeColor(colorRed)      +  " MACD Strength:          GIAM - DOWN",\r\n                         EncodeColor(colorGold)      +  " MACD Strength:          Khong ro rang"))+\r\n\r\n//Suc manh RSI \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(RSIStrength==1,  EncodeColor(colorLime)     +  " RSI Strength:               TANG - UP",\r\nWriteIf(RSIStrength==-1, EncodeColor(colorRed)      +  " RSI Strength:               GIAM - DOWN",\r\n                         EncodeColor(colorGold)     +  " RSI Strength:               Khong ro rang"))+\r\n                         \r\n//Xu huong ngan han hien tai\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorLime)         +  " Xu huong hien tai:      TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)          +  " Xu huong hien tai:      GIAM - DOWN",\r\n                 EncodeColor(colorGold)         +  " Xu huong hien tai:      Khong ro rang"))+\r\n\r\n//Xu huong trung gian thu cap                 \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorLime)       +  " Xu huong thu cap:      TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)        +  " Xu huong thu cap:      GIAM - DOWN",\r\n                   EncodeColor(colorGold)       +  " Xu huong thu cap:      Khong ro rang"))+\r\nWriteIf(upminoroff,  EncodeColor(colorOrange)   +  " (Xu huong TANG thu cap co the thay doi)",\r\nWriteIf(dnminoroff,  EncodeColor(colorSeaGreen) +  " (Xu huong GIAM thu cap co the thay doi)","" ))+\r\n\r\n//Xu huong chinh (trung han)\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(trenddaihan==1,  EncodeColor(colorLime) +  " Xu huong chinh:         TANG - UP",\r\nWriteIf(trenddaihan==-1,EncodeColor(colorRed)   +  " Xu huong chinh:         GIAM - DOWN",\r\n                     EncodeColor(colorGold)     +  " Xu huong chinh:         Khong ro rang"))+\r\nWriteIf(upmajoroff,EncodeColor(colorOrange)     +  " (Xu huong TANG chinh co the thay doi)",\r\nWriteIf(dnmajoroff,EncodeColor(colorSeaGreen)   +  " (Xu huong GIAM chinh co the thay doi)","" ))+\r\n\r\n\r\n\r\n//Xu huong EMAs \r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(EMAStrength==1,  EncodeColor(colorLime)     +  " Xu huong EMAs:         TANG - UP",\r\nWriteIf(EMAStrength==-1, EncodeColor(colorRed)      +  " Xu huong EMAs:         GIAM - DOWN",\r\n                      EncodeColor(colorGold)     +  " Xu huong EMAs:         Khong ro rang"))+\r\n                      \r\n//Xu huong Ichimoku\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(Xuhuongichimoku==1,  EncodeColor(colorLime) +" Xu huong Ichimoku:   TANG - UP",\r\nWriteIf(Xuhuongichimoku==-1, EncodeColor(colorRed)  +" Xu huong Ichimoku:   GIAM - DOWN",\r\nWriteIf(Xuhuongichimoku==0,EncodeColor(colorGold)   +" Xu huong Ichimoku:   Khong ro rang","" )))+\r\n                                                               \r\nWriteIf(XuhuongIchimokuTangoff,EncodeColor(colorOrange)     +"  (Xu huong TANG Ichimoku co the thay doi)",\r\nWriteIf(XuhuongIchimokuGiamoff,EncodeColor(colorSeaGreen)   +"  (Xu huong GIAM Ichimoku co the thay doi)","" ))+\r\n\r\n\r\n\r\n\r\n//====================================================================================================\r\n//Luot song ngan han\r\n\r\n//Buy\r\n\r\nWriteIf(Buyluotsong,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Buy Luot song:" ,"")+\r\n     \r\n//Canh bao Day - Bottom\r\nEncodeColor(colorYellow) + WriteIf(DayBottom, "\\n" + "   - Chu y: (!) ", "") + \r\nEncodeColor( colorLime ) +WriteIf ( BuyDayBottom , "Tinhieu: Mua bat 'Day'" +\r\nEncodeColor( colorLime ) + "\\n   - Gia Mua:        " + EncodeColor( colorGold ) +WriteVal( C, 1.1 ) + \r\nEncodeColor( colorLime ) +" - Gia muc tieu:     " +  EncodeColor( colorGold) +WriteVal( PivotSellPrice, 1.1 ) + " (" + WriteVal( ( PivotSellPrice - PivotBuyPrice), 1.1 ) + "="+ WriteVal( ( PivotSellPrice - PivotBuyPrice)*100/PivotBuyPrice, 1.0 )+"%" +")" + \r\nEncodeColor( colorRed ) +"\\n   - Gia Cutloss: " + EncodeColor( colorGold ) + WriteVal( C * .95, 1.1 ) + \r\nEncodeColor( colorLime) + " - Ty le LN/Rui do: " + EncodeColor( colorGold) + WriteVal( ( PivotProfitTaker - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" , "" ) +\r\n\r\n\t\r\n//Buy Luot song ngan han\r\nEncodeColor(colorBlue) + WriteIf(BuyBreakout_SidewayDay, "\\n" + "   - Buy Brekout (0): " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(Buy5Day, "\\n" + "   - Buy 4 Day (4):     " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(Buy10Day, "\\n" + "   - Buy 8 Day (8):     " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyEMA5cross, "\\n" + "   - Buy EMA5 Cross (5): " + \r\nEncodeColor(colorLime) + "(+) EMA5 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyEMA10cross, "\\n" + "   - Buy EMA10 Cross (6): " + \r\nEncodeColor(colorLime) + "(+) EMA10 vuot EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorBlue) + WriteIf(BuyTurtle, "\\n" + "   - Buy Turtle Trading System: " + \r\nEncodeColor(colorLime) + "(+) Vuot Dinh Turtle + EMAFast &gt; EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Canh bao Bat Day theo RSI\r\nEncodeColor(colorYellow) + WriteIf(BuyRSIDivergence, "\\n" + "   - Bat day theo RSI: " + \r\nEncodeColor(colorLime) + "(!) Dau hieu RSI phan ky Tang: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Tin hieu ATR\r\nEncodeColor(colorBlue) + WriteIf(Buyatr, "\\n" + "   - Buy % &amp; ATR: " + \r\nEncodeColor(colorLime) + "(+) Buy theo % Dinh Day hoac ATR: "  +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n\r\n//Ket qua Mua Day\r\nEncodeColor( colorLime ) +WriteIf( PivotLong AND NOT BuyDayBottom, EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n"  - Ket Qua:"  + \r\nEncodeColor( colorLime) +" Lenh (Mua bat 'Day')" + \r\nEncodeColor( colorGold )  +"\\n   - Gia Mua:        " +  WriteVal( ( PivotBuyPrice ), 1.1 ) +\r\nEncodeColor( colorLime ) + " - Loi nhuan: " + EncodeColor( colorBrightGreen) + WriteVal( ( C - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" +\r\nEncodeColor( colorRed ) + "\\n   - Gia Cutloss: " + EncodeColor( colorGold) + WriteVal( ( PivotBuyPrice * .95 ), 1.1 ) + \r\nEncodeColor( colorSeaGreen ) + " - Ty le LN/Rui do hien tai: " + \r\nEncodeColor( colorGold) + WriteVal( ( C - PivotBuyPrice ) / ( PivotBuyPrice - PivotBuyPrice * 0.95 ), 1.1 ) + " (Lan)" + " - " + \r\nEncodeColor( colorGold ) + " Cu de Lai chay tiep!", "" ) +  \r\n\r\n//***********************************\r\n\r\n\r\n//Sell\r\n\r\nWriteIf(Sellluotsong,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorRed) + "  - Sell Luot song: " ,"")+\t\r\n\r\n\r\n//Canh bao Dinh - Top\r\nEncodeColor(colorYellow) + WriteIf(DinhTop, "\\n" + "   - Chu y: (!) " + \r\nEncodeColor(colorYellow) + "Dau hieu tao Dinh ngan han: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\nEncodeColor( colorYellow ) +WriteIf ( SellDinhTop , "\\n   - Tinhieu: (-) Ban chot lenh (Mua bat 'Day') truoc" + \r\nEncodeColor( colorRed ) +"\\n   - Gia Ban: " + EncodeColor( colorGold )  +WriteVal( C, 1.1 ) + \r\nEncodeColor( colorLime )  +" - Loi nhuan: " +  EncodeColor( colorGold ) + WriteVal( ( PivotSellPrice - PivotBuyPrice ), 1.1 ) + " (" + WriteVal( ( ( PivotSellPrice - PivotBuyPrice ) * 100 / PivotBuyPrice ), 1.1 ) + "%)" , "" ) +\r\n\r\n//Sell luot song ngan han\r\nEncodeColor(colorRed) + WriteIf(SellBreakout_SidewayDay, "\\n" + "   - Sell Breakdown (0): " + \r\nEncodeColor(colorDarkYellow) + "(-) Duoi EMA10: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\nEncodeColor(colorRed) + WriteIf(Sell5Day, "\\n" + "   - Sell 4 Day (4):           " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day T4: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(Sell10Day, "\\n" + "   - Sell 8 Day (8):           " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day T8: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellEMA5cross, "\\n" + "   - Sell EMA5 Cross (5): " + \r\nEncodeColor(colorDarkYellow) + "(-) EMA5 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellEMA10cross, "\\n" + "   - Sell EMA10 Cross (6): " + \r\nEncodeColor(colorDarkYellow) + "(-) EMA10 duoi EMAs dai: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorRed) + WriteIf(SellTurtle, "\\n" + "   - Sell Turtle Trading System: " + \r\nEncodeColor(colorDarkYellow) + "(-) Pha Day Turtle, EMAFast &lt; EMASlow: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\nEncodeColor(colorYellow) + WriteIf(exitArray, "\\n" + "   - Chu Y: " + \r\nEncodeColor(colorDarkYellow) + "(-) Thoat lenh Turtle truoc do (Chot loi, Cat lo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Canh bao Ban Dinh theo RSI\r\nEncodeColor(colorYellow) + WriteIf(SellRSIDivergence, "\\n" + "   - Ban Dinh theo RSI: " + \r\nEncodeColor(colorDarkYellow) + "(!) Dau hieu RSI phan ky Giam: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Tin hieu ATR\r\nEncodeColor(colorRed) + WriteIf(Sellatr, "\\n" + "   - Sell % &amp; ATR: " + \r\nEncodeColor(colorDarkYellow) + "(-) Theo % Dinh Day hoac ATR: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\r\n//Muc giam tu Dinh gan nhat\r\nWriteIf( PivotShort AND NOT SellDinhTop, EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\nEncodeColor( colorRed ) + "  - Muc Giam tu Dinh gan nhat: " \r\n+ EncodeColor( colorGold) +"("+WriteVal( ( PivotSellPrice ), 1.1 ) +"): "\r\n+ EncodeColor( colorGold) +WriteVal( ( C - PivotSellPrice ), 1.1 ) + " (" + WriteVal( ( ( C - PivotSellPrice ) * 100 / PivotSellPrice ), 1.1 ) + "%)" + \r\nEncodeColor( colorGold ) + "\\n   - Cho tin hieu Mua bat 'Day'!", "" ) +\r\n\r\n\r\n//====================================================================================================================\r\n\r\n\r\n//*************************************************************************************\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n//Buy Ichimoku\r\n\r\nWriteIf(Buyichimoku,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Buy Ichimoku Kinko Hyo:" ,"")+\r\n    \r\n    \r\n    EncodeColor(colorBlue) + WriteIf(Buyichimoku2 OR Buyichimoku3, "\\n" + "   - Buy (0): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan &amp; Kijun &amp; Trong hoac Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Buy (1): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Kijun &amp; Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Buy (2): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan + Tenkan vuot Kijun + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Buy (3): " + \r\n\tEncodeColor(colorLime) + "(+) Tenkan vuot Kijun + Tren Sen &amp; Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Buy (4): " + \r\n\tEncodeColor(colorLime) + "(+) SpanA vuot SpanB + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Buy (5): " + \r\n\tEncodeColor(colorLime) + "(+) Vuot Tenkan + Chikou vuot Gia + Tren Kumo: " +EncodeColor(colorYellow) + WriteVal(C,1.2)+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen: " +\r\n\tEncodeColor(colorLime) + "(+) Mua Manh!: "+EncodeColor(colorYellow) + WriteVal(C,1.2) , "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot may Sen &amp; Kumo: " + \r\n\tEncodeColor(colorLime) + "(+) Mua rat Manh!!: " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\n\tEncodeColor(colorViolet) + WriteIf(Bomno, "\\n"  + "   - Bung no: " + \r\n\tEncodeColor(colorLime) + "(+) Mua cuc Manh!!!: " + EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t\r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Song kiem hop bich Tenkan &amp; Kijun:" + \r\n\tEncodeColor(colorLime) + "(+) Mua Gia tang: " +EncodeColor(colorYellow) + WriteVal(TL ,1.2) , "") +\r\n\t\r\n\r\n\r\n//Sell Ichimoku\r\n\r\n\r\n\r\nWriteIf(Sellichimoku,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorRed) + "  - Sell Ichimoku Kinko Hyo: " ,"")+\t\r\n\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku1, "\\n" + "   - Sell (1): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Duoi Tenkan &amp; Kijun (Tren Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \r\n\t\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku2, "\\n" + "   - Sell (2): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Ban Manh!: Duoi Tenkan &amp; Kijun (Trong Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t                         \r\n\r\n\tEncodeColor(colorRed) + WriteIf(Sellichimoku3, "\\n" + "   - Sell (3): " + \r\n\tEncodeColor(colorDarkYellow) + "(-) Ban rat Manh!!!: Duoi Tenkan &amp; Kijun (Duoi Kumo): " +EncodeColor(colorYellow) + WriteVal(C,1.2), "") + \t \t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\r\n\r\n//====================================================================================================================\r\n\r\n\r\n\r\n "\\n" +  EncodeColor( colorLightGrey ) +":::::::::::::::::::::::::::::::::::::::::::::::::::::::::"\r\n\r\n//Cac chi bao ky thuat\r\n\r\n//AccDist\r\n+ "\\n" + EncodeColor( colorLime ) + "   - AccDist ():        " \r\n+ WriteIf( wuWilliamR, EncodeColor( colorLime ) + "Tich luy", \r\n  WriteIf( wdWilliamR, EncodeColor( colorRed ) + "Phan phoi", EncodeColor( colorGold ) +"Khong ro" ) )\r\n  \r\n//RSI\r\n+ "\\n" + EncodeColor( colorLime ) + "   - RSI (14):         " \r\n+ WriteIf( RSI( 14 ) &gt;= 70 ,                   EncodeColor( colorViolet )+" OverBought: "  , \r\n  WriteIf( RSI( 14 ) &gt;= 50 AND RSI( 14 ) &lt; 70, EncodeColor( colorLime )+" Up: " ,\r\n  WriteIf( RSI( 14 )  &lt; 50 AND RSI( 14 ) &gt; 30, EncodeColor( colorRed )+" Down: " ,\r\n                                               EncodeColor( colorBrown )+" OverSold: ")))\r\n+ WriteVal( RSI( 14 ), format = 1.1 )\r\n\r\n//CCI\r\n+ "\\n" + EncodeColor( colorLime ) + "   - CCI (14):         " \r\n+ WriteIf( CCI( 14 ) &gt;= 100 ,                   EncodeColor( colorViolet )+" OverBought: "  , \r\n  WriteIf( CCI( 14 ) &gt;= 0 AND CCI( 14 ) &lt; 100,  EncodeColor( colorLime )+" Up: " ,\r\n  WriteIf( CCI( 14 )  &lt; 0 AND CCI( 14 ) &gt; -100, EncodeColor( colorRed )+" Down: " ,\r\n                                                EncodeColor( colorBrown )+" OverSold: " )))\r\n+ WriteVal( CCI( 14 ), format = 1.1 )\r\n\r\n//ROC\r\n+ "\\n" + EncodeColor( colorLime ) + "   - ROC (C,14):   " \r\n+ WriteIf( ROC( C, 14 ) &gt;= 10 ,                   EncodeColor( colorViolet )+" OverBought: "  , \r\n  WriteIf( ROC( C, 14 ) &gt;= 0 AND ROC( C, 14 ) &lt; 10,  EncodeColor( colorLime )+" Up: " ,\r\n  WriteIf( ROC( C, 14 )  &lt; 0 AND ROC( C, 14 ) &gt; -10, EncodeColor( colorRed )+" Down: " ,\r\n                                                EncodeColor( colorBrown )+" OverSold: " )))\r\n+ WriteVal( ROC( C, 14 ), format = 1.1 )\r\n\r\n//Wm%R\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Wm%R (14):  " \r\n+ WriteIf( WilliamR &gt;= -20 ,                   EncodeColor( colorViolet )+" OverBought: "  , \r\n  WriteIf( WilliamR &gt;= -50 AND WilliamR &lt; -20,  EncodeColor( colorLime )+" Up: " ,\r\n  WriteIf( WilliamR  &lt; -50 AND WilliamR &gt; -80, EncodeColor( colorRed )+" Down: " ,\r\n                                                EncodeColor( colorBrown )+" OverSold: " )))\r\n+ WriteVal( WilliamR, format = 1.1 )\r\n\r\n\r\n+ "\\n" +  EncodeColor( colorLightGrey ) +":::::::::::::::::::::::::::::::::::::::::::::::::::::::::"\r\n\r\n\r\n//Tin hieu Buy Sell theo chi bao ky thuat\r\n\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Signal (RSI):       " \r\n+ WriteIf( RSIbuy, EncodeColor( colorLime)    + "Buy", \r\nWriteIf( RSIsell, EncodeColor( colorRed )     + "Sell", \r\nWriteIf( RSIBullish, EncodeColor( colorLime ) + "Bullish", \r\nWriteIf( RSIBearish, EncodeColor( colorRed )  + "Bearish", "Neutral" ) ) ) )\r\n\r\n\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Signal (MACD):  " \r\n+ WriteIf( MACDbuy, EncodeColor( colorLime )  + "Buy", \r\nWriteIf( MACDsell, EncodeColor( colorRed )    + "Sell", \r\nWriteIf( MACDBulish, EncodeColor( colorLime ) + "Bullish", \r\nWriteIf( MACDBearish, EncodeColor( colorRed ) + "Bearish", "Neutral" ) ) ) )\r\n\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Signal (Stoch):   " \r\n+ WriteIf( StochBuy, EncodeColor( colorLime )   + "Buy", \r\nWriteIf( StochSell, EncodeColor( colorRed )     + "Sell", \r\nWriteIf( StochBullish, EncodeColor( colorLime ) + "Bullish", \r\nWriteIf( StochBearish, EncodeColor( colorRed )  + "Bearish", "Neutral" ) ) ) )\r\n\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Signal (ADX):      " \r\n+ WriteIf( ADXBuy, EncodeColor( colorLime )   + "Buy", \r\nWriteIf( ADXSell, EncodeColor( colorRed )     + "Sell", \r\nWriteIf( ADXBullish, EncodeColor( colorLime ) + "Bullish", \r\nWriteIf( ADXBearish, EncodeColor( colorRed )  + "Bearish", "Neutral" ) ) ) )\r\n\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Signal (ZeroLagTMA):   " \r\n+ WriteIf( TMBuy, EncodeColor(colorLime ) + "Buy", \r\nWriteIf( TMSell, EncodeColor( colorRed )  + "Sell", \r\nWriteIf( TMBuy1, EncodeColor( colorLime ) + "Bullish", \r\nWriteIf( TMSell1, EncodeColor( colorRed ) + "Bearish", "Neutral" ) ) ) )\r\n\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Signal (ZeroLagEMA):   " \r\n+ WriteIf( ZeroLagBuy, EncodeColor(colorLime ) + "Buy", \r\nWriteIf( ZeroLagSell, EncodeColor( colorRed )  + "Sell", \r\nWriteIf( ZeroLagBuy1, EncodeColor( colorLime ) + "Bullish", \r\nWriteIf( ZeroLagSell1, EncodeColor( colorRed ) + "Bearish", "Neutral" ) ) ) )\r\n\r\n\r\n\r\n\r\n\r\n\r\n+  "\\n" +  EncodeColor( colorLightGrey ) +":::::::::::::::::::::::::::::::::::::::::::::::::::::::::"\r\n\r\n//Ho tro khang cu\r\n\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Diem thoat lenh : " + EncodeColor( colorLime ) + WriteVal( PivotTrailStop, format = 1.0 )\r\n+ "\\n" + EncodeColor( colorLime ) + "   - Diem chot Lai : " + EncodeColor( colorLime ) + WriteVal( PivotProfitTaker, format = 1.0 )\r\n+ "\\n" +EncodeColor( colorRed ) + "   - R1: " + EncodeColor( colorGold ) + WriteVal( r1RS, format = 1.0 )\r\n+ EncodeColor( colorRed ) + " R2: " + EncodeColor( colorGold ) + WriteVal( r2RS, format = 1.0 )\r\n+ EncodeColor( colorRed ) + " R3: " + EncodeColor( colorGold ) + WriteVal( r3RS, format = 1.0 )\r\n+ "\\n" +EncodeColor( colorBlue ) + "   - S1: " + EncodeColor( colorGold ) + WriteVal( s1RS, format = 1.0 )\r\n+ EncodeColor( colorBlue ) + " S2: " + EncodeColor( colorGold ) + WriteVal( s2RS, format = 1.0 )\r\n+EncodeColor( colorBlue ) + " S3: " + EncodeColor( colorGold ) + WriteVal( s3RS, format = 1.0 ) +\r\n\r\n  \r\n\r\n\t\r\n\t\r\n\t\t\r\n\r\n//*********************************************************************************************\r\n//|                            Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su."+"\\n + Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao."+"\\n +Co khoi luong thap hon 2 thanh truoc no. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap."+"\\n +Theo sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). "+"\\n  +Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam)."+"\\n +Voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon."+"\\n +Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. "+"\\n +Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). "+"\\n +Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. "+"\\n +Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . "+"\\n +Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. "+"\\n +Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. "+"\\n +Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu."+"\\n +Co the dang gap Vung Khang cu/Ho tro manh.","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. "+"\\n +Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. "+"\\n +Bao hieu xu huong giam sap ket thuc. ","") +\r\n\r\n\r\n\t\r\n//******************************************\r\n\r\n\r\n\r\n//Dien giai Nen Nhat\r\n\r\n\r\n WriteIf(BuyJapaneseCandle OR SellJapaneseCandle OR CoverJapaneseCandle OR ShortJapaneseCandle,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Japanese Candle: \\n","")+\r\n                                         \r\n\r\n\r\n\r\n \r\n      \r\n//Buy Candles Bullish \r\n//Nen canh bao Mua Tang Gia Manh\r\n//********************************\r\nWriteIf(BuyJapaneseCandle,EncodeColor(colorBlue)+"    - Buy: \\n" ,"") +\r\nEncodeColor(colorLime)+\r\nWriteIf(BullishAbandonedBaby,"(+) Abandoned Baby Bullish. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(ConcealingBabySwallow,"(+) Concealing Baby Swallow. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MorningDojiStar,"(+) Morning Doji Star. Mau hinh dao chieu.\\n Important sign of reversal.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MorningStar,"(+) Morning Star. Mau hinh dao chieu.\\n Nison: Tot hon nen theo kich thuoc tang cua nen trang (thu ba).\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeInsideUp,"(+) 3 Inside Up. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeOutsideUp,"(+) 3 Outside Up. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(MAtHoldBullish,"(+) Mat Hold Bullish. Mau hinh tiep dien.\\n Nison: Trong 2-4 ngay co cay nen Giam gia.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(risingThreeMethods,"(+) Rising Three Methods. Mau hinh tiep dien. \\n Nison: No co y nghia lon hon neu khoi luong cua nen trang lon hon khoi luong cua nen den.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(sideBySideWhiteLines,"(+) Side by Side White Lines. Mau hinh tiep dien.\\n Nison: Neu trong mot xu huong giam co the duoc gay ra boi ricoperture la Ngan. \\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeWhiteSoldiers,"(+) 3 White Soldiers. Mau hinh tiep dien.\\n Nison: Tin hieu Tich cuc.\\n Nhung hay chu y den Mau hinh giam Gia truoc do va mau hinh tiep theo.\\n Do tin cay Cao. \\n","") +\r\n\r\n\r\n//Cover Candles Bullish \r\n//Nen canh bao Tang Gia nhe\r\n//**************************\r\n\r\n\r\nWriteIf(CoverJapaneseCandle,EncodeColor(colorGold)+"    - Cover: \\n","") +\r\nEncodeColor(colorLime)+\r\nWriteIf(BullishKicker,"(+) BullishKicker. Mau hinh dao chieu.\\n Than cay Nen cang Rong thi cang manh.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(EngulfingBull,"(+) Bullish Engulfing. Mau hinh dao chieu.\\n Nison: Cac yeu to lam tang hieu ung cua mo hinh la: \\n 1) Ngay dau tien (truoc do) cay nen co than nho, vao ngay thu hai co than nen rong.\\n 2) Mo hinh xuat hien sau khi di chuyen rat nhanh hoac rat keo dai. \\n 3) Khoi luong cao vao ngay thu hai (hien tai).\\n 4) Nhieu ngay co Nen bao phu cay Nen truoc. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishBeltHold,"(+) Belt Hold Bullish. Mau hinh dao chieu.\\n Than cay Nen cang Rong thi cang manh.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(breakAwayBullish,"(+) Break Bar Away Bullish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dojiStarBullish,"(+) Bullish Doji Star. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. Tin hieu Manh neu o vung Dinh cao.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(hammerBullish,"(+) Bullish Hammer. Mau hinh dao chieu.\\n Nison: Dau hieu Manh neu Than nen phia tren Hep va Duoi Nen phia duoi dai.\\n  Nen tang Gia se tot hon Nen giam Gia \\n Do tin cay Thap. \\n","") +\r\nWriteIf(dragonflyDoji,"(+) Dragonfly Doji. Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishHarami, "(+) Harami Bullish. Mau hinh dao chieu.\\n Nison: Tin hieu Yeu. Nen cho su xac nhan. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(BullishHaramiCross,"(+) Harami Cross. Mau hinh dao chieu.\\n Nison: Dau hieu Harami dang tin cay nhat.\\n  Dau hieu lon nhat se manh hon dau hieu thap hon. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(homingPigeon,"(+) Homing Pigeon. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(invertedHammer,"(+) Inverted Hammer. Mau hinh dao chieu.\\nNison: Nen cho su xac nhan Tang Gia phia sau.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(meetingLinesbullish,"(+) Meeting Lines bullish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(piercingLine,"(+) Piercing Line. Mau hinh dao chieu.\\n Nison: Day la Mo hinh Dao chieu Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(stickSandwich,"(+) Stick Sandwich. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeStarsInTheSouth,"(+) 3 Stars in the South. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(TriStarBottom,"(+) 3 Stars Bottom. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(triStarBullish,"(+) Tri-Star Bullish. Mau hinh dao chieu.\\n Nison: Mo hinh Dao chieu tuong doi Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeriverBottom,"(+) 3 River Bottom. Mau hinh dao chieu.\\n Nison: Ap luc Ban dang Giam dan.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BullishSeparatingLine,"(+) Separating Lines Bullish. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(upsideGapThreeMethods,"(+) Upside Gap 3 Methods. Mau hinh tiep dien.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeLineStrike,"(+) 3 Line Strike. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(TweezerBottoms,"(+) Tweezer Bottom. Mau hinh dao chieu.\\n  Cung voi su dao chieu cua cac nen khac co the cho thay muc ho tro.\\n Nison: Nen cho su xac nhan. \\n","") +\r\nWriteIf(UpwardGappingTasuki,"(+) Upside Tasuki Gap. Mau hinh tiep dien.\\n Nison: Than cua hai ngon nen trong khoang trong phai co cung do lon.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(Bull3Formation,"(+) Bull3Formation. \\n","") +\r\nWriteIf(BullishCounterAttack,"(+) BullishCounterAttack. \\n","") +\r\nWriteIf(SeperatingLines,"(+) SeperatingLines. \\n","") +\r\n\r\n\r\n//Sell Candle Down - Bearish \r\n//Nen canh bao Sell Giam Gia Manh\r\n//*********************************\r\n\r\nWriteIf(SellJapaneseCandle,EncodeColor(colorRed)+"    - Sell: \\n","") +\r\nEncodeColor(colorBrown)+\r\nWriteIf(BearishAbandonedBaby,"(-) Abandoned Baby Bearish. Mau hinh dao chieu.\\n Nison: Hiem khi xuat hien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(DarkCloudCover,"(-) Dark Cloud Cover. Mau hinh dao chieu.\\n Nison: Cac yeu to cho thay tam quan trong cua tin hieu nay la: \\n 1) Su tham nhap cua ngon nen dau tien trong ngon nen thu hai. \\n 2) Neu ca hai nen deu la nen Marabozu. \\n 3) Than cua cay nen thu hai o tren mot muc khang cu dang ke. \\n 4) Xay ra trong nhung ngay co khoi luong cao.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(EveningDojiStar,"(-) Evening Doji Star. Mau hinh dao chieu.\\n Nison: Phai duoc xac nhan boi mot cay nen den dai.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(EveningStar,"(-) Evening Star. Mau hinh dao chieu.\\n Nison: Khoang cach giua than nen thu hai va thu ba khong phai luc nao cung xuat hien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(idendicalThreeBlackCrows,"(-) Identical 3 Black Crows.\\n  Mo hinh dao chieu cua xu huong tang truoc do.\\n Nison: Dau hieu Giam rat ro rang.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(BearishKicker,"(-) Kicking Bearish. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeInsideDownBearish,"(-) 3 Inside Down. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeoutsideDownBearish,"(-) 3 Outside Down. Mau hinh dao chieu.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(upsideGapTwoCrows,"(-) Upside Gap 2 Crows. Mau hinh dao chieu.\\n Nison: Yeu cau xac nhan voi su dao nguoc tiep tuc vao ngay thu ba.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(fallingThreeMethods,"(-) Falling 3 Methods. Mau hinh tiep dien.\\n Do tin cay Cao. \\n","") +\r\nWriteIf(threeBlackCrows,"(-) 3 Black Crows. Mau hinh dao chieu.\\n Nison: Nen chu y neu trong xu  the tang. \\n Do tin cay Cao. \\n","") +\r\n\r\n\r\n//Short sell Candle Down - Bearish \r\n//Nen canh bao Sell Giam Gia nhe\r\n//**************************************\r\n\r\nWriteIf(ShortJapaneseCandle,EncodeColor(colorGold)+"    - Short: \\n" ,"") +\r\nEncodeColor(colorBrown)+\r\nWriteIf(advanceBlockBearish,"(-) advanceBlockBearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishBeltHold,"(-) Belt Hold Bearish. Mau hinh dao chieu.\\n Nison: Chieu cao cua nen cang dai thi cang Manh. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(breakAwayBearish,"(-) breakvar Away Bearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(HangingMan,"(-) Hanging Man. Mau hinh dao chieu.\\n Nison: Nhu mot 'cay Nen bua giam gia' voi mot khoang trong dang ke vao ngay hom sau. \\n Do tin cay Thap. \\n","") +\r\nWriteIf(deliberationBearish,"(-) Deliberation Bearish. Mau hinh dao chieu.\\n Nison: Day khong phai la mot mo hinh dao chieu thuc su.\\n  Nhung la mot dau hieu cho thay su phuc hoi dang suy yeu. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishCounterAttack,"(-) Counter Attack Bearish.\\n Nison: Dau hieu tiem nang cua su Giam gia. \\n","") +\r\nWriteIf(EngulfingBear,"(-) Engulfing Bearish. Mau hinh dao chieu.\\n Nison: Dau hieu dao chieu quan trong.\\n  Cac yeu to lam tang tam quan trong cua cac mau la: \\n 1) Phia tren cay nen co than rat nho VA cay nen thu hai co than rat lon. \\n 2) Mau hinh xuat hien sau mot xu huong tang gia nhanh truoc do. \\n 3) Khoi luong cao trong Ngay thu Hai. \\n 4) Vao Ngay thu hai bao phu than nen nhieu hon so voi than nen truoc day.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(HammerBearish,"(-) HammerBearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dragonflyDojiBearish,"(-) Dragonfly Doji Bearish. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishHarami,"(-) Bearish Harami. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishHaramiCross,"(-) Harami Cross Bearish. Mau hinh dao chieu.\\n Nison: Mau hinh bao xu huong giam dang ke hon so voi Nen 'Harami'. \\n Ngay thu hai, cay nen co the co mau trang hoac den.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(MeetingLinesBearish,"(-) Meeting Lines Bearish. Mau hinh dao chieu.\\n Nhung khong qua manh nhu Nen 'Dark Cloud Cover'. \\n Do tin cay Trung binh. ","") +\r\nWriteIf(ShootingStar,"(-) Shooting Star. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(shootingStarGap,"(-) Shooting Star. Mau hinh dao chieu.\\n Nison: Khong quan trong nhu Nen 'evening star'. \\n Tot nhat, than nen phai nam trong mot khoang trong so voi than nen truoc do.\\n No se xuat hien sau mot xu huong tang truoc do.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(GraveStoneDoji,"(-) Gravestone Doji. Mau hinh dao chieu.\\n Nison: Tin hieu quan trong hon khi cham muc cao nhat lich su.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(triStarBearish,"(-) Tri-Star Bearish. Mau hinh dao chieu.\\n Nison: Mau hinh dao chieu rat Manh.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(twoCrows,"(-) 2 Crows. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(dojiStarBearish,"(-) Doji Star Bearish. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(downsideGapThreeMethods,"(-) Downside Gap 3 Methods. Mau hinh tiep dien. \\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(DownwardGappingTasuki,"(-) Downside Tasuki Gap. Dau hieu tiep dien xu the.\\n Nison: Neu ngay cuoi cung Gap bi dong lai.\\n No hinh tiep tuc se bi tu choi.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(inNeckBearish,"(-) In Neck Bearish. Mau hinh tiep dien.\\n Nison: Giong nhu Nen 'piercing pattern' .\\n Nhung giam nhieu hon vao ngay thu hai vi khong co su xam nhap.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(OnNeckBearish,"(-) On Neck Bearish. Mau hinh tiep dien.\\n Nison: Giong nhu Nen 'piercing' - Nen xuyen thau.\\n Nhung giam gia hon vi khong co su xam nhap nao vao ngay thu hai.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(BearishSeparatingLine,"(-) Separating Lines Bearish. \\n","") +\r\nWriteIf(sideBySideWhiteLinesBearish,"(-) Side by Side White Lines Bearish. Mau hinh tiep dien.\\n Nison: Hiem khi xay ra.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(threeLineStrike,"(-) 3 Line Strike. Mau hinh tiep dien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(thrustingBearish,"(-) Thrusting - Luc day Manh. Mau hinh tiep dien.\\n Nison: Khong phai la ngay dao chieu.\\n Boi vi ngay thu hai khong tham gia vao diem giua cua ngay dau tien.\\n Do tin cay Thap. \\n","") +\r\nWriteIf(TweezerTops,"(-) Tweezer Top. Mau hinh dao chieu.\\n Nison: Nen cho su xac nhan. \\n","")+\r\nWriteIf(Bear3Formation,"(-) Bear3Formation. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(TriStarTop,"(-) TriStarTop. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") +\r\nWriteIf(InvertedBlackHammer,"(-) InvertedBlackHammer. Mau hinh dao chieu.\\n Do tin cay Trung binh. \\n","") \r\n\r\n\r\n\t\r\n\r\n\t\r\n\t\r\n\r\n//*************************************************************************************\r\n//                       Hien thi Phan dien giai VSA                                       \r\n//====================================================================================|\r\n//*************************************************************************************\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n\r\n//**********************************************************************************************\r\n//|                  END TITLE - TIEU DE Bat Dinh + Day                                     \r\n//|============================================================================================|\r\n//**********************************************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA - VPA 5.1 (Vietnamese).Full All Indicator in one V10 Binhnt 3.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>12.64</Min>
			<Max>26.7716</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>tinhieu</Name>
		<Pane>
			<ChartID>1107</ChartID>
			<PercentHeight>43</PercentHeight>
			<Formula>// Bo tin hieu mua ban theo duong ZZ duoc viet boi Vocucdn\r\n// thong tin co ban\r\n_SECTION_BEGIN("ZZ");\r\n _SECTION_BEGIN("Price");\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\n_N(Title = StrFormat("{{NAME}} - {{INTERVAL}} {{DATE}} {{OHLCX}} Vol %.0f {{VALUES}}", V ));\r\nPlot( C, "Close", ParamColor("Color", colorDefault ), styleNoTitle | ParamStyle("Style") | GetPriceStyle() ); \r\n_SECTION_END();\r\n_SECTION_BEGIN("Volume");\r\nColor = ParamColor("Color", ColorRGB( 128, 128, 192 ) );\r\nPlot( Volume, _DEFAULT_NAME(), ColorBlend( Color, GetChartBkColor(), 0.5  ), styleNoTitle | ParamStyle( "Style", styleHistogram | styleOwnScale | styleThick | styleNoLabel, maskHistogram  ), 2 );\r\n_SECTION_END();\r\n// tin hieu duong ZZ\r\n_SECTION_BEGIN("ZZ");\r\n PercentChange = 6;\r\nZZ = Zig(C,LastValue(PercentChange)) ; \r\nPlot( ZZ, _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style") );\r\nPivotLow = Ref(IIf(Ref(ROC(ZZ,1),-1) &lt; 0 AND ROC(ZZ,1) &gt; 0, 1, Null),1);\r\nPivotHigh = Ref(IIf(Ref(ROC(ZZ,1),-1) &gt; 0 AND ROC(ZZ,1) &lt; 0, 1, Null),1);\r\nBuy= PivotLow;\r\nSell = PivotHigh;\r\nMeanPricebuy = IIf(PivotLow&gt;=1, Prec(ZZ,2),0);\r\nMeanPricesell = IIf(PivotHigh&gt;=1, Prec(ZZ,2),0);\r\nBuyPrice = ValueWhen(Buy, MeanPricebuy, 1);\r\nSellPrice = ValueWhen(Sell,MeanPricesell, 1);\r\nfor( i = 0; i &lt; BarCount; i++ )\r\n{\r\nif( Buy[i] ) PlotShapes(IIf(PivotLow&gt;=1,shapeUpArrow , shapeNone), ColorRGB(168,255,0), 0, Low, Offset=-15);\r\nif( Buy[i] ) PlotText( "Mua@" + BuyPrice[ i ], i, L[ i ]*0.98, colorGreen );\r\nif( Sell[i] ) PlotText( "Ban@" + SellPrice[ i ], i, H[ i ]*1.02,  colorYellow );\r\nif( Sell[i] ) PlotShapes(IIf(PivotHigh&gt;=1,shapeDownArrow, shapeNone), colorRed, 0,High, Offset=-30);\r\n}\r\n_SECTION_BEGIN("FACEBOOK: VOCUCDN");\r\nGfxSetBkMode(1);\r\nX=1000;\r\nY=1;\r\nFont=10;\r\nGfxSelectFont("Impact",Font*1.5, 550);GfxSetTextColor(colorRed);GfxTextOut(FullName()+" - "+Name(),x,y);\r\nGfxSelectFont("Impact",Font*1.2, 550);GfxSetTextColor(colorYellow);GfxTextOut("Nganh nghe: "+IndustryID( 1 ),x,Y+25);\r\n// lay ngay mua\r\nBuyDate = ValueWhen(Buy , DateTime(), 1);\r\nchuyenngay = NumToStr( BuyDate, formatDateTime );\r\ncutngay = StrTrim( chuyenngay, " 00:00:00" );\r\ndemTBuy = BarsSince(Buy);\r\nTrend = IIf(PivotLow&gt;=1 OR ZZ- Ref(ZZ,-1)&gt;=0 OR PivotHigh&gt;=1,2,-2);// cai nay quan trong\r\nbaongaymua = WriteIf(Trend&gt;=1, "Khuyen nghi mua ngay: "+cutngay + "- T"+demTBuy,"");\r\nGfxSelectFont("Impact",Font*1.2, 550);GfxSetTextColor(colorBrightGreen);GfxTextOut(baongaymua,x,Y+25+18);\r\nGiamua = IIf(Trend&gt;=1, BuyPrice,-1);\r\nGiamuat = WriteIf(Trend&gt;=1, ""+BuyPrice,"");\r\ntanggiam1= Prec( ( ( C - BuyPrice) / O ) * 100,2);//lam tron so\r\ntanggiam2 = IIf(Giamua&gt;=0,tanggiam1,0);\r\ntanggiam3 = WriteIf(Giamua&gt;=0, ""+tanggiam1+"%","");\r\nplotgia = WriteIf(Trend&gt;=1, "Khuyen nghi mua gia: "+Giamuat + "- Loi nhuan: "+tanggiam3+"    RSI: "+Prec(RSI(14),0)+" //  MFI: "+ Prec(MFI(14),0),"");\r\nGfxSelectFont("Impact",Font*1.2, 550);GfxSetTextColor(colorBrightGreen);GfxTextOut(plotgia,x,Y+25+18+18);\r\n_SECTION_END();\r\n//Bo loc\r\nSetOption( "Nodefaultcolumns", True ); \r\nAddTextColumn( Name(), "Ma CK",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault))); // Ten\r\nAddTextColumn( FullName(), "Ten Cty"); //Ful ten\r\nAddTextColumn( IndustryID( 1 ), "Nganh nghe" );// Nganh nghe\r\n//AddColumn(Datetime(),"Date",formatDateTime);\r\nchuyenngay1 = NumToStr( Datetime(), formatDateTime );// chuyen ngay qua chuoi\r\ncutngay1 = StrTrim( chuyenngay1, " 00:00:00" ); // cut gio phut giay\r\nAddTextColumn(cutngay1 , "Date",  colorDefault, colorDefault);\r\n// Cot5. Gia\r\nAddColumn(Close,"Gia",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorYellow)));\r\n// Cot6. Tang Giam\r\nAddColumn( ( ( C - Ref ( C ,-1 )) / O ) * 100 , " % Change " , 1.2 ,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorYellow)));\r\n// Cot7. GTGD\r\nAddColumn(Close*Volume,"GTGD",1);\r\nSetSortColumns(-7);\r\nAddColumn(MA(Ref(V,-1),10),"Vol AVG",1);\r\nAddColumn(RSIa(C,14),"RSI",1.2,IIf(RSIa(C,14)&gt;Ref(RSIa(C,14),-1), colorGreen, IIf(RSIa(C,14)&lt;Ref(RSIa(C,14),-1), colorRed, colorYellow)));// Hien thi RSI\r\n\r\n///\r\n\r\nKhuyennghi = WriteIf(Trend&gt;=1 AND PivotLow&gt;=1, "Mua",WriteIf(Trend&gt;=1 AND PivotHigh&gt;=1 , "Ban",""));\r\nkhuyennghiColor = IIf(Trend&gt;=1 AND PivotLow&gt;=1, colorGreen, colorRed);\r\nAddTextColumn(Khuyennghi, "Khuyen nghi", 1.2, khuyennghiColor , colorDefault);\r\n//\r\n\r\nbaongaymua2 = WriteIf(Trend&gt;=1,cutngay ,"");\r\nAddTextColumn(baongaymua2 , "Ngay khuyen nghi mua",  colorDefault, colorDefault);\r\ndemTBuy2 = IIf( Trend&gt;=1,BarsSince(Buy),-2);\r\nAddColumn(demTBuy2,"T+",1);\r\nAddTextColumn(Giamuat , "Gia khuyen nghi mua",  colorDefault, colorDefault);\r\nGiamua2 = IIf(Trend&gt;=1, BuyPrice,0);\r\nloinhuan = IIf(Trend&gt;=1, (( C - Giamua2) / O ) * 100,0);\r\nAddColumn( loinhuan , " % Loi nhuan " , 1.2 ,IIf(Close&gt;Giamua2, colorGreen, IIf(Close&lt;Giamua2, colorRed, colorYellow)));\r\nFilter = MA(Ref(V,-1),10) &gt;= 100000 AND demTBuy2&gt;=0 ;\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VOCUC KIEM end 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>14.404</Min>
			<Max>24.9018</Max>
		</Pane>
		<Pane>
			<ChartID>1108</ChartID>
			<PercentHeight>43</PercentHeight>
			<Formula>\r\n_SECTION_BEGIN("Realtime"); //Tach gio phut giay hien tai\r\nRealtimeClock = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(4)));\r\nGioHientai = ValueWhen(LastValue(V)&gt;0 , LastValue( int(RealtimeClock/10000)));\r\nPhutHienTai = ValueWhen(LastValue(V)&gt;0 , LastValue( int((RealtimeClock - GioHientai*10000)/100)));\r\nGiayHienTai = ValueWhen(LastValue(V)&gt;0 , LastValue( RealtimeClock - (GioHientai*10000 + PhutHienTai*100)));\r\nRealtime  = LastValue( GioHientai*60 + PhutHienTai);//So phut da dien ra trong ngay\r\nNgayhientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(6)));\r\nThanghientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(7)));\r\nNamhientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(8)));\r\n_SECTION_END();\r\nSetForeign("VNINDEX");//Ham Lam viec truc tiep voi 1 ma nhat dinh, o day la Vnindex\r\ntestTimeVningay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeVnithang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeVninam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichVni = (testTimeVninam*100 + testTimeVnithang)*100 + testTimeVningay;\r\nDieukienThoiGian = IIf(testTimeVningay == Ngayhientai AND testTimeVnithang == Thanghientai AND testTimeVninam == Namhientai,2,-2);\r\nstartTimeVni1 = 9*60; // Th?i gian b?t d?u giao d?ch (9:00 AM)\r\nendTimeVni1 = 11*60 +30; // Th?i gian k?t thc giao d?ch (11:30 PM)\r\nstartTimeVni2 = 13*60; // Th?i gian b?t d?u giao d?ch (13:00 PM)\r\nendTimeVni2 = 14*60+45; // Th?i gian k?t thc giao d?ch (14:45 PM)\r\nPhienSangVni = (endTimeVni1 - startTimeVni1);\r\nPhienChieuVni = (endTimeVni2 - startTimeVni2);\r\nFulltimeVni = (endTimeVni1 - startTimeVni1) + (endTimeVni2 - startTimeVni2);\r\nInTimeVni  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeVni1 AND Realtime &lt;= endTimeVni1,Realtime -startTimeVni1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeVni1 AND Realtime &lt; startTimeVni2,PhienSangVni,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeVni2 AND Realtime&lt;= endTimeVni2,PhienSangVni + (Realtime - startTimeVni2),FulltimeVni)));\t\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\nSetForeign("HNXINDEX");\r\ntestTimeHNXngay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeHNXthang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeHNXnam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichHNX = (testTimeHNXnam*100 + testTimeHNXthang)*100 + testTimeHNXngay;\r\nstartTimeHNX1 = 9*60; \r\nendTimeHNX1 = 11*60 +30;\r\nstartTimeHNX2 = 13*60; \r\nendTimeHNX2 = 15*60;\r\nPhienSangHNX = (endTimeHNX1 - startTimeHNX1);\r\nPhienChieuHNX = (endTimeHNX2 - startTimeHNX2);\r\nFulltimeHNX = (endTimeHNX1 - startTimeHNX1) + (endTimeHNX2 - startTimeHNX2);\r\nInTimeHNX  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeHNX1 AND Realtime &lt;= endTimeHNX1,Realtime -startTimeHNX1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeHNX1 AND Realtime &lt; startTimeHNX2,PhienSangHNX,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeHNX2 AND Realtime&lt;= endTimeHNX2,PhienSangHNX + (Realtime - startTimeHNX2),FulltimeHNX)));\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\nSetForeign("UPINDEX");\r\ntestTimeUpcomngay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeUpcomthang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeUpcomnam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichUpcom = (testTimeUpcomnam*100 + testTimeUpcomthang)*100 + testTimeUpcomngay;\r\nstartTimeUpcom1 = 9*60; \r\nendTimeUpcom1 = 11*60 +30;\r\nstartTimeUpcom2 = 13*60; \r\nendTimeUpcom2 = 15*60;\r\nPhienSangUpcom = (endTimeUpcom1 - startTimeUpcom1);\r\nPhienChieuUpcom = (endTimeUpcom2 - startTimeUpcom2);\r\nFulltimeUpcom = (endTimeUpcom1 - startTimeUpcom1) + (endTimeUpcom2 - startTimeUpcom2);\r\nInTimeUpcom  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeUpcom1 AND Realtime &lt;= endTimeUpcom1,Realtime -startTimeUpcom1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeUpcom1 AND Realtime &lt; startTimeUpcom2,PhienSangUpcom,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeUpcom2 AND Realtime&lt;= endTimeUpcom2,PhienSangUpcom + (Realtime - startTimeUpcom2),FulltimeUpcom)));\t\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\n////////////Lay time cua ma tren san GD hien tai \r\nLaySGD = MarketID( 1 );\r\nSanHNX = "HNXINDEX";\r\nSanUpcom = "UPINDEX";\r\nSanHSX = "VNINDEX";\r\ntestSan1 = WriteIf(LaySGD == "HSX","VNINDEX","");\r\ntestSan2 = WriteIf(LaySGD == "HNX","HNXINDEX","");\r\ntestSan3 = WriteIf(LaySGD == "UPCOM","UPINDEX","");\r\ntestSan = testSan1 + testSan2 + testSan3;\r\nInTime =  IIf(LaySGD == "HSX",InTimeVni, IIf(LaySGD == "HNX",InTimeHNX,InTimeUpcom));\r\nOutTime = IIf(LaySGD == "HSX",FulltimeVni, IIf(LaySGD == "HNX",FulltimeHNX,FulltimeUpcom));\r\nMorningTime = IIf(LaySGD == "HSX",PhienSangVni, IIf(LaySGD == "HNX",PhienSangHNX,PhienSangUpcom));\r\nTongthoigianGiaodich3San =  IIf(LaySGD == "HSX",TongthoigianGiaodichVni, IIf(LaySGD == "HNX",TongthoigianGiaodichHNX,TongthoigianGiaodichUpcom));\r\n////////////////////////////////////////////////////////////////////////\r\n///////////////////////////DanhGiaVol\r\n_SECTION_BEGIN("Danh Gia Vol");\r\nVolcuaPhut = IIf(InTime &lt; OutTime ,Volume/InTime,Volume/OutTime);\r\n_SECTION_END();\r\n_SECTION_BEGIN("Danh Gia OBV");\r\nOBVcuaPhut = IIf(InTime &lt; OutTime ,OBV()/InTime,OBV()/OutTime);\r\n_SECTION_END();\r\nHesoRank = 14;\r\nSetOption( "Nodefaultcolumns", True ); \r\nAddTextColumn( Name(), "Ma CK",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault))); // Ten\r\nAddTextColumn( FullName(), "Ten Cty"); //Ful ten\r\nAddTextColumn( MarketID( 1 ), "San GD");\r\nAddTextColumn( IndustryID( 1 ), "Nganh nghe" );// Nganh nghe\r\nchuyenngay1 = NumToStr( Datetime(), formatDateTime );// chuyen ngay qua chuoi\r\ncutngay1 = StrTrim( chuyenngay1, " 00:00:00" ); // cut gio phut giay\r\nAddTextColumn(cutngay1 , "Date",  colorDefault, colorDefault);\r\nRankingCl = RSIa(C,HesoRank) ;\r\nWarnaText = colorBlack ;\r\nWarnaBackGround = ColorHSB(RankingCl, 255, 255);\r\nRankingTD = PercentRank (( ( C - Ref ( C ,-1 )) / Ref ( C ,-1 ) ) * 100, HesoRank) ;\r\nAddColumn (Close, "Gia", 1.2, IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)), WarnaBackGround, -1, RankingCL) ;\r\n//AddColumn(Close,"Gia",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)));\r\nAddColumn( ( ( C - Ref ( C ,-1 )) / Ref ( C ,-1 ) ) * 100 , " % Change " , 1.2 ,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)));\r\nRankingVol = RSIa( VolcuaPhut,HesoRank);\r\nWarnaBackGroundVol = ColorHSB(RankingVol , 255, 255);\r\nVolCo = IIf(VolcuaPhut &gt; Ref(VolcuaPhut,-1), colorGreen, IIf(VolcuaPhut &lt; Ref(VolcuaPhut,-1),colorRed,colorDefault));\r\nAddColumn (Volume, "Volume", 1, VolCo, WarnaBackGroundVol, -1, RankingVol) ;\r\nRankingGTGD = RSIa(VolcuaPhut*Avg, HesoRank) ;\r\nWarnaBackGroundGTGD = ColorHSB(RankingGTGD, 255, 255);\r\nGTGDCo = IIf(VolcuaPhut*Avg &gt; Ref(VolcuaPhut*Avg,-1), colorGreen, IIf(VolcuaPhut*Avg &lt; Ref(VolcuaPhut*Avg,-1),colorRed,colorDefault));\r\nAddColumn (Volume*Avg, "GTGD", 1, GTGDCo, WarnaBackGroundGTGD, -1, RankingGTGD) ;\r\nRSICo = IIf(RankingCl &gt; Ref(RankingCl,-1), colorGreen, IIf(RankingCl &lt; Ref(RankingCl,-1),colorRed,colorDefault));\r\nAddColumn (RankingCl, "RSI14", 1.2, RSICo, WarnaBackGround, -1,RankingCl) ;\r\nRSIVolCo = IIf(RankingVol &gt; Ref(RankingVol,-1), colorGreen, IIf(RankingVol &lt; Ref(RankingVol,-1),colorRed,colorDefault));\r\n//AddColumn (RankingVol, "RSIVol", 1.2, RSIVolCo, WarnaBackGroundVol, -1,RankingVol) ;\r\nRSIGTGDCo = IIf(RankingGTGD &gt; Ref(RankingGTGD,-1), colorGreen, IIf(RankingGTGD &lt; Ref(RankingGTGD,-1),colorRed,colorDefault));\r\n//AddColumn (RankingGTGD, "RSIGTGD", 1.2, RSIGTGDCo, WarnaBackGroundGTGD, -1,RankingGTGD) ;\r\nTonghop =  (RankingCl + RankingVol + RankingGTGD )/3;\r\nWarnaBackGroundTH = ColorHSB(Tonghop , 255, 255);\r\nTangGiam = Tonghop - Ref(Tonghop,-1);\r\nRankingtangiam = PercentRank (TangGiam, HesoRank) ;\r\nWarnaBackGroundTG = ColorHSB(Rankingtangiam * 64/100, 255, 255);\r\nTangGiamRSI = RankingCl - Ref(RankingCl,-1);\r\n//AddColumn(TangGiamRSI,"RSI+/-",1.2,IIf(TangGiamRSI &gt; 0, colorGreen, IIf(TangGiamRSI &lt; 0, colorRed, colorDefault)));\r\nTangGiamVol = RankingVol - Ref(RankingVol,-1);\r\n//AddColumn(TangGiamVol,"Vol+/-",1.2,IIf(TangGiamVol &gt; 0, colorGreen, IIf(TangGiamVol &lt; 0, colorRed, colorDefault)));\r\ntanggiamGTGD = \tRankingGTGD - Ref(\tRankingGTGD,-1);\t\r\n//AddColumn(tanggiamGTGD,"GTGD+/-",1.2,IIf(tanggiamGTGD &gt; 0, colorGreen, IIf(tanggiamGTGD &lt; 0, colorRed, colorDefault)));\r\ndiemTH = \t (TangGiamRSI +  TangGiamVol + tanggiamGTGD)/3;\r\n//AddColumn(diemTH,"TH Tang giam",1.2,IIf(diemTH &gt; 0, colorGreen, IIf(diemTH &lt; 0, colorRed, colorDefault)));\r\nSetSortColumns(-8);\r\n//AddRankColumn(); \r\ndieukienbb = IIf(Ref(MA(V,20),-1)&gt;=300000  ,2,-2);// Dieu kien de loai bien cac ma xau, thanh khoan kem, ma mat thanh khoan, thanh khoan khong on dinh\r\ntestTime2023ngay =ValueWhen(V&gt;0 , LastValue(Day()));\r\ntestTime2023thang =ValueWhen(V&gt;0 , LastValue(Month()));\r\ntestTime2023nam =ValueWhen(V&gt;0 , LastValue(Year()));\r\nTongthoigianHienTai = (Namhientai*100+Thanghientai)*100+Ngayhientai;\r\nTongthoigianGiaodich = (testTime2023nam*100 + testTime2023thang)*100 + testTime2023ngay;\r\nDoiCHieuVni = TongthoigianHienTai - TongthoigianGiaodich3San;\r\nDoichieuTructiep = TongthoigianHienTai - TongthoigianGiaodich;\r\nDieukienthoigianvanhanh = IIf( DoiCHieuVni == DoichieuTructiep AND DoichieuTructiep&lt;= 75,2,-2);\r\n//Filter = MA(C,20) &gt;=5  AND dieukienbb&gt;=2  AND Dieukienthoigianvanhanh&gt;=2 ;\r\n_SECTION_BEGIN("Dieu kien bat buoc");\r\nChibaoADX = Max(ADX(14),Max(PDI(14),MDI(14)));\r\nDanhgiaADX = IIf(ChibaoADX&gt;=22.5,1,0);\r\nDanhgiaVol = IIf(RankingVol &gt;=30,1,0);\r\nDanhgiaRSI = IIf(RSI(14)  &gt;=30 AND RSIa(OBV(),14) &gt;=30,1,0);\r\nDanhgiaGTGD = IIf(RankingGTGD &gt;=30,1,0);\r\n_SECTION_END();\r\n_SECTION_BEGIN("Danh gia MACD");\r\nr1 = Param( "Fast avg", 12, 2, 200, 1 );\r\nr2 = Param( "Slow avg", 26, 2, 200, 1 );\r\nr3 = Param( "Signal avg", 9, 2, 200, 1 );\r\nml = MACD(r1, r2);\r\nsl = Signal(r1,r2,r3);\r\nHistogram = MACD(r1, r2) - Signal(r1,r2,r3);\r\nDanhgiaMACD =   ml - Ref ( ml,-1 ) ;    \r\nDanhgiaSignal =   sl - Ref ( sl,-1 ) ;    \r\nDanhgiaHito =   Histogram - Ref ( Histogram,-1 ) ;    \r\nDanhgiaTotalMACD = DanhgiaMACD + DanhgiaSignal + DanhgiaHito;\r\n_SECTION_END();\r\n_SECTION_BEGIN("Danh gia MACD bang gia High");\r\nHigh12 = EMA(H,12);\r\nHigh26 = EMA(H,26);\r\nMACDHigh = (High12 - High26);\r\nSigerHigh = EMA(MACDHigh,9);\r\nHitoHigh = (MACDHigh - SigerHigh);\r\nDanhgiaMACDHigh = MACDHigh - Ref ( MACDHigh,-1 );    \r\nDanhgiaSignalHigh = SigerHigh - Ref ( SigerHigh,-1 );    \r\nDanhgiaHitoHigh =  HitoHigh - Ref ( HitoHigh,-1 );    \r\nDanhgiaTotalMACDHigh = DanhgiaMACDHigh + DanhgiaSignalHigh + DanhgiaHitoHigh;\r\n_SECTION_END();\r\n_SECTION_BEGIN("Danh gia MACD bang gia Low");\r\nLow12 = EMA(L,12);\r\nLow26 = EMA(L,26);\r\nMACDLow = (Low12 - Low26);\r\nSigerLow = EMA(MACDLow,9);\r\nHitoLow = (MACDLow - SigerLow);\r\nDanhgiaMACDLow = MACDLow - Ref ( MACDLow,-1 );    \r\nDanhgiaSignalLow = SigerLow - Ref ( SigerLow,-1 );    \r\nDanhgiaHitoLow =  HitoLow - Ref ( HitoLow,-1 );    \r\nDanhgiaTotalMACDLow = DanhgiaMACDLow + DanhgiaSignalLow + DanhgiaHitoLow;\r\n_SECTION_END();\r\n\r\n\r\nDanhgiaTHMACD = DanhgiaADX * DanhgiaVol * DanhgiaRSI * DanhgiaGTGD * (DanhgiaTotalMACD + DanhgiaTotalMACDHigh +DanhgiaTotalMACDLow);\r\n\r\n\r\nT=2;\r\n////Lop nen\r\nBuy0 = DanhgiaTHMACD &gt; 0 AND Ref(DanhgiaTHMACD,-1) &lt;=0;\r\nSell0 = DanhgiaTHMACD &lt;= 0 AND Ref(DanhgiaTHMACD,-1) &gt;0;\r\ndemTUp0 = BarsSince(Buy0);\r\ndemTDow0 = BarsSince(Sell0);\r\n///Lop 1\r\nTrend0 = IIf(demTUp0 &lt; demTDow0 OR (demTDow0 &gt;=0 AND demTDow0 &lt;=0),demTUp0,demTDow0*-1); \r\ndemTmua = IIf(demTUp0 ==0 AND Ref(demTUp0,-1*T)==0,T-demTUp0,demTUp0);\r\nBuy = demTmua==0;\r\ndemTUp1 = BarsSince(Buy);\r\nSell1 = Sell0 AND demTmua&gt;=T ;\r\nSell2 = demTmua==T  AND   demTDow0 &lt; demTUp0;\r\nSellTotal = Sell1 OR Sell2;\r\ntestTimengay =ValueWhen(SellTotal , Day());\r\ntestTimethang =ValueWhen(SellTotal , Month());\r\ntestTimenam =ValueWhen(SellTotal , Year());\r\nALotime = IIf(testTimengay &lt; testTime2023ngay OR testTimethang &lt; testTime2023thang OR testTimenam &lt; testTime2023nam ,2,\r\n\t\t\tIIf( testTimengay == testTime2023ngay AND testTimethang == testTime2023thang AND testTimenam == testTime2023nam AND InTimeVni &gt;= PhienSangVni,2,-2)); // test thoi gian T0.5 (luat chung khoan 0.5 nay rat kem)\r\n//Sell = Sell1 OR Sell2;\r\nSell = SellTotal AND ALotime&gt;=2 ;\r\ndemTDow1 = BarsSince(Sell);\r\nBuyPrice = ValueWhen(Buy , Prec(Avg,2));\r\nSellPrice=ValueWhen(Sell,Prec(Avg,2));\r\nTrend1 = IIf(demTUp1 &lt; demTDow1 OR (demTDow1 &gt;=0 AND demTDow1 &lt;=0),demTUp1,demTDow1*-1); \r\ntanggiam11= Prec( ( ( C - BuyPrice) / BuyPrice ) * 100,2);//lam tron so \r\ntanggiam99= Prec( ( ( SellPrice - BuyPrice) / BuyPrice ) * 100,2);//lam tron so \r\ntanggiam9999 =IIf(demTDow1==0,tanggiam99,tanggiam11);\r\nhienthiban = WriteIf(Sell AND SellPrice&gt;=BuyPrice,"Sell","CutLoss");\r\nSellA = Sell AND SellPrice&gt;=BuyPrice;\r\nSellB = Sell AND SellPrice&lt;BuyPrice;\r\ntextBuy = WriteIf(Buy,"Buy&lt;= "+BuyPrice,"");\r\ntextSell = WriteIf(Sell AND SellPrice&gt;=BuyPrice,"Sell&gt;= "+SellPrice,"");\r\ntextSell1 = WriteIf(Sell AND SellPrice &lt; BuyPrice,"CutLoss&gt;= "+SellPrice,"");\r\ntextBuySell = textBuy + textSell +textSell1 ;\r\ntextBuySellCo = IIf(Buy,colorGreen,IIf(Sell, colorRed , colorDefault));\r\nAddTextColumn(textBuySell , "Tin Hieu", 1.2,textBuySellCo , colorDefault);\r\nBuyDate = ValueWhen(Buy , DateTime(), 1);\r\nchuyenngay = NumToStr( BuyDate, formatDateTime );\r\ncutngay = StrTrim( chuyenngay, " 00:00:00" );\r\ncutngay2 = WriteIf(Trend1&gt;=0,cutngay,"");\r\nBuyDay = ValueWhen(Buy , Day(), 1);\r\nBuymount = ValueWhen(Buy , Month(), 1);\r\nBuyyear = ValueWhen(Buy , Year(), 1);\r\nngaymuachuan = ""+BuyDay+"/"+Buymount+"/"+Buyyear;\r\nSellDay = ValueWhen(Sell , Day(), 1);\r\nSellmount = ValueWhen(Sell , Month(), 1);\r\nSellyear = ValueWhen(Sell , Year(), 1);\r\nngaybanchuan = ""+SellDay+"/"+Sellmount+"/"+Sellyear;\r\nAddTextColumn(cutngay2 , "Ngay mua", 1.2, colorDefault , colorDefault);\r\nAddColumn(Trend1,"T+/-",1,IIf(Trend1&gt;=0,colorGreen,colorRed) );\r\ntextgiamua = WriteIf(Trend1&gt;=0,""+BuyPrice,"");\r\n//AddTextColumn(textgiamua , "Gia Mua", 1.2, colorDefault , colorDefault);\r\nAddColumn(BuyPrice, "Gia Mua", 1.2, colorDefault , colorDefault);\r\n\r\nlaytexthienthi =WriteIf(LastValue(Trend1)&gt;=0,"T"+LastValue(Trend1)+" // " +LastValue(tanggiam9999)+"%","");\r\nloinhuan = WriteIf(Trend1 &gt;=0, ""+tanggiam9999+"%","");\r\n//AddTextColumn(loinhuan, "Loi nhuan %", 1.2, IIf( tanggiam9999&gt;0 ,colorGreen,IIf( tanggiam9999&lt;0, colorRed,colorDefault)));\r\nAddColumn(tanggiam9999,"Loi nhuan %",1.2,IIf( tanggiam9999&gt;0 ,colorGreen,IIf( tanggiam9999&lt;0, colorRed,colorDefault)));\r\nFilter = MA(C,20) &gt;=5  AND dieukienbb&gt;=2  AND Dieukienthoigianvanhanh&gt;=2 AND Trend1 &gt;=0 ;\r\n\r\n_SECTION_BEGIN("Price");\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\n_N(Title = StrFormat("{{NAME}} - {{INTERVAL}} {{DATE}} Open %g, Hi %g, Lo %g, Close %g (%.1f%%) Vol " +WriteVal( V, 1.0 ) +" {{VALUES}}", O, H, L, C, SelectedValue( ROC( C, 1 )) ));\r\nPlot( C, "Close", ParamColor("Color", colorDefault ), styleNoTitle | ParamStyle("Style") | GetPriceStyle() ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 15, 2, 200, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Mid MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 45, 2, 300, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Long MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 100, 2, 400, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("BBands");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 15, 2, 100, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorLightGrey );\r\nColor = ColorBlend( Color,  GetChartBkColor(), 0.5 );\r\nStyle = ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale;;\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style ); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style ); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, GetChartBkColor(), 0.7 ), styleNoLabel | styleCloud | styleNoRescale, Null, Null, Null, -1 );\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Volume");\r\nColor = ParamColor("Color", ColorRGB( 128, 128, 192 ) );\r\nPlot( Volume, _DEFAULT_NAME(), ColorBlend( Color, GetChartBkColor(), 0.5  ), styleNoTitle | ParamStyle( "Style", styleHistogram | styleOwnScale | styleThick | styleNoLabel, maskHistogram  ), 2 );\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Price Interpretation");\r\nmovshort = ParamField("Short Time MA", 8 );\r\nmovmed = ParamField("Mid Time MA", 9 );\r\nmovlong = ParamField("Long Time MA", 10 );\r\nbtop = ParamField("BBTop", 11 );\r\nbbot = ParamField("BBBottom", 12 );\r\nif( Status("action") == actionCommentary )\r\n{\r\nwidth = btop - bbot;\r\nlslop = LinRegSlope( C, 30 ) + 100;\r\nlslo = LLV( lslop, 90 );\r\nlshi = HHV( lslop, 90 );\r\nlswidth = lshi - lslo;\r\ntrend = 100*( lslop - lslo )/lswidth;\r\n\r\nmawidth = MA( width, 100 );\r\nrelwidth = 100*(width - mawidth)/mawidth;\r\n\r\n_N( tname = Name()+"("+FullName()+")" );\r\n\r\nprintf("Price and moving averages:\\n");\r\nprintf( "%s", tname + " has closed " + WriteIf( C &gt; movshort, "above" , "below" ) + " its Short time moving average. ");\r\n\r\nprintf( "%s", "\\nShort time moving average is currently " + WriteIf( movshort &gt; movmed, "above", "below") + " mid-time, AND " + WriteIf( movshort &gt; movlong, "above", "below" ) + " long time moving averages.");\r\n\r\nprintf( "%s", "\\nThe relationship between price and moving averages is: "+\r\nWriteIf( C &gt; movshort AND movshort &gt; movmed, "bullish",\r\nWriteIf( C &lt; movshort AND movshort &lt; movmed, "bearish", "neutral" ) ) + " in short-term, and "+\r\nWriteIf( movshort &gt; movmed AND movmed &gt; movlong , "bullish",\r\nWriteIf( movshort &lt; movmed AND movmed &lt; movlong, "bearish", "neutral" ) ) + " in mid-long term. ");\r\n\r\nprintf("\\n\\nBollinger Bands:\\n");\r\nprintf("%s", tname+ " has closed " + \r\nWriteIf( C &lt; bbot, "below the lower band by " +\r\nWriteVal( 100 *( bbot-C )/ width, 1.1 ) + "%. " +\r\nWriteIf( trend &lt; 30, " This combined with the steep downtrend can suggest that the downward trend in prices has a good chance of continuing.  However, a short-term pull-back inside the bands is likely.",\r\nWriteIf( trend &gt; 30 AND trend &lt; 70, "Although prices have broken the lower band and a downside breakout is possible, the most likely scenario for "+tname+" is to continue within current trading range.", "" ) ), "" ) +\r\n\r\nWriteIf( C &gt; btop, "above the upper band by " +\r\nWriteVal( 100 *( C- btop )/ width, 1.1 ) + "%. " +\r\nWriteIf( trend &gt; 70, " This combined with the steep uptrend suggests that the upward trend in prices has a good chance of continuing.  However, a short-term pull-back inside the bands is likely.",\r\nWriteIf( trend &gt; 30 AND trend &lt; 70, "Although prices have broken the upper band and a upside breakout is possible, the most likely scenario for "+tname+" is to continue within current trading range.", "" ) ), "" ) +\r\n\r\nWriteIf( C &lt; btop AND ( ( btop - C ) / width ) &lt; 0.5, \r\n"below upper band by " +\r\nWriteVal( 100 *( btop - C )/ width, 1.1 ) + "%. ", \r\nWriteIf( C &lt; btop AND C &gt; bbot , "above bottom band by " +\r\nWriteVal( 100 *( C - bbot )/ width, 1.1 ) + "%. ", "" ) ));\r\n\r\nprintf("%s", "\\n"+\r\nWriteIf( ( trend &gt; 30 AND trend &lt; 70 AND ( C &gt; btop OR C &lt; bbot ) ) AND abs(relwidth) &gt; 40,\r\n\t\t "This picture becomes somewhat unclear due to the fact that Bollinger Bands are  currently",\r\n\t\t "Bollinger Bands are " )+\t  \r\nWriteVal( abs( relwidth ), 1.1 ) + "% " +\r\nWriteIf( relwidth &gt; 0, "wider" , "narrower" ) +\r\n" than normal.");\r\n\r\nprintf("\\n");\r\n\r\nprintf("%s",\r\nWriteIf( abs( relwidth ) &lt; 40, "The current width of the bands (alone) does not suggest anything conclusive about the future volatility or movement of prices.","")+\r\nWriteIf( relwidth &lt; -40, "The narrow width of the bands suggests low volatility as compared to " + tname + "'s normal range.  Therefore, the probability of volatility increasing with a sharp price move has increased for the near-term. "+\r\n"The bands have been in this narrow range for " + WriteVal(BarsSince(Cross(-40,relwidth)),1.0) + " bars. The probability of a significant price move increases the longer the bands remain in this narrow range." ,"")+\r\nWriteIf( relwidth &gt; 40, "The large width of the bands suggest high volatility as compared to " + tname + "'s normal range.  Therefore, the probability of volatility decreasing and prices entering (or remaining in) a trading range has increased for the near-term. "+\r\n"The bands have been in this wide range for  " + WriteVal(BarsSince(Cross(relwidth,40)),1.0) + " bars.The probability of prices consolidating into a less volatile trading range increases the longer the bands remain in this wide range." ,""));\r\n\r\nprintf("\\n\\nThis commentary is not a recommendation to buy or sell. Use at your own risk.");\r\n}\r\n_SECTION_END();\r\n\r\n\r\ndist = 0.5 * ATR( 15 );\r\nfor ( i=BarCount-1; i &gt; 0; i-- )\r\n{\r\n    if ( Buy[i] )\r\n        PlotText("Buy: " + BuyPrice[ i ], i, L[ i ] - dist[i], colorRose);\r\n     if ( SellA[i] )\r\n        PlotText( "Sell: " + SellPrice[ i ]+"\\n"+"    // "+"T"+Trend1[ i ]+"// "+tanggiam99[ i ]+"%", i, H[ i ] + dist[i],colorBrightGreen);\r\n    if ( SellB[i] )\r\n        PlotText( "Cutloss: " + SellPrice[ i ]+"\\n"+"    // "+"T"+Trend1[ i ]+"// "+tanggiam99[ i ]+"%", i, H[ i ] + dist[i],colorRed);\r\n        \r\n}\r\n//PlotShapes( shapeUpArrow * Buy, colorYellow, 0, HaLow );\r\n//PlotShapes( shapeDownArrow * Sell, colorPink, 0, HaHigh );\r\n\r\nPlotShapes(IIf(Sell,shapeDownArrow, shapeNone), colorRed, 0,High, Offset=-15);\r\n\r\nPlotShapes(IIf(Buy,shapeUpArrow , shapeNone), ColorRGB(168,255,0), 0, Low, Offset=-15);\r\n\r\n\r\ncline=ParamToggle("Gia Nen", "Show|Hide",0);\r\nPriceLineColor=ParamColor("PriceLineColor",colorRed|styleNoLabel);\r\nPriceLevel = LastValue( Prec(Close,2));\r\nDaysback    = Param("Bars Back",100,10,500,1); \r\nFirstBar    = BarCount - DaysBack; \r\nYY          = IIf(BarIndex() &gt;= Firstbar,EndValue(PriceLevel),Null); \r\nside = Param("side",1,0,1000,1);\r\ndist = 0; \r\nif(cline==0)\r\n{\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{\r\n if(i+side== BarCount) PlotText( "........."+"=&gt;   " + PriceLevel[ i ]+" // " +WriteVal(LastValue((C/Ref(C,-1)-1)*100),1.2)+"% ", i, YY[ i ]-dist[i], colorYellow );\r\n if(i+side== BarCount) PlotText( "\\n                "+laytexthienthi+"", i, YY[ i ]-dist[i], colorWhite ); \r\n}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\Kiem  pho MACD 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>14.404</Min>
			<Max>24.9018</Max>
		</Pane>
		<Pane>
			<ChartID>1109</ChartID>
			<PercentHeight>14</PercentHeight>
			<Formula>// TRADING THE MACD Ver 1.0 by Karthik Marar.\r\n\r\n_SECTION_BEGIN("MACD");\r\nr1 = Param( "Fast avg", 12, 2, 200, 1 );\r\nr2 = Param( "Slow avg", 26, 2, 200, 1 );\r\nr3 = Param( "Signal avg", 9, 2, 200, 1 );\r\nr4 = Param( "Wk slow", 17, 2, 200, 1 );\r\nr5 = Param( "Wk fast", 8, 2, 200, 1 );\r\nm1=MACD(r1,r2);\r\ns1=Signal(r1,r2,r3);\r\nGraphXSpace =20;\r\n\r\nmycolor=IIf(m1&lt;0 AND m1&gt;s1, 51,IIf(m1&gt;0 AND m1&gt;s1,colorLime,IIf(m1&gt;0 AND m1&lt;s1,colorOrange,colorRed)));\r\nPlot( m1, StrFormat(_SECTION_NAME()+"(%g,%g)", r1, r2), mycolor,ParamStyle("MACD style") );\r\nPlot( s1 ,"Signal" + _PARAM_VALUES(), ParamColor("Signal color", colorBlue ), ParamStyle("Signal style") );\r\nhistcolor = IIf((m1-s1)-Ref((m1-s1),-1)&gt; 0, colorLime, colorRed ); \r\n\r\nTimeFrameSet( inDaily );// weekly \r\nm1w=MACD(r4,r5);\r\ns1w=Signal(r4,r5,r3);\r\nkp=m1w-s1w;\r\nkph=Ref(kp,-1);\r\nTimeFrameRestore(); \r\n\r\nkw=TimeFrameExpand( kp, inDaily ); // expand for display \r\nkhw=TimeFrameExpand( kph, inDaily ); // expand for display \r\nmw=TimeFrameExpand( m1w, inDaily ); // expand for display \r\nsw=TimeFrameExpand( s1w, inDaily ); // expand for display \r\n\r\nhcolor=IIf(mw&lt;0 AND mw&gt;sw, 51,IIf(mw&gt;0 AND mw&gt;sw,colorLime,IIf(mw&gt;0 AND mw&lt;sw,colorOrange,colorRed)));\r\ngcolor=IIf(kw&gt;khw,IIf(kw&gt;0,colorDarkYellow,colorYellow),IIf(kw&gt;0,colorSkyblue,colorBlue));\r\n\r\n\r\nPlot( m1-s1, "MACD Histogram",  mycolor, styleHistogram | styleThick| styleOwnScale  );\r\n\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Signals");\r\n//Zero crossover up\r\n\r\nj1=Cross(m1,0);\r\nPlotShapes(IIf(j1,shapeDigit1 ,Null),colorPaleGreen,0,Min(0,0),Min(0,0)); \r\nPlotShapes(IIf(j1,shapeUpArrow,Null),colorGreen,0,Min(0,0),-10); \r\n\r\n// crossover above zero\r\n\r\nj2=Cross(m1,s1) AND m1&gt;0;\r\nPlotShapes(IIf(j2,shapeDigit2 ,Null),colorYellow,0,0,0); \r\nPlotShapes(IIf(j2,shapeUpArrow,Null),colorGreen,0,0,-10); \r\n\r\n//Zero crossover down\r\n\r\nj3=Cross(s1,m1) AND m1&gt;0;\r\nPlotShapes(IIf(j3,shapeDigit3 ,Null),colorOrange,0,Min(0,0),0); \r\nPlotShapes(IIf(j3,shapeDownArrow,Null),colorOrange,0,Min(0,0),-10); \r\n\r\n// crossover below zero\r\n\r\nj4=Cross(0,m1);\r\nPlotShapes(IIf(j4,shapeDigit3 ,Null),colorRed,0,0,0); \r\nPlotShapes(IIf(j4,shapeDownArrow,Null),colorRed,0,0,-10); \r\n\r\n// Histogram peak and troughs\r\npt=m1-s1;\r\nTp = Ref(pT,-1) == HHV(pT,3);\r\nVl = Ref(pT,-1)==LLV(pT,3);\r\nPlotShapes(IIf(Vl AND m1&gt;s1 ,shapeSmallCircle+ shapePositionAbove,shapeNone),IIf(m1&lt;0 ,colorYellow,colorLime),0,0,0);\r\nPlotShapes(IIf(Tp AND m1&lt;s1 ,shapeSmallCircle+ shapePositionAbove,shapeNone),colorRed,0,0,0);\r\n\r\n//Zeroline reject bearish\r\nzd=BarsSince(j1);\r\nzlrd1=(zd&lt;6 )AND j4;\r\nPlotShapes(IIf(zlrd1,shapeStar+ shapePositionAbove,shapeNone),colorDarkRed,0,0,20);\r\n\r\n//hooks bearish\r\nHu=BarsSince(j2);\r\nHu1=(Hu&lt;6)AND j3;\r\nPlotShapes(IIf(Hu1,shapeStar+ shapePositionAbove,shapeNone),colorRed,0,0,20);\r\n\r\n//Zeroline reject Bullish\r\nzu=BarsSince(j4);\r\nzlru=zu&lt;6 AND j1;\r\nPlotShapes(IIf(zlru,shapeStar+ shapePositionAbove,shapeNone),colorPink,0,0,20);\r\n\r\n//Hook Bullish\r\nHd=BarsSince(j3);\r\nHd1=Hd&lt;6 AND j2;\r\nPlotShapes(IIf(Hd1,shapeStar+ shapePositionAbove,shapeNone),colorLime,0,0,20);\r\n\r\n//ADX related calculations\r\nplus=EMA(PDI(14),3)&gt;Ref(EMA(PDI(14),3),-5);\r\nap=EMA(ADX(14),3)&gt;Ref(EMA(ADX(14),3),-5);\r\nMinus=EMA(MDI(14),3)&gt;Ref(EMA(MDI(14),3),-5);\r\n\r\n//Power Dips - Bullish\r\nPDIp=ADX(14)&gt;MDI(14) AND PDI(14)&gt;MDI(14) AND ap AND Vl AND m1&gt;s1 AND plus ;\r\nPlotShapes(IIf(PDIp,shapeHollowCircle+ shapePositionAbove,shapeNone),colorCustom12,0,0,0);\r\n\r\n//power buys\r\npr2=ADX(14)&gt;20 AND PDI(14)&gt;20 AND ADX(14)&gt;MDI(14) AND PDI(14)&gt;MDI(14) AND plus AND j2;\r\nPlotShapes(IIf(pr2,shapeHollowCircle+ shapePositionAbove,shapeNone),colorCustom12,0,0,20);\r\n\r\n//Power Dips - Bearish\r\nPDIm=ADX(14)&gt;PDI(14) AND MDI(14)&gt;PDI(14) AND ap AND Tp AND m1&lt;s1 AND Minus ;\r\nPlotShapes(IIf(PDIm,shapeHollowCircle+ shapePositionAbove,shapeNone),colorWhite,0,0,0);\r\n\r\n//Power shorts\r\nsr2=ADX(14)&gt;20 AND MDI(14)&gt;20 AND ADX(14)&gt;PDI(14) AND MDI(14)&gt;PDI(14) AND Minus AND j4;\r\nPlotShapes(IIf(sr2,shapeHollowCircle+ shapePositionAbove,shapeNone),colorRed,0,0,-20);\r\n\r\n//powerbuy2\r\npr2a=ADX(14)&gt;20 AND PDI(14)&gt;20 AND ADX(14)&gt;MDI(14) AND PDI(14)&gt;MDI(14) AND  plus AND j1;\r\nPlotShapes(IIf(pr2a,shapeHollowCircle+ shapePositionAbove,shapeNone),colorCustom12,0,0,20);\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Exploration");\r\nFilter = j1 OR j2 OR j3 OR j4 OR PDIp OR PDIm OR pr2 OR sr2 ;\r\n\r\nAddColumn(j1,"ZL UP",1);\r\nAddColumn(J2,"MA Up",1);\r\nAddColumn(j3,"MA DN",1);\r\nAddColumn(J4,"ZL DN",1);\r\nAddColumn(PDIp,"PDIP UP",1);\r\nAddColumn(pr2,"PHK UP",1);\r\nAddColumn(PDIm,"PDIP DN",1);\r\nAddColumn(sr2,"PHk UP",1);\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Display the Signals");\r\nTitle = "Trading the MACD" + " - " +  Name() + " - " + EncodeColor(colorRed)+ Interval(2) + EncodeColor() +\r\n\r\n "  - " + Date() +" - " +EncodeColor(colorLime)+ "MACD= "+WriteVal(m1)+"--"+EncodeColor(colorBlue)+\r\nWriteIf (j1, " MACD Crossed above zero","")+\r\nWriteIf (j2, " Bullish crossover above zero","")+\r\nWriteIf (j4, " MACD Crossed below Zero","")+\r\nWriteIf (j3, " Bearish crossover above zero","")+\r\nWriteIf (PDIP, "  Bullish Power Dip","")+\r\nWriteIf (pr2, " &amp; Power Buy","")+\r\nWriteIf (sr2, " &amp; Power Short","")+\r\nWriteIf (PDIm, " Bearish Power Dip","")+\r\nWriteIf (Hd1, " &amp; Bullish Hook","")+\r\nWriteIf (Hu1, " &amp; Bearish Hook","")+\r\nWriteIf (zlrd1, " &amp; Bearish zeroline Reject","")+\r\nWriteIf (zlru, " &amp; Bullish Zeroline Reject","");\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("Earth-2");\r\n//Copyright 9Trading.com\r\nVAR2=(High+Low+(Close)*(2))/(4);\r\nB = ((EMA((VAR2-LLV(VAR2,15))/(HHV(Low,15)-LLV(VAR2,15)),2))*(38));\r\nPlot(b, "", 4, 1+4);\r\nbot1 = ((((-1))*(EMA((VAR2-LLV(VAR2,15))/(HHV(Low,15)-LLV(VAR2,15)),2))+0.01)*(38));\r\nPlot(bot1, "", 4, 1+4);\r\nVAR22=((Close-LLV(Low,10))/(HHV(High,10)-LLV(Low,10)))*(100);\r\nVAR33=EMA(VAR22,10);\r\nVAR44=EMA(VAR33,10);\r\nVAR55=(3)*(VAR33)-(2)*(VAR44);\r\nVAR66=EMA(VAR55,5);\r\nBridgeT = (EMA(VAR66,1));\r\nPlot(bridget, "", IIf(bridget &gt; Ref(bridget,-1),colorBlue,colorYellow), 1+4);\r\nPlot(-bridget, "", IIf(bridget &gt; Ref(bridget,-1),colorBlue,colorYellow), 1+4);\r\n\r\ntrend = (5)*(EMA(((Close-LLV(Low,27))/(HHV(High,27)-LLV(Low,27)))*(100),5))-\r\n    (3)*(EMA(EMA(((Close-LLV(Low,27))/(HHV(High,27)-LLV(Low,27)))*(100),5),3))-\r\n    EMA(EMA(EMA(((Close-LLV(Low,27))/(HHV(High,27)-LLV(Low,27)))*(100),5),3),2);\r\nBuy1 = Cross(trend,5);\r\nPlotShapes( IIf( Buy1, shapeSmallSquare, shapeNone ), colorGreen, layer = 0, yposition = 0, offset = 3  ); \r\nPlotShapes( IIf( Buy1, shapeSmallSquare, shapeNone ),colorGreen, layer = 0, yposition = 0, offset = -4  ); \r\n\r\nVARA1=((Close&gt;=Ref(Close,-1)) AND (Ref(Close,-1)&gt;=Ref(Close,-2)) AND (Ref(Close,-1)&lt;=Ref(Close,-3)) \r\n       AND (Ref(Close,-2)&lt;=Ref(Close,-3)) AND ((Ref(Close,-4)&gt;Ref(Close,-2)) OR (Ref(Close,-4)&lt;=Ref(Close,-2)) \r\n       AND (Ref(Close,-5)&gt;=Ref(Close,-3))) OR (Close&gt;=Ref(Close,-1)) AND (Ref(Close,-1)&lt;=Ref(Close,-2)) \r\n       AND (Close&gt;=Ref(Close,-2)) AND ((Ref(Close,-3)&gt;Ref(Close,-1)) OR (Ref(Close,-3)&lt;=Ref(Close,-1)) \r\n       AND (Ref(Close,-4)&gt;=Ref(Close,-2))));\r\nVARA2=LLV(Low,5);\r\nVARA3=HHV(High,5);\r\nVARA4=EMA(((Close-VARA2)/(VARA3-VARA2))*(100),4);\r\nVARA5=EMA((0.66699999)*(Ref(VARA4,-1))+(0.333)*(VARA4),2);\r\nVARA6=(VARA5&lt;24) AND (Open&lt;MA(Close,20));\r\n\r\nBuy2 =IIf(VARA1 AND (VARA6),30,0);\r\nPlot(Buy2, "", 8,2+4);\r\nPlot(-Buy2, "", 8,2+4);\r\n\r\n_N(Title = StrFormat("\\\\c02.{{NAME}} | {{DATE}} | {{VALUES}}")+EncodeColor(colorBrightGreen)+WriteIf(Buy2==30,"BuySignal-A","" )+EncodeColor(colorBrightGreen)+WriteIf(Buy1==1," | BuySignal-B",""));\r\n\r\n\r\n_SECTION_BEGIN("Earth-3");\r\nn = Param("Periods", 14, 5, 25, 1 );\r\nvar6=(2*Close+High+Low)/4;\r\nvar7=LLV(L,n);\r\nvar8=HHV(H,n);\r\nvar9=EMA((var6-var7)/(var8-var7)*100,5);\r\nvarA=EMA(0.333*Ref(var9,-1)+0.667*var9,3);\r\nUP=Var9; \r\nDOWN=Vara;\r\nbarcolor2=\r\nIIf( (Ref(up,-1)&gt;Ref(down,-1) AND Ref(up,-1)&gt;up AND up&gt;down ) \r\n  OR (Ref(up,-1)&lt;Ref(down,-1) AND Ref(up,-1)&lt;up AND up&lt;down ) \r\n  , colorBlue,\r\n  IIf(up&gt;down,5,4));\r\nPlot(0,"",barcolor2,styleLine);\r\n\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Earth-1");\r\nEB1 = Close &gt; Ref(Close, -1) AND Ref(Close, -1) &gt; Ref(Close, -2) AND Ref(Close, -1) &lt; Ref(Close, -3) AND IIf(Ref(Close, -3) &lt; Ref(Close, -4), 1, IIf(Ref(Close, -4) &lt; Ref(Close, -5),Ref(Close, -1) &lt; Ref(Close, -4) OR( Ref(Close, -2) &lt; Ref(Close, -4) AND Ref(Close, -3) &gt;= Ref(Close, -5) ),IIf(Ref(Close, -5) &lt; Ref(Close, -6), 1,Ref(Close, -6) &lt; Ref(Close, -7))));\r\nES1 = Close &lt; Ref(Close, -1) AND Ref(Close, -1) &lt; Ref(Close, -2) AND Ref(Close, -1) &gt; Ref(Close, -3) AND IIf(Ref(Close, -3) &gt; Ref(Close, -4), 1, IIf(Ref(Close, -4) &gt; Ref(Close, -5),Ref(Close, -1) &gt; Ref(Close, -4) OR( Ref(Close, -2) &gt; Ref(Close, -4) AND Ref(Close, -3) &lt;= Ref(Close, -5) ),IIf(Ref(Close, -5) &gt; Ref(Close, -6), 1,Ref(Close, -6) &gt; Ref(Close, -7))));\r\nPlotShapes( IIf( EB1, shapeHollowSmallSquare, shapeNone ), colorWhite, layer = 0, 0, 0  ); \r\nPlotShapes( IIf( ES1, shapeHollowSmallSquare, shapeNone ), colorOrange, layer = 0, 0, 0 );\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Exploration");\r\nLastBar = Cum( 1 ) == LastValue( Cum( 1 ) );  \r\nFilter = LastBar; \r\n\r\npfrom = Param("Price From", 0, 0, 1000, 0.5 );\r\npto = Param("Price To", 1000, 0, 1000, 0.5 );\r\nMinv = Param("Minimum Volume (K)", 500, 0, 1000, 50);\r\ndd = Param("Decimal Digits", 1.2, 1, 1.7, 0.1 );\r\n\r\nEB21= Buy1; \r\nEB22=Buy2;\r\n//Filter = Buy AND C&gt;pfrom AND C&lt;pto AND V&gt;1000*Minv;\r\nColor = IIf(Close&gt;Open, colorGreen, colorRed);\r\nbcolor = IIf(Buy1 OR Buy2, colorGreen, 1);\r\nAddTextColumn(WriteIf(EB1,"Buy",WriteIf(ES1,"Sell","")),"Earth-1",colorDefault,-1);\r\nAddTextColumn(WriteIf(Buy1==1,"Buy-A"," "),"Earth-2a",colorDefault,-1);\r\nAddTextColumn(WriteIf(Buy2==30,"Buy-B"," "),"Earth-2b",colorDefault,-1);\r\nAddTextColumn(WriteIf(bridget &gt; Ref(bridget,-1) AND Ref(bridget,-1)&lt;Ref(bridget,-2),"Buy",WriteIf(bridget &lt; Ref(bridget,-1) AND Ref(bridget,-1)&gt;Ref(bridget,-2),"Sell","")),"Earth-2c",colorDefault,-1);\r\nAddTextColumn(WriteIf(barcolor2==colorBlue,"Modarate",WriteIf(barcolor2==4,"Buy",WriteIf(barcolor2==5,"Sell",""))),"Earth-3",colorDefault,-1);\r\n//AddColumn(Buy, "Buy" , 1.1, bcolor);\r\n//AddColumn(O, "Open", dd, textColor = Color);\r\n//AddColumn(C, "Close", dd, textColor = Color);\r\n//AddColumn(V, "Volume", 1, textColor = Color);\r\n//AddTextColumn(FullName(),"Name");\r\n_SECTION_END();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// created by chandrakant\r\n//modified on 120309..credit goes to of Karthik sir \r\n\r\n/*1. Here are some observations to keep in mind that will help assure\r\nyou are in a good trending move which is detrimental to the success \r\nof the trade moving higher before the inevitable over exhausted trend.\r\n \r\n2 Consider only going long on the 5M if the 30M (two rows above) is also blue.\r\n\r\n3 Consider the 1hr row as well being blue since it has an effect too.\r\n\r\n4 The 15M row has to be blue with NO exceptions\r\n\r\n5 The 30M row if blue has less effect on the trade as compared to the 15M row \r\nbut keep this in mind. The 30M row being blue helps the 15M row continue to stay blue. \r\n\r\n6 The 1hr row has even less effect OR importance but it too keeps the 30M \r\nfrom weakening to some minor degree. \r\n*/\r\n// Define label bar (x) position location\r\n\r\nblankRightBars = 5; //insert actual blank right bars specified in Preferences \r\nbarsInView = Status("lastvisiblebarindex") - Status("firstvisiblebarindex") - blankRightBars;\r\nOffset = Param("Offset Bar", 0.95, 0, 1, 0.01);\r\ntextOffset = BarCount - (Offset * barsInView);\r\n\r\n_SECTION_BEGIN("default");\r\nHaClose =EMA((O+H+L+C)/4,3); \r\nHaOpen = AMA( Ref( HaClose, -1 ), 0.5 ); \r\nHaHigh = Max( H, Max( HaClose, HaOpen ) ); \r\nHaLow = Min( L, Min( HaClose, HaOpen ) );\r\nPlotText("Heinkein 4T tf :"+Interval(2), textoffset, 41.01, colorYellow);\r\n\r\nColor = IIf( Haopen &gt; Haclose,4, IIf( Haopen == Haclose,colorYellow, 6));\r\nPlot(10,"", Color,  styleHistogram+styleThick|styleOwnScale|styleNoLabel, 0, 100 );\r\nPlot( 11,"",colorBlack,styleOwnScale|styleArea|styleNoLabel,0, 100 );\r\n\r\n_SECTION_BEGIN("4");\r\nCompress4= Param("Compression4",8,2,10,1); \r\nTimeFrameSet(Compress4* Interval());\r\nHaClose4 =EMA((O+H+L+C)/4,3); \r\nHaOpen4 = AMA( Ref( HaClose4, -1 ), 0.5 ); \r\nHaHigh4 = Max( H, Max( HaClose4, HaOpen4 ) ); \r\nHaLow4 = Min( L, Min( HaClose4, HaOpen4 ) ); \r\nPlotText("Heinkein 4T tf :"+Interval(2), textoffset, 41.14, colorYellow);\r\nTimeFrameRestore();\r\nHAopen4f=TimeFrameExpand( Haopen4, Compress4* Interval());  \r\nHaclose4f=TimeFrameExpand( Haclose4, Compress4* Interval());\r\nHaHigh4f=TimeFrameExpand( Hahigh4, Compress4* Interval());\r\nHaLow4f=TimeFrameExpand( Halow4, Compress4* Interval());\r\nColor4 = IIf( Haopen4f &gt; Haclose4f,4, IIf( Haopen4f == Haclose4f ,colorYellow, 6));\r\nPlot(10,"", Color4,  styleHistogram+styleThick|styleOwnScale|styleNoLabel, 0, 100 );\r\nPlot( 41,"",colorBlack,styleOwnScale|styleArea|styleNoLabel,0, 100 );\r\n_N(Title = "{{NAME}} - {{INTERVAL}} {{DATE}} "+_DEFAULT_NAME()+" : {{OHLCX}} {{VALUES}}" );\r\n\r\n\r\n\r\n\r\n</Formula>
			<FilePath>Formulas\\Custom\\CON BACH TUOT 1.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>-144.442</Min>
			<Max>153.109</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>long</Name>
		<Pane>
			<ChartID>1115</ChartID>
			<PercentHeight>50</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (ang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (ang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATRs ", 3, 0.5, 10, 0.1 ); // How many ATRs to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 10.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>11.66</Min>
			<Max>27.8104</Max>
		</Pane>
	</Sheet>
	<Sheet>
		<Name>Sheet 6</Name>
		<Pane>
			<ChartID>1114</ChartID>
			<PercentHeight>51</PercentHeight>
			<Formula>/*Volume Price Analysis AFL - VPA Version 5.0 - 22-8-2021 \r\nEdit by binhnt.tamviet@gmail.com\r\n Revision Details\r\n V-2.0 AFL - fully re written for clarity, Minor bugs removed\r\n V-2.1 support AND resistance line added\r\n V-2.2 Commentary for support AND resistance line breaks Added.\r\n V-2.3 Revision detail- High Volume Lines added\r\n V-2.4 Toggle switch for plotting S/R, High Volume AND Trend lines added\r\n V-2.5 Bar coloring option included - VSA based OR Trend Based\r\n V-3.0 Trend detection Method changed to "Random Walk"\r\n V-3.1 exploration AddedClosePos\r\n V-3.2 Bug in Exploration fixed\r\n V-4.0 Revamped the formulas for all signals - Especially the No Demand Bar Defn. \r\n       Reduced unnecessary signals\r\n       Low volume Test signals formula improved\r\n       New signal discription for daily signals added like  "Move indicates Strength or weakness".\r\n       Effort up or down failure also added\r\n       Up and Down Arrows included to indicate change of sentiment.\r\n V-5.0 Removed some coding issues\r\n       Added Two Bar reversals\r\n       Added Strength Bar\r\n       Added Dash Board for Buy and Sell Pressure\r\n       Added Vwap \r\n       Added 3 pema and 200 ma plotting  options\r\n       Adde additiona; options for plotting Candle sticks and other options for color\r\n       Added Ribbons for Trend  \r\n V-5.1 Them cac chi bao (Edit by Binhnt.tamviet@gmail.com)\r\n       1. Hien thi Full thong tin ve Gia va Khoi luong\r\n       2. Phan tich xu huong hien tai\r\n       3. Chon che do Bar/Candle (chon che do hien thi cac tin hieu canh bao VSA)\r\n       4. Them tu dong ve cac duong trung binh dong EMA5,10,20,30 MA50,100,150,200\r\n       5. Them tu dong ve duong Ho tro, Khang cu gan nhat\r\n       6. Them tuy chinh cac muc Ho tro, Khang cu\r\n       7. Them tu dong ve Hop Darvas \r\n       8. Them tu dong ve Auto Trendline - duong xu huong gan nhat\r\n       9. Dashboard Bang do thi ap luc Cung Cau\r\n       10. Ichimoku Kinko Hyo (tu hien thi tin hieu Mua Ban theo Ichimoku)\r\n       11. Them tu dong ve duong Fibonacci Internal + External Retracements theo click chuot\r\n       12. Them chi bao Volume\r\n       13. Them chi bao Volume High Line\r\n       14. Them chi bao Volume At Price\r\n       15. Them chi bao  VWAP\r\n       16. Bands\r\n       17. Them tu dong ve duong Bollinger Bands\r\n       18. Them tu dong ve dai bang Keltner Bands system \r\n       19. Them chi bao Center of Gravity - Trung tam trong luc\r\n       20. He thong mua ban Con Rua - Turtle trading System\r\n       21. Them chi bao Psar\r\n       22. Them chi bao Zig zag\r\n       23. Them chi bao  GAP\r\n       24. Tin hieu Mua Ban luot song ngan han\r\n       25. Tin hieu mua ban theo dieu kien Buy4 Sell4 (dung cho ngan han) \r\n       26. Tin hieu mua ban theo dieu kien Buy4 Sell8 (dung cho ngan han)\r\n       27. Tin hieu mua ban theo dieu kien Buy8 Sell8 (dung cho ngan han)  \r\n       28. Tin hieu mua ban theo ATR\r\n      \r\n  \r\n       \r\n       \r\n//===================Version V.5.1 ======================\r\n*/\r\n       \r\n\r\n//====================================================================================|\r\n//                      Begin                                                         |\r\n//====================================================================================|\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\nGraphXSpace=Param("GraphXSpace - Zoom Chart",30,5,300,5);   //Chon che do Zoom\r\n\r\n/*\r\n//====================================================================================|\r\n//                      Color of outer border (Chon mau phong nen mau Den)                           \r\n//====================================================================================|\r\n\r\nSetChartBkColor(ParamColor("Outer panel",colorBlack)); // color of outer border \r\nSetChartBkGradientFill( ParamColor("Inner panel upper",colorBlack),ParamColor("Inner panel lower",colorBlack));\r\n\r\n//End chon phong nen \r\n*/     \r\n\r\n\r\n//|============================================================================================|\r\n//|                        1. Hien thi gia thi truong  \r\n//|============================================================================================|   \r\n\r\n//|Hien thi ten co phieu va gia dong cua|\r\n\r\n_SECTION_BEGIN("Thong tin Gia");\r\n\r\nYC       = TimeFrameGetPrice("C",inDaily,-1);\r\nDD       = Prec(C-YC,2);\r\nxx       = Prec((DD/YC)*100,2);\r\n\r\n\r\n\r\nif (ParamToggle( "* Hien thi Thong tin Gia",  "OFF|ON", 0 ))\r\n{\r\n\r\nfos      = Param("Font Size",25,1,100,1);\r\nnus      = Param("Number Size",10,1,100,1);\r\ncclor    = ParamColor("Color",colorCustom9);\r\nHor      = Param("Horizontal Position",50,1,1000,1);  // Vi tri ngang\r\nVer      = Param("Vertical Position",1,1,1000,1);    // Vi tri doc\r\n\r\nGfxSelectFont("Times New Roman", fos, 700, italic = True, underline = False, True ); //chon Fonts\r\nGfxSetBkMode( colorWhite );  // Chon mau nen\r\nGfxSetTextColor( cclor);  // Hien thi mau chu\r\nGfxTextOut( Name(), Hor+700,Ver -10 );  //|Hien thi ten co phieu\r\nGfxTextOut(""+C,Hor+785 , Ver-10 ); //|Hien thi gia dong cua\r\n\r\n//|Hien thi % thay doi gia\r\nGfxSelectFont("Times New Roman", nus, 700, italic =True, underline = False, True );\r\nGfxTextOut(""+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+" ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)", Hor+785, Ver+30 ); //|Hien thi thay doi gia dong cua\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//|    END Hien thi gia thi truong  \r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    2. Trend Analysis Module - Random Walk Method  \r\n//                        Phan tich Xu huong                               |\r\n//=========================================================================|\r\n\r\n_SECTION_BEGIN("2. Phan tich Trend xu huong");\r\n\r\n\r\n\r\n//=========================================================================|\r\n//                    Slope Calculation                                    |\r\n//=========================================================================|\r\n sma5                 =  MA(C,5);\r\n trendLongTerm     =  LinRegSlope(sma5,50) ; //lts      = linreg(src, 40, 0)\r\n trendMediumTerm   =  LinRegSlope(sma5,20) ; //mts      = linreg(src, 20, 0)\r\n trendShortTerm    =  LinRegSlope(sma5,10)  ;//sts      = linreg(src, 3, 0)\r\n tls               =  LinRegSlope(sma5,5);\r\n \r\n\r\n //========================Trend Estimation ================================\r\n\r\n\r\n minperiodsRWIst = Param ( "Chon Min vung dao dong ngan", 5 , 1 , 30 , 1); \r\n maxperiodsRWIst = Param ( "Chon Max vung dao dong ngan", 10 , 1 , 50 , 1); \r\n \r\n k      = RWI(minperiodsRWIst, maxperiodsRWIst);    //k      = RWIHi-RWILo\r\n Ground = RWIHi (minperiodsRWIst, maxperiodsRWIst); //Vuot dinh ngan han - Xu huong ngan han tang - upimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\n Sky    = RWILo (minperiodsRWIst, maxperiodsRWIst); //Pha day ngan han - xu huong ngan han giam  - dnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n\r\n\r\n\r\n minperiodsRWIlt = Param ( "Chon Min vung dao dong dai", 11 , 1 , 200 , 1); \r\n maxperiodsRWIlt = Param ( "Chon Max vung dao dong dai", 50 , 1 , 200 , 1);  \r\n\r\n j      = RWI(minperiodsRWIlt, maxperiodsRWIlt);  //j      = RWILHi-RWILLo\r\n\r\n j2     = RWIHi (minperiodsRWIlt, maxperiodsRWIlt); //Vuot dinh trung han - Xu huong trung han tang - upminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\n k2     = RWILo (minperiodsRWIlt, maxperiodsRWIlt); //Pha day trung han   - xu huong trung han giam - dnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n \r\n\r\n\r\n // The followign section check the diffeent condition of the RWi above and below zero. In oder to check which trend is doing what\r\n ja     = Cross(j,1); //Giao cat j vuot len dinh tren ngan han\r\n jb     = Cross(1,j); //Giao cat j giam xuong dinh tren ngan han\r\n jc     = Cross(-1,j); //Giao cat j voi day ngan han                bao muon hon k2a\r\n jd     = Cross(j,-1); //Giao cat j quay lai day ngan han\r\n j2a    = Cross(j2,1); //vuot dinh trung han\r\n j2b    = Cross(1,j2); // quay tro lai dinh trung han\r\n k2a    = Cross(k2,1); //pha dinh trung han             ok bao som hown jc\r\n k2b    = Cross(1,k2); //quay tro lai day trung han\r\n \r\n\r\n\r\n//Define the Major, Minor and Immediate trend Sttatus\r\n\r\nupmajoron   = j &gt; 1 AND Ref(ja,-1);\r\ndnmajoron   = j &lt; -1 AND Ref(jc,-1);\r\nupminoroff  = j &lt; 1 AND Ref(jb,-1); //Xu huong TANG trung han truoc do co the ket thuc   OK\r\ndnminoroff  = j &gt; -1 AND Ref(jd,-1); //Xu huong GIAM trung han truoc do co the ket thuc  OK \r\n\r\nupminoron   = j2 &gt; 1 AND Ref(j2a,-1); \r\ndnminoron   = k2 &gt; 1 AND Ref(k2a,-1); \r\nupmajoroff  = j2 &lt; 1 AND Ref(k2a,-1); //Xu huong TANG dai han truoc do co the ket thuc   \r\ndnmajoroff  = k2 &lt; 1 AND Ref(k2b,-1); //Xu huong GIAM dai han truoc do co the ket thuc   \r\n\r\n//Ngan han\r\nupimd       = IIf(ground &gt; 1, 1,0); //Xu huong ngan han: TANG - UP    OK\r\ndnimd       = IIf(sky &gt; 1, 1, 0);   //Xu huong ngan han: GIAM - DOWN  OK\r\n\r\n//Trung han\r\nupminor     = IIf(j2&gt;1,1,-1); //Xu huong trung han: TANG - UP     OK\r\ndnminor     = IIf(k2&gt;1,1,-1); //Xu huong trung han:     GIAM - DOWN\r\n\r\n//Dai han\r\nupmajor     = IIf(j&gt;1,1,IIf(j&lt;(-1),-1,0));  \r\nupdaihan    = upminor AND  C &gt; MA(C,100) AND C &gt; MA(C,150) AND C &gt; MA(C,200) AND   MA(C,10) &gt; MA(C,200);\r\ndowndaihan  = dnminor AND C &lt; MA(C,100) AND C &lt; MA(C,150) AND C &lt; MA(C,200)  AND   MA(C,10) &lt; MA(C,200);\r\ntrenddaihan = IIf(updaihan,1,IIf(downdaihan,-1,0));  \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//=========================================================================|\r\n// END Analysis Module - Random Walk Method           |\r\n//=========================================================================|\r\n\r\n\r\n//=========================================================================|\r\n//                    VPA Basic Module                                     |\r\n//=========================================================================|\r\n_SECTION_BEGIN("VPA Basic Module");\r\n\r\n    \r\n//===================== Basic Definitions =======================================\r\nvolAvg\t\t\t=\tMA(V,30);\r\nvolMean \t\t= \tStDev(volAvg,30); \r\nvolUpBand3 \t\t= \tvolAvg + 3*volMean; \r\nvolUpband2 \t\t= \tvolAvg + 2*volMean;; \r\nvolUpBand1 \t\t= \tvolAvg + 1*volMean;; \r\nvolDnBand1 \t\t= \tvolAvg -1*volMean; \r\nvolDnBand2 \t\t= \tvolAvg -2*volMean; \r\nmidprice\t\t=\t(H+L)/2;\r\nspread\t\t\t=\t(H-L);\r\navgSpread\t\t=\tEMA(spread,40);\r\nAvgSpreadBar    =  spread &gt; Avgspread;//REVIEW\r\nwideRangeBar\t=\tspread&gt;(1.5*avgSpread);\r\nnarrowRangeBar\t=\tspread&lt;(0.7*avgSpread);\r\nlowVolume\t\t=\tV&lt;Ref(V,-1) AND V&lt;Ref(V,-2) AND V &lt; VolAvg;// Third condition added\r\nupBar\t\t    =\tC&gt;Ref(C,-1); \r\ndownBar\t\t\t=\tC&lt;Ref(C,-1); \r\nhighVolume\t\t=\tV&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);//REVIEW\r\ncloseFactor\t\t=\tC-L;\r\nclsPosition\t\t=\tspread/(closeFactor+ 1e-9 );\r\nclosePosition\t=\tIIf(closeFactor==0,avgSpread,clsPosition);//????\r\nVb\t\t\t\t=\tV&gt;volAvg OR V&gt;Ref(V,-1);\r\nupClose\t\t    =\tC&gt;=((spread*0.7)+L);// close is above 70% of the Bar\r\ndownClose\t\t=\tC&lt;=((spread*0.3)+L);// close is below the 30% of the bar\r\naboveClose\t\t=\tC&gt;((spread*0.5)+L) ;// close is between 50% and 70% of the bar\r\nbelowClose\t\t=\tC&lt;((spread*0.5)+L);// close is between 50% and 30% of the bar\r\nmidClose\t\t=\tC&gt;((spread*0.3)+L) AND C&lt;((spread*0.7)+L);// close is between 30% and 70% of the bar\r\nveryLowClose\t=\tclosePosition&gt;4;//close is below 25% of the bar\r\nveryHighClose\t=\tclosePosition&lt;1.35;// Close is above 80% of the bar\r\nClosePos\t\t= \tIIf(C&lt;=((spread*0.2)+L),1,IIf(C&lt;=((spread*0.4)+L),2,IIf(C&lt;=((spread*0.6)+L),3,IIf(C&lt;=((spread*0.8)+L),4,5))));\r\n                    // 1 = downclose, 2 = belowclose, 3 = MidClose, 4 = aboveClose, 5 = Upclose\r\nVolpos\t\t\t=  \tIIf(V&gt;volAvg*2,1,IIf(V&gt;volAvg*1.3,2,IIf(V&gt;= volAvg,3,IIf(V&lt;volAvg AND V&gt;volAvg*0.7,4,5))));\r\n                    //// 1 = Very High, 2 = High, 3 = Above Average, 4 = Less than Average, 5 = Low\r\nfreshGndHi      =  IIf(H == HHV(H,5),1,0);\r\nfreshGndLo      =  IIf(L == LLV(L,5),1,0);\r\n//=================New code - FOM =========================\r\n//---------------No Movement Bar --------------------\r\n//- Thanh gia ko di chuyen khi co su thay doi Volume cao\r\npm       = abs(Close-Open); // price move\r\npma      = EMA(pm,40); // avg price move\r\nLpm\t     = pm&lt;(0.5*pma); // small price move\r\nbw       =  IIf(C &gt;O, H-C,H-O); // wick\r\nbwh      =  bw &gt;= 2*pm; // big wick\r\nfom1     =  (Volume &gt; 1.5 * volAvg)  AND Lpm; // high volume not able to move the price - Volume cao nhung gia ko di chuyen nhieu - Diem yeu\r\n\r\n//---------------Two Bar Revrsal  Dowm side - 2 thanh gia dao chieu trong xu huong giam --------------------\r\n//*******************Diem Manh***************************************\r\ntbcd    =  Ref(C,-1) &lt;  Ref(C,-5) AND Ref(C,-1) &lt;  Ref(C,-4) AND Ref(C,-1) &lt;  Ref(C,-3) AND Ref(C,-1) &lt;  Ref(C,-2); //yesterday bar lower than last 4 bars -Gia dong cua hom qua thap hon 4 ngay truoc no (ang giam gia)\r\ntbc1    =  L &lt; Ref(L,-1)  AND H &gt; Ref(H,-1);// today bar shadoes yesterday bar - Nen nhan chim\r\ntbc1a   = L &lt; Ref(L,-1)  AND C &gt; Ref(C,-1); // Nen xuyen thau\r\ntbc2    = tbcd ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND upClose;\r\ntbc2a   = tbcd ==1 AND tbc1a ==1  AND V&gt;  1.2 * volAvg AND upClose AND NOT tbc1;\r\ntbc3    = tbcd ==1 AND tbc1 ==1  AND upClose AND V&lt;= 1.2 *VolAvg;\r\n\r\n\r\n//---------------- Two bar reversal Up side - 2 thanh gia dao chieu trong xu huong tang --------------------\r\n//*******************Diem Yeu***************************************\r\ntbcu   =  Ref(C,-1) &gt;  Ref(C,-5) AND Ref(C,-1) &gt;  Ref(C,-4) AND Ref(C,-1) &gt;  Ref(C,-3) AND Ref(C,-1) &gt;   Ref(C,-2); //Gia dong cua hom qua cao hon 4 ngay truoc do (ang tang gia)\r\ntbc4   =  tbcu ==1 AND tbc1 ==1  AND V&gt;  1.2 * volAvg AND downClose;\r\ntbc5   =  tbcu ==1 AND tbc1 ==1  AND downClose AND V&lt;= 1.2 * VolAvg;\r\n\r\n_SECTION_END();\r\n\r\n\r\n//======================================================================|\r\n//                      VSA Signal generation                           |\r\n//======================================================================| \r\n_SECTION_BEGIN("Signal Generation");\r\nupThrustBar\t\t=\twideRangeBar AND downClose  AND upimd==1 AND H&gt;Ref(H,-1);//WRB and UHS and \r\nnut             =   wideRangeBar AND downClose  AND freshGndHi AND HighVolume;// NEW SIGNAL Upthrsut after a short up move\r\nbc              =   wideRangeBar AND aboveclose AND V == HHV(V,60) AND upmajor==1;// NEW SIGNAL Nuying Climax\r\nupThrustBarA\t=\twideRangeBar AND (ClosePos==1 OR ClosePos==2) AND upminor&gt;0 AND H&gt;Ref(H,-1)AND (upimd&gt;0 OR upmajor&gt;0)AND VolPos &lt;4;// after minor up trend\r\nupThrustBartrue\t=\twideRangeBar AND ClosePos==1 AND upmajor&gt;0 AND H&gt;Ref(H,-1)AND VolPos &lt;4;//occurs after a major uptrend\r\nupThrustCond1\t=\tRef(upThrustBar,-1) AND downBar AND NOT narrowRangeBar ;\r\nupThrustCond2\t=\tRef(upThrustBar,-1) AND downBar AND VolPos == 2;\r\nupThrustCond3\t=\tupThrustBar AND VolPos ==1;\r\ntopRevBar\t\t=\tRef(V,-1)&gt;volAvg  AND Ref(upBar,-1) AND Ref(wideRangeBar,-1) AND downBar AND downClose AND wideRangeBar AND upmajor&gt;0 AND H==HHV(H,10);\r\nPseudoUpThrust\t=\tRef(upBar,-1) AND H&gt;Ref(H,-1) AND Ref(V,-1)&gt;1.5*volAvg AND downBar AND downClose AND  NOT upThrustBar;\r\npseudoUtCond\t=\tRef(PseudoUpThrust,-1) AND downBar AND downClose AND NOT upThrustBar;\r\ntrendChange\t\t=\tRef(upBar,-1) AND H==HHV(H,5)AND downBar AND (downClose OR midClose) AND V&gt;volAvg AND upmajor&gt;0 AND upimd&gt;0 AND NOT wideRangeBar AND NOT PseudoUpThrust ;\r\nnoDemandBarUt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND ((upminor ==1 AND upimd ==1) OR (upminor ==1 AND upmajor == 1));//in a up market\r\nnoDemandBarDt\t=\tupBar AND narrowRangeBar AND lowVolume AND ClosePos&gt; 3 AND (upminor == -1 OR upimd == -1);// in a down or sidewayss market\r\nnoSupplyBar\t\t=\tdownBar AND narrowRangeBar AND lowVolume  AND ClosePos&lt;3 AND ((upminor&lt;1 AND upimd&lt;1) OR (upminor&gt;0 AND upimd&lt;1));\r\nlowVolTest\t\t=   L==LLV(L,5) AND upClose AND lowVolume;//lowVolume AND L&lt;Ref(L,-1) AND upClose;\r\nlowVolTest1\t\t= \tL==LLV(L,5) AND V&lt;volAvg AND L&lt;Ref(L,-1) AND upClose AND upminor&gt;0 AND upmajor&gt;0;// AND wideRangeBar;\r\nlowVolTest2\t\t= \tRef(lowVolTest,-1) AND upBar AND upClose;\r\nsellCond1\t\t=\t(upThrustCond1 OR upThrustCond2 OR upThrustCond3) ;\r\nsellCond2\t\t=\tRef(sellCond1,-1)==0;\r\nsellCond\t\t=\tsellCond1 AND sellCond2;\r\nstrengthDown0\t= \tupmajor&lt;0 AND VolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;// strength after a long down trend\r\nstrengthDown\t= \tVolPos&lt;4 AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upimd&lt;=00 AND upminor&lt;0;// Strength after a down trend\r\nstrengthDown1\t= \tupmajor&lt;0 AND V&gt;(volAvg*1.5) AND Ref(downBar,-1) AND upBar AND ClosePos&gt;3 AND upminor&lt;0 AND upimd&lt;=0;//Strength after downtrend . High volume\r\nstrengthDown2\t=\tupimd&lt;=0 AND Ref(V,-1)&lt;volAvg  AND upBar AND veryHighClose AND VolPos&lt;4;\r\nbuyCond1\t\t= \tstrengthDown OR strengthDown1;\r\nbuyCond\t\t\t= \tupBar  AND Ref(buyCond1,-1);\r\nstopVolume\t\t= \tL==LLV(L,5)  AND (upClose OR midClose) AND V&gt;1.5*volAvg AND upmajor&lt;0;\r\nrevUpThrust\t\t=\tupmajor&lt;0 AND upBar AND upClose AND V&gt;Ref(V,-1) AND V&gt;volAvg AND  wideRangeBar AND Ref(downBar,-1) AND Ref(downClose,-1) AND upminor&lt;0;\r\neffortUp\t\t=\tH&gt;Ref(H,-1) AND L&gt;Ref(L,-1) AND C&gt;Ref(C,-1) AND C&gt;=((H-L)*0.7+L) AND spread&gt;avgSpread AND VolPos&lt;4;//AND O&lt;=((H-L)*0.3+L) \r\neffortUpfail\t=\tRef(effortUp,-1) AND (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR (downbar AND AvgSpreadBar));\r\neffortDown\t\t=\tH&lt;Ref(H,-1) AND L&lt;Ref(L,-1) AND C&lt;Ref(C,-1) AND  C&lt;=((H-L)*0.25+L) AND wideRangeBar AND VolPos&lt;4;//O&gt;=((H-L)*0.75+\r\neffortDownFail  =    Ref(effortDown,-1) AND ((upbar AND AvgSpreadBar) OR revUpThrust OR Buycond1);\r\nupflag          =    (Sellcond OR Buycond OR effortup OR effortupfail OR stopvolume OR effortdown OR effortdownfail OR revupthrust OR\r\n                                    noDemandBarDt OR noDemandBarUt OR nosupplyBar OR lowVolTest\tOR lowVolTest1 OR lowVolTest2 OR bc);\r\nbullBar\t\t   \t=\t(V&gt;volAvg OR V&gt;Ref(V,-1)) AND closePosition &lt;2 AND upBar AND NOT upflag;\r\nbearBar\t\t\t=\tvb  AND downClose AND downBar AND spread&gt;avgSpread AND NOT upflag ;\r\nsc              =      wideRangeBar AND belowClose AND V == HHV(V,60) AND upmajor== -1;// NEW SIGNAL Nuying Climax\r\n\r\n\r\n//**************************************************************\r\n//-------------------------- Strength - Weakness ----------------------------------------------------\r\n\r\n // Diem Manh\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR effortUp   OR revUpThrust ;\r\n// Diem Yeu\r\nweakness\t= bc or upThrustBartrue OR  upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond or effortUpfail or Sellcond OR  effortDown  OR tbc4  ;\r\n//Dau hieu canh bao thay doi xu huong\r\nvsachange   = trendChange or topRevBar or noDemandBarDt OR noDemandBarUt OR Fom1 OR tbc3 OR tbc5 or buyCond OR noSupplyBar  OR lowVolTest or lowVolTest1 or lowVolTest2  or stopVolume ; \r\n            \r\n//**************************************************************\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//              3. Plotting Module  -  Hien thi chon Chart: Bar | Candle                                         |\r\n//====================================================================================|\r\n\r\n_SECTION_BEGIN("3. Chon che do Chart: Bar | Candle | Line");\r\n\r\n//VSA Bar \r\n//Bar coloring formula 1 _ Preferred - Based on VSA Strength\r\nVscolor=IIf(lowVolTest,colorTurquoise,IIf(lowVolTest2,colorPink,IIf(bc,colorDarkRed ,IIf(upThrustBar,colorYellow ,IIf(bullbar,colorLime ,\r\nIIf(bearbar,colorRed,IIf(noDemandBarUT OR noDemandBarDt,colorWhite ,IIf(noSupplyBar,colorCustom12,IIf(upbar,colorGreen,IIf(downbar,colorOrange,colorBlue))))))))));\r\n\r\n//Bar coloring formula 2 _  Based on Trend \r\nTrcolor=IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorLime,IIf(trendShortTerm&gt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&lt;0,colorGreen,\r\nIIf(trendShortTerm&gt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorPaleGreen,IIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&lt;0,colorRed,IIf(trendShortTerm&lt;0 AND trendMediumTerm&gt;0 AND trendLongTerm&gt;0,colorPaleGreen,\r\nIIf(trendShortTerm&lt;0 AND trendMediumTerm&lt;0 AND trendLongTerm&gt;0,colorOrange,colorBlue))))));\r\n\r\n//Bar coloring formula 3 _  Marar Histogram \r\nVlp=Param("Khoang thoi gian xem lai Volume Bar Chart",150,20,300,10);\r\nVrg=MA(V,Vlp);// average volume\r\nrg=(H-L);\r\narg=Wilders(rg,30);\r\nVh=V&gt;Ref(V,-1) AND Ref(V,-1)&gt;Ref(V,-2);\r\nCloc=C-L;\r\nx=(H-L)/(Cloc+ 1e-9);\r\nx1=IIf(Cloc == 0,arg,x);\r\nVb1 =V&gt;Vrg OR V&gt;Ref(V,-1);\r\nucls=x1&lt;2;\r\ndcls=x1&gt;2;\r\nmcls=x1&lt;2.2 AND x1&gt;1.8 ;\r\nVlcls=x1&gt;4;\r\nVhcls=x1&lt;1.35;\r\n//upbar=C&gt;Ref(C,-1); \r\ndnbar=C&lt;Ref(C,-1); \r\nCloseUp =  C&gt;Ref(C,-1);\r\nClosedn =  C&lt;Ref(C,-1);\r\nVolUp   =  V&gt;Ref(V,-1);\r\nVolDn   =  V&lt;Ref(V,-1);\r\nbb1 = upbar AND CloseUp AND ucls AND L&gt;Ref(L,-1);\r\nbb2 = upbar AND VolUp;\r\nbb3 = dnbar AND CloseDn AND VolDn;\r\nbb4 = dnbar AND CloseDn AND C&gt;Ref(L,-1);\r\ndb1 = dnbar AND CloseDn AND dcls;\r\ndb2 = dnbar AND VolUp  ;\r\ndb3 = upbar AND CloseDn AND VolUp;\r\ndb4 = upbar AND CloseDn AND C&lt;Ref(L,-1) AND dcls;\r\ndb5 = upbar AND CloseUp AND ucls AND L&lt;Ref(L,-1);\r\ndb6 = upbar AND CloseUp AND dcls;\r\nbb=(bb1 OR bb2 OR bb3 OR bb4);\r\ndb=(db1 OR db2 OR db3 OR db4 OR db5 OR db6);\r\nMcolor = IIf(bb AND tls&gt;0, colorLime,IIf(db AND tls&lt;0,colorRed,colorWhite)) ; \r\n\r\nbubar = (upbar AND Close &gt; Open AND spread &gt; 0.3 * Avgspread);\r\nbebar = (downbar AND Close &lt; Open AND spread &gt; 0.3 * Avgspread);\r\nrngbar = (abs(C-O) &lt; 0.2*(H-L)) OR (narrowRangeBar AND abs(C-O) &lt; 0.5*(H-L)) ;\r\n\r\n//Bar coloring formula 4 _ Price Action with Candle \r\npacolor = IIf(rngbar, colorWhite,IIf(bubar, colorLime, IIf(bebar, colorRed,colorBlue)));\r\n\r\n//Bar coloring formula 5 _  Back ground Strength\r\n//-------------------------- Strength band ----------------------------------------------------\r\nstrengthbar\t= \tstrengthDown OR strengthDown1 OR strengthDown2 OR strengthDown0 OR bullBar OR effortUp OR upBar OR lowVolTest OR lowVolTest1 OR lowVolTest2 OR revUpThrust OR stopVolume;\r\n\r\nweaknessbar\t= \tupThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond OR effortDown OR trendChange OR noDemandBarDt OR bearBar OR downBar OR noSupplyBar;\r\n\r\nstrength6\t=\tIIf(Ref(strengthbar,-5),1,IIf(Ref(weaknessbar,-5),-1,0));\r\nstrength5\t=\tIIf(Ref(strengthbar,-4),1,IIf(Ref(weaknessbar,-4),-1,0));\r\nstrength4\t=\tIIf(Ref(strengthbar,-3),1,IIf(Ref(weaknessbar,-3),-1,0));\r\nstrength3\t=\tIIf(Ref(strengthbar,-2),1,IIf(Ref(weaknessbar,-2),-1,0));\r\nstrength2\t=\tIIf(Ref(strengthbar,-1),1,IIf(Ref(weaknessbar,-1),-1,0));\r\nstrength1\t=\tIIf(strengthbar,1,IIf(weaknessbar,-1,0));\r\n\r\nConsolStrength = strength1+strength2+strength3+strength4+strength5+strength6;\r\n\r\n//STrength Bar color\r\nstmcolor=IIf(ConsolStrength==6,ColorRGB(0,80,0),IIf(ConsolStrength==5,ColorRGB(0,100,0),IIf(ConsolStrength==4,ColorRGB(0,140,0),\r\nIIf(ConsolStrength==3,ColorRGB(0,180,0),IIf(ConsolStrength==2,ColorRGB(0,220,0),IIf(ConsolStrength==1,ColorRGB(0,245,0),\r\nIIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&gt;=0,ColorRGB(0,290,0),IIf(ConsolStrength==0 AND Ref(ConsolStrength,-1)&lt;=0,ColorRGB(260,0,0),\r\nIIf(ConsolStrength==-6,ColorRGB(60,0,0), IIf(ConsolStrength==-5,ColorRGB(100,0,0),IIf(ConsolStrength==-4,ColorRGB(140,0,0), \r\nIIf(ConsolStrength==-3,ColorRGB(180,0,0),IIf(ConsolStrength==-2,ColorRGB(220,0,0),IIf(ConsolStrength==-1,ColorRGB(245,0,0),colorBlack))))))))))))));\r\n\r\n//Bar coloring formula 6 _ Price Action with Bar\r\n pabar = IIf(C&gt;Ref(C,-1),colorLime,colorRed);\r\n \r\n\r\n//***************Lua chon kieu hien thi Chart Candle - Line - Bar Close*************\r\n//Chon mau sac thanh Bar\r\n\r\nColorup      = ParamColor( "UpColor Bar", colorBrightGreen );\r\nColordown    = ParamColor( "DownColor Bar", colorRed );\r\nColorsideway = ParamColor( "SidewayColor Bar", colorYellow );\r\n//Change Color theo Gia so voi hom qua\r\nPcolor       = IIf(C&gt;Ref(C,-1),Colorup,IIf(C&lt;Ref(C,-1),Colordown,Colorsideway));\r\n//Change Color theo bien dong Gia trong ngay\r\nColorPriceintraday      = ParamColor( "ColorPriceintraday", colorSeaGreen );\r\nChangePcolor = IIf(xx&gt;=6,colorViolet,\r\n//Gia san&lt;6%\r\nIIf(xx&lt;=-6,colorTurquoise,\r\n//Tang gia\r\nIIf(xx&gt;0 AND xx&lt;6,colorLime,\r\n//Giam gia\r\nIIf(xx&lt;0 AND xx&gt;-6,colorRed,\r\n//Tham chieu\r\ncolorGold))));\r\n\r\n//Mau Line Color\r\nLineColor    = ParamColor("Color - Mau chu CP", colorGold );\r\nPStyle       = ParamStyle("Chart Style", styleThick );\r\n\r\n//Xac dinh xu huong\r\nUpTrend = C &gt; ( LLV( L, 20 ) + 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &gt; EMA( Close, 40 );\r\nDnTrend = C &lt; ( HHV( H, 20 ) - 2 * ATR( 10 ) ) AND EMA( Close, 20 ) &lt; EMA( Close, 40 );\r\n\r\n//Change Color theo xu huong Gia - Neu Uptrend mau Xanh, Downtrend mau Cam, sideway mau trang\r\nColortrend = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) ); \r\n\r\n\r\n\r\n\r\n//***************Lua chon kieu hien thi Chart*************\r\n//Plot( Muc can ve, "Dat ten cho muc can ve", Chon mau sac, Chon kieu hien thi);\r\n\r\n//------------------------------------------------------------------------------------------\r\n\r\nSelectedChartCP = ParamList( "* Chon che do hien thi Bar | Candle", "Candle - Nen Nhat|Close Bar|Based Bar|Uptrend - Downtrend Bar|VSA Based Bar|Trend Based Bar|Marar Trend Based Bar|Strength Bars|PA Bars|Line", 0 );\r\n                                                                      \r\n                                                                      \r\nswitch ( SelectedChartCP )\r\n{\r\n\r\n//Nen Nhat\r\ncase "Candle - Nen Nhat":\r\n//PlotOHLC( Open,  High,  Low,  Close, "", Pcolor, styleCandle | styleThick );\r\nPlot(C, "Close", Pcolor , styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Close\r\ncase "Close Bar":\r\nPlotOHLC(Close,  High,  Low,  Close, "",  Pcolor, styleBar | PStyle);\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Based\r\ncase "Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Pcolor, styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Uptrend - Downtrend\r\ncase "Uptrend - Downtrend Bar":\r\nPlot(C, "Price",  Colortrend , styleBar | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Based\r\ncase "VSA Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", VScolor, styleCandle  | PStyle   );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar VSA Trend Based\r\ncase "Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Trcolor, styleCandle | PStyle );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Bar Marar Trend Based\r\ncase "Marar Trend Based Bar":\r\nPlotOHLC(Open,  High,  Low,  Close, "", Mcolor, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Strength Bars\r\ncase "Strength Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", stmcolor, styleCandle   | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//PA Bars\r\ncase "PA Bars":\r\nPlotOHLC(Open,  High,  Low,  Close, "", pabar, styleCandle | PStyle  );\r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n//Line\r\ncase "Line":\r\n//Ve duong gia CP hien tai\r\nPlotOHLC(Open,High,Low,Close,"",  LineColor, styleLine  | PStyle ); \r\ny = LastValue( C ); PlotText(  "           " + Name() +  ":  " +WriteVal(C,1.2)+ "  =  "+DD+"  ("+xx+"%)", BarCount+ 3 , y,ColorPriceintraday);\r\nbreak;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Plotting Module  -  Hien thi chon Chart: Bar | Candle \r\n\r\n//==========================================================================|\r\n//                   So sanh RS voi Ticker                                          |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("So sanh RS voi Ticker");\r\n\r\n//CP can so sanh\r\nTicker            = ParamStr  ("So sanh RS voi Ticker", "VNINDEX" );\r\nColorForeign      = ParamColor("Color Ticker", colorAqua );\r\nStyleForeign      =  ParamStyle("Style Ticker",styleThick);\r\n  \r\nif (RSticker = ParamToggle( "*. Hien thi So sanh RS voi Ticker",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Ve duong gia Ma so sanh\r\nPlotOHLC(Foreign(Ticker,"Open"), Foreign(Ticker,"High"), Foreign(Ticker,"Low"), Foreign(Ticker,"Close"),Ticker, ColorForeign, styleLine |  StyleForeign| styleOwnScale);\r\ny = LastValue( Foreign(Ticker,"Close") ); PlotText(  "_ " + Ticker +  ":  " +WriteVal(Foreign(Ticker,"Close"),1.2), BarCount+ 3 , y,ColorPriceintraday);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END So sanh RS voi Ticker \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    4. Cac duong trung binh dong                  |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("4. Cac duong Trung binh dong");\r\n\r\n\r\n\r\n\r\n//Chon muc gia Dong cua\r\ntye  =   ParamList("1. Lua chon muc Gia","Close|Pivot = (H+L+C)/3" ,0);\r\npe = IIf(tye == "Close" , Close, (H+L+C)/3);\r\n\r\n//Cac duong EMAs MAs\r\nema5  =  Param(" - EMA5",  5,   1, 500, 1);\r\nema10  = Param(" - EMA10", 10,  1, 500, 1);\r\nema20  = Param(" - EMA20", 20,  1, 500, 1);\r\nema30  = Param(" - EMA30", 30,  1, 500, 1);\r\nma50  =  Param(" - MA50",  50,  1, 500, 1);\r\nma100  = Param(" - MA100", 100, 1, 500, 1);\r\nma150  = Param(" - MA150", 150, 1, 500, 1);\r\nma200  = Param(" - MA200", 200, 1, 500, 1);\r\n\r\n//Ve cac duong EMAs MAs\r\n\r\npema5  = EMA(pe,ema5);\r\npema10 = EMA(pe,ema10);\r\npema20 = EMA(pe,ema20);\r\npema30 = EMA(pe,ema30);\r\nmma50  = MA (pe,ma50);\r\nmma100 = MA (pe,ma100);\r\nmma150 = MA (pe,ma150);\r\nmma200 = MA (pe,ma200);\r\n\r\n\r\n\r\n\r\n\r\n//                    //EMA va MA                         |\r\n//==========================================================================|\r\n\r\n//Ve EMA 5,10,20\r\nif (plotema5_10_20  =   ParamToggle("1. EMAs 5,10,20","OFF|ON" , 0 ))\r\n{\r\n// Hien thi cac duong EMA ngan han EMA5,10,20\r\nPlot(IIf(plotema5_10_20 ==1, pema5 ,Null), "ema5",  colorDarkOliveGreen,styleLine|styleNoLabel|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema10 ,Null),"ema10", colorLightOrange,   styleLine|styleThick|styleNoRescale);\r\nPlot(IIf(plotema5_10_20 ==1, pema20 ,Null),"ema20", colorBlue,          styleLine|styleThick|styleNoRescale);\r\n\r\n//**********************************************************************************\r\nmaupcolor   = ParamColor(" - MA Up Color",      colorSeaGreen );  \r\nmadncolor   = ParamColor(" - MA Down Color",    colorGrey40 );\r\n\r\nbullColor = ColorBlend( maupcolor,   GetChartBkColor(), 0.75 );  \r\nbearColor = ColorBlend( madncolor,   GetChartBkColor(), 0.45 );\r\n\r\n\r\n//Ve may EMA 10 va 20\r\nPlotOHLC( pema10, pema20, pema10, pema20, "", IIf(pema10&gt;pema20, bullColor , bearColor),  styleCloud |styleNoLabel|styleNoRescale);\r\n\r\n}\r\n\r\n\r\n\r\n// Ve duong MA 30,50,100,150,200\r\n// Hien thi cac duong EMA30\r\nPlot(IIf(ParamToggle("2. EMA30","OFF|ON" , 0 )  ==1, pema30 ,Null),"ema30", colorRed,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA50\r\nPlot(IIf(ParamToggle("3. MA50", "OFF|ON" , 0 ) ==1, mma50 ,Null),"MA50",    colorGold,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA100\r\nPlot(IIf(ParamToggle("4. MA100","OFF|ON" , 0 ) ==1, mma100 ,Null),"MA100", colorLightBlue,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA150\r\nPlot(IIf(ParamToggle("5. MA150","OFF|ON" , 0 ) ==1, mma150 ,Null),"MA150", colorGreen,styleLine|styleThick|styleNoRescale);\r\n\r\n// Hien thi cac duong MA200\r\nPlot(IIf(ParamToggle("6. MA200","OFF|ON" , 0 )  ==1, mma200 ,Null),"MA200", colorViolet,styleLine|styleThick|styleNoRescale);\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//====================================================================================|\r\n//                    5.Muc HO TRO | KHANG CU gan nhat                          |\r\n//====================================================================================|\r\n// START SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n_SECTION_BEGIN("5. Muc HO TRO - KHANG CU gan nhat");\r\n\r\n/*\r\nPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\nPlotText("R1 : " + R1, BarCount + 1, LastValue(R1), WarnaResistant);\r\n*/\t\t\t\r\n \r\nWarnaResistant = ParamColor("Chon mau Resistant - Khang cu",colorRed);\r\nWarnaSupport   = ParamColor("Chon mau Support - Ho tro",    colorBlue);\r\nSRStyle        = ParamStyle("S/R Style",styleNoLabel);\r\n\r\nR1_show = 0;\r\nS1_show = 0;\r\n \r\n \r\nif (ParamToggle("* Hien thi muc HO TRO - KHANG CU gan nhat", "OFF|ON" , 0 ))\r\n{\r\n\t// RESISTANT\r\n\tLastHighestValue = LastVisibleValue(Ref(H,-1));\r\n\tif (LastVisibleValue(H) == H[LastValue(BarIndex())])\r\n\t\tLastHighestValue = LastVisibleValue(H);\r\n \r\n\ti = 1;\r\n\t\r\n\tif (LastHighestValue &lt; HighestVisibleValue(H))\r\n\t{\r\n\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i)) &lt; LastHighestValue)\r\n\t\t\t\ti++;\r\n \r\n\t    \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n \r\n\t\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle );\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n \r\n\t\t\ti++;\r\n \r\n\t\t\tif (HighestVisibleValue( H ) &gt; R1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tR2 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\tR2x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= R2x,LastValue(R2),Null),"R2",WarnaResistant ,SRStyle);\r\n\t\t\t\tPlotText("R2 : " + R2, BarCount + 10, LastValue(R2), WarnaResistant);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (HighestVisibleValue( H )&gt; R2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i)) &lt;= R2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tR3 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1), Ref(H,-1), i));\r\n\t\t\t\t\tR3x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\t\r\n \r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= R3x,LastValue(R3),Null),"R3",WarnaResistant ,SRStyle);\r\n\t\t\t\t\tPlotText("R3 : " + R3, BarCount + 10, LastValue(R3), WarnaResistant);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastHighestValue == HighestVisibleValue(H))\r\n\t{\r\n\t   \tR1 = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(H, -1), i));\r\n\t\tR1x = LastVisibleValue(ValueWhen(H &lt;= Ref(H,-1) AND Ref(H,-2) &lt;= Ref(H, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (R1 == LastHighestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= R1x,LastValue(R1),Null),"R1",WarnaResistant ,SRStyle);\r\n\t\t\tPlotText("R1 : " + R1, BarCount + 10, LastValue(R1), WarnaResistant);\r\n\t\t\tR1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\t// SUPPORT\r\n\tLastLowestValue = LastVisibleValue(Ref(L,-1));\r\n\tif (LastVisibleValue(L) == L[LastValue(BarIndex())])\r\n\t\tLastLowestValue = LastVisibleValue(L);\r\n \r\n\ti = 1;\r\n \r\n\tif (LastLowestValue &gt; LowestVisibleValue(L))\r\n\t{\t\r\n\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i)) &gt; LastLowestValue)\r\n\t\t\t\ti++;\r\n \r\n\t\t\tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t\ti++;\r\n \r\n\t\t\tif (LowestVisibleValue( L ) &lt; S1)\r\n\t\t\t{\r\n\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S1)\r\n\t\t\t\t\ti++;\r\n \r\n\t\t\t\tS2 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\tS2x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\t\r\n \r\n\t\t\t\tPlot(IIf(BarIndex() &gt;= S2x,LastValue(S2),Null),"S2",WarnaSupport ,SRStyle);\r\n\t\t\t\tPlotText("S2 : " + S2, BarCount + 10, LastValue(S2), WarnaSupport);\r\n\t\t\t\ti++;\r\n\t\t\t\tif (LowestVisibleValue( L )&lt; S2)\r\n\t\t\t\t{ \t\t\r\n\t\t\t\t\twhile (LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i)) &gt;= S2)\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\tS3 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(L,-1), i));\r\n\t\t\t\t\tS3x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1), Ref(BarIndex(),-1), i));\r\n\t\t\t\t\tPlot(IIf(BarIndex() &gt;= S3x,LastValue(S3),Null),"S3",WarnaSupport ,SRStyle);\r\n\t\t\t\t\tPlotText("S3 : " + S3, BarCount + 10, LastValue(S3), WarnaSupport);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\telse if (LastLowestValue == LowestVisibleValue(L))\r\n\t{\r\n\t   \tS1 = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(L, -1), i));\r\n\t\tS1x = LastVisibleValue(ValueWhen(L &gt;= Ref(L,-1) AND Ref(L,-2) &gt;= Ref(L, -1),Ref(BarIndex(), -1), i));\r\n\t\tif (S1 == LastLowestValue)\r\n\t\t{\r\n\t\t\tPlot(IIf(BarIndex() &gt;= S1x,LastValue(S1),Null),"S1",WarnaSupport ,SRStyle);\r\n\t\t\tPlotText("S1 : " + S1, BarCount + 10, LastValue(S1), WarnaSupport);\r\n\t\t\tS1_show = 1;\r\n\t\t}\r\n\t}\r\n \r\n\tif (S1_show AND R1_show)\r\n\t{\r\n\t\tSR = Prec((1-(S1/R1))*100,2);\r\n\t}\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END SCRIPT UNTUK SUPPORT / RESISTANT\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       PLOT SHAPES SECTION   - Hien thi dau hieu canh bao VSA            |\r\n//====================================================================================|\r\n\r\n\r\n \r\nif (vsasignal = ParamToggle( "* Hien thi dau hieu canh bao VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n\r\n\r\nPlotShapes(shapeSmallDownTriangle*(upThrustBar OR upThrustBartrue ) , colorDarkRed, 0, H, -10 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustBarA OR upThrustBartrue ) , colorRed, 0, H, -10 );\r\nPlotShapes(shapeSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorRed, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*(upThrustcond1 OR upThrustcond2 ) , colorWhite, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*topRevBar, colorBlue, 0, H, 20 );\r\nPlotShapes(shapeSmallSquare*(PseudoUpThrust) , colorBlue, 0, H, 10 );\r\nPlotShapes(shapeSmallDownTriangle*(pseudoUtCond) , colorBlue, 0, H, -20 );\r\nPlotShapes(shapeSmallDownTriangle*trendChange , colorYellow, 0, H, -20 );\r\nPlotShapes(shapeHollowSmallDownTriangle*trendChange , colorRed, 0, H, -20 );\r\nPlotShapes(shapeSmallSquare*noDemandBarUt, colorOrange, 0, H, 15);\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarUt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*(noDemandBarDt) , colorOrange, 0, H, 15 );\r\nPlotShapes(shapeHollowSmallSquare*noDemandBarDt, colorYellow, 0, H, 15);\r\nPlotShapes(shapeSmallSquare*noSupplyBar, colorBlue, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallSquare*noSupplyBar, colorLightBlue, 0, L, -20 );\r\nPlotShapes(shapeSmallSquare*lowVolTest, colorCustom12, 0, L, -20);\r\nPlotShapes(shapeSmallUpTriangle*lowVolTest2, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown, colorDarkGreen, 0, L, -20 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown, colorLime, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*strengthDown2, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeHollowSmallUpTriangle*strengthDown2, colorCustom12, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*stopVolume, colorGreen,0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*stopVolume, colorYellow, 0, L, -10 );\r\nPlotShapes(shapeSmallSquare*revUpThrust, colorYellow, 0, L, -20 );\r\nPlotShapes(shapeSmallUpTriangle*sc, colorViolet, 0, L, -30 );\r\nPlotShapes(shapeSmallCircle*effortUp, colorLime, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortUpFail, colorRed, 0, H, 10 );\r\nPlotShapes(shapeHollowSmallCircle*effortUpFail, colorWhite, 0, H, 10 );\r\nPlotShapes(shapeSmallCircle*effortDown, colorOrange, 0, midprice, 0 );\r\nPlotShapes(shapeSmallCircle*effortDownFail, colorRed, 0, L, -10 );\r\nPlotShapes(shapeHollowSmallCircle*effortDownFail, colorWhite, 0, L, -10 );\r\nPlotShapes(shapeUpArrow*buyCond, colorGreen, 0, L, -20 );\r\nPlotShapes(shapeDownArrow*Sellcond, colorOrange, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(nut) , colorLime, 0, H, -40 );\r\nPlotShapes(shapeSmallDownTriangle*(bc ) , colorDarkRed, 0, H, -20 );\r\nPlotShapes(shapeSmallCircle*(fom1 ) , colorWhite, 0, L, -50 );\r\n//PlotShapes(shapeSmallCircle*(fom2 ) , colorRed, 0, L, -50 );\r\nPlotShapes(shapeHollowCircle*(tbc3 ) , colorYellow ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2a ) , colorBlue ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc2 ) , colorLime ,0, L, -40 );\r\nPlotShapes(shapeHollowCircle*(tbc5 ) , colorYellow ,0, H, 40 );\r\nPlotShapes(shapeHollowCircle*(tbc4 ) , colorRed ,0, H, 40 );\r\n\r\n}\r\n\r\n\r\n\r\n// END Hien thi dau hieu canh bao VSA\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       6. Muc HO TRO - KHANG CU tuy chinh                           |\r\n//====================================================================================|\r\n// AFL By Karthikmarar\r\n// RESISTANCE AND SUPPORT LINES AFL VERSION 2.00\r\n// Provids upto total 20 lines. Two Adjustable Parameters. 1) Sensitivity and 2) Number of lines\r\n// Depending on the Share Volatility, the Sensitivity Factor can be adjusted\r\n// Support Lines are colored Blue and Resistance Line are colored Red.\r\n\r\n\r\n_SECTION_BEGIN("6. Muc HO TRO - KHANG CU tuy chinh");\r\n\r\nRcolor=ParamColor( "Resistance Color", colorRed );\r\nScolor=ParamColor( "Support Color", colorBlue );\r\nPer=Param("Chon do nhay",5,1,100,1);\r\ng=Param("Chon so duong",5,1,20,1);\r\nsr=ParamToggle("* Hien thi Muc HO TRO - KHANG CU tuy chinh","OFF|ON" ,0);\r\n\r\nx=Cum(1);\r\nPk1=PeakBars(H,per,1)== 0;\r\nTk1=TroughBars(L,per,1)== 0;\r\n//peak detection\r\npx1=LastValue(ValueWhen(pk1,x,1));\r\npx2=LastValue(ValueWhen(Pk1,x,2));\r\npx3=LastValue(ValueWhen(Pk1,x,3));\r\npx4=LastValue(ValueWhen(pk1,x,4));\r\npx5=LastValue(ValueWhen(Pk1,x,5));\r\npx6=LastValue(ValueWhen(Pk1,x,6));\r\npx7=LastValue(ValueWhen(pk1,x,7));\r\npx8=LastValue(ValueWhen(Pk1,x,8));\r\npx9=LastValue(ValueWhen(Pk1,x,9));\r\npx10=LastValue(ValueWhen(Pk1,x,10));\r\n//Trough  Detection\r\ntx1=LastValue(ValueWhen(Tk1,x,1));\r\ntx2=LastValue(ValueWhen(Tk1,x,2));\r\ntx3=LastValue(ValueWhen(Tk1,x,3));\r\ntx4=LastValue(ValueWhen(Tk1,x,4));\r\ntx5=LastValue(ValueWhen(Tk1,x,5));\r\ntx6=LastValue(ValueWhen(Tk1,x,6));\r\ntx7=LastValue(ValueWhen(Tk1,x,7));\r\ntx8=LastValue(ValueWhen(Tk1,x,8));\r\ntx9=LastValue(ValueWhen(Tk1,x,9));\r\ntx10=LastValue(ValueWhen(Pk1,x,10));\r\n//values when Peaks occured\r\nXT1 =LastValue(ValueWhen(pk1,H,1));\r\nXT2 =LastValue(ValueWhen(Pk1,H,2));\r\nXT3 =LastValue(ValueWhen(Pk1,H,3));\r\nXT4 =LastValue(ValueWhen(pk1,H,4));\r\nXT5 =LastValue(ValueWhen(Pk1,H,5));\r\nXT6 =LastValue(ValueWhen(Pk1,H,6));\r\nXT7 =LastValue(ValueWhen(pk1,H,7));\r\nXT8 =LastValue(ValueWhen(Pk1,H,8));\r\nXT9 =LastValue(ValueWhen(Pk1,H,10));\r\nXT10 =LastValue(ValueWhen(Pk1,H,10));\r\n//Value when troughs occured\r\nYT1 =LastValue(ValueWhen(tk1,L,1));\r\nYT2 =LastValue(ValueWhen(tk1,L,2));\r\nYT3 =LastValue(ValueWhen(tk1,L,3));\r\nYT4 =LastValue(ValueWhen(tk1,L,4));\r\nYT5 =LastValue(ValueWhen(tk1,L,5));\r\nYT6 =LastValue(ValueWhen(tk1,L,6));\r\nYT7 =LastValue(ValueWhen(tk1,L,7));\r\nYT8 =LastValue(ValueWhen(tk1,L,8));\r\nYT9 =LastValue(ValueWhen(tk1,L,10));\r\nYT10 =LastValue(ValueWhen(tk1,L,10));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n//plot peak lines\r\nPlot(IIf(x&gt;px1 AND g&gt;=1 AND sr,XT1,Null),"P1",IIf( LastValue(C)&gt;XT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px2 AND g&gt;=2 AND sr,XT2,Null),"P2",IIf( LastValue(C)&gt;XT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px3 AND g&gt;=3 AND sr,XT3,Null),"P3",IIf( LastValue(C)&gt;XT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px4 AND g&gt;=4 AND sr,XT4,Null),"P4",IIf( LastValue(C)&gt;XT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px5 AND g&gt;=5 AND sr,XT5,Null),"P5",IIf( LastValue(C)&gt;XT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px6 AND g&gt;=6 AND sr,XT6,Null),"P6",IIf( LastValue(C)&gt;XT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px7 AND g&gt;=7 AND sr,XT7,Null),"P7",IIf( LastValue(C)&gt;XT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px8 AND g&gt;=8 AND sr,XT8,Null),"P8",IIf( LastValue(C)&gt;XT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px9 AND g&gt;=9 AND sr,XT9,Null),"P9",IIf( LastValue(C)&gt;XT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;px10 AND g&gt;=10 AND sr,XT10,Null),"P10",IIf( LastValue(C)&gt;XT10, Scolor, Rcolor ));\r\n//plot Trough lines\r\nPlot(IIf(x&gt;tx1 AND g&gt;=1 AND sr,YT1,Null),"T1",IIf( LastValue(C)&gt;YT1, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx2 AND g&gt;=2 AND sr,YT2,Null),"T2",IIf( LastValue(C)&gt;YT2, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx3 AND g&gt;=3 AND sr,YT3,Null),"T3",IIf( LastValue(C)&gt;YT3, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx4 AND g&gt;=4 AND sr,YT4,Null),"T4",IIf( LastValue(C)&gt;YT4, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx5 AND g&gt;=5 AND sr,YT5,Null),"T5",IIf( LastValue(C)&gt;YT5, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx6 AND g&gt;=6 AND sr,YT6,Null),"T6",IIf( LastValue(C)&gt;YT6, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx7 AND g&gt;=7 AND sr,YT7,Null),"T7",IIf( LastValue(C)&gt;YT7, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx8 AND g&gt;=8 AND sr,YT8,Null),"T8",IIf( LastValue(C)&gt;YT8, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx9 AND g&gt;=9 AND sr,YT9,Null),"T9",IIf( LastValue(C)&gt;YT9, Scolor, Rcolor ));\r\nPlot(IIf(x&gt;tx10 AND g&gt;=10 AND sr,YT10,Null),"T10",IIf( LastValue(C)&gt;YT10, Scolor, Rcolor ));\r\n//Crossing Resistance Lines\r\nxt1c=Cross(C,xt1);\r\nxt2c=Cross(C,xt2);\r\nxt3c=Cross(C,xt3);\r\nxt4c=Cross(C,xt4);\r\nxt5c=Cross(C,xt5);\r\nxt6c=Cross(C,xt6);\r\nxt7c=Cross(C,xt7);\r\nxt8c=Cross(C,xt8);\r\nxt9c=Cross(C,xt9);\r\nxt10c=Cross(C,xt10);\r\n//Breaking support Lines\r\nyt1c=Cross(yt1,C);\r\nyt2c=Cross(yt2,C);\r\nyt3c=Cross(yt3,C);\r\nyt4c=Cross(yt4,C);\r\nyt5c=Cross(yt5,C);\r\nyt6c=Cross(yt6,C);\r\nyt7c=Cross(yt7,C);\r\nyt8c=Cross(yt8,C);\r\nyt9c=Cross(yt9,C);\r\nyt10c=Cross(yt10,C);\r\n//Resistance approaching \r\nax1=C&lt;xt1 AND C&gt;xt1*0.97;\r\nax2=C&lt;xt2 AND C&gt;xt2*0.97;\r\nax3=C&lt;xt3 AND C&gt;xt3*0.97;\r\nax4=C&lt;xt4 AND C&gt;xt4*0.97;\r\nax5=C&lt;xt5 AND C&gt;xt5*0.97;\r\nax6=C&lt;xt6 AND C&gt;xt6*0.97;\r\nax7=C&lt;xt7 AND C&gt;xt7*0.97;\r\nax8=C&lt;xt8 AND C&gt;xt8*0.97;\r\nax9=C&lt;xt9 AND C&gt;xt9*0.97;\r\nax10=C&lt;xt10 AND C&gt;xt10*0.97;\r\n//Support approaching\r\nay1=C&gt;yt1 AND C&lt;yt1*1.03;\r\nay2=C&gt;yt2 AND C&lt;yt2*1.03;\r\nay3=C&gt;yt3 AND C&lt;yt3*1.03;\r\nay4=C&gt;yt4 AND C&lt;yt4*1.03;\r\nay5=C&gt;yt5 AND C&lt;yt5*1.03;\r\nay6=C&gt;yt6 AND C&lt;yt6*1.03;\r\nay7=C&gt;yt7 AND C&lt;yt7*1.03;\r\nay8=C&gt;yt8 AND C&lt;yt8*1.03;\r\nay9=C&gt;yt9 AND C&lt;yt9*1.03;\r\nay10=C&gt;yt10 AND C&lt;yt10*1.03;\r\n//Resistance lines commentary\r\nsrc1=xt1c OR xt2c OR xt3c OR xt4c OR xt5c OR xt6c OR xt7c OR xt8c OR xt9c OR xt10c OR yt1c OR yt2c OR yt3c OR yt4c OR yt5c OR yt6c OR yt7c OR yt8c OR yt9c OR yt10c;\r\nsrc2=ax1 OR ax2 OR ax3 OR ax4 OR ax5 OR ax6 OR ax7 OR ax8 OR ax9 OR ax10 OR ay1 OR ay2 OR ay3 OR ay4 OR ay5 OR ay6 OR ay7 OR ay8 OR ay9 OR ay10;\r\nWriteIf(src1 OR src2,"------------------------------------------","");\r\nWriteIf(src1 OR src2,"Mo ta Ho tro / Khang cu: \\n","");\r\nWriteIf(xt1c AND V&gt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt1c AND V&lt;volAvg,"Khang cu tai: "+xt1+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt2c AND V&gt;volAvg,"Khang cu tai: "+xt2+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt2c AND V&lt;volAvg,"Khang cu tai:"+xt2+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt3c AND V&gt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt3c AND V&lt;volAvg,"Khang cu tai: "+xt3+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt4c AND V&gt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt4c AND V&lt;volAvg,"Khang cu tai: "+xt4+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt5c AND V&gt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt5c AND V&lt;volAvg,"Khang cu tai: "+xt5+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt6c AND V&gt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt6c AND V&lt;volAvg,"Khang cu tai: "+xt6+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt7c AND V&gt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt7c AND V&lt;volAvg,"Khang cu tai: "+xt7+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt8c AND V&gt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt8c AND V&lt;volAvg,"Khang cu tai: "+xt8+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt9c AND V&gt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt9c AND V&lt;volAvg,"Khang cu tai: "+xt9+"  Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(xt10c AND V&gt;volAvg,"Khang cu tai: "+xt10+" Vuot qua voi khoi luong cao.Tang gia.",\r\nWriteIf(xt10c AND V&lt;volAvg,"Khang cu tai: "+xt10+" Vuot qua, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Support line breaks Commentary\r\nWriteIf(yt1c AND V&gt;volAvg,"Ho tro tai: "+yt1+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt1c AND V&lt;volAvg,"Ho tro tai:"+yt1+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt2c AND V&gt;volAvg,"Ho tro tai: "+yt2+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt2c AND V&lt;volAvg,"Ho tro tai: "+yt2+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt3c AND V&gt;volAvg,"Ho tro tai: "+yt3+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt3c AND V&lt;volAvg,"Ho tro tai: "+yt3+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt4c AND V&gt;volAvg,"Ho tro tai: "+yt4+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt4c AND V&lt;volAvg,"Ho tro tai: "+yt4+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt5c AND V&gt;volAvg,"Ho tro tai: "+yt5+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt5c AND V&lt;volAvg,"Ho tro tai: "+yt5+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt6c AND V&gt;volAvg,"Ho tro tai: "+yt6+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt6c AND V&lt;volAvg,"Ho tro tai: "+yt6+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt7c AND V&gt;volAvg,"Ho tro tai: "+yt7+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt7c AND V&lt;volAvg,"Ho tro tai: "+yt7+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt8c AND V&gt;volAvg,"Ho tro tai: "+yt8+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt8c AND V&lt;volAvg,"Ho tro tai: "+yt8+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt9c AND V&gt;volAvg,"Ho tro tai: "+yt9+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt9c AND V&lt;volAvg,"Ho tro tai: "+yt9+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "))+\r\nWriteIf(yt10c AND V&gt;volAvg,"Ho tro tai: "+yt10+"  pha vo voi khoi luong cao. Giam gia.",\r\nWriteIf(yt10c AND V&lt;volAvg,"Ho tro tai: "+yt10+"  pha vo, nhung voi khoi luong thap hon. Hay can trong."," "));\r\n//Resistance approaching Commentary\r\nWriteIf(ax1 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt1+  ". ","")+\r\nWriteIf(ax2 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt2+  ". ","")+\r\nWriteIf(ax3 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt3+  ". ","")+\r\nWriteIf(ax4 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt4+  ". ","")+\r\nWriteIf(ax5 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt5+  ". ","")+\r\nWriteIf(ax6 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt6+  ". ","")+\r\nWriteIf(ax7 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt7+  ". ","")+\r\nWriteIf(ax8 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt8+  ". ","")+\r\nWriteIf(ax9 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt9+  ". ","")+\r\nWriteIf(ax10 AND tls&gt;0, "Gia dang tiep can muc khang cu tai "+xt10+ ". ","");\r\nWriteIf(ay1 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt1+  ". ","")+\r\nWriteIf(ay2 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt2+  ". ","")+\r\nWriteIf(ay3 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt3+  ". ","")+\r\nWriteIf(ay4 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt4+  ". ","")+\r\nWriteIf(ay5 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt5+  ". ","")+\r\nWriteIf(ay6 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt6+  ". ","")+\r\nWriteIf(ay7 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt7+  ". ","")+\r\nWriteIf(ay8 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt8+  ". ","")+\r\nWriteIf(ay9 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt9+  ". ","")+\r\nWriteIf(ay10 AND tls&lt;0, "Gia dang tiep can muc khang cu tai "+yt10+  ". ","");\r\n_SECTION_END();\r\n\r\n//END Ho tro Khang cu tuy chinh\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("7. Breakout Support - Breakout vuot vung khang cu");\r\n\r\nsophien = Param( "Time so phien tinh toan", 10, 0, 260, 1 );  // So phien tinh vung sideway\r\nchenhlech_loc = Param( "% Bien dong vung Sideway", 0.05, 0.01, 0.3, 0.01 ); //Bien dong gia trong vung sideway\r\ncaonhat = Ref( HHV( High, sophien ), -1 );\r\nthapnhat = Ref( LLV( Low, sophien ), -1 );\r\nchenhlech = ( caonhat - thapnhat ) / thapnhat &lt;= chenhlech_loc;\r\nbutpha = \r\n(chenhlech AND Volume &gt; 0.7*EMA( Volume, 20 ) AND Close &gt; caonhat AND volume &gt; 50000 \r\nAND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,20) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) \r\nAND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) \r\n) \r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20)      \r\n)\r\n OR \r\n (chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) \r\n AND C &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 AND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 \r\nAND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20)       \r\n)\r\n\r\nOR\r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) AND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50)      \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)    \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50)\r\n AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,21) &gt;= MA(C,50)   \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 AND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 \r\nAND C &gt;= EMA(C,10) AND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,10)  AND EMA(C,5) &gt;= EMA(C,21) AND EMA(C,5) &gt;= MA(C,50) AND EMA(C,5) &gt;= MA(C,150) AND EMA(C,5) &gt;= MA(C,200)\r\nAND EMA(C,10) &gt;= EMA(C,21) AND EMA(C,10) &gt;= MA(C,50) AND EMA(C,10) &gt;= MA(C,150) AND EMA(C,10) &gt;= MA(C,200)\r\nAND EMA(C,21) &gt;= MA(C,50) AND EMA(C,21) &gt;= MA(C,150) AND EMA(C,21) &gt;= MA(C,200)\r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= EMA(C,21) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,5) &gt;= MA(C,50) \r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(chenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 \r\nAND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) \r\nAND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= EMA(C,21)\r\nAND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260) \r\n)\r\nOR \r\n(\r\nchenhlech AND Volume &gt;= 0.7*EMA( Volume, 30 ) AND Close &gt; caonhat AND volume &gt; 50000 AND C &gt; Ref(C,-1) AND \r\nC &gt;= 5 AND C &gt;= 1.01*Ref(C,-1) AND C*V &gt;= 1000000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 3000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 3000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 AND C &gt;= EMA(C,10) \r\nAND C &gt;= EMA(C,21) AND C &gt;= MA(C,50) AND C &gt;= MA(C,150) AND C &gt;= MA(C,200) AND MA(C,50) &gt;= MA(C,150) AND MA(C,50) &gt;= MA(C,200) AND MA(C,150) &gt;= MA(C,200) \r\nAND MA(C,200) &gt; Ref(MA(C,200),-20) AND EMA(C,10) &gt;= MA(C,50)AND C &gt;= 1.3*LLV(C,260) AND C &gt;= 0.7*HHV(C,260)\r\n);\r\n\r\n//Plot Breakout vuot vung Khang cu  \r\n\r\nif (BreakoutSupport = ParamToggle( "* BreakoutSupport - Vuot vung khang cu",  "OFF|ON", 0 ))\r\n{\r\n\r\n//Plot vung sideway\r\nduongtren = ValueWhen( butpha, caonhat, 0 );\r\nduongduoi = ValueWhen( butpha, thapnhat, 0 );\r\nPlot( duongtren, "", colorRed, styleNoLine + styleDots );\r\nPlot( duongduoi, "", colorBlue, styleNoLine + styleDots );\r\nbutpha_moi[0] = 0;\r\nbutpha_moi[1] = 0;\r\n \r\nfor( i = 0; i &lt;= BarCount - 1; i++ )\r\n{\r\n    if( butpha[i] == 1 AND( butpha[i - 1] == 1 OR butpha[i - 2] == 1 OR butpha[i - 3] == 1 ) )\r\n    {\r\n        butpha_moi[i] = 0;\r\n    }\r\n    else\r\n        if( butpha[i] == 0 )\r\n        {\r\n            butpha_moi[i] = 0;\r\n        }\r\n        else\r\n        {\r\n            butpha_moi[i] = 1;\r\n        }\r\n \r\n    if( butpha_moi[i] == 1 )\r\n    {\r\n        PlotText( "Breakout", i, thapnhat[i], colorBlack, colorBrightGreen,Offset=-33 );\r\n    }\r\n}\r\n \r\nPlotShapes(IIf(butpha_moi, shapeUpArrow, shapeNone),colorBlue, 0,thapnhat, Offset=-12);\r\n \r\n//PlotShapes( butpha_moi*shapeUpArrow, colorBlue, 0, thapnhat );\r\n\r\n}\r\n\r\n/*\r\n//Chay bo loc \r\n\r\nFilter = butpha_moi;\r\nAddColumn( Close, "Dong Cua" );\r\nAddColumn( butpha_moi, "Breakout" );\r\nBuy = butpha_moi;\r\nSell = Cross( EMA( Close, 10 ), Close );\r\n*/\r\n_SECTION_END();\r\n\r\n//|============================================================================================|\r\n//|             END     7. Breakout vuot vung Khang cu                                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     8. Darvas Box    |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("8. Darvas Box");\r\n\r\nPeriods= Param("Darvas Periods",5,1,260); \r\n\r\nboxHigh = Ref(H,-3)&gt;=Ref(HHV(H,Periods),-4) AND \r\n                  Ref(H,-3)&gt;Ref(H,-2) AND Ref(H,-3)&gt;Ref(H,-1) AND Ref(H,-3)&gt;H;\r\n\r\nTopbox=ValueWhen(boxHigh, Ref(H,-3)); \r\nBotbox=ValueWhen(boxHigh,LLV(L,4)); \r\n \r\n \r\nif (darvas = ParamToggle( "* Hien thi Darvas Box",  "OFF|ON", 0 ))\r\n{\r\n\r\n/*=========================\r\n  - Allow color change\r\n  - Style change \r\n ==========================*/\r\nPlot(TopBox, "Top", ParamColor("Box Top Color",  colorRed),    ParamStyle("Box Top Style"));\r\nPlot(Botbox, "Bot", ParamColor("Box Bottom Color",colorBlue),  ParamStyle("Box Bottom Style"));\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Darvas Box \r\n\r\n\r\n//====================================================================================|\r\n//                       9. Auto Trendline                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("9. Auto Trendline - Tu dong ke duong Xu huong");\r\n\r\n \r\nif (ParamToggle("* Hien thi Auto Trenline", "OFF|ON" ,0 ))\r\n{\r\n\r\n\r\n// Parallel lines defined by the automatic support and the HighestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npS = TroughBars( s1, per, 1 ) == 0;\r\nendt= LastValue(ValueWhen( pS, x, 1 ));\r\nstartt=LastValue(ValueWhen( pS, x, 2 ));\r\ndtS =endt-startt;\r\nendS = LastValue(ValueWhen( pS, s1, 1 ) );\r\nstartS = LastValue( ValueWhen( pS, s1, 2 ));\r\naS = (endS-startS)/dtS;bS = endS;\r\ntrendlineS = aS * ( x -endt ) + bS;\r\nPlot(IIf(x&gt;startt-10,trendlineS,-1e10),"",colorBlue,1);\r\nH1=LastValue(Highest((Cum(1)&gt;startt AND Cum(1)&lt;endt)*H));\r\ntH1=LastValue(ValueWhen(H==H1,Cum(1)));\r\nColor=IIf((Cum(1)==startt OR Cum(1)==endt),colorBlue,IIf(Cum(1)==tH1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nUpperParallel=aS*(x-tH1)+H1;Plot(IIf(x&gt;startt-10,UpperParallel,-1e10),"UpperLine",colorOrange,1);\r\n\r\n// Parallel lines defined by the automatic resistance and the LowestBetween point\r\nx = Cum(1);per = 3;s1=L;s11=H;\r\npR = PeakBars( s11, per, 1 ) == 0;\r\nendt1= LastValue(ValueWhen( pR, x, 1 ));\r\nstartt1=LastValue(ValueWhen( pR, x, 2 ));\r\ndtR =endt1-startt1;\r\nendR = LastValue(ValueWhen( pR, s11, 1 ) );\r\nstartR = LastValue( ValueWhen( pR, s11, 2 ));\r\naR = (endR-startR)/dtR;\r\nbR = endR;\r\ntrendlineR = aR * ( x -endt1 ) + bR;\r\nPlot(IIf(x&gt;startt1-10,trendlineR,-1e10),"",colorBlue,1);\r\nL1=LastValue(Lowest(IIf(Cum(1)&gt;startt1 AND Cum(1)&lt;endt1,L,10^10)));\r\ntL1=LastValue(ValueWhen(L==L1,Cum(1)));\r\nColor=IIf((Cum(1)==startt1 OR Cum(1)==endt1),colorBlue,IIf(Cum(1)==tL1,colorOrange,colorBlack));\r\nPlot(C,"Close",Color,64);\r\nLowerParallel=aR*(x-tL1)+L1;Plot(IIf(x&gt;startt1-10,LowerParallel,-1e10),"LowerLine",colorOrange,1);\r\n\r\n\r\n\r\n}\r\n \r\n// END AUTO TRENDLINE\r\n\r\n\r\n//==========================================================================|\r\n//                   10. Dash Boar - Bang dieu khien                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("10. Dash Board - Do thi Ap luc Cung Cau");\r\n\r\n\r\nVlb  = Param("Khoang thoi gian xem lai Volume",60,20,300,10);\r\nxf=Param("Toa do X",-30,-150,1300,1);  //Ngang\r\nyf=Param("Toa do Y", 160,-130,550,1); //Doc\r\n\r\n\r\nif (ParamToggle( "* Hien thi Dash Board - Do thi Ap luc Cung Cau", "OFF|ON", 0 ))\r\n{\r\n\r\nsp \t\t= H-C;  //Bien dong tren close\r\nbp \t\t= C-L;  //Bien dong duoi Close\r\nbpavg \t= WMA(bp,10); //Trung binh 10 ngay cua bien dong duoi close\r\nspavg \t= WMA(sp,10); //Trung binh 10 ngay cua bien dong tren close\r\nnbp \t= bp/bpavg;  //ty le cua bien dong duoi so voi trung binh\r\nnsp \t= sp/spavg;  //ty le cua bien dong tren so voi trung binh\r\ndiff \t= nbp-nsp;  //Hieu so giua 2 ty le\r\nVarg = WMA(V,10);  //Trung binh Volume 10 ngay\r\nnv = V/Varg;        //ty le volume so voi trung binh\r\nnbfraw = nbp * nv;   //ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh\r\nnsfraw = nsp * nv;   //ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh\r\nnbf = WMA(nbp * nv,20); // binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh)\r\nnsf = WMA(nsp * nv,20);  //binh quan 20 ngay cua (ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh)\r\nbfmax = HHV(nbfraw,Vlb);  //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nbfmin = LLV(nbfraw,Vlb);  //muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong duoi so voi trung binh trong ky xem (60)\r\nnfmax = HHV(nsfraw,Vlb); //muc cao nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh            \r\nnfmin = LLV(nsfraw,Vlb);//muc thap nhat cua ty le volume so voi trung binh * ty le cua bien dong tren so voi trung binh     \r\nbfnor = ((nbfraw - bfMin)*100/((bfmax-bfmin)+ 1e-9)); //Luc Cau (Mua)\r\nnfnor = (nsfraw - nfmin)*100/((nfmax-nfmin)+ 1e-9);  //Luc Cung (Ban)\r\nx=Status("pxchartleft")+xf;\r\ny=Status("pxcharttop")+yf;\r\nGfxSetBkMode( colorWhite ); \r\n\r\n//================= Buying Pressure Bar graph ================\r\n//Ap luc Cau (Mua)\r\n//============================================================\r\n\r\nx1 = SelectedValue(bfnor);\r\ny1 = y + (100-x1);\r\nz = SelectedValue(bfnor);\r\nGfxSelectSolidBrush( colorLime ); //Phan thay doi mau\r\nGfxSelectPen( colorPaleTurquoise );  //Vien ngoai\r\nGfxRectangle( x+55,y+100, x+65,y);\r\nGfxGradientRect(x+55,y1,x+65,y+100,colorGreen,colorDarkGreen);\r\n//Mau chu Buy\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Buy", x+55,y+105 );\r\n\r\n//================= Selling Pressure Bar graph ================\r\n//Ap luc Cung (Ban)\r\n//=============================================================\r\n\r\nx2 = SelectedValue(nfnor);\r\ny2 = y + (100-x2);\r\nz1 = SelectedValue(nfnor);\r\n//--------------bargraph---------------------------------------\r\n//Thanh bieu do\r\nGfxSelectSolidBrush( colorOrange ); \r\nGfxSelectPen( colorRose );\r\nGfxRectangle( x+75,y+100, x+85,y);\r\nGfxGradientRect(x+75,y2,x+85,y+100,colorBrown,colorDarkRed);\r\n//Mau chu Sell\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Sell", x+75,y+105 );\r\n\r\n//========================Effort &amp; Result===============================\r\n//======================================================================\r\n//No luc ket qua\r\n//=================\r\nVrg1  = WMA(V,40);// average volume\r\nrg   = (H-L); //Spread\r\narg1  = Wilders(rg,40);//Average Spread\r\nrs   = abs(C-Ref(C,-1));//Result - Ket qua -  Gia so voi hom truoc \r\nrsg  = Wilders(rs,40);//Average Result - Trung binh ket qua\r\nsro  = rg/arg1;//ratio of spread to average - Ty le Spread trung binh\r\nVro  = V/Vrg1;//ratio of volume to average  - Ty le Volume trung binh\r\nrso  = rs/rsg; //ratio of result to average - Ty le ket qua so voi trung binh\r\nsmax = HHV(sro,40); //High cua Ty le Spread trung binh\r\nsmin = LLV(sro,40); //Low cua Ty le Spread trung binh\r\nVmax = HHV(Vro,40); //High cua Ty le Volume trung binh\r\nVmin = LLV(Vro,40); //Low cua Ty le Volume trung binh\r\nrmax = HHV(rso,40); //High cua Ty le ket qua so voi trung binh\r\nRMIn = LLV(rso,40); //Low cua Ty le ket qua so voi trung binh\r\nsnor = (smax-sro )*100/(smax-Smin + 1e-9); //Tinh ty le cua Spread\r\nVnor = (Vmax-Vro )*100/(Vmax-Vmin + 1e-9); //Danh gia gia tri cua Volume hien tai\r\nrnor = (rmax-rso )*100/(rmax-RMIn + 1e-9);  //Danh gia gia tri cua Ket qua \r\n\r\n\r\n//=======================================================\r\n//================DashBoard=============================\r\n//=======================================================\r\n\r\n//========Spread===========\r\nx3 = SelectedValue(snor);\r\ny3 = y+(230-x3);\r\nGfxSelectSolidBrush(colorTurquoise); \r\nGfxSelectPen(colorAqua);\r\nGfxRectangle(x+55,y+230,x+65,y+130);\r\nGfxGradientRect(x+55,y+130+x3,x+65,y+230,colorBlue,colorDarkBlue);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor(colorYellow ); \r\nGfxTextOut("Sp", x+55,y+235 );\r\n\r\n//------------------------------------------------\r\n//========Result===========\r\nx4 = SelectedValue(rnor);\r\ny4 = y + (230-x4);\r\nGfxSelectSolidBrush(colorLightOrange); \r\nGfxSelectPen(colorRose);\r\nGfxRectangle(x+75,y+230,x+85,y+130);\r\nGfxGradientRect(x+75,y+130+x4,x+85,y+230,colorDarkYellow,colorDarkRed) ;\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorYellow ); \r\nGfxTextOut("Re", x+75,y+235 );\r\n\r\n//--------------------------------------------------\r\n//========Effort===========\r\nx5 = SelectedValue(vnor);\r\ny5 = y + (230-x5);\r\nGfxSelectSolidBrush(colorLightBlue ); \r\nGfxSelectPen(colorLightYellow );\r\nGfxRectangle( x+95,y+230, x+105,y+130);\r\nGfxGradientRect(x+95,y+130+x5,x+105,y+230, colorViolet,colorIndigo);\r\nGfxSelectFont("Times New Roman", 8, xf );\r\nGfxSetTextColor( colorGold); \r\nGfxTextOut("Ef", x+95,y+235 );\r\n\r\n//----------------------------------\r\n//========Strenght RSI===========\r\nRPeriod = 14;\r\nLb = Param("LookBack Period",60,40,120,1); // Vung theo doi tin hieu\r\nmySig1 = RSI(14);  //Tin hieu RSI\r\nAdev = StDev(mySig1, 3*RPeriod); //Suc manh RSI\r\njh = HHV(mySig1,Lb); //High cua muc RSI trong ky\r\njl = LLV(mySig1,Lb); //Low cua muc RSI trong ky\r\njc = (WMA((jh-jl),RPeriod)*0.60)+WMA(jl,RPeriod); //trung binh cua muc RSI trong ky\r\nHiline = jh-jc*0.2; //Vung gia tri tren\r\nLoline = jl+jc*0.2; //Vung gia tri duoi\r\nmidline = (jh-jl)/2; //Vung gia tri giua\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\nPA=SelectedValue(Rx);\r\nGfxSelectSolidBrush( colorBlack ); \r\nGfxSelectPen( colorWhite );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\nGfxCircle(  x+135,y+200,15);\r\nGfxSelectFont("Times New Roman", 8, 800 );\r\nGfxSetTextColor( colorLime ); \r\nGfxTextOut("Strength", x+120,y+235 ); \r\n\r\nfor(i = 10; i &lt; BarCount; i++)\r\n\r\n\r\nif (PA[i]==1)\r\n{\r\nGfxSelectSolidBrush( colorLime ); \r\nGfxSelectPen( colorLime );\r\nGfxCircle(  x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse if (PA[i] == 0)\r\n{\r\nGfxSelectSolidBrush( colorRed ); \r\nGfxSelectPen( colorRed );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\telse \r\n{\r\nGfxSelectSolidBrush( colorYellow ); \r\nGfxSelectPen( colorYellow );\r\nGfxCircle( x+135,y+200,12);//GfxCircle( fvb+480,fvb-475,  10);\r\n}\r\n\r\n \r\n\r\n\r\n}\r\n \r\n\r\n//-------------------------------------------------------------------\r\n\r\n_SECTION_END();\r\n\r\n//END Dash Board\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      11. Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\n\r\n_SECTION_BEGIN("11. Ichimoku Kinko Hyo");\r\n\r\n\r\n\r\n//*********************************************\r\n//Cac thong so Ichimoku co ban \r\n// Cac con so quan trong trong Ichimoku: 9 / 17 / 26 / 33 / 42 / 65 / 76 / 129 / 172 / 200 / 257\r\n// Bo so Ichimoku kieu so 1 (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n// Bo so Ichimoku kieu so 1 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n//*********************************************\r\n \r\n\r\n\r\n//****Chon hieu Ichimoku so 1 hoac so 2\r\n/*\r\n \r\n//Chon bo so Ichimoku kieu so 1\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n \r\n //Chonj bo so Ichimoku kieu so2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n */\r\n\r\n\r\nSelectedIchimoku = ParamList( "* Chon kieu Ichimoku", "Ichimoku truyen thong 9-26-26-52-DG129|Ichimoku kieu VN 9-17-26-33-DG65", 1 );\r\n\r\nswitch ( SelectedIchimoku )\r\n{\r\n\r\n//*************Truong hop chon Kieu Ichimoku truyen thong so 1\r\n\r\ncase "Ichimoku truyen thong 9-26-26-52-DG129":\r\n\r\n cprds1=9;\r\n cturn1=26;\r\n cdelay1=26;\r\n cspan1=52;\r\n cDG1=129;\r\n ctimeKumo1=26;\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds1, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn1, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay1, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan1, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG1, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", ctimeKumo1, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n//*************Truong hop chon Kieu Ichimoku kieu moi so2\r\n\r\n\r\n\r\ncase "Ichimoku kieu VN 9-17-26-33-DG65":\r\n\r\n //Chon bo so Ichimoku kieu so 2\r\n cprds2=9;\r\n cturn2=17;\r\n cdelay2=26;\r\n cspan2=33;\r\n cDG2=65;\r\n ctimeKumo2=26;\r\n\r\n\r\n\r\n//Tuy chon so phien Duong Taken Sen (Kieu truyen thong la 9 phien) - Giong duong trung binh ngan han 9 phien\r\nprds = Param( "- Tenkan Sen - Turning Line Periods", cprds2, 5, 65, 1 );  \r\n\r\n//Tuy chon so phien Duong Kijun Sen (Kieu truyen thong la 26 phien) - Giong duong trung binh trung han 26 phien \r\n// Co the thay doi sang kieu Ichimoku so 2 (17 phien)\r\n\r\nturn = Param( "- Kijun Sen - Standard Line Periods", cturn2, 10, 129, 1 ); // Tuy chon theo yeu cau\r\n\r\n\r\n//Duong tre Chikou Span - Duong Gia hien tai duoc lui ve 26 phien qua khu (Kieu truyen thong la 26 phien)\r\n//Chikou Span giong vung Ho tro, Khang cu cua 26 phien qua khu (vung Ho tro khang cu ngan han cua hon 1 thang)\r\n//Dung de xac nhan cho xu huong gia co vuot khang cu hoac ho tro khong\r\ndelay = Param( "- Chikou Span - Delayed Line Periods", cdelay2, 10, 129, 1 ); \r\n\r\n//Tuy chon so phien Duong Span B (Kieu truyen thong la 52 phien) \r\n// Co the thay doi sang kieu Ichimoku so 2 (26 phien)\r\nspan = Param( "- Senkou Span B - Spans Periods", cspan2, 10, 129, 1 ); \r\n\r\n\r\n//Tuy chon Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n//Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\nDG = Param("- Dao Gam - Duong ho tro dai han",cDG2, 20, 260, 1 ); \r\n\r\n// Time cua 26 phien (Kieu truyen thong la 26) (Dung cho ve duong may Kumo (Gom 2 duong Span A va SpanB) duoc day ve phia truoc de du doan tuong lai)\r\ntimeKumo=Param( "* Time - So ngay ve May Kumo tuong lai", cdelay2, 10, 130, 1 );  \r\n\r\n\r\n\r\n\r\nbreak;\r\n\r\n\r\n}\r\n \r\n \r\n \r\n\r\n\r\n\r\n \r\n\r\n//*********************************************\r\n//Cac duong Ichimoku co ban\r\n//*********************************************\r\n//I. Dai may Sen duoc hinh thanh boi 2 duong Taken Sen va Kijun Sen (Dung de danh gia xu huong Gia hien tai)\r\n\r\n    //1. Tenkan-Sen = Conversion Line = Turning Line = TS = TK - Giong duong trung binh ngan han \r\n        //Duong Taken Sen (Kieu truyen thong la 9 phien)\r\n        //Taken Sen la muc binh quan giua gia cao nhat va thap nhat cua so 9 phien qua khu duoc chon\r\n        //Taken Sen la vung ho tro, khang cu cua Gia qua khu ngan han \r\n        //Taken Sen do luong xu huong ngan han\r\n        //Taken Sen do luong bien dong gia ngan han\r\n\r\nTL = ( HHV( H, prds ) + LLV( L, prds ) )/2;\r\n\r\n    //2 Kijun-Sen = Base Line =  Standard Line = SL = TL = = KJ - Giong duong trung binh trung han 26 phien \r\n        //Duong Kijun Sen (Kieu truyen thong la 26 phien)\r\n        // Co the thay doi sang kieu Ichimoku so 2 (17 phien) phu hop danh ngan han o Viet Nam \r\n        //Kijun Sen la muc binh quan giua gia cao nhat va thap nhat cua so phien qua khu duoc chon\r\n        //Kijun Sen la vung ho tro, khang cu cua Gia qua khu trung han \r\n        //Kijun Sen do luong xu huong trung han\r\n        //Kijun Sen do luong bien dong gia trung han\r\n\r\nSL = ( HHV( H, turn ) + LLV( L, turn) )/2;\r\n\r\n    //3. Dao gam - Duong ho tro dai han - Giong duong trung binh dai han \r\n        // Bo so Ichimoku kieu so 1 (Kieu truyen thong) (cac thong so goc theo truyen thong): Taken Sen 9 / Kijun Sen 26 / Chikou Span 26 / Span B 52 + Chon Dao gam 129\r\n        // Bo so Ichimoku kieu so 2 (phu hop cho thi truong ngan han o Viet Nam): Taken Sen 9 / Kijun Sen 17 / Chikou Span 26 / Span B 26 + Chon Dao gam 65\r\n        //Thay doi giua 65 va 129 - so 65 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        // Dao gam la muc gia trung binh cua muc cao nhat va thap nhat cua So phien qua khu duoc chon\r\n        // Dao gam la vung ho tro, khang cu cua Gia qua khu dai han\r\n        // Dao gam do luong xu huong trung han\r\n        // Dao gam do luong bien dong gia trung han\r\n\r\nDG = ( HHV( H, DG ) + LLV( L, DG) )/2;\r\n\r\n\r\n//II. Chikou Span = Lagging Span \r\n        //Duong tre Chikou Span - Duong Gia hien tai duoc lui ve so phien qua khu (Kieu truyen thong la 26 phien)\r\n        //Chikou Span la vung ho tro, khang cu cua Gia qua khu 26 phien gan day (Hon 1 thang)\r\n        //Dung de xac nhan cho xu huong qua khu\r\n        //Hoac dung de danh gia cho xu huong hien tai\r\n        //Neu Chikou cat len duong Gia - Xac nhan cho xu huong hien tai tang\r\n        //Neu Chikou cat xuong duong Gia - Xac nhan cho xu huong hien tai giam\r\n\r\nLagging = Ref( C, -delay );\r\n\r\n//III. Dai may Kumo duoc hinh thanh boi 2 duong Span A va Span B (Dung de du doan xu huong tuong lai)\r\n\r\n        //May Kumo duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) the hien vung Ho tro va khang cu tiem nang trong tuong lai\r\n        //Cho cai nhin ve buc tranh toan canh cua xu huong thi truong trong tuong lai\r\n        //Giup danh gia moi quan he cua Gia trong xu huong hien tai dc so sanh voi du doan tuong tai co phu hop ko?\r\n        //May Kumo cung cap vung Ho tro va khang cu dang tin cay nhat so voi cac vung ho tro khang cu khac\r\n        //Neu Gia nam tren May Kumo (Gia hien tai cao hon muc trung binh cua qua khu) - Xu huong tang hien tai duoc xac nhan\r\n        //Neu Gia nam duoi May Kumo (Gia hien tai thap hon muc trung binh cua qua khu) - Xu huong giam hien tai duoc xac nhan\r\n        //Neu Gia nam trong May Kumo  - Khong co Xu huong ro rang. Thi truong di ngang SideWay (khong giao dich trong TH nay)\r\n\r\n    //1. Senkou Span A = Leading Span A = (Tenkan-Sen + Kijun-Sen)/2\r\n        //Duong Span A la binh quan gia cua duong Taken Sen va Kijun Sen. \r\n        //Span A duoc ve tien ve phia truoc (Kieu truyen thong la 26 phien) \r\n        //Day la Vung ho tro va khang cu tiem nang ngan han cua tuong lai (- Vung ho tro cua 1 thang gan day nhin huong toi 26 phien phia truoc) \r\nSpan1 = (( SL + TL )/2);\r\n\r\n    //2. Senkou Span B = Leading Span B = (Highest High + Lowest Low)/2\r\n        //Duong Span B la binh quan cua muc gia cao nhat va thap nhat cua so phien duoc chon trong qua khu (Kieu truyen thong la 52 phien) \r\n        //Span B co the Thay doi thanh 26 phu hop danh ngan han o Viet Nam (Kieu Ichimoku so 2)\r\n        //Span B uoc ve tien ve phia truoc theo so phien da chon (Kieu truyen thong la 26 phien)  \r\n        //Day la Vung ho tro va khang cu tiem nang trung han cua tuong lai (- Vung ho tro cua 2 thang gan day nhin huong toi 26 phien phia truoc) \r\n\r\nSpan2 = (HHV( H, span) + LLV(L, span))/2;\r\n\r\n    //Du doan tuong lai qua su giao cat giua 2 duong Span A va Span B\r\n        //Neu Span A nam tren Span B hoac Span A cat len tren Span B: du doan cho xu huong tang tuong lai\r\n        //Neu Span A nam duoi Span B hoac Span A cat xuong duoi Span B: du doan cho xu huong giam tuong lai\r\n        //Neu Span A giao cat voi Span B: du doan xu huong co the thay doi\r\n        \r\n    //Du doan tuong lai qua Phan tich do Day Mong cua may Kumo\r\n        //Neu may Kumo Day: Bien dong gia lon, dong thoi cho muc Ho tro va khang cu vung chac hon may Kumo mong\r\n        //Neu may Kumo Mong: Bien dong gia thap, thi truong it bien dong, dong thoi cho muc Ho tro va khang cu kem hon may Day\r\n        \r\n    //Hien tuong May Kumo phang (nam ngang): \r\n        //Co the phang o phia tren hoac phia duoi Do viec tinh toan la muc cao nhat va thap nhat trong 52 Phien (tuong ung voi muc Fibonacci 50%) \r\n        //Viec Kumo Flat the hien Muc ho tro va Khang cu dang duoc duy tri trong so ky duoc chon\r\n        //The hien suc manh cua vung Ho tro va khang cu. Gia co xu huong hut ve phia vung nay de tim trang thai can bang moi\r\n        //Trong xu huong tang, Senkou Span B flat tao ra flat bottom Kumo phia duoi.\r\n        //Trong xu huong giam, Senkou Span B flat tao ra flat top Kumo phia tren.\r\n        //Vung Flat nay giup du doan tuong lai rang xu the gia sap toi co khung huong tien ve gap duong Flat\r\n\r\n\r\n\r\n\r\n//************************************************\r\n// Cac quy tac cua tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n//************Cac tin hieu Mua ban co ban*********\r\n\r\n//1. Chien luoc giao cat giua Tenkan Sen ngan han va Kijun Sen trung han (Danh gia xu huong hien tai)\r\n\r\n     //TenkanSen cat len Kijun Sen: Xu huong tang hien tai duoc xac nhan\r\n     //TenkanSen cat xuong Kijun Sen: Xu huong giam hien tai duoc xac nhan\r\n     \r\n  //Luu y: tin hieu giao cat nay can co su xac nhan tu cac thanh phan khac cua he thong Ichimoku\r\n  \r\n  //Cuong do tin hieu giao cat nay duoc do luong khi so sanh vi tri cua no voi may Kumo\r\n\r\n     //Tin hieu Manh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia tren may Kumo\r\n     //Tin hieu Manh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia duoi may Kumo\r\n\r\n     //Tin hieu Trung binh: Buy khi TenkanSen cat len Kijun Sen va vi tri nam ben trong may Kumo\r\n     //Tin hieu Trung binh: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam ben trong may Kumo\r\n\r\n     //Tin hieu Yeu: Buy khi TenkanSen cat len Kijun Sen va vi tri nam o phia duoi may Kumo\r\n     //Tin hieu Yeu: Sell khi TenkanSen cat xuong Kijun Sen va vi tri nam o phia tren may Kumo\r\n\r\n  //Cac tin hieu giao cat tren can co su Xac nhan them cua duong Chikou Span\r\n\r\n     //Neu su giao cat la tang gia xay ra, dong thoi duong Chikou Span nam tren duong gia thi tin hieu tang cang Manh\r\n     //Neu su giao cat la giam gia xay ra, dong thoi duong Chikou Span nam duoi duong gia thi tin hieu giam cang Manh\r\n     //Neu  su giao cat do nam doi dien nguoc voi duong Chikou Span qua duong Gia thi tin hieu giao cat (Tang hoac giam) la Yeu\r\n\r\n  //Vao lenh Mua Ban tai vi tri giao cat Tenkan Sen va Kijun Sen (can xem xet them muc ho tro va khang cu gan nhat). \r\n  //Vao lenh Mua khi gia nam tren moc ho tro va lenh Short khi gia nam duoi moc khang cu\r\n  //Chot loi, Cutloss, dong giao dich khi Tenkan Sen cat Kijun Sen theo huong nguoc lai hoac cac quy tac quan ly von khac\r\n\r\n\r\n\r\n//2. Chien luoc giao cat giua Span A va Span B (Du doan xu huong tuong lai)\r\n\r\n     // Span A cat len Span B: Du doan Xu huong tuong lai tang \r\n     // Span A cat xuong Span B: Du doan Xu huong tuong lai giam \r\n     \r\n  //Luu y: Su giao cat nay can co su xac nhan cua cac thanh phan khac cua he thong Ichimoku\r\n\r\n  //Cuong do tin hieu giao cat Span A va B duoc phan thanh\r\n\r\n     //Tin hieu Manh: Khi gia nam ben ngoai may Kumo va gia nam cung huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n     //Tin hieu Trung binh: Khi gia nam trong  may Kumo tai thoi diem giao cat xay ra\r\n     //Tin hieu Yeu: Khi gia nam ben ngoai may Kumo va gia nguoc huong voi phia giao cat (so sanh vi tri voi voi Kumo)\r\n\r\n//3. Chien luoc giao cat giua Gia va duong Chikou Span\r\n\r\n     //Chikou Span duoc dung de danh gia cho xu huong qua khu, no co the duoc su dung doc lap rieng biet hoac ket hop voi cac thanh phan khac cua Ichimoku\r\n     //Neu Chikou Span cat len tren duong Gia: Xu huong tang hien tai duoc xac nhan (Vuot khang cu)\r\n     //Neu Chikou Span cat xuong duoi duong Gia: Xu huong giam hien tai duoc xac nhan (Pha ho tro)\r\n\r\n  //Cuong do cua tin hieu giao cat duong Chikou Span voi duong Gia duoc chia thanh 3 cap do\r\n\r\n     //*Tin hieu Manh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam tren may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam duoi may Kumo\r\n\r\n     //*Tin hieu Trung binh\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam trong may Kumo\r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam trong may Kumo\r\n\r\n     //*Tin hieu Yeu\r\n     //Buy: Chikou Span cat len tren duong Gia va Gia hien tai nam duoi may Kumo \r\n     //Sell: Chikou Span cat xuong duoi duong Gia va Gia hien tai nam tren may Kumo\r\n\r\n//*Thoi diem mo lenh giao dich ngay tai vi tri giao cat Chikou Span va duong Gia\r\n//*Ket thuc giao dich, chot loi, cat lo theo cac quy tac khac ngoai he thong Ichimoku hoac khi Chikou Span cat duong Gia o huong nguoc lai\r\n\r\n\r\n\r\n//************************************************\r\n//   Tin Hieu Mua Ban theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//I. So sanh Gia voi May Kumo, May Sen va duong Chikou Span\r\n\r\n   //1. So sanh Gia va May Kumo (2 duong Span A va Span B)\r\n   //Dung de danh gia ve Xu huong trung han hien tai\r\n\r\n\r\n      //A. Gia vuot tren may Kumo - Gia vuot ca 2 duong Span A va Span B \r\n      //Xu huong tang trung han duoc xac nhan\r\naboveKumo=IIf((C&gt;=Ref(Span1,-timeKumo) AND C&gt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //B. Gia Nam trong vung may Kumo - nam giua Span A va Span B\r\n      //Xu huong trung han khong ro rang\r\nwithinKumo=IIf((C&gt;=Ref(Span2,-timeKumo) AND C&lt;=Ref(Span1,-timeKumo)),1,0) OR IIf((C&gt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n      //C. Gia cat xuong may Kumo - Gia cat xuong ca 2 duong Span A va Span B\r\n      //Xu huong giam trung han duoc xac nhan\r\nbelowKumo=IIf((C&lt;=Ref(Span1,-timeKumo) AND C&lt;=Ref(Span2,-timeKumo)),1,0);\r\n\r\n\r\n   //2. So sanh Gia va May Sen (2 duong trung binh Taken Sen va Kijun Sen) \r\n   //Dung de danh gia ve Xu huong ngan han hien tai \r\n\r\n\r\n      //A. Gia vuot tren may Sen - Gia vuot ca 2 duong Taken Sen va Kijun Sen\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\naboveSenCloud = IIf ( (C &gt; Ref(TL,-prds) AND  C &gt; Ref(SL,-turn)),1,0); \r\n\r\n      //B. Gia Nam trong vung may Sen - nam giua duong Taken Sen va Kijun Sen\r\n      //Xu huong ngan han hien tai khong ro rang\r\nwithinSenCloud = IIf ((C &gt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0) OR IIf((C&gt;=Ref(SL,-turn) AND C&lt;=Ref(TL,-prds)),1,0); \r\n\r\n      //C. Gia cat xuong may Sen - Gia cat xuong ca 2 duong Taken Sen va Kijun Sen\r\n      // Xu huong giam ngan han hien tai duoc xac nhan\r\nbelowSenCloud = IIf ((C &lt;=Ref(TL,-prds) AND C&lt;=Ref(SL,-turn)),1,0)  ; \r\n\r\n//***************************Chon timeKumo (co the thay doi) hay chon t2=26 (co dinh)****************\r\n\r\n\r\n\r\n   //3. So sanh gia voi duong tre Chikou Span\r\n   //Price26 above Lagging, lag26 above C, Lag26 is rising \r\n   //Duong Chikou Span nam tren duong Gia cua 26 phien truoc, Duong Chikou Span dang tang len - Xu huong hien tai dang tang\r\n\r\n      //dlUp - Xu huong hien tai Tang gia: \r\n      //Gia tang so voi hom qua va duong Chikou Span cat len duong Gia\r\n      //Vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han hien tai duoc xac nhan\r\ndlUp =   (Ref(C,-(delay+1)) &gt; C ) AND  Ref(C,-delay) &lt; C AND C &gt; Ref(C,-1); \r\n\r\n      //dlDown - Xu huong hien tai Giam gia: \r\n      //Gia giam so voi hom qua va duong Chikou Span cat xuong duong Gia\r\n      //Pha vung ho tro ngan han (1 thang)\r\n      //Xu huong giam ngan han hien tai duoc xac nhan\r\n      \r\ndlDown = (Ref(C,-(delay+1)) &lt; C ) AND  Ref(C,-delay) &gt; C AND C &lt; Ref(C,-1); \r\n\r\n\r\n\r\n//II. So sanh Gia voi cac duong trung binh Taken Sen, Kijun Sen va ca voi May Kumo va May Sen\r\n//Phoi hop danh gia cac thanh phan cua he thong Ichimoku voi nhau\r\n\r\n//1. Tenkan Sen / Kijun Sen Cross - Giao cat giua duong trung binh ngan han Taken Sen va trung han Kijun Sen\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n        //Tin hieu xu huong tang ngan han hien tai khi duong ngan han Tenkan Sen cat len duong trung han Kujun Sen\r\n\r\n        //Tin hieu Mua so 2 (Tinhieu2)\r\n        //Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n        //Tinhieu2 Manh hon Tinhieu1\r\n\r\nBuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Mua so 3 (Tinhieu3)\r\n        //Kijun Sen Cross \r\n        //Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n        //Tinhieu3 manh hon Tinhieu2\r\n\r\nBuyStrongPriceCross = (Cross(C,SL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) \r\n                   OR (Cross(C,TL)  AND (C &gt; TL)  and C &gt; SL AND (TL &gt; SL) AND aboveKumo  AND C &gt; Ref(C,-1)) ; //OK \r\n\r\n             //************** Tin hieu Ban ******************\r\n\r\n        //Tin hieu Ban - Xuat hien khi Gia cat xuong duong Kijun Sen\r\n        // A bearish signal occurs when the PRICE crosses from above to below the Kijun Sen\r\n\r\n        //Tin hieu ban ngan han Yeu \r\n        //Tin hieu ban ngan han Yeu xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia van nam tren may Kumo\r\nSellWeakPriceCross = Cross(SL,C) AND aboveKumo;\r\n\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang)\r\n        //Tin hieu ban ngan han Trung lap (Ko ro rang) xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam trong may Kumo\r\nSellNeutralPriceCross = Cross(SL,C) AND withinKumo;\r\n\r\n        //Tin hieu ban ngan han Manh\r\n        //Tin hieu ban ngan han Manh xuat hien khi Gia cat xuong duong trung han Kijun Sen va gia nam duoi may Kumo\r\nSellStrongPriceCross = Cross(SL,C) AND belowKumo;\r\n\r\n             //*************** Tin hieu pha vo may Kumo - Kumo Breakout ***************\r\n\t\t\t\r\n        //The Kumo Breakout signal occurs when the price leaves or crosses the Kumo (Cloud).\r\n\r\n        //Tin hieu Mua so 1 (Tinhieu1)\r\n        // Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen va vuot ngan han Tenkan Sen\r\n\r\nBuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND  C&gt; TL  AND C &gt; Ref(C,-1); //OK\r\n\r\n        //Tin hieu Ban khi pha vo may Kumo\r\n        //Ban khi Gia tu trong may cat xuong may Kumo hoac tu tren may cat xuong may Kumo\r\nSellKumoBreakout = belowKumo AND Ref(withinKumo,-1)   OR (belowKumo AND Ref(aboveKumo ,-1));\r\n\r\n        //Tin hieu mua khi Gia vuot may Sen\r\n        //Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen\r\nBuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)))  AND C &gt; Ref(C,-1); //OK\r\n\r\n\r\n//2. Tin hieu giao cat cua 2 duong may Span A va B (Dung de du doan tuong lai)\r\n     //Bao hieu dau hieu thay doi xu huong tiem nang co the xay ra trong tuong lai\r\n     //Tin hieu dau tien duoc nhin thay khi duong Span A cat duong Span B o phia truoc\r\n     //Do cac duong Span A va B duoc ve ve phia truoc 26 ngay nen khi tin hieu giao cat xuat hien o phia truoc 26 ngay\r\n     //Thi ngay xuat hien tin hieu giao cat thuc su hien tai\r\n     //Do Manh cua tin hieu duoc xac dinh boi moi quan he cua Gia voi may Kumo trong ngay xay ra tin hieu giao cat do (khong phai yeu to kich hoat lenh Mua Ban)\r\n     //Xu huong tang xuat hien khi Senkou Span A cat tu duoi len Senkou Span B\r\n\r\n             //************** Tin hieu Mua ******************\r\n\r\n\r\n     //Tin hieu mua so 4 (Tinhieu4)\r\n     //Gia nam tren May Kumo va Span A cat len Span B \r\n     //Tin hieu mua gia tang trong xu huong tang Trung han\r\n\r\nBuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2)  AND C &gt; Ref(C,-1); //OK\r\n\r\n//3. Tin hieu giao cat voi duong tre Chikou Span\r\n     //Xay ra khi duong tre giao cat voi duong Gia (Tang len hoac giam xuong duong Gia)\r\n     //Xu huong tang khi Chikou Span tang len va cat len duong Gia\r\n     //Xu huong giam khi Chikou Span giam xuong va cat xuong duong Gia\r\n     //Luu y: Su giao cat giua duong Chikou Span va duong Gia khi dung 1 minh ko du manh cho cac tin hieu Mua - Ban (phai ket hop voi cac dieu kien khac)\r\n     //Vi Chikou Span la gia dong cua hien tai duoc lui ve qua khu 26 ngay.\r\n     //Do do trong ngay xuat hien tin hieu giao cat, do Manh cua tin hieu phai duoc xac nhan boi moi quan he giua Gia va may Kumo\r\n     //Do do mot minh yeu to giao cat giua duong Chikou Span va duong Gia khong phai yeu to kich hoat lenh Mua Ban\r\n     //Xu huong tang hien tai duoc xac nhan khi Chikou Span cat tu duoi len tren duong Gia\r\n\r\n\r\n     //Tin hieu mua so 5 (Tinhieu5)\r\n     //Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n     \r\n     //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n      //Gia tang vuot vung khang cu ngan han (1 thang)\r\n      //Xu huong tang ngan han duoc xac nhan\r\n    \r\n\r\nBuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Mua (Long) theo Ichimoku\r\n//************************************************\r\n\r\n\r\n//1. Tin hieu Mua so 1 (Tinhieu1)\r\n\r\n//Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//Xu huong tang trung han duoc xac nhan\r\n\r\nTinHieu1 = BuyKumoBreakout AND TL&gt; SL ;\r\n\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL AND C &gt; Ref(C,-1);\r\n\r\n//2. Tin hieu Mua so 2 (Tinhieu2)\r\n\r\n//Duong ngan han Tenkan Sen cat len duong trung han Kijun Sen, Gia vuot may Kumo va Gia cat len duong ngan han Taken Sen \r\n//Tinhieu2 Manh hon Tinhieu1\r\n\r\nTinHieu2 = BuyStrongTKCross ;\r\n\r\n//BuyStrongTKCross = Cross(TL,SL) AND aboveKumo AND C &gt; TL AND C &gt; Ref(C,-1);\r\n\r\n//3. Tin hieu Mua so 3 (Tinhieu3)\r\n\r\n//Gia cat len duong trung han Kijun Sen va Gia vuot tren duong ngan han Taken Sen va duong ngan han Taken Sen cat len duong trung han Kijun Sen va gia vuot tren may Kumo\r\n//Tinhieu3 manh hon Tinhieu2\r\n\r\nTinHieu3 = BuyStrongPriceCross ;\r\n\r\n//BuyStrongPriceCross = Cross(C,SL) or Cross(C,TL) AND (C &gt; TL) AND (TL &gt; SL) AND aboveKumo AND C &gt; Ref(C,-1);\r\n\r\n\r\n//4. Tin hieu mua so 4 (Tinhieu4)\r\n\r\n//Gia nam tren May Kumo va Span A cat len Span B \r\n//Tin hieu mua gia tang trong xu huong tang Trung han truoc do\r\n//Tinhieu4 manh hon Tinhieu3\r\n\r\nTinHieu4 = BuyStongSenkouSpanCross AND C &gt; TL AND C &gt; SL AND TL &gt; SL;\r\n\r\n//BuyStongSenkouSpanCross = aboveKumo AND Cross(span1,span2) AND C &gt; Ref(C,-1);\r\n\r\n//5. Tin hieu mua so 5 (Tinhieu5)\r\n\r\n//Gia nam tren may Kumo va tin hieu tang gia dlUp va Gia cat len duong ngan han Taken Sen\r\n      //dlUp - Tang gia: Gia tang so voi hom qua va Gia giao cat voi duong Chikou Span\r\n                       //Gia tang vuot vung khang cu ngan han (1 thang)\r\n                       //Xu huong tang ngan han duoc xac nhan\r\n//Tinhieu5 manh hon Tinhieu4\r\n\r\nTinHieu5 = BuyStrongChikouSpanCross and C &gt; SL and TL &gt; SL ;\r\n\r\n//BuyStrongChikouSpanCross = aboveKumo AND dlUp AND C &gt; TL; //OK (da co DK  AND C &gt; Ref(C,-1) trong dlUP)\r\n\r\n\r\n//6. Tin hieu Vuot May - Gia Vuot may Sen va duong Tenkan Sen va Kijun Sen\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen) va Gia cat len duong ngan han Tenkan Sen va gia cat len duong trung han Kijunsen\r\n//VuotMay manh hon Tinhieu5\r\n\r\nVuotMay = BuySenBreakout AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1);\r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n\r\n//7. Tin hieu Vuot May Sen va may Kumo\r\n\r\n//Tin hieu mua khi Gia vuot may Sen (Mua khi gia tu trong may Sen vuot len tren may Sen hoac tu duoi May Sen vuot len tren may Sen)\r\n//Va Tin hieu Mua Kumo Breakout khi gia tu trong may vuot len tren May Kumo hoac tu duoi may vuot len tren may Kumo dong thoi gia vuot duong trung han Kujun Sen\r\n//VuotMaySenKumo manh hon VuotMay\r\n\r\nVuotMaySenKumo = BuySenBreakout AND BuyKumoBreakout  AND C&gt;TL AND C&gt;SL AND  C &gt; Ref(C,-1); \r\n\r\n//BuySenBreakout = ((aboveSenCloud AND Ref(withinSenCloud ,-1)) OR (aboveSenCloud AND Ref(belowSenCloud ,-1)));\r\n//BuyKumoBreakout = ((aboveKumo AND Ref(withinKumo,-1)) OR (aboveKumo AND Ref(belowKumo ,-1))) AND C &gt; SL;\r\n\r\n\r\n//8. Tin hieu HopBich\r\n\r\n//HopBich la tin hieu giao cat cua duong Tenkan Sen va Kijun Sen va va nam trong xu the tang dai han boi duong Dao Gam va duong Tenkan Sen van trong xu the tang va Gia van nam tren Tenkan Sen\r\n//The hien Xu huong tang ngan han van duong giu vung\r\n//Tin hieu mua gia tang trong xu the tang truoc do\r\n\r\nHopBich = (Ref(TL,-1) == Ref(SL,-1)) AND ( (TL==SL) AND (SL&gt;=DG) )  AND (TL &gt; Ref(TL,-1)) AND (C&gt;TL)  AND C&gt;SL   AND C &gt; Ref(C,-1) ; //OK\r\n\r\n\r\n//********Tong hop hien thi cac tin hieu Mua Ichimoku*************\r\n\r\nMuaichi  = TinHieu1 OR TinHieu2 OR TinHieu3 OR TinHieu4 OR TinHieu5 OR VuotMay OR VuotMaySenKumo OR HopBich  ;\r\n\r\n\r\n\r\n\r\n//************************************************\r\n//   Tong hop cac tin hieu Ban (Short) theo Ichimoku\r\n//************************************************\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n\r\nThem vao cac dieu kien Ban\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n//***********************************************************************\r\n//Bat tat tinh nang hien thi cac tin hieu Mua Ban va cac duong Ichimuko\r\n//***********************************************************************\r\n\r\n\r\nIchimokuOnOff = ParamToggle("* Hien thi Ichimoku Kinko Hyo ","OFF|ON",0);\r\n\r\n\r\nif(IchimokuOnOff==1)\r\n{\r\n\r\n \r\n \r\n\r\n//************************************************\r\n//    Ve cac tin hieu Mua Ban Ichimoku\r\n//************************************************\r\n\r\n\r\n\r\ndist = 2.5*ATR(10); \r\ndist1 = 1.5*ATR(10); \r\n\r\n\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{ \r\nif ( VuotMay[i] ) \r\n\tPlotText( "Sen", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ;\r\nif (VuotMaySenKumo[i] AND VuotMay[i]  AND (span1[i] &gt; span2[i]) AND (TL[i]&gt;SL[i]))\r\n\tPlotText( "Bom No", i , L[ i ] - dist1[i], colorBlack, colorYellow ); \r\n} \r\n\r\n//Tin hieu Mua so 1\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow + shapeDigit1 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu1 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 2\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow + shapeDigit2 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu2 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 3\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow + shapeDigit3 , shapeNone ), colorBlue, 0, L, Offset =5 );\r\nPlotShapes( IIf( TinHieu3 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 4\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( TinHieu4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua so 5\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow + shapeDigit5 , shapeNone ), colorBlue, 0, L, Offset =20 );\r\nPlotShapes( IIf( TinHieu5 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\n//Tin hieu Mua Vuot May Sen\r\nPlotShapes( IIf( VuotMay AND (Span1&gt;Span2) , shapeUpArrow , shapeNone ), colorGreen, 0, L, Offset =-25 );\r\n\r\n//Tin hieu Mua Vuot May Sen va May Kumo\r\nPlotShapes( IIf( VuotMaySenKumo AND VuotMay AND Span1 &gt; Span2 , shapeUpArrow + shapeCircle, shapeNone ), colorBrightGreen, 0, L, Offset =40 );\r\n\r\n//Tin hieu Chu y: Dau hieu giao cat Tenkan Sen va Kijun Sen trong xu huong tang trung han\r\n//Tin hieu Mua gia tang them vi then\r\nPlotShapes( IIf( HopBich , shapeUpArrow + shapeStar, shapeNone ), colorYellow, 0, L, Offset = 60 );\r\n\r\n\r\n\r\n//*********************************************************************************\r\n//  Ve cac duong co ban cua Ichimoku\r\n//*********************************************************************************\r\n\r\n//Ve duong Tenkan Sen va Kijun Sen\r\n  \r\nPlot(TL ,"Tenkan Sen ",colorLightOrange,styleThick); //Duong TenkanSen\r\nPlot(SL,"Kijun Sen",colorBlue,styleThick); // Duong Kijun Sen\r\n\r\n//Ve May Sen va chon mau May Sen \r\nPlotOHLC( TL, SL, TL, SL, "", IIf(TL&gt;SL,colorSkyblue, colorTeal),styleCloud );\r\n\r\n// Ve duong Dao Gam\r\n\r\nPlot(DG,"Dao Gam - Muc ho tro dai han",colorYellow,styleThick); //Duong ho tro dai han Dao Gam\r\n\r\n// Ve duong Chikou Span\r\nPlot(C,"",colorLightGrey,styleThick|styleThick,Null,Null,-delay); // Duong Delayed, Lagging, OR Chikou span\r\n\r\n// Ve duong Senkou Span A va Senkou Span B\r\nPlot(Span1,"",colorGreen,1,0,0,timeKumo); // Duong Senkou span A\r\nPlot(Span2,"",colorViolet,1,0,0,timeKumo); // Duong Senkou span B\r\n\r\n//Ve May Kumo, chon mau May Kumo va day tien ve phia truoc 26 phien\r\nPlotOHLC(Span1,Span2,Span1,Span2,"",IIf(Span1&gt;Span2,colorLime,colorLightOrange),styleCloud|4096,0,0,timeKumo); \r\n\r\n// Ve Ribbon - Xac dinh xu huong\r\nXacDinhXuHuong = (TL &gt;= SL) AND (C&gt;=DG); //Tenkan Sen nam tren Kijun Sen va Gia nam tren duong ho tro dai han Dao gam\r\nColor = IIf(XacDinhXuHuong, colorGreen, colorRed ); \r\nPlot( 1, "", Color, styleArea | styleOwnScale | styleNoLabel, -0.1, 50 );  \r\n\r\n}\r\n \r\n\r\n\r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n//***************************************************************\r\n// END Ichimoku Kinko Hyo \r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n//******************************************************************************\r\n// CandleStick Pattern Recognition (first part) - Nhan dang cac mo hinh Nen Nhat\r\n//******************************************************************************\r\n\r\n// The bullish kicker candlestick pattern is a two-day reversal pattern that is often used to alert investors of impending market strength. - See more at: http://backtestwizard.com/amibroker-afl-bullish-kicker-candlestick-pattern/#sthash.WyxEewJL.dpuf\r\nBullishKicker = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(H,-1) AND C &gt; O AND L &gt; Ref(H,-1) ;\r\n\r\nVolAvg = MA( V, 14 );\r\nVolumeIdx = V / VolAvg;\r\nAvgRange = Sum( abs(O-C),15 )/15;\r\n\r\n/* Candle Codes */\r\nWhite = IIf((C&gt;O) AND ((C-O)&gt;=0.8*(H-L)),1,0) AND (C-O)&gt;AvgRange;\r\nBlack = IIf((C&lt;O) AND ((O-C)&gt;=0.8*(H-L)),1,0) AND (O-C)&gt;AvgRange;\r\nDoji  = IIf(abs(O-C)&lt;=0.1*(H-L),1,0);\r\n\r\n/* Dark Cloud Cover [Bear] */\r\nDCC = IIf(Ref(White, -1) AND Black AND C&lt;=Ref(((H+L)/2),-1) AND O&gt;Ref(C,-1), 1,0);\r\n\r\n/* Piercing Line [Bull] */\r\nPL = IIf(Ref(Black, -1) AND White AND C&gt;=Ref(((H+L)/2),-1) AND O&lt;Ref(C,-1), 1,0);\r\n\r\n/* Evening Doji Star [Bear] */\r\nEDS = IIf(Ref(White, -2) AND Ref(Doji, -1) AND Black AND C&lt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Morning Doji Star [Bull] */\r\nMDS = IIf(Ref(Black, -2) AND Ref(Doji, -1) AND White AND C&gt;=Ref(((H+L)/2),-2), 1,0);\r\n\r\n/* Hammer [Bull] */\r\nHAM = IIf( (H-L &gt; 1.5*AvgRange) AND (C &gt; (H+L)/2)  AND (O &gt; C) AND (VolumeIdx &gt; 2), 1, 0);\r\n\r\n/* Bearish Engulfing */\r\nBRE = IIf(Black AND Ref(White, -1) AND (C &lt; Ref(O, -1))  AND (O &gt; Ref(C, -1)),1,0);\r\n\r\n/* Bullish Engulfing */\r\nBLE = IIf(White AND Ref(Black, -1) AND (C &gt; Ref(O,-1))  AND (O &lt; Ref(C,-1)),1,0);\r\n\r\n//Showing Candle Stick Pattern Signal on chart - Hien thi cac dau hieu cua Mo hinh Nen Nhat\r\n\r\n//PlotShapes( IIf( BullishKicker , shapeUpTriangle, shapeNone ), colorBlue, 0, L, Offset = -40 );\r\n//PlotShapes( IIf( DCC, shapeDownTriangle, shapeNone ), colorRed, 0, L, Offset = -60 );\r\n\r\n//r=CdDoji( threshold = 0.05 );\r\n//s=CdHammer( rangefactor= 1.1 );\r\n//t=CdBearishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(r*shapeSmallCircle,colorRed,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(s*shapeCircle,colorYellow,Layer=0,yposition=H,Offset=12); \r\n//PlotShapes(t*shapeHollowSmallCircle,colorLime,Layer=0,yposition=H,Offset=12); \r\n//u=CdBullishEngulfing( bodyfactor = 0.4, rangefactor = 0.5);\r\n//PlotShapes(u*shapeHollowCircle,colorBlue,Layer=0,yposition=H,Offset=15); \r\n\r\n//for(i=0;i&lt;BarCount-1;i++) \r\n//{\r\n//\tif(r[i]==True)PlotText("Doji", i, H[i], colorRed, bkcolor = colorDefault); \r\n//\tif(s[i]==True)PlotText("Hammer", i, H[i], colorYellow, bkcolor = colorDefault); \r\n//\tif(t[i]==True)PlotText("BearishEngulf", i, H[i], colorLime, bkcolor = colorDefault); \r\n//\tif(u[i]==True)PlotText("BullishEngulf", i, H[i], colorBlue, bkcolor = colorDefault); \r\n//}\r\n\r\n\r\n\r\n// Candlestick Pattern Exploration - Bo loc cac mo hinh Nen Nhat\r\n\r\n\r\nWhiteBody = C &gt; O;\r\nBigWhite = (Close - Open)/Open &gt; 0.015 AND (Close - Open) * 2 &gt; High - Low;\r\nBlackBody = C &lt; O;\r\nBigBlack = (Open - Close)/Open &gt; 0.015 AND (Open - Close) * 2 &gt; High - Low;\r\nBig = abs((Close - Open)/Open) &gt; 0.014;\r\nLongUpperShadow = H - Max(O,C) &gt; (H - L)*0.67;\r\nLongLowerShadow = Min(O,C) - L &gt; (H - L)*0.67;\r\nrng = abs((C-O)/O);\r\nlowerShadow = Min(O,C) - L;\r\nuppershadow = H - Max(O,C);\r\nbody = abs(O-C);\r\nrngx = abs(H - L);\r\nrngy = H-L;\r\nshaven = lowerShadow &lt; rngy*0.1;\r\nShavenBottom = L == Min(O,C);\r\nShavenHead = H == Max(O,C);\r\nprevSize = abs(Ref(O,-1)-Ref(C,-1));\r\ncurrentSize = abs(O-C);\r\nfwh = Ref(H,-4);\r\nfwl = Ref(L,-4); \r\nisPrevLargeWhite = Ref(big,-1) AND Ref(whitebody,-1);\r\nSmallRealBody = rng &lt; 0.003 AND rng &gt;0;\t\r\nDiff = abs((prevSize - currentSize) / IIf(currentSize == 0, 0.0000001, currentSize));\r\nDownTrend = (H &lt; Ref(H,-1) AND L &lt; Ref(L,-1));\r\nUpTrend = (H &gt; Ref(H,-1) AND L &gt; Ref(L,-1));\r\nisPrevUpTrend = Ref(uptrend,-1);\r\nRealBodyGapUp = Min(O,C) &gt; Max(Ref(O,-1),Ref(C,-1));\r\nRealBodyGapDown = Max(O,C) &lt; Min(Ref(O,-1),Ref(C,-1));\r\nFallingWindow = Ref(downtrend,-1) AND GapDown();\r\nRisingWindow = Ref(uptrend,-1) AND GapUp();\r\nisfalling = bigblack AND fallingwindow;\r\nisrising = bigwhite AND risingwindow;\r\nrwh = Ref(H,-4);\r\nrwl = Ref(L,-4);\r\nisFallingBlack = Ref(fallingwindow,-1) AND Ref(blackbody,-1);\r\nhorw = Ref(H,-2); \r\nwindowOpen = C &lt; horw;\r\nopensInside = O &lt; Ref(O,-1) AND O &gt; Ref(C,-1);\r\nsimilarSize = diff &lt;= 0.25;\r\nGapUpFromWhite = realBodyGapUp AND isPrevLargeWhite AND isPrevUptrend;\r\nisPrevLargeBlack = Ref(big,-1) AND Ref(blackbody,-1);\r\nisPrevDownTrend = Ref(downtrend,-1);\r\nGapDownFromBlack = realBodyGapDown AND isPrevLargeBlack AND isPrevDowntrend;\r\nisRisingWhite = Ref(risingwindow,-1) AND Ref(whitebody,-1);\r\nlorw = Ref(L,-2);\r\nwindowOpenx = C &gt; lorw;\r\nDoji = C == O AND V &gt; 0;\r\nLongLeggedDoji = doji AND (H - L)/L &gt; 0.01;\r\nStarUp = smallRealBody AND gapUpFromWhite;\r\nDojiStarUp = doji AND gapUpFromWhite;\r\nDojiStarDown = doji AND gapDownFromBlack;\r\nStarDown = smallRealBody AND gapDownFromBlack;\r\nisPrevDownTrendx = Ref(downtrend,-3);\r\nfirstDoji = Ref(doji,-2); \r\nsecDojiLower = Ref(doji,-1) AND Ref(realBodyGapDown,-1);\r\nisPrevUpTrendx = Ref(uptrend,-3);\r\nsecDojiHigher = Ref(doji,-1) AND Ref(realBodyGapUp,-1);\r\nBeltHold = shavenbottom AND shavenhead AND big;\r\nEngulfing = Max(O,C) &gt; Ref(Max(O,C),-1) AND Min(O,C) &lt; Ref(Min(O,C),-1);\r\nUmbrellaLine = uppershadow &lt; rngx*0.1 AND lowershadow &gt; body*2; \r\n//====================================================================================================\r\n\r\n//----------------------------------------\r\n// Bearish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBR = Ref(O,-1) &lt; Ref(C,-1) AND O &lt;= Ref(O,-1) AND C &lt;= O;\r\n\r\n//Evening Doji Star\r\nEveningDojiStar = Ref(dojiStarUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a doji that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Evening Star\r\nEveningStar = Ref(starUp,-1) AND blackbody AND big AND C &lt; Ref((O + C)/2,-2);\r\n/*\r\nA large white candlestick followed by a small real body of either colour that gaps up from the\r\nprevious candles real body. This is followed by a third candlestick that is black and has a\r\nclose lower than the half way point of the first candlesticks real body. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Grave Stone Doji\r\nGraveStoneDoji = longleggeddoji AND L == C AND Ref(uptrend,-1);\r\n/*\r\nA doji with no lower shadow and an extremenly long upper shadow. Must be preceeded by an uptrend.\r\n*/\r\n\r\n//Bear 3 Formation\r\nBear3Formation = bigblack AND C &lt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= fwh AND Ref(L,-1) &gt;= fwl AND\r\nRef(H,-2) &lt;= fwh AND Ref(L,-2) &gt;= fwl AND \r\nRef(H,-3) &lt;= fwh AND Ref(L,-3) &gt;= fwl AND\r\nRef(isfalling, -4);\r\n/*A strong black candle in a falling window, followed by three\r\n candles that fall within the high/low range of the strong black candle, followed\r\n by another strong black candle that closes below the close of the first black candle. \r\n This is a bearish confirmation.*/\r\n\r\n//Bearish Abandoned Baby\r\nBearishAbandonedBaby = EveningDojiStar AND Ref(GapUp(),-1) AND GapDown();\r\n/*\r\nAn evening doji star where there is a gap between the lower shadow of the doji and\r\nthe upper shadows of the prior and next candle.\r\n*/\r\n\r\n//Bearish Belt Hold\r\nBearishBeltHold = belthold AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large black candle with a shaven head and bottom preceeded by an uptrend.\r\n*/\r\n\r\n//Bearish Counter Attack\r\nBearishCounterAttack = Ref(big AND whitebody,-1) AND O &gt; Ref(H,-1) AND C == Ref(C,-1) AND big AND blackbody AND Ref(uptrend,-1);\r\n/*\r\nA large white candle followed by a black candle which opens sharply higher but closes\r\nat the prior black candles close. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Bearish Harami Cross\r\nBearishHaramiCross = doji AND Ref(C,-1) &gt; O AND Ref(O,-1) &lt; O AND Ref(big AND whitebody,-1) AND Ref(uptrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big white \r\ncandlestick in an uptrend\r\n*/\r\n\r\n// Bearish Harami\r\nBearishHarami = Ref(big AND whitebody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(O,-1) AND Max(O,C) &lt; Ref(C,-1) AND Ref(uptrend,-1);\r\n/*\r\nA small candlestick preceded by and whose real body is contained \r\nwithin, the real body of a big white candlestick in an uptrend\r\n*/\r\n\r\n// Bearish Separating Line\r\nBearishSeparatingLine = Ref(whitebody AND big,-1) AND blackbody AND big AND O == Ref(O,-1) AND Ref(downtrend,-1); \r\n/*\r\nA white candlestick followed by a black candlestick with the same opening price. Continues\r\n the previous downtrend.\r\n*/\r\n\r\n// Dark Cloud Cover\r\nDarkCloudCover = Ref(bigwhite,-1) AND blackbody AND O &gt; Ref(H,-1) AND C &lt;= Ref((O+C)/2,-1) AND C &gt; Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA strong white candle in an uptrend followed by a black candle that opens above the high of the \r\nwhite candle and closes at least 50 percent into the white candles real body. Note that if the black candle completely\r\nengulfs the white candles real body then this is not Dark Cloud Cover but a Bearish Engulfing Pattern.\r\n*/\r\n\r\n\r\n// Engulfing Bear\r\nEngulfingBear = Ref(whitebody,-1) AND blackbody AND engulfing AND Ref(uptrend,-1);\r\n/*\r\nThis bar is black and its real body engulfs the previous bars white real body. Must be preceeded by\r\nan uptrend.\r\n*/\r\n\r\n//Hamging Man\r\nHangingMan = umbrellaline AND uptrend AND Ref(uptrend,-1);\r\n/*\r\nThe same as a hammer except must be preceeded by an uptrend.\r\n*/\r\n\r\n//Shooting Star\r\nShootingStar = smallRealBody AND shaven AND realBodyGapUp AND longuppershadow AND Ref(uptrend,-1);\r\n/*\r\nA small body that closes near the bottom of its range and \r\nhas a long upper shadow. There must be a real body gap up from the previous sessions candle. This\r\npattern occurs only after an uptrend.\r\n*/\r\n\r\n//Three Black Crows\r\nThreeBlackCrows = (big AND blackbody) AND Ref(big AND blackbody, -1) AND Ref(big AND blackbody, -2) AND O &lt; Ref(O,-1) AND Ref(O,-1) &lt; Ref(O,-2) AND Ref(uptrend,-4);\r\n/*\r\nThe last three candlesticks are large and black. Each opens within or lower than the \r\n previous candles real body.Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tri-Star Bottom\r\nTriStarBottom = firstDoji AND secDojiLower AND doji AND realBodyGapUp AND isPrevDownTrendx;\r\n/*\r\nA doji followed by a lower doji which is followed by another doji that is higher than the\r\nsecond doji. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Tweezer Tops\r\nTweezerTops = H == Ref(H,-1) AND Ref(big AND whitebody,-1) AND Ref(uptrend,-2);\r\n/* A large candle followed by a candle with the same high. Must be preceeded by an uptrend. */\r\n\r\n// Upside Gap Two Crows\r\nUpsideGapTwoCrows = Ref(big AND whitebody,-2) AND Ref(realBodyGapUp,-1) AND Ref(smallRealBody,-1) AND Ref(blackbody,-1) AND engulfing AND blackbody AND C &gt; Ref((O+C)/2,-2) AND Ref(uptrend,-2);\r\n/* A strong white candle followed by a small black candle which gaps above the previous \r\ncandles real body, followed by a black candle which engulfs the previous black candle. Preceeded by an uptrend. */\r\n\r\n//----------------------------------------\r\n// Bullish\r\n//----------------------------------------\r\n\r\n// Kicker\r\nKBL = Ref(O,-1) &gt; Ref(C,-1) AND O &gt;= Ref(O,-1) AND C &gt; O; \r\n\r\n// Morning Star\r\nMorningStar = Ref(starDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a small real body of either colour,\r\n that gaps below the previous black candles real body, with a third white candlestick, that has a close \r\n higher than the half way point of the first black candlestick. Must be preceeded by a downtrend.\r\n*/\r\n\r\n// Morning Doji Star\r\nMorningDojiStar = Ref(dojiStarDown,-1) AND whitebody AND big AND C &gt; Ref((O + C)/2,-2);\r\n/*\r\nA large black candlestick followed by a doji that gaps below its real body, with a third\r\n white candlestick, that has a close at least half of the way up the black candlestick. Must be preceeded by a\r\n downtrend.\r\n*/\r\n\r\n// Bull 3 Formation\r\nBull3Formation = bigwhite AND C &gt; Ref(C,-4) AND \r\nRef(H,-1) &lt;= rwh AND Ref(L,-1) &gt;= rwl AND\r\nRef(H,-2) &lt;= rwh AND Ref(L,-2) &gt;= rwl AND \r\nRef(H,-3) &lt;= rwh AND Ref(L,-3) &gt;= rwl AND\r\nRef(isrising, -4);\r\n/*\r\nA strong white candle in a rising window, followed by three \r\n candles that fall within the high/low range of the strong white candle, followed\r\n by another strong white candle that closes above the close of the first white candle. \r\n This is confirmation of the Bullish trend."\r\n*/\r\n\r\n// Bullish Abandoned Baby\r\nBullishAbandonedBaby = morningdojistar AND Ref(GapDown(),-1) AND GapUp();\r\n/*\r\nA morning doji star where there is a gap between the lower shadow of the doji and\r\nthe prior and next candle.\r\n*/\r\n// Bullish Belt Hold\r\nBullishBeltHold = belthold AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large white candle with no upper or lower shadow preceeded by a downtrend.\r\n*/\r\n\r\n// Bullish Counter Attack\r\nBullishCounterAttack = Ref(big AND blackbody,-1) AND O &lt; Ref(H,-1) AND C == Ref(C,-1) AND big AND whitebody AND Ref(downtrend,-1);\r\n/*\r\nA large black candle followed by a white candle which opens sharply lower but closes at the \r\nprior white candles close. Must be preceeded by a downtrend\r\n*/\r\n\r\n// Bullish Harami Cross\r\nBullishHaramiCross = doji AND Ref(O,-1) &gt; O AND Ref(C,-1) &lt; O AND Ref(big AND blackbody,-1) AND Ref(downtrend,-1);\r\n/*\r\nA doji preceded by and contained within the real body of a big \r\nblack candlestick in a downtrend.\r\n*/\r\n\r\n// Bullish Harami\r\nBullishHarami = Ref(big AND blackbody,-1) AND smallRealBody AND Min(O,C) &gt; Ref(C,-1) AND Max(O,C) &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA small candlestick, preceded by, and whose body is contained within a big black \r\ncandlestick in a downtrend\r\n*/\r\n\r\n// Bullish Separating Line\r\nBullishSeparatingLine = Ref(blackbody AND big,-1) AND whitebody AND big AND O == Ref(O,-1) AND Ref(uptrend,-1);\r\n/*\r\nA black candlestick followed by a white candlestick with the same opening price. Continues\r\n the previous uptrend.\r\n*/\r\n\r\n//Dragonfly Doji\r\nDragonflyDoji = longleggeddoji AND H==C AND Ref(downtrend,-1);\r\n/*A doji with no upper shadow AND a long lower shadow preceeded by a downtrend.*/\r\n\r\n// Engulfing Bull\r\nEngulfingBull = Ref(blackbody,-1) AND whitebody AND engulfing AND Ref(downtrend,-1);\r\n/*\r\nThis bar is white and its real body engulfs the previous bars black real body. Must be\r\npreceeded by a downtrend.\r\n*/\r\n\r\n// Hammer\r\nHammer = umbrellaline AND Ref(downtrend,-1);\r\n/*\r\nThe upper shadow is less than ten percent of the range\r\n and the lower shadow is more than two times the size of the body. Must be preceeded by a downtrend.\r\n*/\r\n\r\n//Inverted Hammer\r\nInvertedHammer = smallRealBody AND shaven AND realBodyGapDown AND longuppershadow AND Ref(downtrend,-1);\r\n/*\r\nAn upside down Hammer that appears after a downtrend\r\n*/\r\n\r\n//Piercing Line\r\nPiercingLine = Ref(bigblack,-1) AND whitebody AND O &lt; Ref(L,-1) AND C &gt;= Ref((O+C)/2,-1) AND C &lt; Ref(O,-1) AND Ref(downtrend,-1);\r\n/*\r\nA stong black candle followed by a white candle that opens below the low of\r\nthe prior black candle but closes more than halfway into the black candles real body. Preceeded by a downtrend. Note that if the\r\nwhite candle engulfs the prior black candles real body then this is a Bullish Engulfing Pattern not a Piercing Pattern\r\n*/\r\n\r\n// SeperatingLines\r\nSeperatingLines = O == Ref(O,-1) AND (blackbody AND Ref(whitebody,-1) OR whitebody AND Ref(blackbody,-1));\r\n/*\r\na black candlestick is followed by a white candlestick, or a white with a black,and they have the same opening prices.\r\n*/\r\n\r\n//Three White Soldiers\r\nThreeWhiteSoldiers = (whitebody AND big) AND Ref(whitebody AND big,-1) AND Ref(whitebody AND big,-2) AND O &gt; Ref(O,-1) AND Ref(O,-1) &gt; Ref(O,-2);\r\n/*\r\nThe last three candlesticks are large and white. Each opens within or higher than the \r\n previous candles real body.\r\n*/\r\n\r\n// Tri-Star Top\r\nTriStarTop = firstDoji AND secDojiHigher AND doji AND realBodyGapDown AND isPrevUpTrendx;\r\n/*\r\nA doji followed by a higher doji which is followed by another doji that is lower than the\r\nsecond doji. Must be preceeded by an uptrend.\r\n*/\r\n\r\n// Tweezer Bottoms\r\nTweezerBottoms = L == Ref(L,-1) AND Ref(big AND blackbody,-1) AND Ref(downtrend,-2);\r\n/* A large candle followed by a candle with the same Low. Must be preceeded by a downtrend. */\r\n\r\n\r\n//----------------------------------------\r\n// Continuation\r\n//----------------------------------------\r\n\r\n// Downward Gapping Tasuki\r\nDownwardGappingTasuki = isFallingBlack AND whitebody AND opensInside AND C &gt; Ref(O,-1) AND windowOpen AND similarSize;\r\n/* A black candle that gaps down followed by a similarly sized white candle that opens Inside the black candles real body AND closes above it. */\r\n\r\n//Upward Gapping Tasuki\r\nUpwardGappingTasuki = isRisingWhite AND blackbody AND opensInside AND C &lt; Ref(O,-1) AND  windowOpenx AND similarSize;\r\n/* A white candle that gaps up followed by a similarly sized black candle that opens Inside the white candles real body AND closes below it; */\r\n\r\n//Inverted Black Hammer\r\nInvertedBlackHammer = blackbody AND InvertedHammer;\r\n\r\nrevert1 = InvertedHammer ;\r\n\r\n\r\n\r\n//***************************************************************\r\n//END mo hinh Nen Nhat\r\n//***************************************************************\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                      12. Fibonacci Internal &amp; External Retracements                             |\r\n//====================================================================================|\r\n/* Fibonacci Internal &amp; External Retracements */\r\n// This is a Modified Version that shows Fibonacci 00% &amp; 100% instead of WRONG Sup &amp; Res\r\n\r\n\r\n_SECTION_BEGIN("12. Fibonacci Internal + External Retracements");\r\n\tfibs = ParamToggle("1. Hien thi duong ngang Fibonacci ","OFF|ON",0);\r\n\ttext = ParamToggle("2. Hien thi thong so","OFF|ON",0);\r\n\tpctH = Param ("Pivot Hi %", 0.325,0.001,2.0,0.002);\r\n\tHiLB = Param ("Hi LookBack",1,1,BarCount-1,1);\r\n\tpctL = Param ("Pivot Lo %", 0.325,0.001,2.0,0.002);\r\n\tLoLB = Param ("Lo LookBack",1,1,BarCount-1,1);\r\n\tBack = Param ("Extend Left = 2",1,1,500,1);\r\n\tFwd  = Param("Plot Forward", 0, 0, 500, 1);\r\n\thts  = Param ("Text Shift", -33.5,-50,50,0.10);\r\n\tstyle =ParamStyle("Line Style",styleLine,styleNoLabel);\r\nx = BarIndex();\r\npRp  = PeakBars( H, pctH, 1) == 0;\r\nyRp0 = SelectedValue(ValueWhen( pRp, H, HiLB));\r\nxRp0 = SelectedValue(ValueWhen( pRp, x, HiLB));\r\npSp  = TroughBars( L, pctL, 1) == 0;\r\nySp0 = SelectedValue(ValueWhen( pSp, L, LoLB));\r\nxSp0 = SelectedValue(ValueWhen( pSp, x, LoLB));\r\nDelta = yRp0 - ySp0;\r\n\r\nfunction fib(ret)\r\n{\r\nretval = (Delta * ret);\r\nFibval = IIf(ret &lt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &lt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval,IIf(ret &gt; 1.0 \r\nAND xSp0 &lt; xRp0, yRp0 - retval, IIf(ret &gt; 1.0 \r\nAND xSp0 &gt; xRp0, ySp0 + retval, Null)))); \r\nreturn FibVal;\r\n}\r\n\r\nx0 = Min(xSp0,xRp0)-Back;\r\nx1 = (BarCount -1);\r\n//////////////////////////////////////////////////////////////////\r\nr236 = fib(0.236);\tr236I = LastValue (r236,1);\r\nr382 = fib(0.382);\tr382I = LastValue (r382,1);\r\nr050 = fib(0.50);\t\tr050I = LastValue (r050,1);\r\nr618 = fib(0.618);\tr618I = LastValue (r618,1);\r\nr786 = fib(0.786);\tr786I = LastValue (r786,1);\r\ne127 = fib(1.27);\t\te127I = LastValue (e127,1);\r\ne162 = fib(1.62);\t\te162I = LastValue (e162,1);\r\ne200 = fib(2.00);\t\te200I = LastValue (e200,1);\r\ne262 = fib(2.62);\t\te262I = LastValue (e262,1);\r\ne424 = fib(4.24);\t\te424I = LastValue (e424,1);\r\n//////////////////////////////////////////////////////////////////\r\np00 = IIf(xSp0 &gt; xRp0,ySp0,yRp0); \tp00I = LastValue (p00,1);\r\np100 = IIf(xSp0 &lt; xRp0,ySp0,yRp0); \tp100I = LastValue (p100,1);\r\ncolor00 =IIf(xSp0 &gt; xRp0,colorLime,colorRed);\r\ncolor100 =IIf(xSp0 &lt; xRp0,colorLime,colorRed);\r\n//////////////////////////////////////////////////////////////////\r\nnumbars = LastValue(Cum(Status("barvisible")));\r\nfraction= IIf(StrRight(Name(),3) == "", 3.2, 3.2);\r\n//////////////////////////////////////////////////////////////////\r\nif(fibs==1)\r\n{\r\nPlot(LineArray(xRp0-Fwd,yRp0,x1,yRp0,Back),"PR",32,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(xSp0-Fwd,ySp0,x1,ySp0,Back),"PS",27,8|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r236,x1,r236,Back),"",45,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r382,x1,r382,Back),"",44,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r050,x1,r050,Back),"",41,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r618,x1,r618,Back),"",43,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,r786,x1,r786,Back),"",42,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e127,x1,e127,Back),"e127",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e162,x1,e162,Back),"e162",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e200,x1,e200,Back),"p200",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e262,x1,e262,Back),"p262",47,style|styleNoRescale,Null,\r\nNull,Fwd);\r\nPlot(LineArray(x0-Fwd,e424,x1,e424,Back),"p424",25,style|styleNoRescale,Null,\r\nNull,Fwd);\r\n}\r\n//////////////////////////////////////////////////////////////////\r\nif(text==1)\r\n{ \r\nPlotText(" 0% = " + WriteVal(p00,fraction),\r\n\tLastValue(BarIndex())-(numbars/hts), p00I  + 0.05, color00);\r\nPlotText("23% = " + WriteVal(r236,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r236I + 0.05, 45);\r\nPlotText("38% = " + WriteVal(r382,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r382I + 0.05, 44);\r\nPlotText("50% = " + WriteVal(r050,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r050I + 0.05, 41);\r\nPlotText("62% = " + WriteVal(r618,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r618I + 0.05, 43);\r\nPlotText("78% = " + WriteVal(r786,fraction),\r\nLastValue(BarIndex())-(numbars/hts), r786I + 0.05, 42);\r\nPlotText("100% = " + WriteVal(p100,fraction),\r\nLastValue(BarIndex())-(numbars/hts),p100I + 0.05, color100);\r\nPlotText("127% = " + WriteVal(e127,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e127I + 0.05, 47);\r\nPlotText("162% = " + WriteVal(e162,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e162I + 0.05, 47);\r\nPlotText("200% = " + WriteVal(e200,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e200I + 0.05, 47);\r\nPlotText("262% = " + WriteVal(e262,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e262I + 0.05, 47);\r\nPlotText("424% = " + WriteVal(e424,fraction),\r\nLastValue(BarIndex())-(numbars/hts),e424I + 0.05, 25);\r\n}\r\n_SECTION_END();\r\n\r\n// END Fibonacci Internal &amp; External Retracements\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    13. Volume Volume Buy and Sell                                                |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("13. Volume Buy and Sell ");\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolume             = MA(V,Volumeperiod);                               //Tinh MA Volume theo ky da chon\r\nPmaVolume            = V/maVolume*100;                                   //% Volume so voi Volume trung binh \r\n\r\n//Tinh toan Buy or Sell Volume \r\nBuyVolume   = IIf( (H==L), 0, V*(C-L)/(H-L) ); //Buy  Volume\r\nSellVolume  = IIf( (H==L), 0, V*(H-C)/(H-L) ); //Sell Volume\r\nBuyVolumep  = 100*BuyVolume/(BuyVolume+SellVolume) ;                //% Buy  Volume so voi tong Volume\r\nSellVolumep = 100*SellVolume/(BuyVolume+SellVolume) ;                //% Sell Volume so voi tong Volume\r\n\r\n\r\n//***************************************** \r\n//Ve duong Volume\r\n//------------------------------------------------------------------------------------------\r\n\r\n                                                                      \r\nswitch ( ParamList( "* Hien thi Volume", "OFF|Volume Histogram|Volume Buy and Sell", 0 ) )\r\n{\r\n\r\n//Volume OFF\r\n//************************************************ \r\ncase "OFF":\r\n\r\nbreak;\r\n\r\n\r\n//Volume Histogram\r\n//************************************************\r\ncase "Volume Histogram":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 25, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nVolumeUpcolor       = ParamColor(" - VolumeUp Color",      colorGreen );\r\nVolumeDown          = ParamColor(" - VolumeDown Color",    colorDarkRed ) ;\r\nVolumeSideway       = ParamColor(" - VolumeSideway Color", colorYellow );\r\n\r\nVolumecolor       = IIf(C&gt;Ref(C,-1), VolumeUpcolor,IIf(C&lt;Ref(C,-1),VolumeDown,VolumeSideway));\r\n\r\n//Ve tong Volume dac ruot\r\nPlotOHLC(V,0,V,0, "" ,Volumecolor , styleCandle| styleNoTitle |  styleHistogram | styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\nbreak;\r\n\r\n\r\n//Volume Buy anh Sell\r\n//************************************************ \r\ncase "Volume Buy and Sell":\r\n\r\n//Chon ky MAVolume\r\nVolumeperiod       = Param     (" - MAvolume Periods ", 30,  1, 500, 1); \r\nmaVolumecolor      = ParamColor(" - MAvolume Color", colorOrange);\r\nVolumeheight        = Param     (" - Volume Height", 5, 1, 100, 1.0) ; // Chieu cao Volume\r\nMAVolumeheight      = Param     (" - MA Volume Height", 18, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\nSellVolumeheight    = Param     (" - Sell Volume Height", 9, 1, 100, 1.0) ; // Chieu cao Sell Volume\r\n\r\nTotalVolumeUp       = ParamColor(" - Total VolumeUp Color",      colorBlue );\r\nTotalVolumeDown     = ParamColor(" - Total VolumeDown Color",    colorRed ) ;\r\nTotalVolumeSideway  = ParamColor(" - Total VolumeSideway Color", colorYellow );\r\n\r\n//Ve mau Total Volume theo dien bien Gia\r\nTotalVolumeColor    = IIf(C&gt;Ref(C,-1), TotalVolumeUp,IIf(C&lt;Ref(C,-1),TotalVolumeDown,TotalVolumeSideway));\r\n\r\n//***************************************** \r\n\r\n// Ve them duong Buy Volume mau Xanh\r\n//Plot(BV,"Buy Volume",      ParamColor(" - Buy Volume Color",  colorGold ), styleHistogram | styleThick |styleNoTitle|styleNoLabel ) ;\r\n\r\n// Ve duong Sell Volume dac ruot mau Do\r\nPlotOHLC(SellVolume,SellVolume,0,0, "Sell Volume" , ParamColor(" - Sell Volume Color",  colorRed ), styleCandle|  styleOwnScale | styleThick | styleNoLabel,  SellVolumeheight );\r\n\r\n//***************************************** \r\n//Ve tong Volume rong ruot\r\nPlotOHLC(0, V, 0, V, "" , TotalVolumeColor, styleCandle|  styleOwnScale | styleThick | styleNoLabel,  Volumeheight );\r\n\r\n//Ve tong Volume dac ruot\r\n//PlotOHLC(V,0,V,0, "" , VolumeColor, styleCandle| styleNoTitle |  styleHistogram | styleThick | styleNoLabel );\r\n\r\n// Ve tong Volume loai bo Sell Volume\r\n//PlotOHLC(SV,Volume,SV,Volume,"BuyVolume",VolumeColor,styleCandle|styleNoTitle|styleNoLabel );\r\n \r\n//***************************************** \r\n//Ve line MA Volume \r\nPlot(maVolume,"MA Volume", maVolumecolor, styleLine| styleNoTitle | styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n\r\n//Ve may MA Volume \r\nPlotOHLC( maVolume, maVolume, maVolume, maVolume, "MA Volume", ParamColor(" - Volume Cloud Color",  colorViolet ), styleGradient| styleOwnScale | styleThick | styleNoLabel,  MAVolumeheight );\r\n \r\nbreak;\r\n\r\n\r\n}\r\n\r\n _SECTION_END();\r\n\r\n// END Volume tren duong gia\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    14. VAP - Volume At Price                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("14. VAP - Volume At Price");\r\n\r\nVAPline  = Param("VAP Lines - So luong thanh VAP", 150, 1, 1000, 1 );\r\nVAPwidth = Param("VAP Width - Chieu dai VAP", 10, 1, 100, 1 );\r\nVAPcolor = ParamColor("VAP Color", colorLightOrange);\r\nVAPLR    = ParamToggle("Chon ben Trai | Phai", "Left|Right" ) ;\r\n\r\n\r\nPlotVAP  = ParamToggle( "* VAP - Volume At Price ",  "OFF|ON", 0 ); \r\n\r\n//Ve VAP - Volume At Price\r\nif (PlotVAP &gt;0)\r\n{\r\n PlotVAPOverlay(VAPline ,VAPwidth,VAPcolor , VAPLR );\r\n \r\n}\r\n_SECTION_END();\r\n\r\n//        END  12. VAP - Volume At Price   \r\n   \r\n \r\n \r\n          \r\n//==========================================================================|\r\n//                    15. Volume At Price Anna Coulling                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("15. Volume At Price Anna Coulling");\r\n/*\r\nAuthor: Anderson Wilson, Beppe, Steve Walsh\r\nbased on PriceVolDistribution demo written by Tomasz Janeczko\r\n\r\nVolume-by-Price is an indicator that shows the amount of volume for a particular price range,\r\nThe Volume-by-Price bars are horizontal and shown on the left side of the chart to correspond\r\nwith these price ranges. Bar colors indicate Bull (SeaGreen) / Bear (Custom16) / Total (Grey40) volume\r\nUse double click to define range.\r\n*/\r\n\r\n\r\n\r\nQvap       = Param( "So luong thanh VAP", 15, 1, 200, 1 );\r\npRecHeight = Param( "Rectangle Height - Kich thuoc hop chu nhat", 0.90, 0.10, 1, 0.01 );\r\nSelectsizeFont = Param( "Chon Font Size", 9, 1, 30, 1 );\r\nSelectFont = GfxSelectFont( "Arial", SelectsizeFont ); \r\n\r\n//\r\nbi = BarIndex();\r\nfvb = BeginValue( bi );\r\nlvb = EndValue( bi );\r\n\r\nif (VAPanna = ParamToggle( "* Hien thi Volume At Price Anna Coulling",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\nif( fvb == 0 &amp;&amp; lvb == LastValue( bi ) )\r\n{\r\n    fvb = FirstVisibleValue( bi );\r\n    lvb = LastVisibleValue( bi );\r\n}\r\n\r\nfvb = Max( 0, fvb );\r\nlvb = Max( 0, lvb );\r\n\r\n\r\nBullBearZone = ( High - Low ) / 3;\r\nbullbar = C &gt; ( High - BullBearZone );\r\nbearbar = C &lt; ( Low + BullBearZone );\r\n\r\nmx  = PriceVolDistribution( H, L, V, Qvap, True, fvb, lvb );\r\nmx1 = PriceVolDistribution( H, L, IIf( bullbar, V, 0 ), Qvap, True, fvb, lvb );\r\nmx2 = PriceVolDistribution( H, L, IIf( bearbar, V, 0 ), Qvap, True, fvb, lvb );\r\n\r\nbins  = MxGetSize( mx, 0 );\r\nbins1 = MxGetSize( mx1, 0 );\r\nbins2 = MxGetSize( mx2, 0 );\r\n\r\nGfxSetOverlayMode( 1 );\r\nGfxSetCoordsMode( 1 );\r\n\r\nif( bins &gt; 1 &amp;&amp; bins == bins1 &amp;&amp; bins == bins2 )\r\n{\r\n\r\n    MaxVolume = mx[ 0 ][ 1 ];\r\n\r\n    // find max volume\r\n    for( i = 1; i &lt; bins; i++ )\r\n    {\r\n        if( mx[ i ][ 1 ] &gt; MaxVolume )\r\n            MaxVolume = mx[ i ][ 1 ]; // Volume for that bin 1...\r\n\r\n        //printf( "mx=%g", MaxVolume / 100000 );\r\n    }\r\n\r\n    // rectangle height\r\n    RecHeight = ( mx[ 1 ][ 0 ] - mx[ 0 ][ 0 ] ) / 2 * pRecHeight;\r\n    SelectFont; // Change the text size here\r\n\r\n    for( i = 0; i &lt; bins; i++ )\r\n    {\r\n        // mx1 = Bull\r\n        price = mx1[ i ][ 0 ]; // price level\r\n        absVolume = mx1[ i ][ 1 ];\r\n        VolAcum = absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar = relvolume * ( lvb - fvb + 1 );\r\n        // upper left corner of the rectangle.\r\n        x1 = fvb;\r\n        y1 = price + RecHeight;\r\n        // lower right corner of the rectangle.\r\n        x2 = fvb + relbar;\r\n        y2 = price - RecHeight;\r\n        bullColor = ColorBlend( colorSeaGreen, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bullColor );\r\n        GfxSetBkColor( bullColor );\r\n        GfxSetTextColor( colorBrightGreen );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx2 = Bear\r\n        absVolume = mx2[ i ][ 1 ];\r\n        VolAcum += absVolume;\r\n        relvolume = absVolume / MaxVolume;\r\n        relbar2 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar2;\r\n        bearColor = ColorBlend( colorCustom16, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, bearColor );\r\n        GfxSetBkColor( bearColor );\r\n        GfxSetTextColor( colorRed );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n\r\n        // mx = All Bars\r\n        absVolume = mx[ i ][ 1 ];\r\n        relvolume = ( absVolume - VolAcum ) / MaxVolume;\r\n        relbar3 = relvolume * ( lvb - fvb + 1 );\r\n        x1 = x2;\r\n        x2 = x1 + relbar3;\r\n        midColor = ColorBlend( colorGrey40, GetChartBkColor(), 0.2 );\r\n        GfxFillSolidRect( x1, y1, x2, y2, midColor );\r\n        GfxSetBkColor( midColor );\r\n        GfxSetTextColor( colorBlack );\r\n        GfxTextOut( NumToStr( round( relvolume * 100 ), 2.0 ) + "%", x1, y1 );\r\n    }\r\n}\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n//END   Volume At Price Anna Coulling \r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    16. Volume Lines Module                                   |\r\n//==========================================================================|\r\n// AFL Karthikmarar\r\n// HIGH VOLUME LINES AFL VERSION 1.00\r\n// Provids upto total 20 lines. Number of lines Adjustable from Parameter window\r\n\r\n_SECTION_BEGIN("16. High Volume Lines");\r\n\r\nj        = Param("So luong thanh High Volume Lines",5,1,20,1);\r\nk        = Param("He so Volume factor",2,1.5,3,0.5);\r\nhvlColor = ParamColor( "HVL Colorr", colorOrange );\r\nvr=ParamToggle("* Hien thi High volume lines","OFF|ON" ,0);\r\ny =Cum(1);\r\nHk1=V&gt;k*volAvg;\r\n//High volume detection\r\nhx1=LastValue(ValueWhen(hk1,y,1));\r\nhx2=LastValue(ValueWhen(hk1,y,2));\r\nhx3=LastValue(ValueWhen(hk1,y,3));\r\nhx4=LastValue(ValueWhen(hk1,y,4));\r\nhx5=LastValue(ValueWhen(hk1,y,5));\r\nhx6=LastValue(ValueWhen(hk1,y,6));\r\nhx7=LastValue(ValueWhen(hk1,y,7));\r\nhx8=LastValue(ValueWhen(hk1,y,8));\r\nhx9=LastValue(ValueWhen(hk1,y,9));\r\nhx10=LastValue(ValueWhen(hk1,y,10));\r\nhx11=LastValue(ValueWhen(hk1,y,11));\r\nhx12=LastValue(ValueWhen(hk1,y,12));\r\nhx13=LastValue(ValueWhen(hk1,y,13));\r\nhx14=LastValue(ValueWhen(hk1,y,14));\r\nhx15=LastValue(ValueWhen(hk1,y,15));\r\nhx16=LastValue(ValueWhen(hk1,y,16));\r\nhx17=LastValue(ValueWhen(hk1,y,17));\r\nhx18=LastValue(ValueWhen(hk1,y,18));\r\nhx19=LastValue(ValueWhen(hk1,y,19));\r\nhx20=LastValue(ValueWhen(hk1,y,20));\r\n//values when High volume occured\r\nXV1 =LastValue(ValueWhen(hk1,H,1));\r\nXV2 =LastValue(ValueWhen(hk1,H,2));\r\nXV3 =LastValue(ValueWhen(hk1,H,3));\r\nXV4 =LastValue(ValueWhen(hk1,H,4));\r\nXV5 =LastValue(ValueWhen(hk1,H,5));\r\nXV6 =LastValue(ValueWhen(hk1,H,6));\r\nXV7 =LastValue(ValueWhen(hk1,H,7));\r\nXV8 =LastValue(ValueWhen(hk1,H,8));\r\nXV9 =LastValue(ValueWhen(hk1,H,9));\r\nXV10 =LastValue(ValueWhen(hk1,H,10));\r\nXV11 =LastValue(ValueWhen(hk1,C,11));\r\nXV12 =LastValue(ValueWhen(hk1,C,12));\r\nXV13 =LastValue(ValueWhen(hk1,C,113));\r\nXV14 =LastValue(ValueWhen(hk1,C,14));\r\nXV15 =LastValue(ValueWhen(hk1,C,15));\r\nXV16 =LastValue(ValueWhen(hk1,C,16));\r\nXV17 =LastValue(ValueWhen(hk1,C,17));\r\nXV18 =LastValue(ValueWhen(hk1,C,18));\r\nXV19 =LastValue(ValueWhen(hk1,C,19));\r\nXV20 =LastValue(ValueWhen(hk1,C,20));\r\nLastBar = Cum(1) == LastValue(Cum(1));\r\n\r\n//plot High Volume lines - Ve duong High Volume\r\nPlot(IIf(y&gt;hx1 AND j&gt;=1 AND Vr,xv1,Null),"v1",hvlColor);\r\nPlot(IIf(y&gt;hx2 AND j&gt;=2 AND Vr,xv2,Null),"v2",hvlColor);\r\nPlot(IIf(y&gt;hx3 AND j&gt;=3 AND Vr,xv3,Null),"v3",hvlColor);\r\nPlot(IIf(y&gt;hx4 AND j&gt;=4 AND Vr,xv4,Null),"v4",hvlColor);\r\nPlot(IIf(y&gt;hx5 AND j&gt;=5 AND Vr,xv5,Null),"v5",hvlColor);\r\nPlot(IIf(y&gt;hx6 AND j&gt;=6 AND Vr,xv6,Null),"v6",hvlColor);\r\nPlot(IIf(y&gt;hx7 AND j&gt;=7 AND Vr,xv7,Null),"v7",hvlColor);\r\nPlot(IIf(y&gt;hx8 AND j&gt;=8 AND Vr,xv8,Null),"v8",hvlColor);\r\nPlot(IIf(y&gt;hx9 AND j&gt;=9 AND Vr,xv9,Null),"v9",hvlColor);\r\nPlot(IIf(y&gt;hx10 AND j&gt;=10 AND Vr,xv10,Null),"v10",hvlColor);\r\nPlot(IIf(y&gt;hx11 AND j&gt;=11 AND Vr,xv11,Null),"v11",hvlColor);\r\nPlot(IIf(y&gt;hx12 AND j&gt;=12 AND Vr,xv12,Null),"v12",hvlColor);\r\nPlot(IIf(y&gt;hx13 AND j&gt;=13 AND Vr,xv13,Null),"v13",hvlColor);\r\nPlot(IIf(y&gt;hx14 AND j&gt;=14 AND Vr,xv14,Null),"v14",hvlColor);\r\nPlot(IIf(y&gt;hx15 AND j&gt;=15 AND Vr,xv15,Null),"v15",hvlColor);\r\nPlot(IIf(y&gt;hx16 AND j&gt;=16 AND Vr,xv16,Null),"v16",hvlColor);\r\nPlot(IIf(y&gt;hx17 AND j&gt;=17 AND Vr,xv17,Null),"v17",hvlColor);\r\nPlot(IIf(y&gt;hx18 AND j&gt;=18 AND Vr,xv18,Null),"v18",hvlColor);\r\nPlot(IIf(y&gt;hx19 AND j&gt;=19 AND Vr,xv19,Null),"v19",hvlColor);\r\nPlot(IIf(y&gt;hx20 AND j&gt;=20 AND Vr,xv20,Null),"v20",hvlColor);\r\n_SECTION_END();\r\n\r\n// END High Volume Lines\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    17. Hien thi VWAP - Volume Weighted Average Price                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("17. VWAP - Volume Weighted Average Price");\r\n\r\nPvwap       = ParamField("Price field",-1);\r\nVwapPeriods = Param("Periods", 15, 2, 300, 1, 10 );\r\nVWAPcolor       = ParamColor( "VWAP Color", colorYellow );\r\nVWAPstyle       = ParamStyle( "VWAP Style" , styleThick); \r\n\r\nif(ParamToggle("1. VWAP tuy chinh","OFF|ON",0) )\r\n{\r\nPlot( WMA( Pvwap, VwapPeriods ), _DEFAULT_NAME(), VWAPcolor, VWAPstyle );\r\n\r\n\r\n}\r\n\r\n//****************************************************************************\r\n\r\nPeriod = ParamList( "Chon Time", "Daily|Weekly|Monthly|Lastthursday|Yearly", 1 );\r\npwap = ParamToggle("2. VWAP - Daily|Weekly|Monthly|Lastthursday|Yearly","OFF|ON",0);\r\n\r\nfunction Lastthursday()\r\n{\r\n    Daysinmonth = IIf( Month() == 1 OR Month() == 3 OR Month() == 5 OR Month() == 7 OR Month() == 8 OR Month() == 10 OR Month() == 12, 31, 30 );\r\n    Daysinmonthfeb = IIf( Year() % 4 == 0 AND Year() % 100 != 0, 29, 28 );\r\n    Daysinmonthfinal = IIf( Month() == 2, Daysinmonthfeb, Daysinmonth );\r\n    returnvalue = IIf( Daysinmonthfinal - Day() &lt; 7 AND DayOfWeek() == 4, 1, IIf( Daysinmonthfinal - Day() &lt; 8 AND DayOfWeek() == 3 AND Ref( DayOfWeek(), 1 ) != 4 AND Day() != Daysinmonthfinal , 1, 0 ) );\r\n    return returnvalue;\r\n}\r\n\r\n\r\n\r\nif(Period=="Daily" )\r\n{\r\nBars_so_far_today = 1 + BarsSince( Day() != Ref(Day(), -1));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(V,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * V, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Weekly" OR Interval()==24 * 3600 )\r\n{ \r\nBars_so_far_today = 1 + BarsSince(DayOfWeek() &lt; Ref( DayOfWeek(), -1 ));\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nVol = TimeFrameGetPrice("V", inWeekly, 0);\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nif(Period=="Monthly"  )\r\n{\r\nBars_so_far_today = 1 + BarsSince(Month() != Ref(Month(), -1));\r\nVol = TimeFrameGetPrice("V", inMonthly, 0);\r\nStartBar = ValueWhen(TimeNum() == 091500, BarIndex());\r\nTodayVolume = Sum(Vol,Bars_so_far_today);\r\naverage = (H+L+C)/3;\r\nIIf (BarIndex() &gt;= StartBar, VWAP = Sum (average * Vol, Bars_so_far_today  ) / TodayVolume,0);\r\n}\r\n\r\nPlot (IIf(pwap, VWAP,Null), "Vwap",VWAPcolor);\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END VWAP\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//         18. Bands   - Do luong suc manh Cung Cau + Xu huong                               |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("18. Bands - Thanh suc manh Cung Cau + Xu huong");\r\n//------------------------Strength band------------------------\r\n\r\nRSIPeriod =  Param("Time RSI", 14, 2, 100, 1);\r\nLb      = Param("LookBack Period",60,40,120,1);\r\n\r\nstrband = ParamToggle("1. Plot Strength Bands - Thanh suc manh","OFF|ON",0 );\r\ntrband  = ParamToggle("2. Plot Trend Bands - Thanh xu huong","OFF|ON",0 );\r\n\r\n//-----------------Strength band----------------------\r\n\r\nmySig1 = RSI(RSIPeriod);\r\nAdev = StDev(mySig1, 3*RSIPeriod);\r\njh = HHV(mySig1,Lb);\r\njl = LLV(mySig1,Lb);\r\njc = (WMA((jh-jl),RSIPeriod)*0.60)+WMA(jl,RSIPeriod);\r\nHiline = jh-jc*0.2;\r\nLoline = jl+jc*.2;\r\nmidline = (jh-jl)/2;\r\n\r\nR =  ( 4 * mySig1 + 3 * Ref(mysig1,-1) + 2 * Ref(mysig1,-2) + Ref(mysig1,-3) ) / 10;;\r\nrsicolor = IIf(R&gt;HiLine,colorLime,IIf(R&lt;loLine,colorOrange,colorWhite));\r\nPlot( IIf(strband==1,1.5,0),"Ribbon",rsicolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\nPlot( IIf(trband==1,1.6,0),"",colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// Strength Band\r\n\r\nRx =IIf(R&gt;HiLine,1,IIf(R&lt;loLine,0,2));\r\n\r\n//----------------------Trend Bands-----------------------\r\nLttrendcolor  = IIf(upmajor==1 ,colorLime,IIf( upmajor== -1,colorRed,colorGold));\r\nimdtrendcolor = IIf(upimd==1,colorLime,IIf(dnimd==1,colorRed,colorGold));\r\nmnrtrendcolor  = IIf(upminor==1,colorLime,IIf(dnminor == 1,colorRed,colorGold));\r\nPlot( IIf(trband==1,3.0,0),"", Lttrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\nPlot( IIf(trband==1,3.1,0),"",colorBlack ,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,4.5,0),"Ribbon",mnrtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// mid term trend Band\r\nPlot( IIf(trband==1,4.6,0),"", colorBlack,styleOwnScale|styleArea|styleNoLabel, 0, 100 );\r\nPlot( IIf(trband==1,6.0,0),"Ribbon",  imdtrendcolor,styleOwnScale|styleArea|styleNoLabel, 0, 100 );// lt term trend Band\r\n_SECTION_END();\r\n\r\n//END  18. Bands   - Do luong suc manh Cung Cau + Xu huong       \r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    19. Bollinger Bands                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("19. Bollinger Bands");\r\n\r\n\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 20, 2, 300, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorDarkOliveGreen);\r\nStyle = ParamStyle("Style",styleNoLabel) ;\r\n\r\n\r\n\r\nif (bBollingerBands = ParamToggle( "* Hien thi Bollinger Bands",  "OFF|ON", 0 ))\r\n{\r\n\r\n// Hien thi Bollinger Band cloud\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style |styleNoRescale); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, colorBlack, 0.9 ), styleCloud | styleThick|styleNoLabel|styleNoRescale, Null, Null, Null, -1 );\r\n\r\n\r\n}\r\n\r\n\r\n/*\r\n\r\n// Hien thi tin hieu Mua Ban theo Bollinger Band Signals\r\nSell=Cross(P,BBandTop( P, Periods, Width ));\r\nBuy=Cross(P,BBandBot( P, Periods, Width ));\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n_SECTION_END();\r\n// END Bollinger Bands  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                     20. Keltner Bands system                                 |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("20. Keltner Bands system");\r\n\r\n//Keltner Band Code\r\nKMid = MA (Close, 20);  //Middle Line\r\nATRPeriod = Param("ATRPeriod", 10, 2, 300, 1 ); //ATR Period\r\nKFactor = Param("Width", 2, 0, 10, 0.05 ); //Multiplier\r\nKValue = ATR(ATRPeriod) * KFactor; \r\nKTop = KMid + KValue;   //Upper Band\r\nKBottom = KMid - KValue;    //Lower Ban\r\n \r\n  \r\n  \r\nif (Keltner = ParamToggle( "* Hien thi Keltner Bands system",  "OFF|ON", 0 ))\r\n{\r\n\r\nprintf("\\nKTop : " + KTop );  \r\nprintf("\\nKBottom : " + KBottom );  \r\nprintf("\\nKMid : " + KMid );  \r\n \r\nPlot(KTop,"KTop",colorBlue,styleLine|styleNoRescale);\r\nPlot(KMid,"KMid",colorGold,styleLine|styleNoRescale);\r\nPlot(KBottom,"KBottom",colorRed,styleLine|styleNoRescale);\r\n \r\n \r\nBuy=Cross(High,KTop);\r\nShort=Cross(KBottom,Low);\r\nSell=Cross(KMid,Low);\r\nCover=Cross(High,KMid);\r\n \r\nBuyPrice=KTop;\r\nSellPrice=KMid;\r\nShortPrice=KBottom;\r\nCoverPrice=KMid;\r\n \r\nBuy = ExRem(Buy,Sell);\r\nSell = ExRem(Sell,Buy);\r\nShort=ExRem(Short,Cover);\r\nCover=ExRem(Cover,Short);\r\n \r\n \r\nprintf("\\nBuy : " + Buy );  \r\nprintf("\\nSell : " + Sell );  \r\nprintf("\\nShort : " + Short );  \r\nprintf("\\nCover : " + Cover );  \r\n \r\n/* Plot Buy and Sell Signal Arrows */\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeStar, shapeNone),colorGold, 0, L, Offset=-15);\r\nPlotShapes(IIf(Cover, shapeStar, shapeNone),colorGold, 0,L, Offset=-15);\r\n \r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Keltner Bands system \r\n\r\n\r\n//==========================================================================|\r\n//                     21. Center of Gravity indicator    |\r\n//==========================================================================|\r\n// Trung tam cua Trong luc\r\n// \r\n_SECTION_BEGIN("21. Center of Gravity - Trung tam cua trong luc");\r\n\r\nsx=Null;b=Null;ai=Null;x=Null;\r\nreg=x1=x2=x3=z1=z2=z3=Null;\t\r\nrega=x1a=x2a=x3a=z1a=z2a=z3a=Null;\t\r\n\t\r\nbi=BarIndex();\t\r\neb=LastValue(bi);\t\r\norder=Param("n-th Order",3,1,20,1);\t\r\nbars=Param("Chon time qua khu",260,50,1000,1);\r\nsv=ParamToggle("* Chon che do hien thi theo Click chuot","OFF|ON",1);\r\nalt=ParamToggle("Chon kieu gia tri","Fibonacci|Standard",0);\r\necart=1.61803399;\r\n \r\n \r\nif (Gravity = ParamToggle( "* Hien thi Center of Gravity",  "OFF|ON", 0 ))\r\n{\r\n\r\n  \r\nif(sv)\r\n{\r\n\teb=SelectedValue(bi);\r\n\tbb=Max(0,eb-bars);\r\n}\r\nelse\r\n{\r\n\tbb=Max(0,eb-bars);\r\n}\r\nfin=eb;\r\nnn=order+1;\r\nsx[1]=bars+1;\r\n\r\nif(fin&gt;bars)\r\n{\r\nfor(mi=1;mi&lt;=2*nn-2;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tsuml=suml+n^mi;\r\n\t}\r\n\tsx[mi+1]=suml;\r\n}\r\nfor(mi=1;mi&lt;=nn;mi++)\r\n{\r\n\tsuml=0;\r\n\tfor(n=0;n&lt;=bars;n++)\r\n\t{\r\n\t\tif (mi==1)\r\n\t\t\tsuml=suml+Close[fin-n];\r\n\t\telse\r\n\t\t\tsuml=suml+Close[fin-n]*n^(mi-1);\r\n\t\t\tb[mi]=suml;\r\n\t}\r\n}\r\nfor(jj=1;jj&lt;=nn;jj++)\r\n{\r\n\tfor(ii=1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tkk=ii+jj-1;\r\n\t\tai[(ii-1)*nn+jj]=sx[kk];\r\n\t}\r\n}\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\tll=0;\r\n\tmm=0;\r\n\tfor(ii=kk;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tif(abs(ai[(ii-1)*nn+kk])&gt;mm)\r\n\t\t{\r\n\t\t\tmm=abs(ai[(ii-1)*nn+kk]);\r\n\t\t\tll=ii;\r\n\t\t}\r\n\t}\r\n    if(ll==0) break;\r\n\tif(ll!=kk)\r\n\t{\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\ttt=ai[(kk-1)*nn+jj];\r\n\t\t\tai[(kk-1)*nn+jj]=ai[(ll-1)*nn+jj];\r\n\t\t\tai[(ll-1)*nn+jj]=tt;\r\n\t\t}\r\n\t\ttt=b[kk];\r\n\t\tb[kk]=b[ll];\r\n\t\tb[ll]=tt;\r\n\t}\r\n\tfor(ii=kk+1;ii&lt;=nn;ii++)\r\n\t{\r\n\t\tqq=ai[(ii-1)*nn+kk]/ai[(kk-1)*nn+kk];\r\n\t\tfor(jj=1;jj&lt;=nn;jj++)\r\n\t\t{\r\n\t\t\tif(jj==kk)\r\n\t\t\t\tai[(ii-1)*nn+jj]=0;\r\n\t\t\telse\r\n\t\t\t\tai[(ii-1)*nn+jj]=ai[(ii-1)*nn+jj]-qq*ai[(kk-1)*nn+jj];\r\n\t\t}\r\n\t\tb[ii]=b[ii]-qq*b[kk];\r\n\t}\r\n}\r\nx[nn]=b[nn]/ai[nn*nn];\r\nfor(kk=1;kk&lt;=nn-1;kk++)\r\n{\r\n\ttt=0;\r\n\tii=nn-kk;\r\n\tfor(jj=1;jj&lt;=nn-ii;jj++)\r\n\t{\r\n\t\ttt=tt+ai[(ii-1)*nn+ii+jj]*x[ii+jj];\r\n\t\tif(ai[(ii-1)*nn+ii]!=0)\r\n\t\t\tx[ii]=(b[ii]-tt)/ai[(ii-1)*nn+ii];\r\n\t}\r\n}\r\nfor(n=0;n&lt;=bars;n++)\r\n{\r\n\tsuml=0;\r\n\tfor(kk=1;kk&lt;=order;kk++)\r\n\t{\r\n\t\tsuml=suml+x[kk+1]*n^kk;\r\n\t}\r\n\treg[fin-n]=x[1]+suml;\r\n}\r\n}\r\n\r\nif(alt)\r\n{\r\ndev=StDev(Close-reg,bars);\r\nsd=dev[fin];\r\nx1a=reg+sd*1;//68%\r\nx2a=reg+sd*2;//95%\r\nx3a=reg+sd*3;//99.83%\r\nz1a=reg-sd*1;\r\nz2a=reg-sd*2;\r\nz3a=reg-sd*3;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3a,"x3a",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2a,"x2a",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1a,"x1a",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3a,"z3a",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2a,"z2a",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1a,"z1a",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3a,x3a,x1a,x1a,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z1a,z1a,z3a,z3a,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\nelse\r\n{\r\ndev=StDev(Close,bars);\r\nsd=ecart*dev[fin];\r\nx1=reg+sd/(1.382*1.618);\r\nx2=reg+sd/1.382;\r\nx3=reg+sd;\r\nz1=reg-sd/(1.382*1.618);\r\nz2=reg-sd/1.382;\r\nz3=reg-sd;\r\n\r\nPlot(reg,"reg",colorBlue,1|styleNoRescale);\r\nPlot(x3,"x3",ColorRGB(255,0,0),styleThick|styleNoRescale);\r\nPlot(x2,"x2",ColorRGB(255,100,100),styleDashed|styleNoRescale);\r\nPlot(x1,"x1",ColorRGB(255,200,200),styleDashed|styleNoRescale);\r\nPlot(z3,"z3",ColorRGB(0,255,0),styleThick|styleNoRescale);\r\nPlot(z2,"z2",ColorRGB(100,255,100),styleDashed|styleNoRescale);\r\nPlot(z1,"z1",ColorRGB(200,255,200),styleDashed|styleNoRescale);\r\nPlotOHLC(x3,x3,x2,x2,"",ColorRGB(30,0,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\nPlotOHLC(z2,z2,z3,z3,"",ColorRGB(0,30,0),styleCloud|styleNoLabel|styleNoRescale,0,0,0,-1); \r\n}\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n//END Center of Gravity indicator\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    22. Turtle trading system                                  |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("22. Turtle trading system - He thong giao dich Con Rua");\r\n\r\n/*\r\nFormula Name: Turtle trading system\r\nAuthor/Uploader: DrZingaro\r\nDate Added: 2009-01-12\r\nOrigin: Turtle trading experimemnt Chandelier exit based on Chuck Lebeau's work\r\nKeywords: Trend trading\r\nLevel: Basic\r\nFlags: System\r\n*/\r\n//=============================SETUP================ ======================\r\n\r\npds = Param(" - Chon Time theo doi kenh Turtle", 20, 1,260,1);\r\ntur20  = Param(" - EMA ngan han", 20, 1,200,1);  \r\ntur40  = Param(" - EMA trung han", 40, 1,200,1);  \r\nMAFAST = EMA( Close, tur20 );\r\nMASLOW = EMA( Close, tur40 );\r\n\r\nDonchianUpper = HHV( Ref( H, -1 ), pds ); // Highest high value of highs in last 20 periods\r\nDonchianLower = LLV( Ref( L, -1 ), pds ); // Lowest low value of low in last 20 periods\r\nDonchianMiddle = ( DonchianUpper + DonchianLower ) / 2;\r\n\r\nUpTrend = C &gt; ( LLV( L, pds ) + 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &gt; EMA( Close, tur40 );\r\nDnTrend = C &lt; ( HHV( H, pds ) - 2 * ATR( 10 ) ) AND EMA( Close, tur20 ) &lt; EMA( Close, tur40 );\r\nColor = IIf( UpTrend, colorBlue, IIf( DnTrend, colorOrange, colorCustom11 ) );\r\n\r\n\r\n//=============================TRIGGERS AND ENTRIES=======================\r\nBuy = High &gt; Ref( HHV( High, pds ), -1 ) AND MAFAST &gt; MASLOW; // Enters long trade (Vao lenh Mua)\r\n\r\nShort = Low &lt; Ref( LLV( Low, pds ), -1 ) AND MAFAST &lt; MASLOW; // Enters short trade (Vao lenh Ban khong)\r\n\r\nDbar = Param(" - Chon so thanh Bar theo doi diem Mua - Ban", 50, 1,260,1);\r\nSetBarsRequired( Dbar, Dbar );\r\n\r\nMultiple = Param( "So luong muc ATRs ", 3, 0.5, 10, 0.1 ); // How many ATRs to be allowed below the highest high since latest "buy" bar\r\nATRPeriods = Param( "So ky cho ATR", 20, 1, 100, 1 ); // How many periods to use for the ATR\r\n\r\n\r\n\r\nif (Turtle = ParamToggle( "* Hien thi Turtle trading system",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n// Plots a 20 period Donchian channel\r\n\r\nPlot( DonchianUpper, "Donchian Upper", ParamColor( "DonchianUpper Color", colorBlue ), ParamStyle( "DonchianUpper Style", styleLine|styleNoRescale ) );\r\nPlot( DonchianMiddle, "Donchian Middle", ParamColor( "DonchianMiddle Color", colorBrightGreen ), ParamStyle( "DonchianMiddle Style", styleNoLine|styleNoRescale ) );\r\nPlot( DonchianLower, "Donchian Lower", ParamColor( "DonchianLower Color", colorRed ), ParamStyle( "DonchianLower Style", styleLine |styleNoRescale) );\r\n\r\n\r\n\r\n\r\n//=============================EXITS================ ======================\r\n\r\n\r\n\r\nstopArray = Null;\r\natrArray = ATR( ATRPeriods );\r\nHHArray = Null;\r\nLLArray = Null;\r\nexitArray = Null;\r\ntrendDirection = 0;\r\n\r\nfor ( i = 0; i &lt; BarCount; i++ )\r\n{\r\n    if ( Short[i] )\r\n    {\r\n        // we just triggered a short trade. Set up starting values\r\n        stopArray[i] = Low[i] + ( Multiple * atrArray[i] );\r\n        LLArray[i] = Low[i]; // initialize the lowest low array\r\n        trendDirection = 0 - 1; // going short. Base bar.\r\n    }\r\n\r\n    if ( Buy[i] )\r\n    {\r\n        // we just triggered a long trade. Set up starting values\r\n        stopArray[i] = High[i] - ( Multiple * atrArray[i] );\r\n        HHArray[i] = High[i]; // initialize the highest high array\r\n        trendDirection = 1; // going long. Base bar flag is now set.\r\n    }\r\n\r\n    exitArray[i] = 0;\r\n\r\n    if ( trendDirection &gt; 0 )\r\n    {\r\n        // keep track of the highest high, highest close, highest low, etc..\r\n        if ( trendDirection &gt; 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( Low[i] &lt; stopArray[i-1] )\r\n            {\r\n                //stop got hit. Reset the trade.\r\n                trendDirection = 0; // OK. wait until we trigger another trade.\r\n                exitArray[i] = 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the HHV since trade was entered.\r\n                if ( High[i] &gt; HHArray[i-1] )\r\n                    HHArray[i] = High[i];\r\n                else\r\n                    HHArray[i] = HHArray[i-1];\r\n\r\n                // Compute the stop based on the HHV.\r\n                stopArray[i] = HHArray[i] - ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection + 1;\r\n    }\r\n\r\n    if ( trendDirection &lt; 0 )\r\n    {\r\n        // keep track of the lowest low, lowest close, lowest high, etc..\r\n        if ( trendDirection &lt; 0 - 1 )\r\n        {\r\n            // We are in the trade (2nd day or later)\r\n            if ( High[i] &gt; stopArray[i-1] )\r\n            {\r\n                // our stop got hit. Reset the trade.\r\n                trendDirection = 0;\r\n                exitArray[i] = 0 - 1;\r\n            }\r\n            else\r\n            {\r\n                // keep track of the LLV since trade was entered.\r\n                if ( Low[i] &lt; LLArray[i-1] )\r\n                    LLArray[i] = Low[i];\r\n                else\r\n                    LLArray[i] = LLArray[i-1];\r\n\r\n\t\t// Compute the stop based on the LLV.\r\n                stopArray[i] = LLArray[i] + ( Multiple * atrArray[i] );\r\n            }\r\n        }\r\n\r\n        trendDirection = trendDirection - 1;\r\n    }\r\n\r\n    if ( trendDirection == 0 )\r\n    {\r\n        stopArray[i] = 0;\r\n        LLArray[i] = 0;\r\n        HHArray[i] = 0;\r\n    }\r\n}\r\n\r\nSell = Cover = exitarray;\r\n\r\nBuy = ExRem( Buy, Sell );\r\nSell = ExRem( Sell, Buy );\r\nShort = ExRem( Short, Cover );\r\nCover = ExRem( Cover, Short );\r\n\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Short, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Short, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\nPlotShapes( abs( exitArray )*shapeHollowCircle, colorYellow, 0, ValueWhen( stopArray, stopArray, 1 ), 0 );\r\nPlot( stopArray, "Diem Stoploss", ParamColor( "Diem Stoploss Color:", colorYellow ), ParamStyle( "Diem Stoploss Style", styleDashed|styleNoRescale ) );\r\n\r\n\r\n//PlotShapes(shapeCircle * Sell, colorRed);\r\n//PlotShapes(shapeCircle * Cover, colorBlue);\r\n\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n// END Turtle trading system\r\n\r\n\r\n\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    23. Psar - Parabolic Stop And Reverse                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("23. Psar - Parabolic Stop And Reverse");\r\n\r\nacc = Param("Acceleration", 0.02, 0, 1, 0.001 );\r\naccm = Param("Max. acceleration", 0.2, 0, 1, 0.001 );\r\n\r\nif (psar = ParamToggle( "* Hien thi Psar ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( SAR( acc, accm ), _DEFAULT_NAME(),  ParamColor( "Psar Color", colorBlue ), ParamStyle("Psar Style", styleDots | styleNoLine, maskDefault | styleDots | styleNoLine |styleNoRescale) |styleNoRescale);\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n//END Psar - Parabolic Stop And Reverse\r\n\r\n\r\n \r\n//==========================================================================|\r\n//                    24. Zig Zag Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("24. Zig Zag Indicator ");\r\n\r\nP = ParamField( "Price field" );\r\nchange = Param("% change",5,0.1,25,0.1);\r\n\r\nif (zigzag = ParamToggle( "* Hien thi Zig Zag Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\nPlot( Zig(P, change), _DEFAULT_NAME(), ParamColor( "Color", colorBlue ), ParamStyle("Style") );\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END Zig Zag Indicator  \r\n\r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    25. GAP Indicator                           |\r\n//==========================================================================|\r\n\r\n\r\n_SECTION_BEGIN("25. GAP Indicator ");\r\n\r\n\r\nGup = L&gt;Ref(H,-1);  \r\nGdn = H&lt;Ref(L,-1);  \r\nGap = Gup OR Gdn;  \r\nLinLen = Param("Chon do dai duong Gap",15,1,100,1);  \r\nShowLine = BarsSince(Gup OR Gdn) &lt; LinLen;  \r\nTextPos = Showline &lt; Ref(ShowLine,-1);  \r\nGapUpHi = IIf( ShowLine, ValueWhen(Gup,Ref(H,-1)),Null);  \r\nGapUpLo = IIf( ShowLine, ValueWhen(Gup,L), Null); // OK  \r\nGapDnHi = IIf( ShowLine, ValueWhen(GDn,Ref(L,-1)), Null); // OK  \r\nGapDnLo = IIf( ShowLine, ValueWhen(GDn,H), Null);  \r\nGapLineHi = IIf( ShowLine, ValueWhen(Gap,IIf( Gup, L, IIf( GDn, Ref(L,-1), Null))), Null);  \r\nGapLineLo = IIf( ShowLine, ValueWhen(Gap,IIf( Gdn, H, IIf( Gup, Ref(H,-1), Null))), Null); \r\n\r\nif (gapindicator = ParamToggle( "* Hien thi GAP Indicator ",  "OFF|ON", 0 ))\r\n{\r\n\r\n \r\nPlot(GapLineHi,"",5,styleStaircase|styleNoRescale);  \r\nPlot(GapLineLo,"",4,styleStaircase|styleNoRescale);  \r\nFirstVisibleBar = Status( "FirstVisibleBar" );  \r\nLastvisiblebar = Status("LastVisibleBar");  \r\nfor( b = Max(LinLen,Firstvisiblebar); b &lt;= Lastvisiblebar AND b &lt; BarCount; b++)  \r\n{  \r\nif( Gap[b-LinLen+1] )  \r\n{  \r\nPlotText(NumToStr(GapLineHi[b],1.2),b,GapLineHi[b],5);  \r\nPlotText("\\n"+NumToStr(GapLineLo[b],1.2),b,GapLineLo[b],4);  \r\n}  \r\n}\r\n\r\n\r\n\r\n}\r\n\r\n_SECTION_END();\r\n\r\n// END GAP Indicator \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       26. Tin hieu luot song ngan hanT+4 ngay                               |\r\n//====================================================================================|\r\n// \r\n\r\n\r\n\r\n_SECTION_BEGIN("26. Tin hieu luot song ngan han T+4 ngay ");\r\n\r\n// 4-Day-Range Switch \r\nprevt4=AMA2(C,1,0);\r\ndt4=IIf(C&gt;Ref(Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),-1),Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),\r\nIIf(C&lt;Ref(Min(Min(L,Ref(L,-3)),Min(Ref(L,-1),Ref(L,-2))),-1),Max(Max(H,Ref(H,-3)),Max(Ref(H,-1),Ref(H,-2))),PREVT4));\r\nat4=Cross(Close,dt4);\r\nbt4=Cross(dt4,Close);\r\nstate=IIf(BarsSince(at4)&lt;BarsSince(bt4),1,0);\r\nBuyt4=state&gt;Ref(state,-1);\r\nSellt4=state&lt;Ref(state,-1);\r\nNoaction=state==Ref(state,-1);\r\ncol=IIf(state == 1 ,51,IIf(state ==0,4,1));\r\n\r\n\r\n\r\n \r\nif (ParamToggle("* Tin hieu luot song ngan han T+4 ngay", "OFF|ON" , 0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBlue, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt4 , shapeUpArrow , shapeNone ), colorBlue, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow + shapeDigit3 , shapeNone ), colorYellow, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt4 , shapeDownArrow , shapeNone ), colorYellow, 0, H , Offset=-35 );\r\n\r\n/*\r\nPlotShapes(IIf(Buyt4, shapeUpArrow, shapeNone),colorViolet, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt4, shapeDownArrow, shapeNone),colorRed, 0,H, Offset=-30);\r\n*/\r\n\r\n/*\r\nPlotShapes( shapeUpArrow * Buy ,colorBlue,0,L);\r\nPlotShapes( shapeDownArrow *Sell ,colorYellow,0,H);\r\n*/\r\n\r\n/*\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       27. Tin hieu Buy4 Sell4                                 |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 4 ngay  (Dung cho Trend ngan han)\r\n\r\n\r\n\r\n_SECTION_BEGIN("27. Tin hieu Buy4 Sell4 (Mua ngan han - Ban ngan han)");\r\n\r\n//Buy 4 Sell 4\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\nban =  \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3)\r\nAND C &lt;= Ref(L,-4)\r\nOR ( HHV(C,3)&gt;1.1*C) ;\r\n \r\nBuyt42 = ExRem(mua, ban);\r\nSellt42 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell4 (Song ngan han)", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buyt42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow + shapeDigit3 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sellt42 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buyt42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sellt42, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n\r\n_SECTION_END();\r\n// END Tin hieu Buy4 Sell4  \r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       28. Tin hieu Buy4 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n_SECTION_BEGIN("28. Tin hieu Buy4 Sell8 (Mua ngan han - Ban dai han) ");\r\n\r\n//Buy 4 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy42 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy4 Sell8 ", "OFF|ON" ,0  ))\r\n{\r\n\r\nPlotShapes( IIf( Buy42 , shapeUpArrow + shapeDigit4 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy42 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy42, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy4 Sell8  \r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       29. Tin hieu Buy8 Sell8                               |\r\n//====================================================================================|\r\n//  Mua khi gia vuot dinh 4 ngay, Ban khi gia pha day 8 ngay  (Danh cho Trend dai han)\r\n\r\n\r\n\r\n\r\n_SECTION_BEGIN("29. Tin hieu Buy8 Sell8 (Mua dai han - Ban dai han)");\r\n\r\n//Buy 8 Sell 8\r\nmua =   \r\nC &gt;= Ref(H,-1)\r\nAND C &gt;= Ref(H,-2)\r\nAND C &gt;= Ref(H,-3)\r\nAND C &gt;= Ref(H,-4)\r\nAND C &gt;= Ref(H,-5)\r\nAND C &gt;= Ref(H,-6)\r\nAND C &gt;= Ref(H,-7)\r\nAND C &gt;= Ref(H,-8);\r\n\r\nban = \r\nC &lt;= Ref(L,-1)\r\nAND C &lt;= Ref(L,-2)\r\nAND C &lt;= Ref(L,-3) \r\nAND C &lt;= Ref(L,-4) \r\nAND C &lt;= Ref(L,-5) \r\nAND C &lt;= Ref(L,-6) \r\nAND C &lt;= Ref(L,-7)\r\nAND C &lt;= Ref(L,-8) ;\r\n \r\nBuy8 = ExRem(mua, ban);\r\nSell8 = ExRem(ban, mua);\r\n\r\n \r\nif (ParamToggle("* Tin hieu Buy8 Sell8 - Song dai han", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\nPlotShapes( IIf( Buy8 , shapeUpArrow + shapeDigit8 , shapeNone ), colorBrightGreen, 0, L, Offset =50 );\r\nPlotShapes( IIf( Buy8 , shapeUpArrow , shapeNone ), colorBrightGreen, 0, L, Offset =-35 );\r\n\r\nPlotShapes( IIf( Sell8 , shapeDownArrow + shapeDigit7 , shapeNone ), colorRed, 0, H , Offset=50 );\r\nPlotShapes( IIf( Sell8 , shapeDownArrow , shapeNone ), colorRed, 0, H , Offset=-35 );\r\n\r\n\r\n\r\n/*\r\nPlotShapes(IIf(Buy8, shapeUpArrow, shapeNone),colorBlue, 0,L, Offset=-30);\r\nPlotShapes(IIf(Sell8, shapeDownArrow, shapeNone),colorYellow, 0,H, Offset=-30);\r\n*/\r\n\r\n\r\n}\r\n \r\n_SECTION_END();\r\n\r\n// END Tin hieu Buy8 Sell8  \r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       30. Tin hieu MUA - Ban theo ATR                                 |\r\n//====================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("30. Tin hieu MUA - Ban theo ATR");\r\n\r\n// get start date \r\nStart = Cross( DateNum(), ParamDate("Chon ngay bat dau", "2018-01-01" ) ); \r\nStarted = Flip( Start, 0 ); \r\n \r\nStopMode = ParamToggle("Stop Mode", "Fixed|Chandelier" ); \r\nStopLevel = Param("Fixed perc %", 14, 0.1, 50, 0.1)/100; \r\nStopATRFactor = Param("Chandelier ATR multiple", 4, 0.5, 10, 0.1 ); \r\nStopATRPeriod = Param("Chandelier ATR period", 14, 3, 50 ); \r\n\r\n \r\nif (ParamToggle("* Tin hieu MUA - Ban theo ATR", "OFF|ON" ,0  ))\r\n{\r\n\r\n\r\n \r\n// calculate support and resistance levels \r\nif( StopMode == 0 ) // fixed percent trailing stop \r\n{ \r\n sup = C * ( 1 - stoplevel ); \r\n res = C * ( 1 + stoplevel ); \r\n} \r\nelse // Chandelier ATR-based stop \r\n{ \r\n sup = C - StopATRFactor * ATR( StopATRPeriod ); \r\n res = C + StopATRFactor * ATR( StopATRPeriod ); \r\n} \r\n \r\n// calculate trailing stop line \r\ntrailARRAY = Null; \r\ntrailstop = 0; \r\nfor( i = 1; i &lt; BarCount; i++ ) \r\n{ \r\nif( Started[ i ] == 0 ) continue; \r\n \r\nif( C[ i ] &gt; trailstop AND C[ i - 1 ] &gt; trailstop ) \r\n   trailstop = Max( trailstop, sup[ i ] ); \r\nelse\r\nif( C[ i ] &lt; trailstop AND C[ i - 1 ] &lt; trailstop ) \r\n   trailstop = Min( trailstop, res[ i ] ); \r\nelse\r\n   trailstop = IIf( C[ i ] &gt; trailstop, sup[ i ], res[ i ] );       \r\n \r\ntrailARRAY[ i ] = trailstop; \r\n} \r\n \r\n// generate buy/sell signals based on crossover with trail stop line \r\nBuy = Start OR Cross( C, trailArray ); \r\nSell = Cross( trailArray, C ); \r\n \r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorBlue, 0, L, Offset=-25);\r\nPlotShapes(IIf(Buy, shapeSquare, shapeNone),colorLightBlue, 0,L, Offset=-35);\r\nPlotShapes(IIf(Buy, shapeUpArrow, shapeNone),colorWhite, 0,L, Offset=-30);\r\n\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorRed, 0, H, Offset=25);\r\nPlotShapes(IIf(Sell, shapeSquare, shapeNone),colorPaleGreen, 0,H, Offset=35);\r\nPlotShapes(IIf(Sell, shapeDownArrow, shapeNone),colorWhite, 0,H, Offset=-30);\r\n\r\n/*\r\nPlotText( "ATR", colorBlack, colorBrightGreen ), 0,L, Offset=-30);\r\n\tPlotText( "ATR", i , L[ i ]-dist[i], colorBlack, colorBrightGreen ) ; \r\n */\r\n \r\n\r\nPlot( trailARRAY,"trailing stop level", colorBlue , styleLine|styleNoRescale );\r\n\r\n}\r\n \r\n\r\n\r\n\r\n_SECTION_END();\r\n\r\n// END Diem MUA - Ban theo ATR\r\n\r\n\r\n\r\n   \r\n   \r\n\r\n\r\n\r\n//==========================================================================|\r\n//                    Chay bo loc VSA                              |\r\n//==========================================================================|\r\n\r\n_SECTION_BEGIN("Exploration VSA");\r\n\r\n\r\n\r\nFilter=  (upThrustBar OR upThrustCond2 OR upThrustCond3 OR strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 OR effortUp OR effortDown OR stopVolume OR PseudoUpThrust OR pseudoUtCond\r\n         OR trendChange OR lowVolTest OR lowVolTest1 OR topRevBar OR lowVolTest2 OR buyCond OR noDemandBarUt OR noDemandBarDt OR effortUpfail) \r\n        \r\n         \r\nAND V&gt;10000          \r\nAND C*V &gt;= 100000 AND C*V &lt; 4000000000 AND MA(V,20) &gt;= 100000 \r\nAND Ref(C,-5)*Ref(V,-5) &gt;= 1000000 AND Ref(C,-10)*Ref(V,-10) &gt;= 1000000 \r\nAND Ref(V,-5) &gt;= 50000 AND Ref(V,-10) &gt;= 50000 ;\r\n\r\ntcolor = IIf(strengthDown OR strengthDown1 OR buyCond, 42, IIf(buycond , colorPaleGreen, IIf(strengthDown2, colorPaleGreen,  \r\n        IIf(upThrustBar OR upThrustCond1 OR sellcond, 33, IIf(upThrustCond2 OR upThrustCond3, 25, IIf(effortUp, colorLime, IIf(effortDown,colorRed, IIf(PseudoUpThrust,33,\r\n        IIf(pseudoUtCond OR noDemandBarUt,colorOrange, IIf(strengthDown0 OR noSupplyBar OR lowVolTest OR lowVolTest1 OR lowVolTest2,42, IIf(stopVolume OR revUpThrust,42, IIf(upThrustCond1,colorOrange,\r\n        IIf(trendChange,33,colorPaleBlue))))))))))))); \r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (upThrustCond1\t, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (upThrustCond2\t AND NOT upThrustCond1\t, "Su xac nhan cua Diem Yeu.",\r\nWriteIf (upThrustCond3\t, "Su xac nhan cua Diem Yeu",\r\nWriteIf (strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang tro lai. ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang tro lai. ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2 , "Su xac nhan cua Diem Manh. ",\r\nWriteIf (buyCond, "Su thay doi tich cuc ",\r\nWriteIf (Sellcond, "Su thay doi tieu cuc ",\r\nWriteIf (PseudoUpThrust, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (topRevBar, "Top Reversal - Dao chieu o dinh (Nhan chim giam). Dau hieu cua Diem Yeu. ",\r\nWriteIf (pseudoUtCond, "Su xac nhan cua Diem Yeu. ",\r\nWriteIf (lowVolTest1, "Dau hieu cua Diem Manh. ",\r\nWriteIf (strengthDown2, "Boc lo Suc Manh. ",\r\nWriteIf (noSupplyBar, "Boc lo Suc Manh. ",\r\nWriteIf (trendChange, "Boc lo Diem Yeu. ",\r\nWriteIf (noDemandBarUt, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDT, "Dau hieu cua Diem Yeu. ",\r\nWriteIf (stopVolume, "Su ket thuc cua xu huong giam dang rat gan",\r\nWriteIf (revUpThrust, "Su ket thuc cua xu huong giam dang rat gan ",\r\nWriteIf (effortUp, "Dau hieu Tang gia ",\r\nWriteIf (effortDown\t, "Dau hieu Giam gia ",\r\nWriteIf (effortDownfail\t, "Dau hieu Tang gia ",\r\nWriteIf (effortUpfail, "Dau hieu Giam gia ","")))))))))))))))))))))))))), "Dau hieu" , 1, colorDefault, tcolor,110);\r\n\r\nAddTextColumn(\r\nWriteIf (upThrustBar, " Thanh gia Upthrust. ",\r\nWriteIf (upThrustCond1, " Thanh gia giam sau mot thanh Upthrust. ",\r\nWriteIf (upThrustCond2 AND NOT upThrustCond1, " Mot thanh gia giam voi khoi luong cao di sau thanh Upthrust.",\r\nWriteIf (upThrustCond3, "Day la thanh Upthrust voi khoi luong sieu cao.",\r\nWriteIf (strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown0 AND NOT strengthDown, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (strengthDown AND NOT strengthDown1, "Suc manh dang quay lai sau mot xu huong giam (Co Cau dang bat day). ",\r\nWriteIf (lowVolTest , "Test for supply - Kiem dinh nguon cung. ",\r\nWriteIf (lowVolTest2, "Thanh gia tang sau khi Test cung thanh cong, Diem Manh duoc xac nhan ",\r\nWriteIf (buyCond, "Co the ket thuc xu huong GIAM va bat dau xu huong TANG",\r\nWriteIf (Sellcond, "Co the ket thuc xu huong TANG va bat dau xu huong GIAM",\r\nWriteIf (PseudoUpThrust, "Psuedo UpThrust - Upthrust gia tao (Co khoi luong thap hon 2 thanh gia truoc do). ",\r\nWriteIf (topRevBar, "Dao chieu o dinh. Hay than trong. Xac suat ket thuc da tang hien tai rat cao",\r\nWriteIf (pseudoUtCond, "Mot thanh gia giam voi muc dong cua o phia duoi thap theo sau thanh Pseudo Upthrust - Upthrust gia tao. ",\r\nWriteIf (lowVolTest1, "Test for supply - Kiem dinh nguon cung trong xu huong tang. ",\r\nWriteIf (strengthDown2, "Thanh tang gia voi khoi luong cao, co muc gia dong cua o phia tren cao. ",\r\nWriteIf (trendChange, "Giam gia voi khoi luong cao sau mot xu huong tang. ",\r\nWriteIf (noDemandBarUt, "No Demand  - Khong co cau trong xu huong tang. Dau hieu cua Diem Yeu. ",\r\nWriteIf (noDemandBarDt, "No Demand - Khong co cau. Xu huong tang som ket thuc. ",\r\nWriteIf (stopVolume, "Stopping volume - Khoi luong dung. ",\r\nWriteIf (noSupplyBar, "No Supply - Khong co nguon cung. Dau hieu cua Diem Manh",\r\nWriteIf (revUpThrust, "Thanh UpThrust dao nguoc. ",\r\nWriteIf (effortUp, "No luc day gia TANG. ",\r\nWriteIf (effortDown\t, "No luc day gia GIAM.  ",\r\nWriteIf (effortUpfail, "No luc day gia GIAM that bai. ",\r\nWriteIf (effortUpfail, "No luc day gia TANG that bai. ","")))))))))))))))))))))))))), "Tinh trang" , 1, colorDefault, tcolor,250);\r\n _SECTION_END ();\r\n \r\n //END Chay bo loc VSA\r\n\r\n//==========================================================================|\r\n// Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI                        |\r\n//==========================================================================|\r\n\r\n//www.stockbangladesh.com\r\n_SECTION_BEGIN("All in One Explorer - Manish");\r\ni=0;\r\n//52 Week High Low\r\nHigh52 = HHV(High,250);\r\nLow52 = LLV(Low,250);\r\n\r\n//Bollinger Band\r\nBB1=C&gt;BBandTop(C,20,2) AND Ref(C,-1)&lt;Ref(BBandTop(C,20,2),-1);\r\nBB2=C&lt;BBandBot(C,20,2) AND Ref(C,-1)&gt;Ref(BBandBot(C,20,2),-1);\r\nBBStatus=WriteIf(BB1,"Above Top",WriteIf(BB2,"Below Bottom",WriteIf(IsNull(MA(C,20)),"N/A","Neutral")));\r\nBBColor=IIf(BB1,colorRed,IIf(BB2,colorGreen,colorLightGrey));\r\nIIf(BB2,i+1,i);\r\n\r\n//Moving Average (Short, Mid &amp; Long Term)\r\nMAShort = C&gt;MA(C,15);\r\nIIf(MAShort,i+1,i);\r\nMAMid = C&gt;MA(C,45);\r\nIIf(MAMid,i+1,i);\r\nMALong = C&gt;MA(C,100);\r\nIIf(MALong,i+1,i);\r\nShortStatus = WriteIf(MAShort,"Bullish",WriteIf(IsNull(MA(C,15)) ,"N/A","Bearish"));\r\nShortColor = IIf(MAShort,colorGreen,colorRed);\r\nMidStatus = WriteIf(MAMid,"Bullish",WriteIf(IsNull(MA(C,45))," N/A","Bearish"));\r\nMidColor = IIf(MAMid,colorGreen,colorRed);\r\nLongStatus = WriteIf(MALong,"Bullish",WriteIf(IsNull(MA(C,100)) ,"N/A","Bearish"));\r\nLongColor = IIf(MALong,colorGreen,colorRed);\r\n\r\n//MACD\r\nMACDBull=MACD(12,26)&gt;Signal(12,26,9);\r\nIIf(MACDBull,i+1,i);\r\nMACDStatus=WriteIf(MACDBull,"Bullish",WriteIf(IsNull(MACD(12,26)),"N/A","Bearish"));\r\nMACDColor=IIf(MACDBull,colorGreen,colorRed);\r\n\r\n//Aroon\r\nPeriod=14;\r\nLLVBarsSince=LLVBars(L,Period)+1;\r\nHHVBarsSince=HHVBars(H,Period)+1;\r\nAroonDown=100*(Period-LLVBarsSince)/(Period-1);\r\nAroonUp=100*(Period-HHVBarsSince)/(Period-1);\r\nAroonOsc=AroonUp-AroonDown;\r\nAroon=AroonOsc&gt;0;\r\nIIf(Aroon,i+1,i);\r\nAroonStatus=WriteIf(Aroon,"Bullish",WriteIf(IsNull (RSI(14)),"N/A","Bearish"));\r\nAroonColor=IIf(Aroon,colorGreen,IIf(IsNull(RSI(14) ),colorLightGrey,colorRed));\r\n\r\n//Stochastic\r\nStochKBull=StochK(14,3)&gt;StochD(14,3,3);\r\nIIf(StochKBull,i+1,i);\r\nStochKStatus=WriteIf(StochKBull,"Bullish",WriteIf( IsNull(StochK(14,3)),"N/A","Bearish"));\r\nStochKColor=IIf(StochKBull,colorGreen,colorRed);\r\n\r\n//RSI\r\nR1=RSI(14)&gt;30 AND Ref(RSI(14),-1)&lt;30 AND Ref(RSI(14),-2)&lt;30;\r\nR2=RSI(14)&lt;70 AND Ref(RSI(14),-1)&gt;70 AND Ref(RSI(14),-2)&gt;70;\r\nIIf(R1,i+1,i);\r\nRSIStatus=WriteIf(R1,"Improving",WriteIf(R2,"Decli ning",WriteIf(IsNull(RSI(14)),"N/A","Neutral")));\r\nRSIColor=IIf(R1,colorGreen,IIf(R2,colorRed,colorLightGrey));\r\n//www.pipschart.com\r\n//MFI\r\nM1=MFI(14)&gt;80;\r\nM2=MFI(14)&lt;20;\r\nIIf(M2,i+1,i);\r\nMFIStatus=WriteIf(M1,"Overbought",WriteIf(M2,"Over sold",WriteIf(IsNull(MFI(14)),"N/A","Neutral")));\r\nMFIColor=IIf(M1,colorRed,IIf(M2,colorGreen,colorLightGrey));\r\n\r\n\r\n TrendScore =\r\n IIf(BB2,1,0)+\r\n IIf(MAShort,1,0)+\r\n IIf(MAMid,1,0) + \r\n IIf(MALong,1,0)+\r\n IIf(MACDBull,1,0) +\r\n IIf(Aroon,1,0) +\r\n IIf(StochKBull,1,0)+\r\n IIf(R1,1,0) +\r\n IIf(M2,1,0) ;\r\n\r\n\r\n\r\n\r\n\r\n/*\r\nTrendScore =\r\n\r\nIIf(C&gt;=Ref(C,-11),1,-1)+\r\nIIf(C&gt;=Ref(C,-12),1,-1)+\r\nIIf(C&gt;=Ref(C,-13),1,-1)+\r\nIIf(C&gt;=Ref(C,-14),1,-1)+\r\nIIf(C&gt;=Ref(C,-15),1,-1)+\r\nIIf(C&gt;=Ref(C,-16),1,-1)+\r\nIIf(C&gt;=Ref(C,-17),1,-1)+\r\nIIf(C&gt;=Ref(C,-18),1,-1)+\r\nIIf(C&gt;=Ref(C,-19),1,-1)+\r\nIIf(C&gt;=Ref(C,-20),1,-1);\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n//AddColumn(High52,"52 Week High");\r\n//AddColumn(Low52,"52 Week Low");\r\nAddColumn(C,"Close",1,IIf(C&gt;Ref(C,-1),colorGreen,colorRed));\r\nAddColumn(V,"Volume",1,IIf(V&gt;Ref(V,-1),colorGreen,colorRed));\r\nAddTextColumn(BBStatus,"BBand",1,colorWhite,BBColor);\r\nAddTextColumn(ShortStatus,"Short MA(15)",1,colorWhite,ShortColor);\r\nAddTextColumn(MidStatus,"Mid MA(45)",1,colorWhite,MidColor);\r\nAddTextColumn(LongStatus,"Long MA(100)",1,colorWhite,LongColor);\r\nAddTextColumn(MACDStatus,"MACD",1,colorWhite,MACDColor);\r\nAddTextColumn(AroonStatus,"Aroon",1,colorWhite,AroonColor);\r\nAddTextColumn(StochKStatus,"Stochastic",1,colorWhite,StochKColor);\r\nAddTextColumn(RSIStatus,"RSI(14)",1,colorWhite,RSIColor);\r\nAddTextColumn(MFIStatus,"MFI(14)",1,colorWhite,MFIColor);\r\nAddColumn(TrendScore,"Score");\r\n_SECTION_END();\r\n\r\n// END  Chay bo loc cac chi bao BollingerBand, MAs, MACD, Aroon, Stochastic, RSI, MFI   \r\n\r\n\r\n\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                                       TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))+\r\n\r\n\r\nEncodeColor(colorBlue)+("   -   Danh gia: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"\\n   - Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n"\\n"+\r\nEncodeColor(colorBlue) + "   - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\n\r\n\r\n\r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\t\r\n\r\n);\r\n\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE                                      |\r\n//|============================================================================================|\r\n\r\n\r\n//|============================================================================================|\r\n//|                          Phan TITLE - TIEU DE 2 (Them dien giai VSA)                   |\r\n//|============================================================================================|\r\n\r\n\r\n\r\n_SECTION_BEGIN("Hien thi them phan dien giai VSA");\r\n\r\n\r\nif (SelectedVSA = ParamToggle( "*. Hien thi them phan dien giai VSA",  "OFF|ON", 0 ))\r\n{\r\n\r\n\r\n\r\n_N(Title = EncodeColor(colorSeaGreen)+ " - VSA + VPA Analysis V5.1 (Edit by binhnt.tamviet@gmail.com)"\r\n        +("\\n")+ \r\n        EncodeColor(colorGold)+ " - " + FullName() + " ("+Name()+") - " + "(" + Interval(2) +")" + EncodeColor(colorOrange) + "  - " + Date() \r\n \r\n \r\n\r\n//====================================================================================|\r\n//                       Hien thi thong tin Gia va Khoi luong                            |\r\n//====================================================================================|\r\n\r\n+("\\n")+ EncodeColor(colorLime)+"-------------------------------------------------------------------" +("\\n")+ // Xuong dong\r\n\r\nEncodeColor(colorBlue) + "   - Volume:       "+ \r\n\r\nWriteIf(V&gt;MA(V,30)*1.5,EncodeColor(colorViolet)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*1.5 AND V&gt;=MA(V,30)*1.1  ,EncodeColor(colorGreen)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;MA(V,30)*1.1 AND V&gt;MA(V,30)*0.9  ,EncodeColor(colorYellow)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")",\r\nWriteIf(V&lt;=MA(V,30)*0.9 AND V&gt;=MA(V,30)*0.5,EncodeColor(colorRed)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) + "%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")" ,\r\nWriteIf(V&lt;MA(V,30)*0.5,EncodeColor(colorTurquoise)+ WriteVal(V,1.0)+ "  =  " + WriteVal(V/MA(V,30)*100,1.0) +"%  (MA30 = "+ WriteVal(MA(V,30),1.0) + ")","")))))\r\n\r\n\r\n\r\n+"     "+\r\nEncodeColor(colorBlue) + "    - Open: " +EncodeColor(colorYellow) +O+ \r\nEncodeColor(colorGreen) + "    - High: " +EncodeColor(colorYellow) +H+ \r\nEncodeColor(colorDarkRed) + "    - Low: " +EncodeColor(colorYellow) +L+ \r\nEncodeColor(colorSeaGreen) + "    - Close: " +\r\n\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=6,EncodeColor(colorViolet)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=-6,EncodeColor(colorTurquoise) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;=6,EncodeColor(colorCustom9) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",\r\nWriteIf(Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&lt;0 AND Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)&gt;=-6,EncodeColor(colorRed) +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)",EncodeColor(colorYellow)  +C+ "  =  "+Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)+"  ("+Prec((Prec(C-TimeFrameGetPrice("C",inDaily,-1),2)/TimeFrameGetPrice("C",inDaily,-1))*100,2)+"%)"))))\r\n\r\n\r\n+\r\nEncodeColor(colorBlue)+("\\n   - Khoi luong: ")+\r\nWriteIf(V&gt;MA(V,30)*2,EncodeColor(colorViolet)+" SIEU CAO",WriteIf(V&gt;MA(V,30)*1.3,EncodeColor(colorGreen)+" CAO",\r\nWriteIf(V&gt;MA(V,30),EncodeColor(colorGreen)+" CAO HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30) AND V&gt;MA(V,30)*0.7,EncodeColor(colorRed)+" THAP HON TRUNG BINH",\r\nWriteIf(V&lt;MA(V,30)*0.7 AND V&gt;MA(V,30)*0.3,EncodeColor(colorRed)+" THAP",WriteIf(V&lt;MA(V,30)*0.3,EncodeColor(colorTurquoise)+" RAT THAP",""))))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Bien dong gia (Spread): ")+\r\n\r\nWriteIf(spread &gt;avgSpread*1.5,EncodeColor(colorViolet)+" RONG",\r\nWriteIf(spread &lt;avgSpread*1.5 AND spread&gt;avgSpread ,EncodeColor(colorGreen)+" TREN TRUNG BINH",\r\nWriteIf(spread &lt; avgSpread AND spread &gt;= AvgSpread*0.7,EncodeColor(colorYellow)+"HEP HON TRUNG BINH",\r\nWriteIf(spread &lt; AvgSpread*0.7 AND spread &gt;= AvgSpread*0.3,EncodeColor(colorRed)+" HEP",\r\nWriteIf(spread &lt; AvgSpread*0.3,EncodeColor(colorTurquoise)+" RAT HEP","")))))+\r\n\r\n(EncodeColor(colorBlue)+"      -   Vi tri gia dong cua:  ")+\r\nWriteIf(ClosePos==5,EncodeColor(colorViolet)+" CAO NHAT",\r\nWriteIf(ClosePos==4,EncodeColor(colorGreen)+" PHAN TREN",\r\nWriteIf(ClosePos==3,EncodeColor(colorYellow)+" NGAY GIUA",\r\nWriteIf(ClosePos==2,EncodeColor(colorRed)+" PHAN DUOI",\r\nEncodeColor(colorTurquoise)+" THAP NHAT"))))+ \r\n\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upimd==1,EncodeColor(colorGreen) +" Xu huong ngan han: TANG - UP",\r\nWriteIf(dnimd==1,EncodeColor(colorRed)   +" Xu huong ngan han: GIAM - DOWN",\r\n                 EncodeColor(colorYellow)+" Xu huong ngan han: Khong ro rang"))+\r\n                 \r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upminor==1,EncodeColor(colorGreen) +" Xu huong trung han: TANG - UP",\r\nWriteIf(dnminor==1,EncodeColor(colorRed)   +" Xu huong trung han: GIAM - DOWN",\r\n                   EncodeColor(colorYellow)+" Xu huong trung han: Khong ro rang"))+\r\nWriteIf(upmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong TANG trung han truoc do co the ket thuc)",\r\nWriteIf(dnmajoroff,  EncodeColor(colorSeaGreen)+"  (Xu huong GIAM trung han truoc do co the ket thuc)","" ))+\r\n\r\n\r\nEncodeColor(colorLime)+("\\n   - ")+\r\nWriteIf(upmajor==1,  EncodeColor(colorGreen) +" Xu huong dai han:     TANG - UP",\r\nWriteIf(upmajor== -1,EncodeColor(colorRed)   +" Xu huong dai han:     GIAM - DOWN",\r\n                     EncodeColor(colorYellow)+" Xu huong dai han:     Khong ro rang"))+\r\nWriteIf(upminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong TANG dai han truoc do co the ket thuc)",\r\nWriteIf(dnminoroff,EncodeColor(colorSeaGreen)+"  (Xu huong GIAM dai han truoc do co the ket thuc)","" ))+\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi tin hieu mua Ichimoku Kinko Hyo                             |\r\n//====================================================================================|\r\n\r\nWriteIf(Muaichi,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " +\r\n    \r\n    EncodeColor(colorBlue) + "  - Ichimoku Kinko Hyo","")+\r\n\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu1, "\\n" + "   - Tin hieu Mua so 1: " + \r\n\tEncodeColor(colorCustom9) + "  Vuot may Kumo va duong Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu2, "\\n" + "   - Tin hieu Mua so 2: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Tenkan Sen vuot len Kijun Sen +  Gia vuot len Tenkan Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu3, "\\n" + "   - Tin hieu Mua so 3: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Vuot len may Sen + Tenkan Sen vuot len Kijun Sen tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu4, "\\n" + "   - Tin hieu Mua so 4: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Senkou Span A vuot len Senkou Span B tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(TinHieu5, "\\n" + "   - Tin hieu Mua so 5: " + \r\n\tEncodeColor(colorCustom9) + "  Nam tren may Kumo + Gia vuot len Tenkan Sen + Chikou Span vuot len duong Gia tai: " +C+ "", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMay, "\\n"  + "   - Vuot may Sen:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorBlue) + WriteIf(VuotMaySenKumo, "\\n"  + "   - Vuot ca may Sen va may Kumo:" + \r\n\tEncodeColor(colorCustom9) + "  Tin hieu Mua rat Manh!!!", "") + \r\n\t\r\n\tEncodeColor(colorYellow) + WriteIf(HopBich, "\\n"  + "   - Chu y: Co tin hieu giao cat giua Tenkan Sen va Kijun Sen:" + \r\n\tEncodeColor(colorLime) + "  Gia van trong xu the Tang, Co the gia tang them vi the Mua (Long): " +TL+ "", "")\r\n\t\r\n\t                         \r\n\t\t\r\n\r\n //|============================================================================================|\r\n//|                                       Hien thi Tin hieu canh bao  VSA                                   |\r\n//|============================================================================================|\r\n\r\n  /*\r\nstrength\t= sc OR tbc2a OR tbc2 or effortDownfail OR \tstrengthDown OR strengthDown1 OR strengthDown2 OR \r\n              strengthDown0 OR bullBar OR effortUp OR upBar  OR revUpThrust ;\r\n\r\nweakness\t= bc or upThrustBartrue OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 OR PseudoUpThrust OR pseudoUtCond   \r\n             OR tbc4 or effortUpfail or Sellcond OR  upThrustBar OR  effortDown  OR bearBar OR downBar ;\r\n\r\nvsachange = trendChange OR lowVolTest or lowVolTest1 or lowVolTest2 or buyCond  OR noSupplyBar or stopVolume or noDemandBarDt OR noDemandBarUt \r\n           or topRevBar OR Fom1 OR tbc3 OR tbc5  ;\r\n\r\n*/ \r\n\r\n\r\n//1. Tin hieu canh bao xuat hien Diem Yeu\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                                         +EncodeColor(colorBlue) +"   - Canh bao VSA:  ","")+\r\n\r\nEncodeColor(colorRed)+\r\n\r\nWriteIf (bc,"\\n +Buying Climax - Cao trao Mua tiem nang. ","")+\r\nWriteIf (upThrustBartrue, "\\n +Day la mot thanh Upthrust thuc su. Dau hieu Diem Yeu kha chac chan. ","")+\r\nWriteIf (upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3, "\\n  +Day la mot thanh Upthrust. Mot dau hieu cua Diem Yeu. ","")+\r\nWriteIf (PseudoUpThrust, "\\n +Psuedo UpThrust - Upthrust gia tao (co khoi luong thap hon 2 thanh truoc no). Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (pseudoUtCond AND NOT PseudoUpThrust, "\\n +Mot thanh gia giam co gia dong cua o muc thap, di sau mot thanh Pseudo Upthrust. Xac nhan cua Diem Yeu. ","")+\r\nWriteIf (effortUpfail, "\\n +No luc tang gia that bai (Effort to Move up has failed). Tin hieu giam gia. ","")+\r\nWriteIf (Sellcond, "\\n +Xu huong TANG co kha nang se KET THUC va som bat dau mot xu huong GIAM. ","")+\r\nWriteIf (effortDown, "\\n  +No luc day gia GIAM (Effort to Fall). Dau hieu cua Diem Yeu.  ","")+\r\nWriteIf (tbc4, "\\n +Hai thanh gia dao chieu giam gia (Nhan chim giam) voi khoi luong cao hon. Dau hieu cua Diem Yeu", "")+\r\n\r\n//2. Tin hieu canh bao xuat hien Diem Manh\r\n\r\n\r\nEncodeColor(colorCustom9)+\r\n\r\nWriteIf (sc, "\\n +Sell Climax - Cao trao BAN. Dau hieu cua Diem Manh."\r\n            +"\\n Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (tbc2a , "\\n +Hai thanh gia giong voi 2 thanh dao chieu tang voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (tbc2 AND NOT tbc2a, "\\n +Hai thanh gia dao chieu tang (Nhan chim tang) voi Khoi luong cao hon. Dau hieu cua Diem Manh. ", "")+\r\nWriteIf (effortDownfail, "\\n +No luc day gia xuong that bai (Effort to Move Down has failed). Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2 , "\\n +Diem Manh xuat hien tro lai sau mot xu huong giam. Neu co Khoi luong cao se ho tro cho Diem Manh nay. ","")+\r\nWriteIf (effortUp, "\\n +Mot no luc day gia tang (Effort to Rise) . Dau hieu cua Diem Manh.  ","")+\r\nWriteIf (revUpThrust, "\\n +Thanh gia Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n\r\n\r\n//3. Tin hieu canh bao dau hieu dao chieu xu huong truoc do \r\n\r\n\r\nEncodeColor(colorYellow)+\r\n\r\nWriteIf (trendChange, "\\n +Mot thanh gia GIAM voi Khoi luong cao sau mot dot tang gia. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (topRevBar, "\\n +Top Reversal - Dao chieu giam o dinh. Dau hieu cua Diem Yeu. ","")+\r\nWriteIf (noDemandBarDt OR  noDemandBarUt, "\\n +No Demand - Khong co Cau. Xu huong tang co the thay doi.  ","")+\r\nWriteIf (Fom1, "\\n +Khoi luong CAO nhung gia lai khong di chuyen nhieu. Co the dang gap Vung Khang cu/Ho tro manh - vung Cung/Cau manh me. ","")+\r\nWriteIf (tbc3 AND NOT Fom1 , "\\n +Hai thanh gia dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (tbc5 AND NOT tbc3, "\\n +Hai thanh gia giong voi 2 thanh dao chieu nhau (Nhan chim) voi Khoi luong thap. ", "")+\r\nWriteIf (buyCond, "\\n +Xu huong GIAM co kha nang se KET THUC va som BAT DAU mot xu huong TANG.  ","")+\r\nWriteIf (lowVolTest or lowVolTest1 OR lowVolTest2, "\\n +Test for supply - Kiem dinh nguon cung thanh cong. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (noSupplyBar, "\\n +No Supply - Khong co nguon cung. Dau hieu cua Diem Manh. ","")+\r\nWriteIf (stopVolume, "\\n +Stopping volume - Khoi luong dung giam. Bao hieu xu huong giam sap ket thuc. ","")\r\n\r\n\r\n\r\n//====================================================================================|\r\n//                       Hien thi Phan dien giai VSA                                       |\r\n//====================================================================================|\r\n\r\n\r\n +WriteIf(weakness OR strength OR vsachange,EncodeColor(colorLime)+"\\n ------------------------------------------------------------------- \\n " \r\n                 +EncodeColor(colorBlue) +"  - Dien giai VSA:","")+\r\n\r\n//1. Dien giai VSA Canh bao Xu huong giam\r\nEncodeColor(colorRed) +\r\n\r\nWriteIf(upThrustBartrue , "\\n +Upthrust Bar- xuat hien de quet Stoploss (mua dung lo) cua nha dau tu nho le"+\r\n    "\\n +Smartmoney co gang danh lua nho le cang nhieu cang tot. " +  \r\n\t"\\n +Chung thuong xuat hien sau dau hieu Diem Yeu trong nen gia."+\r\n\t"\\n +Smart money biet rang thi truong dang yeu di (giam gia). " +\r\n\t"\\n +Vi the, Ho gia vo day gia len de quet stoploss cac lenh Ban khong (Short Sell). " +\r\n\t"\\n +Lam cho cac Trader hoang loan, buoc phai cat lo lenh Short sell (Cover - mua lai so hang da ban) " +\r\n\t"\\n +Hoac danh lua nha dau tu phai mua len trong khi thi truong dang yeu di."+\r\n\t"\\n +Tao ra thanh khoan de Smart Money ban xuong.","")+ \r\n\r\nWriteIf(upThrustBar OR upThrustCond1 OR upThrustCond2 OR upThrustCond3 AND NOT upThrustBartrue , "\\n +Upthrust Bar. Dau hieu cua Diem Yeu. "+\r\n     "\\n +Luu y: Thanh Upthrust Bar la thanh nen co bien dong cao " +\r\n\t"\\n +Thanh gia giam nay thuong xuat hien ngay sau bat ky thanh Upthrust nao truoc do. "+\r\n\t"\\n +Dau hieu cua Diem Yeu."+ \r\n\t"\\n +Smartmoney dang khien nho le bi kep hang ngay tren dinh. "+\r\n\t"\\n +Voi su xuat hien cua thanh Upthrust." +\r\n\t"\\n +Ban can phai can trong den lenh Mua va lenh Stoploss cua minh."+ \r\n\t"\\n +Sau nhieu phien Upthrust lien tiep, ban can tim kiem cac dau hieu cua viec kiem dinh lai 'test.","")+ \t\r\n\r\nWriteIf(PseudoUpThrust,"\\n +PseudoUpThrust - Day la Upthrust gia tao. "+\r\n    "\\n +No thuong xuat hien sau mot thanh gia tang co khoi luong tren trung binh. " +\r\n\t"\\n +Trong kha giong thanh upthrust nhung co gia dong cua gan muc thap. "+\r\n\t"\\n +Nhung khoi luong thuong thap hon muc trung binh. "+\r\n\t"\\n +Day la dau hieu cua Diem Yeu. Neu kem khoi luong cao thi Diem Yeu cang manh hon" + \r\n\t"\\n +Smart Money dang co gang bay nho le vao cac vi the xau. ","")+\t\r\n\r\nWriteIf(pseudoUtCond AND NOT PseudoUpThrust, "\\n +PseudoUpThrust - Mot thanh gia giam sau thanh Upthrust gia tao."+\r\n    "\\n +Day la su xac nhan Diem Yeu. Neu khoi luong cao hon muc trung binh thi Diem Yeu cang manh hon. ","")+\t\r\n\t\r\nWriteIf(tbc4, "\\n +Dau hieu cua Diem Yeu","")+\r\n \r\nWriteIf(bc, "\\n +Buying Climax - Cao trao Mua tiem nang."+\r\n            "\\n +Chu y: No co the la dau hieu cua Diem Yeu neu o cuoi mot xu huong tang da keo dai truoc do"+\r\n            "\\n +Neu xuat hien o vung khang cu thi day la luc Mua hap thu cua phien Breakout. La Diem Manh.","") +\r\n      \r\nWriteIf(effortUpfail, "\\n +No luc tang gia that bai. Dau hieu cua Diem Yeu. ","") + \r\n    \r\nWriteIf(Sellcond, "\\n +Tin hieu Ban. ","") + \r\n  \r\nWriteIf(effortDown, "\\n +No luc day gia GIAM. Dau hieu cua Diem Yeu. "\r\n                    + "\\n +Mot thanh gia cho thay su no luc day gia giam. "\r\n                    + "\\n +No thuong duoc nhin thay o dau chu ky giam gia.","") + \r\n                  \r\n\r\n//2. Dien giai VSA Canh bao Xu huong tang\r\n\r\n\t\r\nEncodeColor(colorCustom9) +\r\n\r\nWriteIf(sc,"\\n +Selling Climax - Cao trao BAN tiem nang. "\r\n                   +"\\n +Chu y: Hay xem xet tung tinh huong de danh gia chinh xac cay nen nay"\r\n                   +"\\n +Neu no xuat hien o cuoi xu huong Giam keo dai truoc do thi day la dau hieu Diem Manh"\r\n                   +"\\n +Neu no xuat hien khi pha vo vung ho tro thi day la dau hieu Suy Yeu ","")+\r\n\r\nWriteIf(tbc2a OR tbc2 ,"\\n +Hai thanh gia dao chieu nhau. Dau hieu cua Diem Manh ","")+\r\n                            \r\n            \r\nWriteIf(effortDownfail,"\\n +No luc Giam gia that bai. Dau hieu cua Diem Manh ","")+ \r\n                                      \r\nWriteIf(strengthDown OR strengthDown0 OR strengthDown1 OR strengthDown2, "\\n +Strength Bar - Thanh gia tang manh. Thi truong dang trong xu huong giam truoc do. " \r\n\t+"\\n +Neu xuat hien mot thanh gia tang voi khoi luong cao hon."\r\n\t+"\\n +Co muc gia dong cua gan muc cao nhat, bao hieu Cau dang manh tro lai. "\r\n\t+"\\n +Xu huong giam co the som dung lai va dao chieu tang. "\r\n\t+"\\n +La dau hieu cho thay thi truong dang manh hon. ","")+\r\n\r\n                   \r\nWriteIf(effortUp ,"\\n +No luc day Gia TANG. Dau hieu cua Diem Manh. "\r\n                   + "\\n +Mot thanh gia cho thay su no luc day gia tang."\r\n                   +"\\n +Day la dau hieu bat dau cua thi truong con Bo. " \r\n\t               + "\\n +Nhung dau hieu nay thuong duoc nhin thay o dau chu ky tang gia."\r\n\t               + "\\n +Cho thay Smart money dang rat no luc de day gia tang len muc cao nhat","") + \r\n\t                                      \r\nWriteIf(revUpThrust ,"\\n +Thanh Upthrust dao nguoc. Dau hieu cua Diem Manh. ","")+\r\n            \r\n                   \r\n                   \r\n//3.  Dien giai VSA Canh bao dau hieu dao chieu xu huong\r\n\r\n                 \r\nEncodeColor(colorYellow) +\r\n\r\nWriteIf(trendChange,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                                              + "\\n +Trong xu huong tang gia truoc do. Thanh gia hien tai la mot thanh gia giam voi khoi luong cao."\r\n                                              +"\\n +Dau hieu cua Diem Yeu, co the ket thuc qua trinh tang gia","")+\r\n\r\nWriteIf(lowVolTest OR lowVolTest1 OR lowVolTest2 ,"\\n +Test of supply - Tin hieu test Cung thanh cong."\r\n                                                 + "\\n +Thanh gia truoc do cho thay su kiem dinh nguon cung thanh cong khi luc ban co Volume thap . "\r\n                                                 + "\\n +Thanh gia hien tai la mot thanh tang gia voi khoi luong cao. Day la su xac nhan cua Diem Manh","")+\r\n\r\n\r\nWriteIf(buyCond,"\\n +Tin hieu Mua - Thanh gia truoc do da cho thay Suc manh dang quay tro lai."\r\n               + "\\n +Day la thanh gia xac nhan cho Diem Manh. ","")+\r\n\r\nWriteIf(noSupplyBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                    + "\\n +Thanh gia khong co nguon cung - No Supply. Cho biet nguon cung ban ra da can kiet."\r\n                    + "\\n +Smart money dang chuan bi day gia len. Tot nhat nen cho su xac nhan o cac thanh gia tiep theo ","")+\r\n\r\n\r\nWriteIf(stopVolume,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                   + "\\n +Stopping Volume - Khoi luong dung."\r\n                   +"\\n +Trong xu huong giam xuat hien mot thanh giam gia co muc gia dong cua o gan dinh tren, kem khoi luong cao. " \r\n\t               + "\\n +No cho biet Smartmoney dang co gang hap thu nguon cung ban ra. "\r\n\t               +"\\n +Day la dau hieu cho thay nguoi Mua dang quay tro lai. " \r\n\t               + "\\n +Chung ta co the mong doi mot su dao chieu tang gia tro lai. ","")+\r\n\r\n\r\n\r\nWriteIf(noDemandBarUt OR  noDemandBarDt,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +No Demand - Khong co nhu cau. "\r\n                     +"\\n +Thanh gia tang co muc gia dong cua o giua hoac muc thap, khoi luong thap hon 2 thanh gia truoc do"\r\n                     +"\\n +Day la dau hieu cua Diem Yeu tiem nang. " \r\n\t                 + "\\n   - Luu y:  \\n Neu thi truong van con manh, ban se nhin thay dau hieu cua Diem Manh sau do."\r\n\t                 +"\\n +Thuong duoc bieu hien bang viec gia giam voi khoi luong thap"\r\n\t                 +"\\n +Di kem chenh lech gia nho, co muc gia dong cua o phan tren cay nen .","")+\r\n\r\n\r\nWriteIf(topRevBar,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." \r\n                     + "\\n +Tin hieu dao chieu o Dinh xu huong tang (Nen nhan chim). ","")+\r\n              \t \r\n\r\nWriteIf(Fom1 OR tbc3 OR tbc5 ,"\\n   - Chu y: Co tin hieu Dao chieu xu huong." ,"")\r\n                 \r\n\r\n\r\n);\r\n\r\n\r\n}\r\n\r\n\r\n_SECTION_END();\r\n\r\n\r\n//|============================================================================================|\r\n//|                  END TITLE - TIEU DE 2 (Them dien giai VSA)                                    |\r\n//|============================================================================================|\r\nlistnum = 12; // we use watchlist 10 for storing results\r\n// erase the watchlist when we process very first symbol\r\nif ( Status( "stocknum" ) == 0 )\r\n{\r\n// retrieve watchlist members\r\noldlist = CategoryGetSymbols( categoryWatchlist, listnum );\r\n// iterate through the list and remove tickers\r\nfor ( i = 0; ( sym = StrExtract( oldlist, i ) ) != ""; i++ )\r\n{\r\nCategoryRemoveSymbol( sym, categoryWatchlist, listnum );\r\n}\r\n}\r\n// check how many times Filter variable was true in the tested range\r\n// if non-zero value detected, add current symbol to a watchlist\r\nif ( LastValue( Cum( Filter AND Status( "barinrange" ) ) ) )\r\nCategoryAddSymbol( "", categoryWatchlist, listnum );\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\VSA_VPA_5_1_Vietnamese_Full_All_Indicator_in_one_V9_tang_hieu_suat 9.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1073741835</MoreFlags>
			<Min>11.66</Min>
			<Max>27.8104</Max>
		</Pane>
		<Pane>
			<ChartID>1111</ChartID>
			<PercentHeight>18</PercentHeight>
			<Formula>_SECTION_BEGIN("PsychIndex");\r\nLookBack= Param("Number of lookback periods",12, 2, 100);\r\nUThreshold= Param("Upper threshold (%)",75, 0, 100);\r\nLThreshold= Param("Lower threshold (%)", 25,0, 100);\r\nUpDay= Close &gt; Ref(Close,-1);\r\nPsychIndex= 100*Sum(UpDay,LookBack) / LookBack;\r\nPeriods = 10;\r\nx= MA(PsychIndex,Periods);\r\nPlot(PsychIndex,_DEFAULT_NAME(),ParamColor("Color",colorCustom11), ParamStyle("Style",styleLine));\r\nPlot(x,"MA(10)",colorCustom12,styleDashed); \r\nPlot(UThreshold,"75",colorRed,styleDashed|styleNoTitle); \r\nPlot(LThreshold,"25",colorLime,styleDashed|styleNoTitle);\r\n\r\nBuy = Cross(PsychIndex,x);\r\nSell = Cross( x , PsychIndex);\r\nAlertIF( Buy,"SOUND C:WindowsMediaDing.wav", "Audio alert", 2 );\r\n\r\nPlotShapes(IIf(Buy,shapeUpArrow,shapeNone),colorGreen, layer= 0, x);\r\nPlotShapes(IIf(Sell,shapeDownArrow,shapeNone),colorred, layer= 0, x);\r\ndk_kl= V&gt;= 30000;\r\nFilter = Buy AND dk_kl OR Sell AND dk_kl;\r\n\r\nAddColumn( IIf( Buy, 66 , 83 ), "Buy", formatChar, colorWhite, IIf( Buy , colorGreen, colorWhite ) );\r\nAddColumn( IIf( Sell, 83 , 66 ), "Sell", formatChar, colorWhite, IIf( Sell , colorRed, colorWhite ) );\r\nAddColumn(Close,"Entry Price",1.4, colorDefault, IIf( buy, colorGreen, colorRed ));\r\nAddColumn(Volume,"Volume tang 125% th mu xanh",1.0, colorDefault, IIf ((Volume &gt; 1.25 * EMA( Volume, 34 )),ColorRGB(0,128,255),colorYellow));\r\n\r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\DV_AMI_PsychIndex 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>24</Min>
			<Max>77.56</Max>
		</Pane>
		<Pane>
			<ChartID>1112</ChartID>
			<PercentHeight>16</PercentHeight>
			<Formula>_SECTION_BEGIN(" Ulcer Index ");\r\n \r\nlength = Param( "Length", 10, 1, 5000, 1 );\r\ncutoff = Param( "Cut off", 5, 0, 100, 0.1 );\r\n \r\nhcl=hhv(close,length);\r\nr=100.0*((close-hcl)/hcl);\r\nui=sqrt(sum(r^2, length)/length);\r\ncol=IIf(ui&gt;cutoff,colorRed,colorAqua);\r\nPlot( ui, "Ulcer Index ("+length+","+cutoff+") ", col);\r\nPlotgrid(cutoff,colorRed,9, 1);\r\n \r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\DV_AMI_Ulcer Index 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>0.166617</Min>
			<Max>14.7958</Max>
		</Pane>
		<Pane>
			<ChartID>1113</ChartID>
			<PercentHeight>15</PercentHeight>
			<Formula>// Modified by DV\r\n\r\n_SECTION_BEGIN("DV_Smart money");\r\nSetBarsRequired(sbrAll,sbrAll);\r\nBV = IIf( (H==L), 0, V*(C-L)/(H-L) );\r\nSV = IIf( (H==L), 0, V*(H-C)/(H-L) );\r\nPlotOHLC(SV,SV,0,0,"SellVolume",colorRed,styleCandle|styleNoTitle|styleNoLabel );\r\nPlotOHLC(SV,BV+SV,SV,BV+SV,"BuyVolume",colorbrightgreen ,styleCandle|styleNoTitle|styleNoLabel );\r\nPeriods = Param("Periods", 30, 2, 300, 1, 10 );\r\nVa = MA(V,Periods);\r\nPlotOHLC( Va, Va, 0, 0, "", ColorBlend( ColorRGB(0,128,255) , GetChartBkColor(), 0.4 ), styleNoLabel | styleCloud | styleNoRescale, Null, Null, Null, -1 );\r\nPlot(Va,"Average Volume",ColorRGB(0,128,255) ,style = 1+4 );\r\nPlot(V,"",colorWhite, styleNoLine);\r\nVI = V/Va;\r\nBV_P = 100*BV/(BV+SV);\r\nSV_P = 100*SV/(BV+SV);\r\nBV_X = (V &gt;= Va) AND (BV_P &gt; SV_P);\r\nV_status = WriteIf(BV_X,"X", "");\r\nBuy = BV_X;\r\nPrice_percent = ROC (Close,1);\r\nPrice_PercentTxT= NumToStr(Price_percent,1.2)+"%";\r\nPrice_percent5 = ROC (Close,5);\r\nPrice_percent10 = ROC (Close,10);\r\nPrice_PercentTxT5= NumToStr(Price_percent5,1.2)+"%";\r\nPrice_PercentTxT10= NumToStr(Price_percent10,1.2)+"%";\r\nAlertIf( Buy ,"SOUND C:\\\\Windows\\\\Media\\\\Ring08.wav", "Audio alert", 1 ); \r\nFilter =  1;\r\nAddColumn(Close,"Gia",1.2, colorDefault);\r\nAddTextColumn(Price_PercentTxT,"Tang/Giam T0 voi T1", 1.2,colorDefault, IIf(Price_percent &gt; 0 , colorLime, IIf (Price_percent == 0, colorDefault, colorRed)));\r\nAddTextColumn(Price_PercentTxT5,"Tang/Giam T0 voi T5", 1.2,colorDefault, IIf(Price_percent5 &gt; 0 , colorLime, IIf (Price_percent5 == 0, colorDefault, colorRed)));\r\nAddTextColumn(Price_PercentTxT10,"Tang/Giam T0 voi T10", 1.2,colorDefault, IIf(Price_percent10 &gt; 0 , colorLime, IIf (Price_percent10 == 0, colorDefault, colorRed)));\r\nAddColumn(Volume,"Volume T0",1.0, colorDefault);\r\nAddTextColumn(V_status,"Vol T0 vuot Tr/b 30 ngy",1.0,colorDefault, bkcolor = IIf( Buy, 34, 55 )); \r\nAddTextColumn(FullName(),"Name");\r\nTitle =  "Volume: "+WriteVal(V,1.2) +  EncodeColor(ColorRGB(0,128,255)) + ";  Vol Tr/b " + Periods+ " ngay: " + WriteVal(Va,1.2) + \r\n         "\\n" + EncodeColor(colorLime) + "BuyVolume: "+WriteVal(BV_P,2.0)+"%" + WriteIf(BV_P &gt; SV_P , EncodeColor(colorCustom12) + " - KL Mua chu dong lon hon ", " ")\r\n                                                                              + WriteIf(V &gt;= Va , EncodeColor(colorGold) + " - Vol vuot Tr/b " + Periods + " ngy ", " ") +\r\n         "\\n" + EncodeColor(colorRed) + "SellVolume: "+WriteVal(SV_P,2.0)+"%" ; \r\n_SECTION_END();\r\n</Formula>
			<FilePath>Formulas\\Drag-drop\\DV_AMI_Volume Buy &amp; Sell 2.afl</FilePath>
			<Flags>256</Flags>
			<MoreFlags>1342177281</MoreFlags>
			<Min>-549394</Min>
			<Max>2.88761e+007</Max>
		</Pane>
	</Sheet>
</Window>
