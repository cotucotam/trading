<?xml version="1.0" encoding="ISO-8859-1"?>
<AmiBroker-Analysis CompactMode="0">
<General>
<FormatVersion>1</FormatVersion>
<Symbol>OCB</Symbol>
<FormulaPath>Formulas\\Indicators\\suutam\\Pivots and Fibonacci vung mua.afl</FormulaPath>
<FormulaContent>//Bo Code xac dinh diem dinh day bang Pivot sau do ve cac duong Fibo theo dinh day Pivot\r\n//Tai khoan ung ho : Nguyen Xuan Lam - Tel 0911.222537\r\n// Ngan hang Nong nghiep va phat trien nong thon : 2000206083140\r\n\r\n_SECTION_BEGIN("Price");\r\nSetChartOptions(0,chartShowArrows|chartShowDates);\r\n_N(Title = StrFormat("{{NAME}} - {{INTERVAL}} {{DATE}} Open %g, Hi %g, Lo %g, Close %g (%.1f%%) Vol " +WriteVal( V, 1.0 ) +" {{VALUES}}", O, H, L, C, SelectedValue( ROC( C, 1 )) ));\r\nPlot( C, "Close", ParamColor("Color", colorDefault ), styleNoTitle | ParamStyle("Style") | GetPriceStyle() ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 15, 2, 200, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Mid MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 45, 2, 300, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Long MA");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 100, 2, 400, 1 );\r\nPlot( MA( P, Periods ), _DEFAULT_NAME(), ParamColor( "Color", colorCycle ), ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale ); \r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("BBands");\r\nP = ParamField("Price field",-1);\r\nPeriods = Param("Periods", 15, 2, 100, 1 );\r\nWidth = Param("Width", 2, 0, 10, 0.05 );\r\nColor = ParamColor("Color", colorLightGrey );\r\nColor = ColorBlend( Color,  GetChartBkColor(), 0.5 );\r\nStyle = ParamStyle("Style", styleLine | styleNoLabel ) | styleNoRescale;;\r\nPlot( bbt = BBandTop( P, Periods, Width ), "BBTop" + _PARAM_VALUES(), Color, Style ); \r\nPlot( bbb = BBandBot( P, Periods, Width ), "BBBot" + _PARAM_VALUES(), Color, Style ); \r\nPlotOHLC( bbt, bbt, bbb, bbb, "", ColorBlend( Color, GetChartBkColor(), 0.7 ), styleNoLabel | styleCloud | styleNoRescale, Null, Null, Null, -1 );\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Volume");\r\nColor = ParamColor("Color", ColorRGB( 128, 128, 192 ) );\r\nPlot( Volume, _DEFAULT_NAME(), ColorBlend( Color, GetChartBkColor(), 0.5  ), styleNoTitle | ParamStyle( "Style", styleHistogram | styleOwnScale | styleThick | styleNoLabel, maskHistogram  ), 2 );\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Price Interpretation");\r\nmovshort = ParamField("Short Time MA", 8 );\r\nmovmed = ParamField("Mid Time MA", 9 );\r\nmovlong = ParamField("Long Time MA", 10 );\r\nbtop = ParamField("BBTop", 11 );\r\nbbot = ParamField("BBBottom", 12 );\r\nif( Status("action") == actionCommentary )\r\n{\r\nwidth = btop - bbot;\r\nlslop = LinRegSlope( C, 30 ) + 100;\r\nlslo = LLV( lslop, 90 );\r\nlshi = HHV( lslop, 90 );\r\nlswidth = lshi - lslo;\r\ntrend = 100*( lslop - lslo )/lswidth;\r\n\r\nmawidth = MA( width, 100 );\r\nrelwidth = 100*(width - mawidth)/mawidth;\r\n\r\n_N( tname = Name()+"("+FullName()+")" );\r\n\r\nprintf("Price and moving averages:\\n");\r\nprintf( "%s", tname + " has closed " + WriteIf( C &gt; movshort, "above" , "below" ) + " its Short time moving average. ");\r\n\r\nprintf( "%s", "\\nShort time moving average is currently " + WriteIf( movshort &gt; movmed, "above", "below") + " mid-time, AND " + WriteIf( movshort &gt; movlong, "above", "below" ) + " long time moving averages.");\r\n\r\nprintf( "%s", "\\nThe relationship between price and moving averages is: "+\r\nWriteIf( C &gt; movshort AND movshort &gt; movmed, "bullish",\r\nWriteIf( C &lt; movshort AND movshort &lt; movmed, "bearish", "neutral" ) ) + " in short-term, and "+\r\nWriteIf( movshort &gt; movmed AND movmed &gt; movlong , "bullish",\r\nWriteIf( movshort &lt; movmed AND movmed &lt; movlong, "bearish", "neutral" ) ) + " in mid-long term. ");\r\n\r\nprintf("\\n\\nBollinger Bands:\\n");\r\nprintf("%s", tname+ " has closed " + \r\nWriteIf( C &lt; bbot, "below the lower band by " +\r\nWriteVal( 100 *( bbot-C )/ width, 1.1 ) + "%. " +\r\nWriteIf( trend &lt; 30, " This combined with the steep downtrend can suggest that the downward trend in prices has a good chance of continuing.  However, a short-term pull-back inside the bands is likely.",\r\nWriteIf( trend &gt; 30 AND trend &lt; 70, "Although prices have broken the lower band and a downside breakout is possible, the most likely scenario for "+tname+" is to continue within current trading range.", "" ) ), "" ) +\r\n\r\nWriteIf( C &gt; btop, "above the upper band by " +\r\nWriteVal( 100 *( C- btop )/ width, 1.1 ) + "%. " +\r\nWriteIf( trend &gt; 70, " This combined with the steep uptrend suggests that the upward trend in prices has a good chance of continuing.  However, a short-term pull-back inside the bands is likely.",\r\nWriteIf( trend &gt; 30 AND trend &lt; 70, "Although prices have broken the upper band and a upside breakout is possible, the most likely scenario for "+tname+" is to continue within current trading range.", "" ) ), "" ) +\r\n\r\nWriteIf( C &lt; btop AND ( ( btop - C ) / width ) &lt; 0.5, \r\n"below upper band by " +\r\nWriteVal( 100 *( btop - C )/ width, 1.1 ) + "%. ", \r\nWriteIf( C &lt; btop AND C &gt; bbot , "above bottom band by " +\r\nWriteVal( 100 *( C - bbot )/ width, 1.1 ) + "%. ", "" ) ));\r\n\r\nprintf("%s", "\\n"+\r\nWriteIf( ( trend &gt; 30 AND trend &lt; 70 AND ( C &gt; btop OR C &lt; bbot ) ) AND abs(relwidth) &gt; 40,\r\n\t\t "This picture becomes somewhat unclear due to the fact that Bollinger Bands are  currently",\r\n\t\t "Bollinger Bands are " )+\t  \r\nWriteVal( abs( relwidth ), 1.1 ) + "% " +\r\nWriteIf( relwidth &gt; 0, "wider" , "narrower" ) +\r\n" than normal.");\r\n\r\nprintf("\\n");\r\n\r\nprintf("%s",\r\nWriteIf( abs( relwidth ) &lt; 40, "The current width of the bands (alone) does not suggest anything conclusive about the future volatility or movement of prices.","")+\r\nWriteIf( relwidth &lt; -40, "The narrow width of the bands suggests low volatility as compared to " + tname + "'s normal range.  Therefore, the probability of volatility increasing with a sharp price move has increased for the near-term. "+\r\n"The bands have been in this narrow range for " + WriteVal(BarsSince(Cross(-40,relwidth)),1.0) + " bars. The probability of a significant price move increases the longer the bands remain in this narrow range." ,"")+\r\nWriteIf( relwidth &gt; 40, "The large width of the bands suggest high volatility as compared to " + tname + "'s normal range.  Therefore, the probability of volatility decreasing and prices entering (or remaining in) a trading range has increased for the near-term. "+\r\n"The bands have been in this wide range for  " + WriteVal(BarsSince(Cross(relwidth,40)),1.0) + " bars.The probability of prices consolidating into a less volatile trading range increases the longer the bands remain in this wide range." ,""));\r\n\r\nprintf("\\n\\nThis commentary is not a recommendation to buy or sell. Use at your own risk.");\r\n}\r\n_SECTION_END();\r\n\r\n_SECTION_BEGIN("Realtime"); //Tach gio phut giay hien tai\r\nRealtimeClock = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(4)));\r\nGioHientai = ValueWhen(LastValue(V)&gt;0 , LastValue( int(RealtimeClock/10000)));\r\nPhutHienTai = ValueWhen(LastValue(V)&gt;0 , LastValue( int((RealtimeClock - GioHientai*10000)/100)));\r\nGiayHienTai = ValueWhen(LastValue(V)&gt;0 , LastValue( RealtimeClock - (GioHientai*10000 + PhutHienTai*100)));\r\nRealtime  = LastValue( GioHientai*60 + PhutHienTai);//So phut da dien ra trong ngay\r\nNgayhientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(6)));\r\nThanghientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(7)));\r\nNamhientai = ValueWhen(LastValue(V)&gt;0 , LastValue( Now(8)));\r\n_SECTION_END();\r\nSetForeign("VNINDEX");//Ham Lam viec truc tiep voi 1 ma nhat dinh, o day la Vnindex\r\ntestTimeVningay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeVnithang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeVninam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichVni = (testTimeVninam*100 + testTimeVnithang)*100 + testTimeVningay;\r\nDieukienThoiGian = IIf(testTimeVningay == Ngayhientai AND testTimeVnithang == Thanghientai AND testTimeVninam == Namhientai,2,-2);\r\nstartTimeVni1 = 9*60; // Th?i gian b?t d?u giao d?ch (9:00 AM)\r\nendTimeVni1 = 11*60 +30; // Th?i gian k?t thúc giao d?ch (11:30 PM)\r\nstartTimeVni2 = 13*60; // Th?i gian b?t d?u giao d?ch (13:00 PM)\r\nendTimeVni2 = 14*60+45; // Th?i gian k?t thúc giao d?ch (14:45 PM)\r\nPhienSangVni = (endTimeVni1 - startTimeVni1);\r\nPhienChieuVni = (endTimeVni2 - startTimeVni2);\r\nFulltimeVni = (endTimeVni1 - startTimeVni1) + (endTimeVni2 - startTimeVni2);\r\nInTimeVni  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeVni1 AND Realtime &lt;= endTimeVni1,Realtime -startTimeVni1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeVni1 AND Realtime &lt; startTimeVni2,PhienSangVni,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeVni2 AND Realtime&lt;= endTimeVni2,PhienSangVni + (Realtime - startTimeVni2),FulltimeVni)));\t\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\nSetForeign("HNXINDEX");\r\ntestTimeHNXngay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeHNXthang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeHNXnam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichHNX = (testTimeHNXnam*100 + testTimeHNXthang)*100 + testTimeHNXngay;\r\nstartTimeHNX1 = 9*60; \r\nendTimeHNX1 = 11*60 +30;\r\nstartTimeHNX2 = 13*60; \r\nendTimeHNX2 = 15*60;\r\nPhienSangHNX = (endTimeHNX1 - startTimeHNX1);\r\nPhienChieuHNX = (endTimeHNX2 - startTimeHNX2);\r\nFulltimeHNX = (endTimeHNX1 - startTimeHNX1) + (endTimeHNX2 - startTimeHNX2);\r\nInTimeHNX  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeHNX1 AND Realtime &lt;= endTimeHNX1,Realtime -startTimeHNX1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeHNX1 AND Realtime &lt; startTimeHNX2,PhienSangHNX,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeHNX2 AND Realtime&lt;= endTimeHNX2,PhienSangHNX + (Realtime - startTimeHNX2),FulltimeHNX)));\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\nSetForeign("UPINDEX");\r\ntestTimeUpcomngay =ValueWhen(LastValue(V)&gt;0 , LastValue(Day()));\r\ntestTimeUpcomthang =ValueWhen(LastValue(V)&gt;0 , LastValue(Month()));\r\ntestTimeUpcomnam =ValueWhen(LastValue(V)&gt;0 , LastValue(Year()));\r\nTongthoigianGiaodichUpcom = (testTimeUpcomnam*100 + testTimeUpcomthang)*100 + testTimeUpcomngay;\r\nstartTimeUpcom1 = 9*60; \r\nendTimeUpcom1 = 11*60 +30;\r\nstartTimeUpcom2 = 13*60; \r\nendTimeUpcom2 = 15*60;\r\nPhienSangUpcom = (endTimeUpcom1 - startTimeUpcom1);\r\nPhienChieuUpcom = (endTimeUpcom2 - startTimeUpcom2);\r\nFulltimeUpcom = (endTimeUpcom1 - startTimeUpcom1) + (endTimeUpcom2 - startTimeUpcom2);\r\nInTimeUpcom  = IIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND  Realtime&gt;= startTimeUpcom1 AND Realtime &lt;= endTimeUpcom1,Realtime -startTimeUpcom1,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt; endTimeUpcom1 AND Realtime &lt; startTimeUpcom2,PhienSangUpcom,\r\n\t\t\t\tIIf(DieukienThoiGian==2 AND LastValue(V)&gt;0 AND Realtime &gt;= startTimeUpcom2 AND Realtime&lt;= endTimeUpcom2,PhienSangUpcom + (Realtime - startTimeUpcom2),FulltimeUpcom)));\t\r\nRestorePriceArrays();//tra lai lam viec chung cho toan thi truong \r\n////////////Lay time cua ma tren san GD hien tai \r\nLaySGD = MarketID( 1 );\r\nSanHNX = "HNXINDEX";\r\nSanUpcom = "UPINDEX";\r\nSanHSX = "VNINDEX";\r\ntestSan1 = WriteIf(LaySGD == "HSX","VNINDEX","");\r\ntestSan2 = WriteIf(LaySGD == "HNX","HNXINDEX","");\r\ntestSan3 = WriteIf(LaySGD == "UPCOM","UPINDEX","");\r\ntestSan = testSan1 + testSan2 + testSan3;\r\nInTime =  IIf(LaySGD == "HSX",InTimeVni, IIf(LaySGD == "HNX",InTimeHNX,InTimeUpcom));\r\nOutTime = IIf(LaySGD == "HSX",FulltimeVni, IIf(LaySGD == "HNX",FulltimeHNX,FulltimeUpcom));\r\nMorningTime = IIf(LaySGD == "HSX",PhienSangVni, IIf(LaySGD == "HNX",PhienSangHNX,PhienSangUpcom));\r\nTongthoigianGiaodich3San =  IIf(LaySGD == "HSX",TongthoigianGiaodichVni, IIf(LaySGD == "HNX",TongthoigianGiaodichHNX,TongthoigianGiaodichUpcom));\r\n////////////////////////////////////////////////////////////////////////\r\n///////////////////////////DanhGiaVol\r\n_SECTION_BEGIN("Danh Gia Vol");\r\nVolcuaPhut = IIf(InTime &lt; OutTime ,Volume/InTime,Volume/OutTime);\r\n_SECTION_END();\r\n_SECTION_BEGIN("Danh Gia OBV");\r\nOBVcuaPhut = IIf(InTime &lt; OutTime ,OBV()/InTime,OBV()/OutTime);\r\n_SECTION_END();\r\nHesoRank = 14;\r\nSetOption( "Nodefaultcolumns", True ); \r\nAddTextColumn( Name(), "Ma CK",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault))); // Ten\r\nAddTextColumn( FullName(), "Ten Cty"); //Ful ten\r\nAddTextColumn( MarketID( 1 ), "San GD");\r\nAddTextColumn( IndustryID( 1 ), "Nganh nghe" );// Nganh nghe\r\nchuyenngay1 = NumToStr( Datetime(), formatDateTime );// chuyen ngay qua chuoi\r\ncutngay1 = StrTrim( chuyenngay1, " 00:00:00" ); // cut gio phut giay\r\nAddTextColumn(cutngay1 , "Date",  colorDefault, colorDefault);\r\nRankingCl = RSIa(C,HesoRank) ;\r\nWarnaText = colorBlack ;\r\nWarnaBackGround = ColorHSB(RankingCl, 255, 255);\r\nRankingTD = PercentRank (( ( C - Ref ( C ,-1 )) / Ref ( C ,-1 ) ) * 100, HesoRank) ;\r\nAddColumn (Close, "Gia", 1.2, IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)), WarnaBackGround, -1, RankingCL) ;\r\n//AddColumn(Close,"Gia",1.2,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)));\r\nAddColumn( ( ( C - Ref ( C ,-1 )) / Ref ( C ,-1 ) ) * 100 , " % Change " , 1.2 ,IIf(Close&gt;Ref(Close,-1), colorGreen, IIf(Close&lt;Ref(Close,-1), colorRed, colorDefault)));\r\nRankingVol = RSIa( VolcuaPhut,HesoRank);\r\nWarnaBackGroundVol = ColorHSB(RankingVol , 255, 255);\r\nVolCo = IIf(VolcuaPhut &gt; Ref(VolcuaPhut,-1), colorGreen, IIf(VolcuaPhut &lt; Ref(VolcuaPhut,-1),colorRed,colorDefault));\r\nAddColumn (Volume, "Volume", 1, VolCo, WarnaBackGroundVol, -1, RankingVol) ;\r\nRankingGTGD = RSIa(VolcuaPhut*Avg, HesoRank) ;\r\nWarnaBackGroundGTGD = ColorHSB(RankingGTGD, 255, 255);\r\nGTGDCo = IIf(VolcuaPhut*Avg &gt; Ref(VolcuaPhut*Avg,-1), colorGreen, IIf(VolcuaPhut*Avg &lt; Ref(VolcuaPhut*Avg,-1),colorRed,colorDefault));\r\nAddColumn (Volume*Avg, "GTGD", 1, GTGDCo, WarnaBackGroundGTGD, -1, RankingGTGD) ;\r\nRSICo = IIf(RankingCl &gt; Ref(RankingCl,-1), colorGreen, IIf(RankingCl &lt; Ref(RankingCl,-1),colorRed,colorDefault));\r\nAddColumn (RankingCl, "RSI14", 1.2, RSICo, WarnaBackGround, -1,RankingCl) ;\r\n//RSIVolCo = IIf(RankingVol &gt; Ref(RankingVol,-1), colorGreen, IIf(RankingVol &lt; Ref(RankingVol,-1),colorRed,colorDefault));\r\n//AddColumn (RankingVol, "RSIVol", 1.2, RSIVolCo, WarnaBackGroundVol, -1,RankingVol) ;\r\n//RSIGTGDCo = IIf(RankingGTGD &gt; Ref(RankingGTGD,-1), colorGreen, IIf(RankingGTGD &lt; Ref(RankingGTGD,-1),colorRed,colorDefault));\r\n//AddColumn (RankingGTGD, "RSIGTGD", 1.2, RSIGTGDCo, WarnaBackGroundGTGD, -1,RankingGTGD) ;\r\n//Tonghop =  (RankingCl + RankingVol + RankingGTGD )/3;\r\n//WarnaBackGroundTH = ColorHSB(Tonghop , 255, 255);\r\n//TangGiam = Tonghop - Ref(Tonghop,-1);\r\n//Rankingtangiam = PercentRank (TangGiam, HesoRank) ;\r\n//WarnaBackGroundTG = ColorHSB(Rankingtangiam * 64/100, 255, 255);\r\n//TangGiamRSI = RankingCl - Ref(RankingCl,-1);\r\n//AddColumn(TangGiamRSI,"RSI+/-",1.2,IIf(TangGiamRSI &gt; 0, colorGreen, IIf(TangGiamRSI &lt; 0, colorRed, colorDefault)));\r\n//TangGiamVol = RankingVol - Ref(RankingVol,-1);\r\n//AddColumn(TangGiamVol,"Vol+/-",1.2,IIf(TangGiamVol &gt; 0, colorGreen, IIf(TangGiamVol &lt; 0, colorRed, colorDefault)));\r\n//tanggiamGTGD = \tRankingGTGD - Ref(\tRankingGTGD,-1);\t\r\n//AddColumn(tanggiamGTGD,"GTGD+/-",1.2,IIf(tanggiamGTGD &gt; 0, colorGreen, IIf(tanggiamGTGD &lt; 0, colorRed, colorDefault)));\r\n//diemTH = \t (TangGiamRSI +  TangGiamVol + tanggiamGTGD)/3;\r\n//AddColumn(diemTH,"TH Tang giam",1.2,IIf(diemTH &gt; 0, colorGreen, IIf(diemTH &lt; 0, colorRed, colorDefault)));\r\nSetSortColumns(-8);\r\n//AddRankColumn(); \r\ndieukienbb = IIf(Ref(MA(V,20),-1)&gt;=200000  ,2,-2);// Dieu kien de loai bien cac ma xau, thanh khoan kem, ma mat thanh khoan, thanh khoan khong on dinh\r\ntestTime2023ngay =ValueWhen(V&gt;0 , LastValue(Day()));\r\ntestTime2023thang =ValueWhen(V&gt;0 , LastValue(Month()));\r\ntestTime2023nam =ValueWhen(V&gt;0 , LastValue(Year()));\r\nTongthoigianHienTai = (Namhientai*100+Thanghientai)*100+Ngayhientai;\r\nTongthoigianGiaodich = (testTime2023nam*100 + testTime2023thang)*100 + testTime2023ngay;\r\nDoiCHieuVni = TongthoigianHienTai - TongthoigianGiaodich3San;\r\nDoichieuTructiep = TongthoigianHienTai - TongthoigianGiaodich;\r\nDieukienthoigianvanhanh = IIf( DoiCHieuVni == DoichieuTructiep AND DoichieuTructiep&lt;= 75,2,-2);\r\n//Filter = MA(C,20) &gt;=3  AND dieukienbb&gt;=2  AND Dieukienthoigianvanhanh&gt;=2 ;\r\n/////////////Xac dinh pivots\r\n\r\n_SECTION_BEGIN("Pivot Finder");\r\nfarback=Param("How Far back to go",100,50,5000,10);\r\nnBars = Param("Number of bars", 12, 5, 40);\r\n"BIdxJJJ = " + BarIndex() + \r\n"\\n" + "OGGGGGGGGGGG = " + O + "\\n"+"H = "+ H + "\\n"+"L = " + L \r\n+ "\\n"+"C " ; \r\nGraphXSpace=7;\r\n// -- Create 0-initialized arrays the size of barcount\r\naHPivs = H - H;\r\naLPivs = L - L;\r\n// -- More for future use, not necessary for basic plotting\r\naHPivHighs = H - H;\r\naLPivLows = L - L;\r\naHPivIdxs = H - H;\r\naLPivIdxs = L - L;\r\nnHPivs = 0;\r\nnLPivs = 0;\r\nlastHPIdx = 0;\r\nlastLPIdx = 0;\r\nlastHPH = 0;\r\nlastLPL = 0;\r\ncurPivBarIdx = 0;\r\naHHVBars = HHVBars(H, nBars);\r\naLLVBars = LLVBars(L, nBars);\r\naHHV = HHV(H, nBars);\r\naLLV = LLV(L, nBars);\r\naVisBars = Status("barvisible");\r\nnLastVisBar = LastValue(Highest(IIf(aVisBars, BarIndex(), 0)));\r\n_TRACE("Last visible bar: " + nLastVisBar);\r\ncurBar = (BarCount-1);\r\ncurTrend = "";\r\nif (aLLVBars[curBar] &lt; \r\naHHVBars[curBar]) {\r\ncurTrend = "D";\r\n}\r\nelse {\r\ncurTrend = "U";\r\n}\r\nif (BarCount &gt; farback)\r\n{\r\nfor (i=0; i&lt;farback; i++) {\r\ncurBar = (BarCount - 1) - i;\r\nif (aLLVBars[curBar] &lt; aHHVBars[curBar]) {\r\nif (curTrend == "U") {\r\ncurTrend = "D";\r\ncurPivBarIdx = curBar - aLLVBars[curBar];\r\naLPivs[curPivBarIdx] = 1;\r\naLPivLows[nLPivs] = L[curPivBarIdx];\r\naLPivIdxs[nLPivs] = curPivBarIdx;\r\nnLPivs++;\r\n}\r\n} else {\r\nif (curTrend == "D") {\r\ncurTrend = "U";\r\ncurPivBarIdx = curBar - aHHVBars[curBar];\r\naHPivs[curPivBarIdx] = 1;\r\naHPivHighs[nHPivs] = H[curPivBarIdx];\r\naHPivIdxs[nHPivs] = curPivBarIdx;\r\nnHPivs++;\r\n}\r\n} \r\n} \r\n}\r\ncurBar = (BarCount-1);\r\ncandIdx = 0;\r\ncandPrc = 0;\r\nlastLPIdx = aLPivIdxs[0];\r\nlastLPL = aLPivLows[0];\r\nlastHPIdx = aHPivIdxs[0];\r\nlastHPH = aHPivHighs[0];\r\nif (lastLPIdx &gt; lastHPIdx) {\r\ncandIdx = curBar - aHHVBars[curBar];\r\ncandPrc = aHHV[curBar]; \r\nif (\r\nlastHPH &lt; candPrc AND\r\ncandIdx &gt; lastLPIdx AND\r\ncandIdx &lt; curBar) {\r\naHPivs[candIdx] = 1;\r\nfor (j=0; j&lt;nHPivs; j++) {\r\naHPivHighs[nHPivs-j] = aHPivHighs[nHPivs-\r\n(j+1)];\r\naHPivIdxs[nHPivs-j] = aHPivIdxs[nHPivs-(j+1)];\r\n}\r\naHPivHighs[0] = candPrc ;\r\naHPivIdxs[0] = candIdx;\r\nnHPivs++;\r\n} \r\n} else {\r\ncandIdx = curBar - aLLVBars[curBar];\r\ncandPrc = aLLV[curBar]; \r\nif (\r\nlastLPL &gt; candPrc AND\r\ncandIdx &gt; lastHPIdx AND\r\ncandIdx &lt; curBar) {\r\naLPivs[candIdx] = 1;\r\nfor (j=0; j&lt;nLPivs; j++) {\r\naLPivLows[nLPivs-j] = aLPivLows[nLPivs-(j+1)];\r\naLPivIdxs[nLPivs-j] = aLPivIdxs[nLPivs-(j+1)];\r\n}\r\naLPivLows[0] = candPrc;\r\naLPivIdxs[0] = candIdx;\r\nnLPivs++;\r\n}\r\n}\r\nBuyPivot = aLPivs==1;\r\nSellPivot = aHPivs==1;\r\nLowPivot = ValueWhen(BuyPivot , L);\r\nHighPivot =ValueWhen(SellPivot,H);\r\n\r\nTangPivot= Prec( ( ( HighPivot - LowPivot) / LowPivot ) * 100,2);//lam tron so \r\nGiamPivot= Prec( ( ( LowPivot - HighPivot) / HighPivot ) * 100,2);//lam tron so \r\n\r\ndemTUpPivot = BarsSince(BuyPivot)+1;\r\ndemTDowPivot = BarsSince(SellPivot)+1;\r\nTrendPivot = IIf(demTUpPivot &lt; demTDowPivot,demTUpPivot,demTDowPivot*-1);\r\nAddColumn(TrendPivot,"Trend Pivot",1,IIf(TrendPivot&gt;=1,colorGreen,colorRed) );\r\nSogiatang = Prec( ( ( C - LowPivot) / LowPivot ) * 100,2);\r\nSogiagiam = Prec( ( ( C - HighPivot) / HighPivot ) * 100,2);\r\nTanggiamPivot = IIf(TrendPivot &gt;=1,Sogiatang,Sogiagiam);\r\nAddColumn( TanggiamPivot , "% / Pivot" , 1.2 ,IIf(TanggiamPivot&gt; Ref(TanggiamPivot,-1), colorGreen, IIf(TanggiamPivot&lt;Ref(TanggiamPivot,-1), colorRed, colorDefault)));\r\nHsPivot = TanggiamPivot - Ref(TanggiamPivot,-1);\r\nAddColumn( HsPivot , "+/-% Pivot" , 1.2 ,IIf(HsPivot&gt;0, colorGreen, IIf(HsPivot&lt;0, colorRed, colorDefault)));\r\n\r\nPlotShapes(IIf(aHPivs==1,shapeDownArrow, shapeNone), colorRed, 0,High, Offset=-15);\r\nPlotShapes(IIf(aLPivs==1,shapeUpArrow , shapeNone), ColorRGB(168,255,0), 0, Low, Offset=-15);\r\ndist = 0.5 * ATR( 15 );\r\nfor ( i=BarCount-1; i &gt; 0; i-- )\r\n{\r\n     if ( BuyPivot[i] )\r\n        PlotText( "LowPivot: " + LowPivot[ i ]+"\\n"+ ""+GiamPivot[ i ]+"%", i, L[ i ] - dist[i],colorRose);\r\n     if ( SellPivot[i] )\r\n        PlotText( "HighPivot: " + HighPivot[ i ]+"\\n"+ ""+TangPivot[ i ]+"%", i, H[ i ] + dist[i],colorBrightGreen);    \r\n}\r\n\r\n_SECTION_END();\r\n//Xac dinh cac 3 diem Fibo (2 day 1 dinh hoac 2 dinh 1 day)\r\nDiem2 = IIf(TrendPivot &gt; 0 ,LowPivot,HighPivot); //diem gan nhat 0% fibo\r\nDiem1 = IIf(TrendPivot &gt; 0 ,HighPivot,LowPivot); //diem xa nhat 100% fibo\r\nNguongPivot =  abs(( ( Diem2 - Diem1) / Diem2 ) * 100);\r\ndonviFibo = (Diem1 - Diem2)/100;\r\nNguongPivotFibo = NguongPivot / 100;\r\nFiboCl = IIf(TrendPivot &gt; 0 ,(C  - Diem2)/donviFibo,(C  - Diem2)/donviFibo*-1) ; \r\nFiboHi = IIf(TrendPivot &gt; 0 ,(H  - Diem2)/donviFibo,(H  - Diem2)/donviFibo*-1) ; \r\nFiboLo = IIf(TrendPivot &gt; 0 ,(L  - Diem2)/donviFibo,(L  - Diem2)/donviFibo*-1) ; \r\nFiboAVG = IIf(TrendPivot &gt; 0 ,((H+L+C)/3  - Diem2)/donviFibo,((H+L+C)/3  - Diem2)/donviFibo*-1) ; \r\nFiboOp = IIf(TrendPivot &gt; 0 ,(O  - Diem2)/donviFibo,(O  - Diem2)/donviFibo*-1) ; \r\n\r\nAddColumn( FiboCl , "% / Fibo" , 1 , IIf(FiboCl&gt; Ref(FiboCl,-1), colorGreen, IIf(FiboCl &lt; Ref(FiboCl,-1), colorRed, colorDefault)));\r\nHSFibo = FiboCl - Ref(FiboCl,-1);\r\nAddColumn( HSFibo , "+/-% Fibo" , 1 , IIf(HSFibo&gt; 0, colorGreen, IIf(HSFibo &lt; 0, colorRed, colorDefault)));\r\n//AddColumn( NguongPivotFibo , "%Pivot/1Fibo" , 1.2 ,colorDefault);\r\n//AddColumn( ValueWhen(BuyPivot , -2) , "Diem 3" , 1.2 , colorDefault);\r\n//Cac muc Fibo am : -161.8 -127.2 -100 -78.6 -61.8 -50 -38.2 -23.6 0\r\n//Cac muc Fibo duong : 0 23.6 38.2 50 61.8 78.6 100 127.2 161.8\r\n// canh bao tang 2 nen \r\nKCfibo = (FiboCl -  Ref(FiboCl,-1)) + (FiboAVG - Ref(FiboAVG,-1));\r\nCanhbao1bs = WriteIf((FiboCl &gt;  -200 AND Ref( FiboCl,-1) &lt;= -200) OR  (FiboCl &gt;  -200 AND FiboAVG &gt; -200 AND FiboLo &lt;= -200 AND KCfibo &gt;0),"-200% ","");  \r\nCanhbao1 = WriteIf((FiboCl &gt;  -161.8 AND Ref( FiboCl,-1) &lt;= -161.8) OR  (FiboCl &gt;  -161.8 AND FiboAVG &gt; -161.8 AND FiboLo &lt;= -161.8 AND KCfibo &gt;0),"-161.8% ","");\r\nCanhbao2 = WriteIf((FiboCl &gt;  -127.2 AND Ref( FiboCl,-1) &lt;= -127.2) OR (FiboCl &gt;  -127.2 AND FiboAVG &gt; -127.2  AND FiboLo &lt;= -127.2 AND KCfibo &gt;0),"-127.2% ","");\r\nCanhbao3 = WriteIf((FiboCl &gt;  -100 AND Ref( FiboCl,-1) &lt;= -100) OR (FiboCl &gt;  -100 AND FiboAVG &gt; -100  AND FiboLo &lt;= -100 AND KCfibo &gt;0),"-100% ","");\r\nCanhbao4 = WriteIf((FiboCl &gt;  -78.6 AND Ref( FiboCl,-1) &lt;= -78.6) OR (FiboCl &gt;  -78.6 AND FiboAVG &gt; -78.6  AND FiboLo &lt;= -78.6 AND KCfibo &gt;0) ,"-78.6% ","");\r\nCanhbao5 = WriteIf((FiboCl &gt;  -61.8 AND Ref( FiboCl,-1) &lt;= -61.8) OR (FiboCl &gt;  -61.8 AND FiboAVG &gt; -61.8  AND FiboLo &lt;= -61.8 AND KCfibo &gt;0),"-61.8% ","");\r\nCanhbao6 = WriteIf((FiboCl &gt;  -50 AND Ref( FiboCl,-1) &lt;= -50) OR (FiboCl &gt;  -50 AND FiboAVG &gt; -50  AND FiboLo &lt;= -50 AND KCfibo &gt;0),"-50% ","");\r\nCanhbao7 = WriteIf((FiboCl &gt;  -38.2 AND Ref( FiboCl,-1) &lt;= -38.2) OR (FiboCl &gt;  -38.2 AND FiboAVG &gt; -38.2  AND FiboLo &lt;= -38.2 AND KCfibo &gt;0),"-38.2% ","");\r\nCanhbao8 = WriteIf((FiboCl &gt;  -23.6 AND Ref( FiboCl,-1) &lt;= -23.6) OR (FiboCl &gt;  -23.6 AND FiboAVG &gt; -23.6  AND FiboLo &lt;= -23.6 AND KCfibo &gt;0),"-23.6% ","");\r\nCanhbao9 = WriteIf((FiboCl &gt;  0 AND Ref( FiboCl,-1) &lt;= 0) OR (FiboCl &gt;  0 AND FiboAVG &gt; 0  AND FiboLo &lt;= 0 AND KCfibo &gt;0),"0% ","");\r\nCanhbao10 = WriteIf((FiboCl &gt;  23.6 AND Ref( FiboCl,-1) &lt;= 23.6) OR (FiboCl &gt;  23.6 AND FiboAVG &gt; 23.6  AND FiboLo &lt;= 23.6 AND KCfibo &gt;0),"23.6% ","");\r\nCanhbao11 = WriteIf((FiboCl &gt;  38.2 AND Ref( FiboCl,-1) &lt;= 38.2) OR (FiboCl &gt;  38.2 AND FiboAVG &gt; 38.2  AND FiboLo &lt;= 38.2 AND KCfibo &gt;0),"38.2% ","");\r\nCanhbao12 = WriteIf((FiboCl &gt;  50 AND Ref( FiboCl,-1) &lt;= 50) OR (FiboCl &gt;  50 AND FiboAVG &gt; 50  AND FiboLo &lt;= 50 AND KCfibo &gt;0),"50% ","");\r\nCanhbao13 = WriteIf((FiboCl &gt;  61.8 AND Ref( FiboCl,-1) &lt;= 61.8) OR (FiboCl &gt;  61.8 AND FiboAVG &gt; 61.8  AND FiboLo &lt;= 61.8 AND KCfibo &gt;0),"61.8% ","");\r\nCanhbao14 = WriteIf((FiboCl &gt;  78.6 AND Ref( FiboCl,-1) &lt;= 78.6) OR (FiboCl &gt;  78.6 AND FiboAVG &gt; 78.6  AND FiboLo &lt;= 78.6 AND KCfibo &gt;0),"78.6% ","");\r\nCanhbao15 = WriteIf((FiboCl &gt;  100 AND Ref( FiboCl,-1) &lt;= 100) OR (FiboCl &gt;  100 AND FiboAVG &gt; 100  AND FiboLo &lt;= 100 AND KCfibo &gt;0),"100% ","");\r\nCanhbao16 = WriteIf((FiboCl &gt;  127.2 AND Ref( FiboCl,-1) &lt;= 127.2) OR (FiboCl &gt;  127.2 AND FiboAVG &gt; 127.2  AND FiboLo &lt;= 127.2 AND KCfibo &gt;0),"127.2% ","");\r\nCanhbao17 = WriteIf((FiboCl &gt;  161.8 AND Ref( FiboCl,-1) &lt;= 161.8) OR (FiboCl &gt;  161.8 AND FiboAVG &gt; 161.8  AND FiboLo &lt;= 161.8 AND KCfibo &gt;0),"161.8% ","");\r\nCanhbao17bs = WriteIf((FiboCl &gt;  200 AND Ref( FiboCl,-1) &lt;= 200) OR (FiboCl &gt;  200 AND FiboAVG &gt; 200  AND FiboLo &lt;= 200 AND KCfibo &gt;0),"200% ","");\r\n// canh bao giam 2 nen\r\nCanhbao1abs = WriteIf((FiboCl &lt;=  -200 AND Ref( FiboCl,-1) &gt; -200) OR (FiboCl &lt;=  -200 AND FiboAVG &lt;= -200 AND FiboHi &gt; -200 AND KCfibo &lt;=0),"-200% ","");\r\nCanhbao1a = WriteIf((FiboCl &lt;=  -161.8 AND Ref( FiboCl,-1) &gt; -161.8) OR (FiboCl &lt;=  -161.8 AND FiboAVG &lt;= -161.8 AND FiboHi &gt; -161.8 AND KCfibo &lt;=0),"-161.8% ","");\r\nCanhbao2a = WriteIf((FiboCl &lt;=  -127.2 AND Ref( FiboCl,-1) &gt; -127.2) OR (FiboCl &lt;=  -127.2 AND FiboAVG &lt;= -127.2  AND FiboHi &gt; -127.2 AND KCfibo &lt;=0),"-127.2% ","");\r\nCanhbao3a = WriteIf((FiboCl &lt;=  -100 AND Ref( FiboCl,-1) &gt; -100) OR (FiboCl &lt;=  -100 AND FiboAVG &lt;= -100  AND FiboHi &gt; -100 AND KCfibo &lt;=0),"-100% ","");\r\nCanhbao4a = WriteIf((FiboCl &lt;=  -78.6 AND Ref( FiboCl,-1) &gt; -78.6) OR (FiboCl &lt;=  -78.6 AND FiboAVG &lt;= -78.6  AND FiboHi &gt; -78.6 AND KCfibo &lt;=0),"-78.6% ","");\r\nCanhbao5a = WriteIf((FiboCl &lt;=  -61.8 AND Ref( FiboCl,-1) &gt; -61.8) OR (FiboCl &lt;=  -61.8 AND FiboAVG &lt;= -61.8  AND FiboHi &gt; -61.8 AND KCfibo &lt;=0),"-61.8% ","");\r\nCanhbao6a = WriteIf((FiboCl &lt;=  -50 AND Ref( FiboCl,-1) &gt; -50) OR (FiboCl &lt;=  -50 AND FiboAVG &lt;= -50  AND FiboHi &gt; -50 AND KCfibo &lt;=0),"-50% ","");\r\nCanhbao7a = WriteIf((FiboCl &lt;=  -38.2 AND Ref( FiboCl,-1) &gt; -38.2) OR (FiboCl &lt;=  -38.2 AND FiboAVG &lt;= -38.2  AND FiboHi &gt; -38.2 AND KCfibo &lt;=0),"-38.2% ","");\r\nCanhbao8a = WriteIf((FiboCl &lt;=  -23.6 AND Ref( FiboCl,-1) &gt; -23.6) OR (FiboCl &lt;=  -23.6 AND FiboAVG &lt;= -23.6  AND FiboHi &gt; -23.6 AND KCfibo &lt;=0),"-23.6% ","");\r\nCanhbao9a = WriteIf((FiboCl &lt;=  0 AND Ref( FiboCl,-1) &gt; 0) OR (FiboCl &lt;=  0 AND FiboAVG &lt;= 0  AND FiboHi &gt; 0 AND KCfibo &lt;=0),"0% ","");\r\nCanhbao10a = WriteIf((FiboCl &lt;=  23.6 AND Ref( FiboCl,-1) &gt; 23.6) OR (FiboCl &lt;=  23.6 AND FiboAVG &lt;= 23.6  AND FiboHi &gt; 23.6 AND KCfibo &lt;=0),"23.6% ","");\r\nCanhbao11a = WriteIf((FiboCl &lt;=  38.2 AND Ref( FiboCl,-1) &gt; 38.2) OR (FiboCl &lt;=  38.2 AND FiboAVG &lt;= 38.2  AND FiboHi &gt; 38.2 AND KCfibo &lt;=0),"38.2% ","");\r\nCanhbao12a = WriteIf((FiboCl &lt;=  50 AND Ref( FiboCl,-1) &gt; 50) OR (FiboCl &lt;=  50 AND FiboAVG &lt;= 50  AND FiboHi &gt; 50 AND KCfibo &lt;=0),"50% ","");\r\nCanhbao13a = WriteIf((FiboCl &lt;=  61.8 AND Ref( FiboCl,-1) &gt; 61.8) OR (FiboCl &lt;=  61.8 AND FiboAVG &lt;= 61.8  AND FiboHi &gt; 61.8 AND KCfibo &lt;=0),"61.8% ","");\r\nCanhbao14a = WriteIf((FiboCl &lt;=  78.6 AND Ref( FiboCl,-1) &gt; 78.6) OR (FiboCl &lt;=  78.6 AND FiboAVG &lt;= 78.6  AND FiboHi &gt; 78.6 AND KCfibo &lt;=0),"78.6% ","");\r\nCanhbao15a = WriteIf((FiboCl &lt;=  100 AND Ref( FiboCl,-1) &gt; 100) OR (FiboCl &lt;=  100 AND FiboAVG &lt;= 100  AND FiboHi &gt; 100 AND KCfibo &lt;=0),"100% ","");\r\nCanhbao16a = WriteIf((FiboCl &lt;=  127.2 AND Ref( FiboCl,-1) &gt; 127.2) OR (FiboCl &lt;=  127.2 AND FiboAVG &lt;= 127.2  AND FiboHi &gt; 127.2 AND KCfibo &lt;=0),"127.2% ","");\r\nCanhbao17a = WriteIf((FiboCl &lt;=  161.8 AND Ref( FiboCl,-1) &gt; 161.8) OR (FiboCl &lt;=  161.8 AND FiboAVG &lt;= 161.8  AND FiboHi &gt; 161.8 AND KCfibo &lt;=0),"161.8% ","");\r\nCanhbao17abs = WriteIf((FiboCl &lt;=  200 AND Ref( FiboCl,-1) &gt; 200) OR (FiboCl &lt;=  200 AND FiboAVG &lt;= 200  AND FiboHi &gt; 200 AND KCfibo &lt;=0),"200% ","");\r\nTinhieu2nenGiam = IIf(\t\t(FiboCl &lt;=  -200 AND Ref( FiboCl,-1) &gt; -200) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -161.8 AND Ref( FiboCl,-1) &gt; -161.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -127.2 AND Ref( FiboCl,-1) &gt; -127.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -100 AND Ref( FiboCl,-1) &gt; -100) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -78.6 AND Ref( FiboCl,-1) &gt; -78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -61.8 AND Ref( FiboCl,-1) &gt; -61.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -50 AND Ref( FiboCl,-1) &gt; -50) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -38.2 AND Ref( FiboCl,-1) &gt; -38.2) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -23.6 AND Ref( FiboCl,-1) &gt; -23.6) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  0 AND Ref( FiboCl,-1) &gt; 0) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  23.6 AND Ref( FiboCl,-1) &gt; 23.6) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  38.2 AND Ref( FiboCl,-1) &gt; 38.2) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  50 AND Ref( FiboCl,-1) &gt; 50) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  61.8 AND Ref( FiboCl,-1) &gt; 61.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  78.6 AND Ref( FiboCl,-1) &gt; 78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  100 AND Ref( FiboCl,-1) &gt; 100) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  127.2 AND Ref( FiboCl,-1) &gt; 127.2) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  161.8 AND Ref( FiboCl,-1) &gt; 161.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  200 AND Ref( FiboCl,-1) &gt; 200) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -200 AND FiboAVG &lt;= -200 AND FiboHi &gt; -200 AND KCfibo &lt;=0) OR\r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -161.8 AND FiboAVG &lt;= -161.8 AND FiboHi &gt; -161.8 AND KCfibo &lt;=0 ) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -127.2 AND FiboAVG &lt;= -127.2  AND FiboHi &gt; -127.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -100 AND FiboAVG &lt;= -100  AND FiboHi &gt; -100 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -78.6 AND FiboAVG &lt;= -78.6  AND FiboHi &gt; -78.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -61.8 AND FiboAVG &lt;= -61.8  AND FiboHi &gt; -61.8 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -50 AND FiboAVG &lt;= -50  AND FiboHi &gt; -50 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -38.2 AND FiboAVG &lt;= -38.2  AND FiboHi &gt; -38.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  -23.6 AND FiboAVG &lt;= -23.6  AND FiboHi &gt; -23.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  0 AND FiboAVG &lt;= 0  AND FiboHi &gt; 0 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  23.6 AND FiboAVG &lt;= 23.6  AND FiboHi &gt; 23.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  38.2 AND FiboAVG &lt;= 38.2  AND FiboHi &gt; 38.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  50 AND FiboAVG &lt;= 50  AND FiboHi &gt; 50 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  61.8 AND FiboAVG &lt;= 61.8  AND FiboHi &gt; 61.8 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  78.6 AND FiboAVG &lt;= 78.6  AND FiboHi &gt; 78.6 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  100 AND FiboAVG &lt;= 100  AND FiboHi &gt; 100 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  127.2 AND FiboAVG &lt;= 127.2  AND FiboHi &gt; 127.2 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  161.8 AND FiboAVG &lt;= 161.8  AND FiboHi &gt; 161.8 AND KCfibo &lt;=0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  200 AND FiboAVG &lt;= 200  AND FiboHi &gt; 200 AND KCfibo &lt;=0),-2,0);\r\n\t\t\t\t\t\t\t\r\nTinhieu2nenTang =IIf ( \t\t(FiboCl &gt;  -200 AND Ref( FiboCl,-1) &lt;= -200) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -161.8 AND Ref( FiboCl,-1) &lt;= -161.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -127.2 AND Ref( FiboCl,-1) &lt;= -127.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -100 AND Ref( FiboCl,-1) &lt;= -100) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -78.6 AND Ref( FiboCl,-1) &lt;= -78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -61.8 AND Ref( FiboCl,-1) &lt;= -61.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -50 AND Ref( FiboCl,-1) &lt;= -50) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -38.2 AND Ref( FiboCl,-1) &lt;= -38.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -23.6 AND Ref( FiboCl,-1) &lt;= -23.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  0 AND Ref( FiboCl,-1) &lt;= 0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  23.6 AND Ref( FiboCl,-1) &lt;= 23.6) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  38.2 AND Ref( FiboCl,-1) &lt;= 38.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  50 AND Ref( FiboCl,-1) &lt;= 50) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  61.8 AND Ref( FiboCl,-1) &lt;= 61.8) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  78.6 AND Ref( FiboCl,-1) &lt;= 78.6) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  100 AND Ref( FiboCl,-1) &lt;= 100) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  127.2 AND Ref( FiboCl,-1) &lt;= 127.2) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  161.8 AND Ref( FiboCl,-1) &lt;= 161.8) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  200 AND Ref( FiboCl,-1) &lt;= 200) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -200 AND FiboAVG &gt; -200 AND FiboLo &lt;= -200 AND KCfibo &gt;0) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  -161.8 AND FiboAVG &gt; -161.8 AND FiboLo &lt;= -161.8 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -127.2 AND FiboAVG &gt; -127.2  AND FiboLo &lt;= -127.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -100 AND FiboAVG &gt; -100  AND FiboLo &lt;= -100 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -78.6 AND FiboAVG &gt; -78.6  AND FiboLo &lt;= -78.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -61.8 AND FiboAVG &gt; -61.8  AND FiboLo &lt;= -61.8 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -50 AND FiboAVG &gt; -50  AND FiboLo &lt;= -50 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -38.2 AND FiboAVG &gt; -38.2  AND FiboLo &lt;= -38.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  -23.6 AND FiboAVG &gt; -23.6  AND FiboLo &lt;= -23.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  0 AND FiboAVG &gt; 0  AND FiboLo &lt;= 0 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  23.6 AND FiboAVG &gt; 23.6  AND FiboLo &lt;= 23.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  38.2 AND FiboAVG &gt; 38.2  AND FiboLo &lt;= 38.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  50 AND FiboAVG &gt; 50  AND FiboLo &lt;= 50 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  61.8 AND FiboAVG &gt; 61.8  AND FiboLo &lt;= 61.8 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  78.6 AND FiboAVG &gt; 78.6  AND FiboLo &lt;= 78.6 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  100 AND FiboAVG &gt; 100  AND FiboLo &lt;= 100 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &lt;=  127.2 AND FiboAVG &lt;= 127.2  AND FiboHi &gt; 127.2 AND KCfibo &gt;0) OR \r\n\t\t\t\t\t\t\t(FiboCl &gt;  161.8 AND FiboAVG &gt; 161.8  AND FiboLo &lt;= 161.8 AND KCfibo &gt;0) OR\r\n\t\t\t\t\t\t\t(FiboCl &gt;  200 AND FiboAVG &gt; 200  AND FiboLo &lt;= 200 AND KCfibo &gt;0),2,0);\r\nCanhbaoTang = Canhbao1bs + Canhbao1 + Canhbao2 + Canhbao3 + Canhbao4 + Canhbao5 + Canhbao6 + Canhbao7 + Canhbao8 + Canhbao9 + Canhbao10 + Canhbao11 + Canhbao12 + Canhbao13 + Canhbao14 + Canhbao15 + Canhbao16 + Canhbao17 + Canhbao17bs;\r\nNoiChuoi2nentang = WriteIf(Tinhieu2nenTang ==2,"Cat len: " +CanhbaoTang ,"");\r\nCanhbaogiam = Canhbao17abs + Canhbao17a + Canhbao16a + Canhbao15a + Canhbao14a + Canhbao13a + Canhbao12a + Canhbao11a + Canhbao10a + Canhbao9a + Canhbao8a + Canhbao7a + Canhbao6a + Canhbao5a + Canhbao4a + Canhbao3a + Canhbao2a + Canhbao1a + Canhbao1abs; \r\nNoiChuoi2nengiam = WriteIf(Tinhieu2nenGiam ==-2,"Cat xuong: " +Canhbaogiam ,"");\r\nCanhbaoTh1 = NoiChuoi2nentang + NoiChuoi2nengiam;\t\t\t\t\t\t\t\r\nMau2nen = IIf(Tinhieu2nenTang ==2,colorGreen,IIf( Tinhieu2nenGiam ==-2,\tcolorRed, colorDefault));\t\t\t\t\t\r\n\r\n/////Fibo Time\r\n//Diem2 = IIf(TrendPivot &gt; 0 ,LowPivot,HighPivot);\r\nKCFibotime = \tabs(LastValue( BarsSince(BuyPivot)) - LastValue(BarsSince(SellPivot)));\r\nKCGiatime  =  IIf(TrendPivot &gt; 0 ,LastValue( BarsSince(BuyPivot)),LastValue(BarsSince(SellPivot))) -BarsSince(C);\r\n//AddColumn( KCFibotime , "KC Fibo Time" , 1 , colorDefault);\t\t\r\n//AddColumn( KCGiatime , "Gia Time" , 1 , colorDefault);\t\t\r\nDvFiboTime = KCFibotime/100;\r\nFibotimeGia =IIf(TrendPivot &gt; 0, KCGiatime/ DvFiboTime,KCGiatime/ DvFiboTime*-1);\r\nAddColumn( FibotimeGia , "FiboTime" , 1 ,  IIf(FibotimeGia&gt; 0, colorGreen, IIf(FibotimeGia &lt; 0, colorRed, colorDefault)));\t\t\r\nAddTextColumn(CanhbaoTh1 , "Tin hieu Fibo", 1.2, Mau2nen , colorDefault);\t\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////\r\nTrenhienthi = IIf(TrendPivot &gt;0,TrendPivot -1, TrendPivot +1);\r\nlaytexthienthi ="Pivot: "+LastValue(TrendPivot)+" // " +LastValue(TanggiamPivot)+"%" + "\\n   "+"                   Fibo: " + prec(LastValue(FiboCl),0)+"%" + "\\n   "+"                   Fibo Time:" +prec(LastValue(FibotimeGia),0)+"%"  ;\r\ncline=ParamToggle("Gia Nen", "Show|Hide",0);\r\nPriceLineColor=ParamColor("PriceLineColor",colorRed|styleNoLabel);\r\nPriceLevel = LastValue( Prec(Close,2));\r\nDaysback    = Param("Bars Back",100,10,500,1); \r\nFirstBar    = BarCount - DaysBack; \r\nYY          = IIf(BarIndex() &gt;= Firstbar,EndValue(PriceLevel),Null); \r\nside = Param("side",1,0,1000,1);\r\ndist = 0; \r\nif(cline==0)\r\n{\r\nfor( i = 0; i &lt; BarCount; i++ ) \r\n{\r\n if(i+side== BarCount) PlotText( "........."+"      =&gt;   " + PriceLevel[ i ]+" // " +WriteVal(LastValue((C/Ref(C,-1)-1)*100),1.2)+"% ", i, YY[ i ]-dist[i], colorYellow );\r\n if(i+side== BarCount) PlotText( "\\n                      "+laytexthienthi+"", i, YY[ i ]-dist[i], colorWhite ); \r\n}\r\n}\r\n\r\n//Tu ve Fibo theo Pivot\r\nLevel0 \t\t=IIf(TrendPivot &gt;0,LowPivot,HighPivot); \r\nLevel6 \t= IIf(TrendPivot &gt; 0 ,HighPivot,LowPivot);\r\ndonviFibo = (Level6 - Level0)/100;\r\nLevel1 = Level0 + 23.6*donviFibo;\r\nLevel2 = Level0 + 38.2*donviFibo;\r\nLevel3 = Level0 + 50*donviFibo;\r\nLevel4 = Level0 + 61.8*donviFibo;\r\nLevel5 = Level0 + 78.6*donviFibo;\r\nLevel7 = Level0 + 127.2*donviFibo;\r\nLevel8 = Level0 + 161.8*donviFibo;\r\nLevel9 = Level0 + 200*donviFibo;\r\nLevel0name = "0%";\r\nLevel1name = WriteIf(LastValue(TrendPivot) &gt;0,"23.6%","-23.6%");\r\nLevel2name = WriteIf(LastValue(TrendPivot) &gt;0,"38.2%","-38.2%");\r\nLevel3name = WriteIf(LastValue(TrendPivot) &gt;0,"50%","-50%");\r\nLevel4name = WriteIf(LastValue(TrendPivot) &gt;0,"61.8%","-61.8%");\r\nLevel5name = WriteIf(LastValue(TrendPivot) &gt;0,"78.6%","-78.6%");\r\nLevel6name = WriteIf(LastValue(TrendPivot) &gt;0,"100%","-100%");\r\nLevel7name = WriteIf(LastValue(TrendPivot) &gt;0,"127.2%","-127.2%");\r\nLevel8name = WriteIf(LastValue(TrendPivot) &gt;0,"161.8%","-161.8%");\r\nLevel9name = WriteIf(LastValue(TrendPivot) &gt;0,"200%","-200%");\r\nChieudaibentrai = -1;\r\nNenmua = LastValue(ValueWhen(BuyPivot, Ref(BarIndex(),Chieudaibentrai)));\r\nNenban = LastValue(ValueWhen(SellPivot, Ref(BarIndex(),Chieudaibentrai)));\r\naaaa =Min(Nenmua,Nenban);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level0),Null),Level0name,colorWhite ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level1),Null),Level1name,colorLightBlue ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level2),Null),Level2name,colorRed ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level3),Null),Level3name,colorBrightGreen ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level4),Null),Level4name,colorBlue ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level5),Null),Level5name,colorYellow ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level6),Null),Level6name,colorBrightGreen ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level7),Null),Level7name,colorWhite ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level8),Null),Level8name,colorLightBlue ,styleThick);\r\nPlot(IIf(BarIndex() &gt;= aaaa,LastValue(Level9),Null),Level9name,colorRed ,styleThick);\r\n\r\nKCbenphai = 1;\r\nPlotText(""+Prec(LastValue(Level0),2), BarCount + KCbenphai, LastValue(Level0), colorWhite); //Ben phai\r\nPlotText(""+Prec(LastValue(Level1),2), BarCount + KCbenphai, LastValue(Level1), colorLightBlue); //Ben phai\r\nPlotText(""+Prec(LastValue(Level2),2), BarCount + KCbenphai, LastValue(Level2), colorRed); //Ben phai\r\nPlotText(""+Prec(LastValue(Level3),2), BarCount + KCbenphai, LastValue(Level3), colorBrightGreen); //Ben phai\r\nPlotText(""+Prec(LastValue(Level4),2), BarCount + KCbenphai, LastValue(Level4), colorBlue); //Ben phai\r\nPlotText(""+Prec(LastValue(Level5),2), BarCount + KCbenphai, LastValue(Level5), colorYellow); //Ben phai\r\nPlotText(""+Prec(LastValue(Level6),2), BarCount + KCbenphai, LastValue(Level6), colorBrightGreen); //Ben phai\r\nPlotText(""+Prec(LastValue(Level7),2), BarCount + KCbenphai, LastValue(Level7), colorWhite); //Ben phai\r\nPlotText(""+Prec(LastValue(Level8),2), BarCount + KCbenphai, LastValue(Level8), colorLightBlue); //Ben phai\r\nPlotText(""+Prec(LastValue(Level9),2), BarCount + KCbenphai, LastValue(Level9), colorRed); //Ben phai\r\n\r\nKCbentrai = -2;\r\nPlotText(Level0name, aaaa + KCbentrai, LastValue(Level0),  colorWhite); // Ben trai\r\nPlotText(Level1name, aaaa + KCbentrai, LastValue(Level1),  colorLightBlue); // Ben trai\r\nPlotText(Level2name, aaaa + KCbentrai, LastValue(Level2),  colorRed); // Ben trai\r\nPlotText(Level3name, aaaa + KCbentrai, LastValue(Level3),  colorBrightGreen); // Ben trai\r\nPlotText(Level4name, aaaa + KCbentrai, LastValue(Level4),  colorBlue); // Ben trai\r\nPlotText(Level5name, aaaa + KCbentrai, LastValue(Level5),  colorYellow); // Ben trai\r\nPlotText(Level6name, aaaa + KCbentrai, LastValue(Level6),  colorBrightGreen); // Ben trai\r\nPlotText(Level7name, aaaa + KCbentrai, LastValue(Level7),  colorWhite); // Ben trai\r\nPlotText(Level8name, aaaa + KCbentrai, LastValue(Level8),  colorLightBlue); // Ben trai\r\nPlotText(Level9name, aaaa + KCbentrai, LastValue(Level9),  colorRed); // Ben trai\r\n\r\nFilter = MA(C,20) &gt;=3  AND dieukienbb&gt;=2  AND Dieukienthoigianvanhanh&gt;=2 AND FibotimeGia&gt;=23.6 AND FiboCl &gt;=23.6 AND FiboCl &lt;=38.2;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n</FormulaContent>
<ApplyTo>0</ApplyTo>
<RangeType>2</RangeType>
<RangeAmount>1</RangeAmount>
<FromDate>2023-12-18 00:00:00</FromDate>
<ToDate>2023-12-18</ToDate>
<SyncOnSelect>0</SyncOnSelect>
<RunEvery>0</RunEvery>
<RunEveryInterval>5min</RunEveryInterval>
<IncludeFilter>
<ExcludeMode>0</ExcludeMode>
<OrSelection>0</OrSelection>
<Favourite>0</Favourite>
<Index>0</Index>
<Type0>0</Type0>
<Category0>-1</Category0>
<Type1>1</Type1>
<Category1>-1</Category1>
<Type2>2</Type2>
<Category2>-1</Category2>
<Type3>3</Type3>
<Category3>-1</Category3>
<Type4>4</Type4>
<Category4>-1</Category4>
<Type5>5</Type5>
<Category5>-1</Category5>
<Type6>6</Type6>
<Category6>-1</Category6>
</IncludeFilter>
<ExcludeFilter>
<ExcludeMode>1</ExcludeMode>
<OrSelection>0</OrSelection>
<Favourite>0</Favourite>
<Index>0</Index>
<Type0>0</Type0>
<Category0>-1</Category0>
<Type1>1</Type1>
<Category1>-1</Category1>
<Type2>2</Type2>
<Category2>-1</Category2>
<Type3>3</Type3>
<Category3>-1</Category3>
<Type4>4</Type4>
<Category4>-1</Category4>
<Type5>5</Type5>
<Category5>-1</Category5>
<Type6>6</Type6>
<Category6>-1</Category6>
</ExcludeFilter>
</General>
<BacktestSettings>
<InitialEquity>10000</InitialEquity>
<TradeFlags>1</TradeFlags>
<MaxLossStopMode>0</MaxLossStopMode>
<MaxLossStopValue>0</MaxLossStopValue>
<MaxLossStopAtStop>0</MaxLossStopAtStop>
<ProfitStopMode>0</ProfitStopMode>
<ProfitStopValue>0</ProfitStopValue>
<ProfitStopAtStop>0</ProfitStopAtStop>
<TrailingStopMode>0</TrailingStopMode>
<TrailingStopPeriods>0</TrailingStopPeriods>
<TrailingStopValue>0</TrailingStopValue>
<TrailingStopAtStop>0</TrailingStopAtStop>
<CommissionMode>0</CommissionMode>
<CommissionValue>0</CommissionValue>
<BuyPriceField>0</BuyPriceField>
<BuyDelay>0</BuyDelay>
<SellPriceField>0</SellPriceField>
<SellDelay>0</SellDelay>
<ShortPriceField>0</ShortPriceField>
<ShortDelay>0</ShortDelay>
<CoverPriceField>0</CoverPriceField>
<CoverDelay>0</CoverDelay>
<ReportSystemFormula>0</ReportSystemFormula>
<ReportSystemSettings>0</ReportSystemSettings>
<ReportOverallSummary>1</ReportOverallSummary>
<ReportSummary>1</ReportSummary>
<ReportTradeList>1</ReportTradeList>
<LoadRemainingQuotes>1</LoadRemainingQuotes>
<Periodicity>0</Periodicity>
<InterestRate>0</InterestRate>
<ReportOutPositions>1</ReportOutPositions>
<UseConstantPriceArrays>0</UseConstantPriceArrays>
<PointsOnlyTest>0</PointsOnlyTest>
<AllowShrinkingPosition>0</AllowShrinkingPosition>
<RangeType>2</RangeType>
<RangeLength>0</RangeLength>
<RangeFromDate>2023-12-18 00:00:00</RangeFromDate>
<RangeToDate>2023-12-18</RangeToDate>
<ApplyTo>0</ApplyTo>
<FilterQty>2</FilterQty>
<IncludeFilter>
<ExcludeMode>0</ExcludeMode>
<OrSelection>0</OrSelection>
<Favourite>0</Favourite>
<Index>0</Index>
<Type0>0</Type0>
<Category0>-1</Category0>
<Type1>1</Type1>
<Category1>-1</Category1>
<Type2>2</Type2>
<Category2>-1</Category2>
<Type3>3</Type3>
<Category3>-1</Category3>
<Type4>4</Type4>
<Category4>-1</Category4>
<Type5>5</Type5>
<Category5>-1</Category5>
<Type6>6</Type6>
<Category6>-1</Category6>
</IncludeFilter>
<ExcludeFilter>
<ExcludeMode>1</ExcludeMode>
<OrSelection>0</OrSelection>
<Favourite>0</Favourite>
<Index>0</Index>
<Type0>0</Type0>
<Category0>-1</Category0>
<Type1>1</Type1>
<Category1>-1</Category1>
<Type2>2</Type2>
<Category2>-1</Category2>
<Type3>3</Type3>
<Category3>-1</Category3>
<Type4>4</Type4>
<Category4>-1</Category4>
<Type5>5</Type5>
<Category5>-1</Category5>
<Type6>6</Type6>
<Category6>-1</Category6>
</ExcludeFilter>
<UseOptimizedEvaluation>0</UseOptimizedEvaluation>
<BacktestRangeType>0</BacktestRangeType>
<BacktestRangeLength>1</BacktestRangeLength>
<BacktestRangeFromDate>Invalid DateTime.</BacktestRangeFromDate>
<BacktestRangeToDate>Invalid DateTime.</BacktestRangeToDate>
<MarginRequirement>100</MarginRequirement>
<SameDayStops>0</SameDayStops>
<RoundLotSize>0</RoundLotSize>
<TickSize>0</TickSize>
<DrawdownPriceField>0</DrawdownPriceField>
<ReverseSignalForcesExit>1</ReverseSignalForcesExit>
<NoDefaultColumns>0</NoDefaultColumns>
<AllowSameBarExit>1</AllowSameBarExit>
<ExtensiveOptimizationWarning>1</ExtensiveOptimizationWarning>
<WaitForBackfill>0</WaitForBackfill>
<MaxRanked>4</MaxRanked>
<MaxTraded>4</MaxTraded>
<MaxTracked>100</MaxTracked>
<PortfolioReportMode>0</PortfolioReportMode>
<MinShares>0.1</MinShares>
<SharpeRiskFreeReturn>5</SharpeRiskFreeReturn>
<PortfolioMode>0</PortfolioMode>
<PriceBoundCheck>1</PriceBoundCheck>
<AlignToReferenceSymbol>0</AlignToReferenceSymbol>
<ReferenceSymbol>^DJI</ReferenceSymbol>
<UPIRiskFreeReturn>5.4</UPIRiskFreeReturn>
<NBarStopMode>0</NBarStopMode>
<NBarStopValue>0</NBarStopValue>
<NBarStopReentryDelay>0</NBarStopReentryDelay>
<MaxLossStopReentryDelay>0</MaxLossStopReentryDelay>
<ProfitStopReentryDelay>0</ProfitStopReentryDelay>
<TrailingStopReentryDelay>0</TrailingStopReentryDelay>
<AddFutureBars>0</AddFutureBars>
<DistChartSpacing>5</DistChartSpacing>
<ProfitDistribution>1</ProfitDistribution>
<MAFEDistribution>1</MAFEDistribution>
<IndividualDetailedReports>0</IndividualDetailedReports>
<PortfolioReportTradeList>1</PortfolioReportTradeList>
<LimitTradeSizeAsPctVol>10</LimitTradeSizeAsPctVol>
<DisableSizeLimitWhenVolumeIsZero>1</DisableSizeLimitWhenVolumeIsZero>
<UsePrevBarEquityForPosSizing>0</UsePrevBarEquityForPosSizing>
<NBarStopHasPriority>0</NBarStopHasPriority>
<UseCustomBacktestProc>0</UseCustomBacktestProc>
<CustomBacktestProcFormulaPath/>
<MinPosValue>0</MinPosValue>
<MaxPosValue>0</MaxPosValue>
<ChartInterval>0</ChartInterval>
<DisableRuinStop>0</DisableRuinStop>
<OptTarget>CAR/MDD</OptTarget>
<WFMode>0</WFMode>
<GenerateReport>1</GenerateReport>
<MaxLongPos>0</MaxLongPos>
<MaxShortPos>0</MaxShortPos>
<SeparateLongShortRank>0</SeparateLongShortRank>
<TotalSymbolQty>7426</TotalSymbolQty>
<EnableUserReportCharts>1</EnableUserReportCharts>
<ChartWidth>800</ChartWidth>
<ChartHeight>480</ChartHeight>
<SettlementDelay>0</SettlementDelay>
<PortfolioReportSystemFormula>1</PortfolioReportSystemFormula>
<InterestRateSymbol/>
<MarginRate>0</MarginRate>
<IncludeBHStats>1</IncludeBHStats>
<BHSymbol>^DJI</BHSymbol>
<MCEnable>1</MCEnable>
<MCRuns>1000</MCRuns>
<MCPosSizeMethod>0</MCPosSizeMethod>
<MCPosSizeShares>100</MCPosSizeShares>
<MCPosSizeValue>1000</MCPosSizeValue>
<MCPosSizePctEquity>5</MCPosSizePctEquity>
<MCChartEquityCurves>1</MCChartEquityCurves>
<MCStrawBroomLines>0</MCStrawBroomLines>
<Scenario>0</Scenario>
<MCChartEquityScale>0</MCChartEquityScale>
<MCUseEquityChanges>0</MCUseEquityChanges>
<MCLogScaleFinalEquity>0</MCLogScaleFinalEquity>
<MCLogScaleDrawdown>0</MCLogScaleDrawdown>
<MCNegativeDrawdown>1</MCNegativeDrawdown>
<ISEnabled>1</ISEnabled>
<ISStartDate>2000-01-01</ISStartDate>
<ISEndDate>2004-01-01</ISEndDate>
<ISLastDate>2018-01-01</ISLastDate>
<ISStep>1</ISStep>
<ISStepUnit>3</ISStepUnit>
<ISAnchored>0</ISAnchored>
<ISLastUsesToday>1</ISLastUsesToday>
<OSEnabled>1</OSEnabled>
<OSStartDate>2004-01-01</OSStartDate>
<OSEndDate>2005-01-01</OSEndDate>
<OSLastDate>2018-01-01</OSLastDate>
<OSStep>1</OSStep>
<OSStepUnit>3</OSStepUnit>
<OSAnchored>0</OSAnchored>
<OSLastUsesToday>1</OSLastUsesToday>
</BacktestSettings>
</AmiBroker-Analysis>
